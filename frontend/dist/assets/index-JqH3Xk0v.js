(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();/**
* @vue/shared v3.5.16
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Ma(i){const e=Object.create(null);for(const t of i.split(","))e[t]=1;return t=>t in e}const He={},Si=[],ls=()=>{},Ug=()=>!1,Nr=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),Na=i=>i.startsWith("onUpdate:"),lt=Object.assign,Ba=(i,e)=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)},Gg=Object.prototype.hasOwnProperty,Ne=(i,e)=>Gg.call(i,e),ye=Array.isArray,Ai=i=>_n(i)==="[object Map]",Mi=i=>_n(i)==="[object Set]",Pl=i=>_n(i)==="[object Date]",Le=i=>typeof i=="function",Ze=i=>typeof i=="string",Wt=i=>typeof i=="symbol",je=i=>i!==null&&typeof i=="object",pd=i=>(je(i)||Le(i))&&Le(i.then)&&Le(i.catch),yd=Object.prototype.toString,_n=i=>yd.call(i),Vg=i=>_n(i).slice(8,-1),vd=i=>_n(i)==="[object Object]",$a=i=>Ze(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,Yi=Ma(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Br=i=>{const e=Object.create(null);return t=>e[t]||(e[t]=i(t))},Hg=/-(\w)/g,Bt=Br(i=>i.replace(Hg,(e,t)=>t?t.toUpperCase():"")),Kg=/\B([A-Z])/g,di=Br(i=>i.replace(Kg,"-$1").toLowerCase()),$r=Br(i=>i.charAt(0).toUpperCase()+i.slice(1)),uo=Br(i=>i?`on${$r(i)}`:""),Gs=(i,e)=>!Object.is(i,e),Xn=(i,...e)=>{for(let t=0;t<i.length;t++)i[t](...e)},xd=(i,e,t,s=!1)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,writable:s,value:t})},mr=i=>{const e=parseFloat(i);return isNaN(e)?i:e},jg=i=>{const e=Ze(i)?Number(i):NaN;return isNaN(e)?i:e};let Ol;const Ur=()=>Ol||(Ol=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ua(i){if(ye(i)){const e={};for(let t=0;t<i.length;t++){const s=i[t],n=Ze(s)?zg(s):Ua(s);if(n)for(const r in n)e[r]=n[r]}return e}else if(Ze(i)||je(i))return i}const Wg=/;(?![^(]*\))/g,qg=/:([^]+)/,Yg=/\/\*[^]*?\*\//g;function zg(i){const e={};return i.replace(Yg,"").split(Wg).forEach(t=>{if(t){const s=t.split(qg);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function Kt(i){let e="";if(Ze(i))e=i;else if(ye(i))for(let t=0;t<i.length;t++){const s=Kt(i[t]);s&&(e+=s+" ")}else if(je(i))for(const t in i)i[t]&&(e+=t+" ");return e.trim()}const Xg="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Qg=Ma(Xg);function Ed(i){return!!i||i===""}function Jg(i,e){if(i.length!==e.length)return!1;let t=!0;for(let s=0;t&&s<i.length;s++)t=Ln(i[s],e[s]);return t}function Ln(i,e){if(i===e)return!0;let t=Pl(i),s=Pl(e);if(t||s)return t&&s?i.getTime()===e.getTime():!1;if(t=Wt(i),s=Wt(e),t||s)return i===e;if(t=ye(i),s=ye(e),t||s)return t&&s?Jg(i,e):!1;if(t=je(i),s=je(e),t||s){if(!t||!s)return!1;const n=Object.keys(i).length,r=Object.keys(e).length;if(n!==r)return!1;for(const o in i){const a=i.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Ln(i[o],e[o]))return!1}}return String(i)===String(e)}function Ga(i,e){return i.findIndex(t=>Ln(t,e))}const bd=i=>!!(i&&i.__v_isRef===!0),ue=i=>Ze(i)?i:i==null?"":ye(i)||je(i)&&(i.toString===yd||!Le(i.toString))?bd(i)?ue(i.value):JSON.stringify(i,Td,2):String(i),Td=(i,e)=>bd(e)?Td(i,e.value):Ai(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[s,n],r)=>(t[fo(s,r)+" =>"]=n,t),{})}:Mi(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>fo(t))}:Wt(e)?fo(e):je(e)&&!ye(e)&&!vd(e)?String(e):e,fo=(i,e="")=>{var t;return Wt(i)?`Symbol(${(t=i.description)!=null?t:e})`:i};/**
* @vue/reactivity v3.5.16
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let gt;class Sd{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=gt,!e&&gt&&(this.index=(gt.scopes||(gt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=gt;try{return gt=this,e()}finally{gt=t}}}on(){++this._on===1&&(this.prevScope=gt,gt=this)}off(){this._on>0&&--this._on===0&&(gt=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,s;for(t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(this.effects.length=0,t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0}}}function Ad(i){return new Sd(i)}function _d(){return gt}function Zg(i,e=!1){gt&&gt.cleanups.push(i)}let We;const ho=new WeakSet;class Ld{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,gt&&gt.active&&gt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,ho.has(this)&&(ho.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Id(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Fl(this),kd(this);const e=We,t=jt;We=this,jt=!0;try{return this.fn()}finally{wd(this),We=e,jt=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Ka(e);this.deps=this.depsTail=void 0,Fl(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?ho.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Xo(this)&&this.run()}get dirty(){return Xo(this)}}let Rd=0,zi,Xi;function Id(i,e=!1){if(i.flags|=8,e){i.next=Xi,Xi=i;return}i.next=zi,zi=i}function Va(){Rd++}function Ha(){if(--Rd>0)return;if(Xi){let e=Xi;for(Xi=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let i;for(;zi;){let e=zi;for(zi=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){i||(i=s)}e=t}}if(i)throw i}function kd(i){for(let e=i.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function wd(i){let e,t=i.depsTail,s=t;for(;s;){const n=s.prevDep;s.version===-1?(s===t&&(t=n),Ka(s),em(s)):e=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=n}i.deps=e,i.depsTail=t}function Xo(i){for(let e=i.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Cd(e.dep.computed)||e.dep.version!==e.version))return!0;return!!i._dirty}function Cd(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===on)||(i.globalVersion=on,!i.isSSR&&i.flags&128&&(!i.deps&&!i._dirty||!Xo(i))))return;i.flags|=2;const e=i.dep,t=We,s=jt;We=i,jt=!0;try{kd(i);const n=i.fn(i._value);(e.version===0||Gs(n,i._value))&&(i.flags|=128,i._value=n,e.version++)}catch(n){throw e.version++,n}finally{We=t,jt=s,wd(i),i.flags&=-3}}function Ka(i,e=!1){const{dep:t,prevSub:s,nextSub:n}=i;if(s&&(s.nextSub=n,i.prevSub=void 0),n&&(n.prevSub=s,i.nextSub=void 0),t.subs===i&&(t.subs=s,!s&&t.computed)){t.computed.flags&=-5;for(let r=t.computed.deps;r;r=r.nextDep)Ka(r,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function em(i){const{prevDep:e,nextDep:t}=i;e&&(e.nextDep=t,i.prevDep=void 0),t&&(t.prevDep=e,i.nextDep=void 0)}let jt=!0;const Dd=[];function As(){Dd.push(jt),jt=!1}function _s(){const i=Dd.pop();jt=i===void 0?!0:i}function Fl(i){const{cleanup:e}=i;if(i.cleanup=void 0,e){const t=We;We=void 0;try{e()}finally{We=t}}}let on=0;class tm{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class ja{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!We||!jt||We===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==We)t=this.activeLink=new tm(We,this),We.deps?(t.prevDep=We.depsTail,We.depsTail.nextDep=t,We.depsTail=t):We.deps=We.depsTail=t,Pd(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const s=t.nextDep;s.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=s),t.prevDep=We.depsTail,t.nextDep=void 0,We.depsTail.nextDep=t,We.depsTail=t,We.deps===t&&(We.deps=s)}return t}trigger(e){this.version++,on++,this.notify(e)}notify(e){Va();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Ha()}}}function Pd(i){if(i.dep.sc++,i.sub.flags&4){const e=i.dep.computed;if(e&&!i.dep.subs){e.flags|=20;for(let s=e.deps;s;s=s.nextDep)Pd(s)}const t=i.dep.subs;t!==i&&(i.prevSub=t,t&&(t.nextSub=i)),i.dep.subs=i}}const pr=new WeakMap,ni=Symbol(""),Qo=Symbol(""),an=Symbol("");function yt(i,e,t){if(jt&&We){let s=pr.get(i);s||pr.set(i,s=new Map);let n=s.get(t);n||(s.set(t,n=new ja),n.map=s,n.key=t),n.track()}}function bs(i,e,t,s,n,r){const o=pr.get(i);if(!o){on++;return}const a=l=>{l&&l.trigger()};if(Va(),e==="clear")o.forEach(a);else{const l=ye(i),c=l&&$a(t);if(l&&t==="length"){const u=Number(s);o.forEach((d,f)=>{(f==="length"||f===an||!Wt(f)&&f>=u)&&a(d)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(an)),e){case"add":l?c&&a(o.get("length")):(a(o.get(ni)),Ai(i)&&a(o.get(Qo)));break;case"delete":l||(a(o.get(ni)),Ai(i)&&a(o.get(Qo)));break;case"set":Ai(i)&&a(o.get(ni));break}}Ha()}function sm(i,e){const t=pr.get(i);return t&&t.get(e)}function hi(i){const e=Pe(i);return e===i?e:(yt(e,"iterate",an),Mt(i)?e:e.map(ut))}function Gr(i){return yt(i=Pe(i),"iterate",an),i}const im={__proto__:null,[Symbol.iterator](){return go(this,Symbol.iterator,ut)},concat(...i){return hi(this).concat(...i.map(e=>ye(e)?hi(e):e))},entries(){return go(this,"entries",i=>(i[1]=ut(i[1]),i))},every(i,e){return fs(this,"every",i,e,void 0,arguments)},filter(i,e){return fs(this,"filter",i,e,t=>t.map(ut),arguments)},find(i,e){return fs(this,"find",i,e,ut,arguments)},findIndex(i,e){return fs(this,"findIndex",i,e,void 0,arguments)},findLast(i,e){return fs(this,"findLast",i,e,ut,arguments)},findLastIndex(i,e){return fs(this,"findLastIndex",i,e,void 0,arguments)},forEach(i,e){return fs(this,"forEach",i,e,void 0,arguments)},includes(...i){return mo(this,"includes",i)},indexOf(...i){return mo(this,"indexOf",i)},join(i){return hi(this).join(i)},lastIndexOf(...i){return mo(this,"lastIndexOf",i)},map(i,e){return fs(this,"map",i,e,void 0,arguments)},pop(){return Gi(this,"pop")},push(...i){return Gi(this,"push",i)},reduce(i,...e){return Ml(this,"reduce",i,e)},reduceRight(i,...e){return Ml(this,"reduceRight",i,e)},shift(){return Gi(this,"shift")},some(i,e){return fs(this,"some",i,e,void 0,arguments)},splice(...i){return Gi(this,"splice",i)},toReversed(){return hi(this).toReversed()},toSorted(i){return hi(this).toSorted(i)},toSpliced(...i){return hi(this).toSpliced(...i)},unshift(...i){return Gi(this,"unshift",i)},values(){return go(this,"values",ut)}};function go(i,e,t){const s=Gr(i),n=s[e]();return s!==i&&!Mt(i)&&(n._next=n.next,n.next=()=>{const r=n._next();return r.value&&(r.value=t(r.value)),r}),n}const nm=Array.prototype;function fs(i,e,t,s,n,r){const o=Gr(i),a=o!==i&&!Mt(i),l=o[e];if(l!==nm[e]){const d=l.apply(i,r);return a?ut(d):d}let c=t;o!==i&&(a?c=function(d,f){return t.call(this,ut(d),f,i)}:t.length>2&&(c=function(d,f){return t.call(this,d,f,i)}));const u=l.call(o,c,s);return a&&n?n(u):u}function Ml(i,e,t,s){const n=Gr(i);let r=t;return n!==i&&(Mt(i)?t.length>3&&(r=function(o,a,l){return t.call(this,o,a,l,i)}):r=function(o,a,l){return t.call(this,o,ut(a),l,i)}),n[e](r,...s)}function mo(i,e,t){const s=Pe(i);yt(s,"iterate",an);const n=s[e](...t);return(n===-1||n===!1)&&Ya(t[0])?(t[0]=Pe(t[0]),s[e](...t)):n}function Gi(i,e,t=[]){As(),Va();const s=Pe(i)[e].apply(i,t);return Ha(),_s(),s}const rm=Ma("__proto__,__v_isRef,__isVue"),Od=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(Wt));function om(i){Wt(i)||(i=String(i));const e=Pe(this);return yt(e,"has",i),e.hasOwnProperty(i)}class Fd{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,s){if(t==="__v_skip")return e.__v_skip;const n=this._isReadonly,r=this._isShallow;if(t==="__v_isReactive")return!n;if(t==="__v_isReadonly")return n;if(t==="__v_isShallow")return r;if(t==="__v_raw")return s===(n?r?pm:$d:r?Bd:Nd).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const o=ye(e);if(!n){let l;if(o&&(l=im[t]))return l;if(t==="hasOwnProperty")return om}const a=Reflect.get(e,t,Je(e)?e:s);return(Wt(t)?Od.has(t):rm(t))||(n||yt(e,"get",t),r)?a:Je(a)?o&&$a(t)?a:a.value:je(a)?n?Gd(a):li(a):a}}class Md extends Fd{constructor(e=!1){super(!1,e)}set(e,t,s,n){let r=e[t];if(!this._isShallow){const l=Hs(r);if(!Mt(s)&&!Hs(s)&&(r=Pe(r),s=Pe(s)),!ye(e)&&Je(r)&&!Je(s))return l?!1:(r.value=s,!0)}const o=ye(e)&&$a(t)?Number(t)<e.length:Ne(e,t),a=Reflect.set(e,t,s,Je(e)?e:n);return e===Pe(n)&&(o?Gs(s,r)&&bs(e,"set",t,s):bs(e,"add",t,s)),a}deleteProperty(e,t){const s=Ne(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&s&&bs(e,"delete",t,void 0),n}has(e,t){const s=Reflect.has(e,t);return(!Wt(t)||!Od.has(t))&&yt(e,"has",t),s}ownKeys(e){return yt(e,"iterate",ye(e)?"length":ni),Reflect.ownKeys(e)}}class am extends Fd{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const lm=new Md,cm=new am,um=new Md(!0);const Jo=i=>i,Dn=i=>Reflect.getPrototypeOf(i);function dm(i,e,t){return function(...s){const n=this.__v_raw,r=Pe(n),o=Ai(r),a=i==="entries"||i===Symbol.iterator&&o,l=i==="keys"&&o,c=n[i](...s),u=t?Jo:e?yr:ut;return!e&&yt(r,"iterate",l?Qo:ni),{next(){const{value:d,done:f}=c.next();return f?{value:d,done:f}:{value:a?[u(d[0]),u(d[1])]:u(d),done:f}},[Symbol.iterator](){return this}}}}function Pn(i){return function(...e){return i==="delete"?!1:i==="clear"?void 0:this}}function fm(i,e){const t={get(n){const r=this.__v_raw,o=Pe(r),a=Pe(n);i||(Gs(n,a)&&yt(o,"get",n),yt(o,"get",a));const{has:l}=Dn(o),c=e?Jo:i?yr:ut;if(l.call(o,n))return c(r.get(n));if(l.call(o,a))return c(r.get(a));r!==o&&r.get(n)},get size(){const n=this.__v_raw;return!i&&yt(Pe(n),"iterate",ni),Reflect.get(n,"size",n)},has(n){const r=this.__v_raw,o=Pe(r),a=Pe(n);return i||(Gs(n,a)&&yt(o,"has",n),yt(o,"has",a)),n===a?r.has(n):r.has(n)||r.has(a)},forEach(n,r){const o=this,a=o.__v_raw,l=Pe(a),c=e?Jo:i?yr:ut;return!i&&yt(l,"iterate",ni),a.forEach((u,d)=>n.call(r,c(u),c(d),o))}};return lt(t,i?{add:Pn("add"),set:Pn("set"),delete:Pn("delete"),clear:Pn("clear")}:{add(n){!e&&!Mt(n)&&!Hs(n)&&(n=Pe(n));const r=Pe(this);return Dn(r).has.call(r,n)||(r.add(n),bs(r,"add",n,n)),this},set(n,r){!e&&!Mt(r)&&!Hs(r)&&(r=Pe(r));const o=Pe(this),{has:a,get:l}=Dn(o);let c=a.call(o,n);c||(n=Pe(n),c=a.call(o,n));const u=l.call(o,n);return o.set(n,r),c?Gs(r,u)&&bs(o,"set",n,r):bs(o,"add",n,r),this},delete(n){const r=Pe(this),{has:o,get:a}=Dn(r);let l=o.call(r,n);l||(n=Pe(n),l=o.call(r,n)),a&&a.call(r,n);const c=r.delete(n);return l&&bs(r,"delete",n,void 0),c},clear(){const n=Pe(this),r=n.size!==0,o=n.clear();return r&&bs(n,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(n=>{t[n]=dm(n,i,e)}),t}function Wa(i,e){const t=fm(i,e);return(s,n,r)=>n==="__v_isReactive"?!i:n==="__v_isReadonly"?i:n==="__v_raw"?s:Reflect.get(Ne(t,n)&&n in s?t:s,n,r)}const hm={get:Wa(!1,!1)},gm={get:Wa(!1,!0)},mm={get:Wa(!0,!1)};const Nd=new WeakMap,Bd=new WeakMap,$d=new WeakMap,pm=new WeakMap;function ym(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function vm(i){return i.__v_skip||!Object.isExtensible(i)?0:ym(Vg(i))}function li(i){return Hs(i)?i:qa(i,!1,lm,hm,Nd)}function Ud(i){return qa(i,!1,um,gm,Bd)}function Gd(i){return qa(i,!0,cm,mm,$d)}function qa(i,e,t,s,n){if(!je(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const r=vm(i);if(r===0)return i;const o=n.get(i);if(o)return o;const a=new Proxy(i,r===2?s:t);return n.set(i,a),a}function Vs(i){return Hs(i)?Vs(i.__v_raw):!!(i&&i.__v_isReactive)}function Hs(i){return!!(i&&i.__v_isReadonly)}function Mt(i){return!!(i&&i.__v_isShallow)}function Ya(i){return i?!!i.__v_raw:!1}function Pe(i){const e=i&&i.__v_raw;return e?Pe(e):i}function za(i){return!Ne(i,"__v_skip")&&Object.isExtensible(i)&&xd(i,"__v_skip",!0),i}const ut=i=>je(i)?li(i):i,yr=i=>je(i)?Gd(i):i;function Je(i){return i?i.__v_isRef===!0:!1}function ne(i){return Vd(i,!1)}function xm(i){return Vd(i,!0)}function Vd(i,e){return Je(i)?i:new Em(i,e)}class Em{constructor(e,t){this.dep=new ja,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Pe(e),this._value=t?e:ut(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,s=this.__v_isShallow||Mt(e)||Hs(e);e=s?e:Pe(e),Gs(e,t)&&(this._rawValue=e,this._value=s?e:ut(e),this.dep.trigger())}}function pt(i){return Je(i)?i.value:i}const bm={get:(i,e,t)=>e==="__v_raw"?i:pt(Reflect.get(i,e,t)),set:(i,e,t,s)=>{const n=i[e];return Je(n)&&!Je(t)?(n.value=t,!0):Reflect.set(i,e,t,s)}};function Hd(i){return Vs(i)?i:new Proxy(i,bm)}function Tm(i){const e=ye(i)?new Array(i.length):{};for(const t in i)e[t]=Am(i,t);return e}class Sm{constructor(e,t,s){this._object=e,this._key=t,this._defaultValue=s,this.__v_isRef=!0,this._value=void 0}get value(){const e=this._object[this._key];return this._value=e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return sm(Pe(this._object),this._key)}}function Am(i,e,t){const s=i[e];return Je(s)?s:new Sm(i,e,t)}class _m{constructor(e,t,s){this.fn=e,this.setter=t,this._value=void 0,this.dep=new ja(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=on-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=s}notify(){if(this.flags|=16,!(this.flags&8)&&We!==this)return Id(this,!0),!0}get value(){const e=this.dep.track();return Cd(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Lm(i,e,t=!1){let s,n;return Le(i)?s=i:(s=i.get,n=i.set),new _m(s,n,t)}const On={},vr=new WeakMap;let Js;function Rm(i,e=!1,t=Js){if(t){let s=vr.get(t);s||vr.set(t,s=[]),s.push(i)}}function Im(i,e,t=He){const{immediate:s,deep:n,once:r,scheduler:o,augmentJob:a,call:l}=t,c=b=>n?b:Mt(b)||n===!1||n===0?Ts(b,1):Ts(b);let u,d,f,h,g=!1,p=!1;if(Je(i)?(d=()=>i.value,g=Mt(i)):Vs(i)?(d=()=>c(i),g=!0):ye(i)?(p=!0,g=i.some(b=>Vs(b)||Mt(b)),d=()=>i.map(b=>{if(Je(b))return b.value;if(Vs(b))return c(b);if(Le(b))return l?l(b,2):b()})):Le(i)?e?d=l?()=>l(i,2):i:d=()=>{if(f){As();try{f()}finally{_s()}}const b=Js;Js=u;try{return l?l(i,3,[h]):i(h)}finally{Js=b}}:d=ls,e&&n){const b=d,S=n===!0?1/0:n;d=()=>Ts(b(),S)}const m=_d(),x=()=>{u.stop(),m&&m.active&&Ba(m.effects,u)};if(r&&e){const b=e;e=(...S)=>{b(...S),x()}}let E=p?new Array(i.length).fill(On):On;const v=b=>{if(!(!(u.flags&1)||!u.dirty&&!b))if(e){const S=u.run();if(n||g||(p?S.some((w,L)=>Gs(w,E[L])):Gs(S,E))){f&&f();const w=Js;Js=u;try{const L=[S,E===On?void 0:p&&E[0]===On?[]:E,h];E=S,l?l(e,3,L):e(...L)}finally{Js=w}}}else u.run()};return a&&a(v),u=new Ld(d),u.scheduler=o?()=>o(v,!1):v,h=b=>Rm(b,!1,u),f=u.onStop=()=>{const b=vr.get(u);if(b){if(l)l(b,4);else for(const S of b)S();vr.delete(u)}},e?s?v(!0):E=u.run():o?o(v.bind(null,!0),!0):u.run(),x.pause=u.pause.bind(u),x.resume=u.resume.bind(u),x.stop=x,x}function Ts(i,e=1/0,t){if(e<=0||!je(i)||i.__v_skip||(t=t||new Set,t.has(i)))return i;if(t.add(i),e--,Je(i))Ts(i.value,e,t);else if(ye(i))for(let s=0;s<i.length;s++)Ts(i[s],e,t);else if(Mi(i)||Ai(i))i.forEach(s=>{Ts(s,e,t)});else if(vd(i)){for(const s in i)Ts(i[s],e,t);for(const s of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,s)&&Ts(i[s],e,t)}return i}/**
* @vue/runtime-core v3.5.16
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Rn(i,e,t,s){try{return s?i(...s):i()}catch(n){Vr(n,e,t)}}function qt(i,e,t,s){if(Le(i)){const n=Rn(i,e,t,s);return n&&pd(n)&&n.catch(r=>{Vr(r,e,t)}),n}if(ye(i)){const n=[];for(let r=0;r<i.length;r++)n.push(qt(i[r],e,t,s));return n}}function Vr(i,e,t,s=!0){const n=e?e.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||He;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const u=a.ec;if(u){for(let d=0;d<u.length;d++)if(u[d](i,l,c)===!1)return}a=a.parent}if(r){As(),Rn(r,null,10,[i,l,c]),_s();return}}km(i,t,n,s,o)}function km(i,e,t,s=!0,n=!1){if(n)throw i;console.error(i)}const Tt=[];let ss=-1;const _i=[];let Os=null,xi=0;const Kd=Promise.resolve();let xr=null;function Hr(i){const e=xr||Kd;return i?e.then(this?i.bind(this):i):e}function wm(i){let e=ss+1,t=Tt.length;for(;e<t;){const s=e+t>>>1,n=Tt[s],r=ln(n);r<i||r===i&&n.flags&2?e=s+1:t=s}return e}function Xa(i){if(!(i.flags&1)){const e=ln(i),t=Tt[Tt.length-1];!t||!(i.flags&2)&&e>=ln(t)?Tt.push(i):Tt.splice(wm(e),0,i),i.flags|=1,jd()}}function jd(){xr||(xr=Kd.then(qd))}function Cm(i){ye(i)?_i.push(...i):Os&&i.id===-1?Os.splice(xi+1,0,i):i.flags&1||(_i.push(i),i.flags|=1),jd()}function Nl(i,e,t=ss+1){for(;t<Tt.length;t++){const s=Tt[t];if(s&&s.flags&2){if(i&&s.id!==i.uid)continue;Tt.splice(t,1),t--,s.flags&4&&(s.flags&=-2),s(),s.flags&4||(s.flags&=-2)}}}function Wd(i){if(_i.length){const e=[...new Set(_i)].sort((t,s)=>ln(t)-ln(s));if(_i.length=0,Os){Os.push(...e);return}for(Os=e,xi=0;xi<Os.length;xi++){const t=Os[xi];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Os=null,xi=0}}const ln=i=>i.id==null?i.flags&2?-1:1/0:i.id;function qd(i){try{for(ss=0;ss<Tt.length;ss++){const e=Tt[ss];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Rn(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;ss<Tt.length;ss++){const e=Tt[ss];e&&(e.flags&=-2)}ss=-1,Tt.length=0,Wd(),xr=null,(Tt.length||_i.length)&&qd()}}let it=null,Yd=null;function Er(i){const e=it;return it=i,Yd=i&&i.type.__scopeId||null,e}function Ge(i,e=it,t){if(!e||i._n)return i;const s=(...n)=>{s._d&&Yl(-1);const r=Er(e);let o;try{o=i(...n)}finally{Er(r),s._d&&Yl(1)}return o};return s._n=!0,s._c=!0,s._d=!0,s}function Be(i,e){if(it===null)return i;const t=zr(it),s=i.dirs||(i.dirs=[]);for(let n=0;n<e.length;n++){let[r,o,a,l=He]=e[n];r&&(Le(r)&&(r={mounted:r,updated:r}),r.deep&&Ts(o),s.push({dir:r,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return i}function qs(i,e,t,s){const n=i.dirs,r=e&&e.dirs;for(let o=0;o<n.length;o++){const a=n[o];r&&(a.oldValue=r[o].value);let l=a.dir[s];l&&(As(),qt(l,t,8,[i.el,a,i,e]),_s())}}const Dm=Symbol("_vte"),zd=i=>i.__isTeleport,Fs=Symbol("_leaveCb"),Fn=Symbol("_enterCb");function Pm(){const i={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return fi(()=>{i.isMounted=!0}),rf(()=>{i.isUnmounting=!0}),i}const Dt=[Function,Array],Xd={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Dt,onEnter:Dt,onAfterEnter:Dt,onEnterCancelled:Dt,onBeforeLeave:Dt,onLeave:Dt,onAfterLeave:Dt,onLeaveCancelled:Dt,onBeforeAppear:Dt,onAppear:Dt,onAfterAppear:Dt,onAppearCancelled:Dt},Qd=i=>{const e=i.subTree;return e.component?Qd(e.component):e},Om={name:"BaseTransition",props:Xd,setup(i,{slots:e}){const t=Dp(),s=Pm();return()=>{const n=e.default&&ef(e.default(),!0);if(!n||!n.length)return;const r=Jd(n),o=Pe(i),{mode:a}=o;if(s.isLeaving)return po(r);const l=Bl(r);if(!l)return po(r);let c=Zo(l,o,s,t,d=>c=d);l.type!==vt&&cn(l,c);let u=t.subTree&&Bl(t.subTree);if(u&&u.type!==vt&&!ei(l,u)&&Qd(t).type!==vt){let d=Zo(u,o,s,t);if(cn(u,d),a==="out-in"&&l.type!==vt)return s.isLeaving=!0,d.afterLeave=()=>{s.isLeaving=!1,t.job.flags&8||t.update(),delete d.afterLeave,u=void 0},po(r);a==="in-out"&&l.type!==vt?d.delayLeave=(f,h,g)=>{const p=Zd(s,u);p[String(u.key)]=u,f[Fs]=()=>{h(),f[Fs]=void 0,delete c.delayedLeave,u=void 0},c.delayedLeave=()=>{g(),delete c.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return r}}};function Jd(i){let e=i[0];if(i.length>1){for(const t of i)if(t.type!==vt){e=t;break}}return e}const Fm=Om;function Zd(i,e){const{leavingVNodes:t}=i;let s=t.get(e.type);return s||(s=Object.create(null),t.set(e.type,s)),s}function Zo(i,e,t,s,n){const{appear:r,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:d,onBeforeLeave:f,onLeave:h,onAfterLeave:g,onLeaveCancelled:p,onBeforeAppear:m,onAppear:x,onAfterAppear:E,onAppearCancelled:v}=e,b=String(i.key),S=Zd(t,i),w=(R,_)=>{R&&qt(R,s,9,_)},L=(R,_)=>{const N=_[1];w(R,_),ye(R)?R.every(O=>O.length<=1)&&N():R.length<=1&&N()},k={mode:o,persisted:a,beforeEnter(R){let _=l;if(!t.isMounted)if(r)_=m||l;else return;R[Fs]&&R[Fs](!0);const N=S[b];N&&ei(i,N)&&N.el[Fs]&&N.el[Fs](),w(_,[R])},enter(R){let _=c,N=u,O=d;if(!t.isMounted)if(r)_=x||c,N=E||u,O=v||d;else return;let X=!1;const te=R[Fn]=re=>{X||(X=!0,re?w(O,[R]):w(N,[R]),k.delayedLeave&&k.delayedLeave(),R[Fn]=void 0)};_?L(_,[R,te]):te()},leave(R,_){const N=String(i.key);if(R[Fn]&&R[Fn](!0),t.isUnmounting)return _();w(f,[R]);let O=!1;const X=R[Fs]=te=>{O||(O=!0,_(),te?w(p,[R]):w(g,[R]),R[Fs]=void 0,S[N]===i&&delete S[N])};S[N]=i,h?L(h,[R,X]):X()},clone(R){const _=Zo(R,e,t,s,n);return n&&n(_),_}};return k}function po(i){if(Kr(i))return i=Ks(i),i.children=null,i}function Bl(i){if(!Kr(i))return zd(i.type)&&i.children?Jd(i.children):i;if(i.component)return i.component.subTree;const{shapeFlag:e,children:t}=i;if(t){if(e&16)return t[0];if(e&32&&Le(t.default))return t.default()}}function cn(i,e){i.shapeFlag&6&&i.component?(i.transition=e,cn(i.component.subTree,e)):i.shapeFlag&128?(i.ssContent.transition=e.clone(i.ssContent),i.ssFallback.transition=e.clone(i.ssFallback)):i.transition=e}function ef(i,e=!1,t){let s=[],n=0;for(let r=0;r<i.length;r++){let o=i[r];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:r);o.type===ke?(o.patchFlag&128&&n++,s=s.concat(ef(o.children,e,a))):(e||o.type!==vt)&&s.push(a!=null?Ks(o,{key:a}):o)}if(n>1)for(let r=0;r<s.length;r++)s[r].patchFlag=-2;return s}/*! #__NO_SIDE_EFFECTS__ */function tf(i,e){return Le(i)?lt({name:i.name},e,{setup:i}):i}function sf(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}function br(i,e,t,s,n=!1){if(ye(i)){i.forEach((g,p)=>br(g,e&&(ye(e)?e[p]:e),t,s,n));return}if(Li(s)&&!n){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&br(i,e,t,s.component.subTree);return}const r=s.shapeFlag&4?zr(s.component):s.el,o=n?null:r,{i:a,r:l}=i,c=e&&e.r,u=a.refs===He?a.refs={}:a.refs,d=a.setupState,f=Pe(d),h=d===He?()=>!1:g=>Ne(f,g);if(c!=null&&c!==l&&(Ze(c)?(u[c]=null,h(c)&&(d[c]=null)):Je(c)&&(c.value=null)),Le(l))Rn(l,a,12,[o,u]);else{const g=Ze(l),p=Je(l);if(g||p){const m=()=>{if(i.f){const x=g?h(l)?d[l]:u[l]:l.value;n?ye(x)&&Ba(x,r):ye(x)?x.includes(r)||x.push(r):g?(u[l]=[r],h(l)&&(d[l]=u[l])):(l.value=[r],i.k&&(u[i.k]=l.value))}else g?(u[l]=o,h(l)&&(d[l]=o)):p&&(l.value=o,i.k&&(u[i.k]=o))};o?(m.id=-1,It(m,t)):m()}}}Ur().requestIdleCallback;Ur().cancelIdleCallback;const Li=i=>!!i.type.__asyncLoader,Kr=i=>i.type.__isKeepAlive;function Mm(i,e){nf(i,"a",e)}function Nm(i,e){nf(i,"da",e)}function nf(i,e,t=at){const s=i.__wdc||(i.__wdc=()=>{let n=t;for(;n;){if(n.isDeactivated)return;n=n.parent}return i()});if(jr(e,s,t),t){let n=t.parent;for(;n&&n.parent;)Kr(n.parent.vnode)&&Bm(s,e,t,n),n=n.parent}}function Bm(i,e,t,s){const n=jr(e,i,s,!0);Wr(()=>{Ba(s[e],n)},t)}function jr(i,e,t=at,s=!1){if(t){const n=t[i]||(t[i]=[]),r=e.__weh||(e.__weh=(...o)=>{As();const a=kn(t),l=qt(e,t,i,o);return a(),_s(),l});return s?n.unshift(r):n.push(r),r}}const Rs=i=>(e,t=at)=>{(!fn||i==="sp")&&jr(i,(...s)=>e(...s),t)},$m=Rs("bm"),fi=Rs("m"),Um=Rs("bu"),Gm=Rs("u"),rf=Rs("bum"),Wr=Rs("um"),Vm=Rs("sp"),Hm=Rs("rtg"),Km=Rs("rtc");function jm(i,e=at){jr("ec",i,e)}const Wm="components";function Ls(i,e){return Ym(Wm,i,!0,e)||i}const qm=Symbol.for("v-ndc");function Ym(i,e,t=!0,s=!1){const n=it||at;if(n){const r=n.type;{const a=Np(r,!1);if(a&&(a===e||a===Bt(e)||a===$r(Bt(e))))return r}const o=$l(n[i]||r[i],e)||$l(n.appContext[i],e);return!o&&s?r:o}}function $l(i,e){return i&&(i[e]||i[Bt(e)]||i[$r(Bt(e))])}function Et(i,e,t,s){let n;const r=t,o=ye(i);if(o||Ze(i)){const a=o&&Vs(i);let l=!1,c=!1;a&&(l=!Mt(i),c=Hs(i),i=Gr(i)),n=new Array(i.length);for(let u=0,d=i.length;u<d;u++)n[u]=e(l?c?yr(ut(i[u])):ut(i[u]):i[u],u,void 0,r)}else if(typeof i=="number"){n=new Array(i);for(let a=0;a<i;a++)n[a]=e(a+1,a,void 0,r)}else if(je(i))if(i[Symbol.iterator])n=Array.from(i,(a,l)=>e(a,l,void 0,r));else{const a=Object.keys(i);n=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const u=a[l];n[l]=e(i[u],u,l,r)}}else n=[];return n}function zm(i,e,t={},s,n){if(it.ce||it.parent&&Li(it.parent)&&it.parent.ce)return M(),cs(ke,null,[Se("slot",t,s)],64);let r=i[e];r&&r._c&&(r._d=!1),M();const o=r&&of(r(t)),a=t.key||o&&o.key,l=cs(ke,{key:(a&&!Wt(a)?a:`_${e}`)+""},o||[],o&&i._===1?64:-2);return l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),r&&r._c&&(r._d=!0),l}function of(i){return i.some(e=>dn(e)?!(e.type===vt||e.type===ke&&!of(e.children)):!0)?i:null}const ea=i=>i?Lf(i)?zr(i):ea(i.parent):null,Qi=lt(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>ea(i.parent),$root:i=>ea(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>lf(i),$forceUpdate:i=>i.f||(i.f=()=>{Xa(i.update)}),$nextTick:i=>i.n||(i.n=Hr.bind(i.proxy)),$watch:i=>yp.bind(i)}),yo=(i,e)=>i!==He&&!i.__isScriptSetup&&Ne(i,e),Xm={get({_:i},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:s,data:n,props:r,accessCache:o,type:a,appContext:l}=i;let c;if(e[0]!=="$"){const h=o[e];if(h!==void 0)switch(h){case 1:return s[e];case 2:return n[e];case 4:return t[e];case 3:return r[e]}else{if(yo(s,e))return o[e]=1,s[e];if(n!==He&&Ne(n,e))return o[e]=2,n[e];if((c=i.propsOptions[0])&&Ne(c,e))return o[e]=3,r[e];if(t!==He&&Ne(t,e))return o[e]=4,t[e];ta&&(o[e]=0)}}const u=Qi[e];let d,f;if(u)return e==="$attrs"&&yt(i.attrs,"get",""),u(i);if((d=a.__cssModules)&&(d=d[e]))return d;if(t!==He&&Ne(t,e))return o[e]=4,t[e];if(f=l.config.globalProperties,Ne(f,e))return f[e]},set({_:i},e,t){const{data:s,setupState:n,ctx:r}=i;return yo(n,e)?(n[e]=t,!0):s!==He&&Ne(s,e)?(s[e]=t,!0):Ne(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(r[e]=t,!0)},has({_:{data:i,setupState:e,accessCache:t,ctx:s,appContext:n,propsOptions:r}},o){let a;return!!t[o]||i!==He&&Ne(i,o)||yo(e,o)||(a=r[0])&&Ne(a,o)||Ne(s,o)||Ne(Qi,o)||Ne(n.config.globalProperties,o)},defineProperty(i,e,t){return t.get!=null?i._.accessCache[e]=0:Ne(t,"value")&&this.set(i,e,t.value,null),Reflect.defineProperty(i,e,t)}};function Ul(i){return ye(i)?i.reduce((e,t)=>(e[t]=null,e),{}):i}let ta=!0;function Qm(i){const e=lf(i),t=i.proxy,s=i.ctx;ta=!1,e.beforeCreate&&Gl(e.beforeCreate,i,"bc");const{data:n,computed:r,methods:o,watch:a,provide:l,inject:c,created:u,beforeMount:d,mounted:f,beforeUpdate:h,updated:g,activated:p,deactivated:m,beforeDestroy:x,beforeUnmount:E,destroyed:v,unmounted:b,render:S,renderTracked:w,renderTriggered:L,errorCaptured:k,serverPrefetch:R,expose:_,inheritAttrs:N,components:O,directives:X,filters:te}=e;if(c&&Jm(c,s,null),o)for(const z in o){const j=o[z];Le(j)&&(s[z]=j.bind(t))}if(n){const z=n.call(t,t);je(z)&&(i.data=li(z))}if(ta=!0,r)for(const z in r){const j=r[z],he=Le(j)?j.bind(t,t):Le(j.get)?j.get.bind(t,t):ls,fe=!Le(j)&&Le(j.set)?j.set.bind(t):ls,Z=Ye({get:he,set:fe});Object.defineProperty(s,z,{enumerable:!0,configurable:!0,get:()=>Z.value,set:F=>Z.value=F})}if(a)for(const z in a)af(a[z],s,t,z);if(l){const z=Le(l)?l.call(t):l;Reflect.ownKeys(z).forEach(j=>{Qn(j,z[j])})}u&&Gl(u,i,"c");function q(z,j){ye(j)?j.forEach(he=>z(he.bind(t))):j&&z(j.bind(t))}if(q($m,d),q(fi,f),q(Um,h),q(Gm,g),q(Mm,p),q(Nm,m),q(jm,k),q(Km,w),q(Hm,L),q(rf,E),q(Wr,b),q(Vm,R),ye(_))if(_.length){const z=i.exposed||(i.exposed={});_.forEach(j=>{Object.defineProperty(z,j,{get:()=>t[j],set:he=>t[j]=he})})}else i.exposed||(i.exposed={});S&&i.render===ls&&(i.render=S),N!=null&&(i.inheritAttrs=N),O&&(i.components=O),X&&(i.directives=X),R&&sf(i)}function Jm(i,e,t=ls){ye(i)&&(i=sa(i));for(const s in i){const n=i[s];let r;je(n)?"default"in n?r=Nt(n.from||s,n.default,!0):r=Nt(n.from||s):r=Nt(n),Je(r)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>r.value,set:o=>r.value=o}):e[s]=r}}function Gl(i,e,t){qt(ye(i)?i.map(s=>s.bind(e.proxy)):i.bind(e.proxy),e,t)}function af(i,e,t,s){let n=s.includes(".")?bf(t,s):()=>t[s];if(Ze(i)){const r=e[i];Le(r)&&tt(n,r)}else if(Le(i))tt(n,i.bind(t));else if(je(i))if(ye(i))i.forEach(r=>af(r,e,t,s));else{const r=Le(i.handler)?i.handler.bind(t):e[i.handler];Le(r)&&tt(n,r,i)}}function lf(i){const e=i.type,{mixins:t,extends:s}=e,{mixins:n,optionsCache:r,config:{optionMergeStrategies:o}}=i.appContext,a=r.get(e);let l;return a?l=a:!n.length&&!t&&!s?l=e:(l={},n.length&&n.forEach(c=>Tr(l,c,o,!0)),Tr(l,e,o)),je(e)&&r.set(e,l),l}function Tr(i,e,t,s=!1){const{mixins:n,extends:r}=e;r&&Tr(i,r,t,!0),n&&n.forEach(o=>Tr(i,o,t,!0));for(const o in e)if(!(s&&o==="expose")){const a=Zm[o]||t&&t[o];i[o]=a?a(i[o],e[o]):e[o]}return i}const Zm={data:Vl,props:Hl,emits:Hl,methods:Wi,computed:Wi,beforeCreate:bt,created:bt,beforeMount:bt,mounted:bt,beforeUpdate:bt,updated:bt,beforeDestroy:bt,beforeUnmount:bt,destroyed:bt,unmounted:bt,activated:bt,deactivated:bt,errorCaptured:bt,serverPrefetch:bt,components:Wi,directives:Wi,watch:tp,provide:Vl,inject:ep};function Vl(i,e){return e?i?function(){return lt(Le(i)?i.call(this,this):i,Le(e)?e.call(this,this):e)}:e:i}function ep(i,e){return Wi(sa(i),sa(e))}function sa(i){if(ye(i)){const e={};for(let t=0;t<i.length;t++)e[i[t]]=i[t];return e}return i}function bt(i,e){return i?[...new Set([].concat(i,e))]:e}function Wi(i,e){return i?lt(Object.create(null),i,e):e}function Hl(i,e){return i?ye(i)&&ye(e)?[...new Set([...i,...e])]:lt(Object.create(null),Ul(i),Ul(e??{})):e}function tp(i,e){if(!i)return e;if(!e)return i;const t=lt(Object.create(null),i);for(const s in e)t[s]=bt(i[s],e[s]);return t}function cf(){return{app:null,config:{isNativeTag:Ug,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let sp=0;function ip(i,e){return function(s,n=null){Le(s)||(s=lt({},s)),n!=null&&!je(n)&&(n=null);const r=cf(),o=new WeakSet,a=[];let l=!1;const c=r.app={_uid:sp++,_component:s,_props:n,_container:null,_context:r,_instance:null,version:$p,get config(){return r.config},set config(u){},use(u,...d){return o.has(u)||(u&&Le(u.install)?(o.add(u),u.install(c,...d)):Le(u)&&(o.add(u),u(c,...d))),c},mixin(u){return r.mixins.includes(u)||r.mixins.push(u),c},component(u,d){return d?(r.components[u]=d,c):r.components[u]},directive(u,d){return d?(r.directives[u]=d,c):r.directives[u]},mount(u,d,f){if(!l){const h=c._ceVNode||Se(s,n);return h.appContext=r,f===!0?f="svg":f===!1&&(f=void 0),i(h,u,f),l=!0,c._container=u,u.__vue_app__=c,zr(h.component)}},onUnmount(u){a.push(u)},unmount(){l&&(qt(a,c._instance,16),i(null,c._container),delete c._container.__vue_app__)},provide(u,d){return r.provides[u]=d,c},runWithContext(u){const d=ri;ri=c;try{return u()}finally{ri=d}}};return c}}let ri=null;function Qn(i,e){if(at){let t=at.provides;const s=at.parent&&at.parent.provides;s===t&&(t=at.provides=Object.create(s)),t[i]=e}}function Nt(i,e,t=!1){const s=at||it;if(s||ri){let n=ri?ri._context.provides:s?s.parent==null||s.ce?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(n&&i in n)return n[i];if(arguments.length>1)return t&&Le(e)?e.call(s&&s.proxy):e}}function np(){return!!(at||it||ri)}const uf={},df=()=>Object.create(uf),ff=i=>Object.getPrototypeOf(i)===uf;function rp(i,e,t,s=!1){const n={},r=df();i.propsDefaults=Object.create(null),hf(i,e,n,r);for(const o in i.propsOptions[0])o in n||(n[o]=void 0);t?i.props=s?n:Ud(n):i.type.props?i.props=n:i.props=r,i.attrs=r}function op(i,e,t,s){const{props:n,attrs:r,vnode:{patchFlag:o}}=i,a=Pe(n),[l]=i.propsOptions;let c=!1;if((s||o>0)&&!(o&16)){if(o&8){const u=i.vnode.dynamicProps;for(let d=0;d<u.length;d++){let f=u[d];if(qr(i.emitsOptions,f))continue;const h=e[f];if(l)if(Ne(r,f))h!==r[f]&&(r[f]=h,c=!0);else{const g=Bt(f);n[g]=ia(l,a,g,h,i,!1)}else h!==r[f]&&(r[f]=h,c=!0)}}}else{hf(i,e,n,r)&&(c=!0);let u;for(const d in a)(!e||!Ne(e,d)&&((u=di(d))===d||!Ne(e,u)))&&(l?t&&(t[d]!==void 0||t[u]!==void 0)&&(n[d]=ia(l,a,d,void 0,i,!0)):delete n[d]);if(r!==a)for(const d in r)(!e||!Ne(e,d))&&(delete r[d],c=!0)}c&&bs(i.attrs,"set","")}function hf(i,e,t,s){const[n,r]=i.propsOptions;let o=!1,a;if(e)for(let l in e){if(Yi(l))continue;const c=e[l];let u;n&&Ne(n,u=Bt(l))?!r||!r.includes(u)?t[u]=c:(a||(a={}))[u]=c:qr(i.emitsOptions,l)||(!(l in s)||c!==s[l])&&(s[l]=c,o=!0)}if(r){const l=Pe(t),c=a||He;for(let u=0;u<r.length;u++){const d=r[u];t[d]=ia(n,l,d,c[d],i,!Ne(c,d))}}return o}function ia(i,e,t,s,n,r){const o=i[t];if(o!=null){const a=Ne(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Le(l)){const{propsDefaults:c}=n;if(t in c)s=c[t];else{const u=kn(n);s=c[t]=l.call(null,e),u()}}else s=l;n.ce&&n.ce._setProp(t,s)}o[0]&&(r&&!a?s=!1:o[1]&&(s===""||s===di(t))&&(s=!0))}return s}const ap=new WeakMap;function gf(i,e,t=!1){const s=t?ap:e.propsCache,n=s.get(i);if(n)return n;const r=i.props,o={},a=[];let l=!1;if(!Le(i)){const u=d=>{l=!0;const[f,h]=gf(d,e,!0);lt(o,f),h&&a.push(...h)};!t&&e.mixins.length&&e.mixins.forEach(u),i.extends&&u(i.extends),i.mixins&&i.mixins.forEach(u)}if(!r&&!l)return je(i)&&s.set(i,Si),Si;if(ye(r))for(let u=0;u<r.length;u++){const d=Bt(r[u]);Kl(d)&&(o[d]=He)}else if(r)for(const u in r){const d=Bt(u);if(Kl(d)){const f=r[u],h=o[d]=ye(f)||Le(f)?{type:f}:lt({},f),g=h.type;let p=!1,m=!0;if(ye(g))for(let x=0;x<g.length;++x){const E=g[x],v=Le(E)&&E.name;if(v==="Boolean"){p=!0;break}else v==="String"&&(m=!1)}else p=Le(g)&&g.name==="Boolean";h[0]=p,h[1]=m,(p||Ne(h,"default"))&&a.push(d)}}const c=[o,a];return je(i)&&s.set(i,c),c}function Kl(i){return i[0]!=="$"&&!Yi(i)}const Qa=i=>i[0]==="_"||i==="$stable",Ja=i=>ye(i)?i.map(ns):[ns(i)],lp=(i,e,t)=>{if(e._n)return e;const s=Ge((...n)=>Ja(e(...n)),t);return s._c=!1,s},mf=(i,e,t)=>{const s=i._ctx;for(const n in i){if(Qa(n))continue;const r=i[n];if(Le(r))e[n]=lp(n,r,s);else if(r!=null){const o=Ja(r);e[n]=()=>o}}},pf=(i,e)=>{const t=Ja(e);i.slots.default=()=>t},yf=(i,e,t)=>{for(const s in e)(t||!Qa(s))&&(i[s]=e[s])},cp=(i,e,t)=>{const s=i.slots=df();if(i.vnode.shapeFlag&32){const n=e._;n?(yf(s,e,t),t&&xd(s,"_",n,!0)):mf(e,s)}else e&&pf(i,e)},up=(i,e,t)=>{const{vnode:s,slots:n}=i;let r=!0,o=He;if(s.shapeFlag&32){const a=e._;a?t&&a===1?r=!1:yf(n,e,t):(r=!e.$stable,mf(e,n)),o=e}else e&&(pf(i,e),o={default:1});if(r)for(const a in n)!Qa(a)&&o[a]==null&&delete n[a]},It=Ap;function dp(i){return fp(i)}function fp(i,e){const t=Ur();t.__VUE__=!0;const{insert:s,remove:n,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:f,setScopeId:h=ls,insertStaticContent:g}=i,p=(A,I,D,W=null,$=null,H=null,se=void 0,ie=null,J=!!I.dynamicChildren)=>{if(A===I)return;A&&!ei(A,I)&&(W=G(A),F(A,$,H,!0),A=null),I.patchFlag===-2&&(J=!1,I.dynamicChildren=null);const{type:Y,ref:ge,shapeFlag:ae}=I;switch(Y){case Yr:m(A,I,D,W);break;case vt:x(A,I,D,W);break;case Jn:A==null&&E(I,D,W,se);break;case ke:O(A,I,D,W,$,H,se,ie,J);break;default:ae&1?S(A,I,D,W,$,H,se,ie,J):ae&6?X(A,I,D,W,$,H,se,ie,J):(ae&64||ae&128)&&Y.process(A,I,D,W,$,H,se,ie,J,ce)}ge!=null&&$&&br(ge,A&&A.ref,H,I||A,!I)},m=(A,I,D,W)=>{if(A==null)s(I.el=a(I.children),D,W);else{const $=I.el=A.el;I.children!==A.children&&c($,I.children)}},x=(A,I,D,W)=>{A==null?s(I.el=l(I.children||""),D,W):I.el=A.el},E=(A,I,D,W)=>{[A.el,A.anchor]=g(A.children,I,D,W,A.el,A.anchor)},v=({el:A,anchor:I},D,W)=>{let $;for(;A&&A!==I;)$=f(A),s(A,D,W),A=$;s(I,D,W)},b=({el:A,anchor:I})=>{let D;for(;A&&A!==I;)D=f(A),n(A),A=D;n(I)},S=(A,I,D,W,$,H,se,ie,J)=>{I.type==="svg"?se="svg":I.type==="math"&&(se="mathml"),A==null?w(I,D,W,$,H,se,ie,J):R(A,I,$,H,se,ie,J)},w=(A,I,D,W,$,H,se,ie)=>{let J,Y;const{props:ge,shapeFlag:ae,transition:pe,dirs:be}=A;if(J=A.el=o(A.type,H,ge&&ge.is,ge),ae&8?u(J,A.children):ae&16&&k(A.children,J,null,W,$,vo(A,H),se,ie),be&&qs(A,null,W,"created"),L(J,A,A.scopeId,se,W),ge){for(const $e in ge)$e!=="value"&&!Yi($e)&&r(J,$e,null,ge[$e],H,W);"value"in ge&&r(J,"value",null,ge.value,H),(Y=ge.onVnodeBeforeMount)&&Zt(Y,W,A)}be&&qs(A,null,W,"beforeMount");const Ie=hp($,pe);Ie&&pe.beforeEnter(J),s(J,I,D),((Y=ge&&ge.onVnodeMounted)||Ie||be)&&It(()=>{Y&&Zt(Y,W,A),Ie&&pe.enter(J),be&&qs(A,null,W,"mounted")},$)},L=(A,I,D,W,$)=>{if(D&&h(A,D),W)for(let H=0;H<W.length;H++)h(A,W[H]);if($){let H=$.subTree;if(I===H||Sf(H.type)&&(H.ssContent===I||H.ssFallback===I)){const se=$.vnode;L(A,se,se.scopeId,se.slotScopeIds,$.parent)}}},k=(A,I,D,W,$,H,se,ie,J=0)=>{for(let Y=J;Y<A.length;Y++){const ge=A[Y]=ie?Ms(A[Y]):ns(A[Y]);p(null,ge,I,D,W,$,H,se,ie)}},R=(A,I,D,W,$,H,se)=>{const ie=I.el=A.el;let{patchFlag:J,dynamicChildren:Y,dirs:ge}=I;J|=A.patchFlag&16;const ae=A.props||He,pe=I.props||He;let be;if(D&&Ys(D,!1),(be=pe.onVnodeBeforeUpdate)&&Zt(be,D,I,A),ge&&qs(I,A,D,"beforeUpdate"),D&&Ys(D,!0),(ae.innerHTML&&pe.innerHTML==null||ae.textContent&&pe.textContent==null)&&u(ie,""),Y?_(A.dynamicChildren,Y,ie,D,W,vo(I,$),H):se||j(A,I,ie,null,D,W,vo(I,$),H,!1),J>0){if(J&16)N(ie,ae,pe,D,$);else if(J&2&&ae.class!==pe.class&&r(ie,"class",null,pe.class,$),J&4&&r(ie,"style",ae.style,pe.style,$),J&8){const Ie=I.dynamicProps;for(let $e=0;$e<Ie.length;$e++){const Fe=Ie[$e],ft=ae[Fe],ct=pe[Fe];(ct!==ft||Fe==="value")&&r(ie,Fe,ft,ct,$,D)}}J&1&&A.children!==I.children&&u(ie,I.children)}else!se&&Y==null&&N(ie,ae,pe,D,$);((be=pe.onVnodeUpdated)||ge)&&It(()=>{be&&Zt(be,D,I,A),ge&&qs(I,A,D,"updated")},W)},_=(A,I,D,W,$,H,se)=>{for(let ie=0;ie<I.length;ie++){const J=A[ie],Y=I[ie],ge=J.el&&(J.type===ke||!ei(J,Y)||J.shapeFlag&198)?d(J.el):D;p(J,Y,ge,null,W,$,H,se,!0)}},N=(A,I,D,W,$)=>{if(I!==D){if(I!==He)for(const H in I)!Yi(H)&&!(H in D)&&r(A,H,I[H],null,$,W);for(const H in D){if(Yi(H))continue;const se=D[H],ie=I[H];se!==ie&&H!=="value"&&r(A,H,ie,se,$,W)}"value"in D&&r(A,"value",I.value,D.value,$)}},O=(A,I,D,W,$,H,se,ie,J)=>{const Y=I.el=A?A.el:a(""),ge=I.anchor=A?A.anchor:a("");let{patchFlag:ae,dynamicChildren:pe,slotScopeIds:be}=I;be&&(ie=ie?ie.concat(be):be),A==null?(s(Y,D,W),s(ge,D,W),k(I.children||[],D,ge,$,H,se,ie,J)):ae>0&&ae&64&&pe&&A.dynamicChildren?(_(A.dynamicChildren,pe,D,$,H,se,ie),(I.key!=null||$&&I===$.subTree)&&vf(A,I,!0)):j(A,I,D,ge,$,H,se,ie,J)},X=(A,I,D,W,$,H,se,ie,J)=>{I.slotScopeIds=ie,A==null?I.shapeFlag&512?$.ctx.activate(I,D,W,se,J):te(I,D,W,$,H,se,J):re(A,I,J)},te=(A,I,D,W,$,H,se)=>{const ie=A.component=Cp(A,W,$);if(Kr(A)&&(ie.ctx.renderer=ce),Pp(ie,!1,se),ie.asyncDep){if($&&$.registerDep(ie,q,se),!A.el){const J=ie.subTree=Se(vt);x(null,J,I,D)}}else q(ie,A,I,D,$,H,se)},re=(A,I,D)=>{const W=I.component=A.component;if(Tp(A,I,D))if(W.asyncDep&&!W.asyncResolved){z(W,I,D);return}else W.next=I,W.update();else I.el=A.el,W.vnode=I},q=(A,I,D,W,$,H,se)=>{const ie=()=>{if(A.isMounted){let{next:ae,bu:pe,u:be,parent:Ie,vnode:$e}=A;{const Qt=xf(A);if(Qt){ae&&(ae.el=$e.el,z(A,ae,se)),Qt.asyncDep.then(()=>{A.isUnmounted||ie()});return}}let Fe=ae,ft;Ys(A,!1),ae?(ae.el=$e.el,z(A,ae,se)):ae=$e,pe&&Xn(pe),(ft=ae.props&&ae.props.onVnodeBeforeUpdate)&&Zt(ft,Ie,ae,$e),Ys(A,!0);const ct=Wl(A),ht=A.subTree;A.subTree=ct,p(ht,ct,d(ht.el),G(ht),A,$,H),ae.el=ct.el,Fe===null&&Sp(A,ct.el),be&&It(be,$),(ft=ae.props&&ae.props.onVnodeUpdated)&&It(()=>Zt(ft,Ie,ae,$e),$)}else{let ae;const{el:pe,props:be}=I,{bm:Ie,m:$e,parent:Fe,root:ft,type:ct}=A,ht=Li(I);Ys(A,!1),Ie&&Xn(Ie),!ht&&(ae=be&&be.onVnodeBeforeMount)&&Zt(ae,Fe,I),Ys(A,!0);{ft.ce&&ft.ce._injectChildStyle(ct);const Qt=A.subTree=Wl(A);p(null,Qt,D,W,A,$,H),I.el=Qt.el}if($e&&It($e,$),!ht&&(ae=be&&be.onVnodeMounted)){const Qt=I;It(()=>Zt(ae,Fe,Qt),$)}(I.shapeFlag&256||Fe&&Li(Fe.vnode)&&Fe.vnode.shapeFlag&256)&&A.a&&It(A.a,$),A.isMounted=!0,I=D=W=null}};A.scope.on();const J=A.effect=new Ld(ie);A.scope.off();const Y=A.update=J.run.bind(J),ge=A.job=J.runIfDirty.bind(J);ge.i=A,ge.id=A.uid,J.scheduler=()=>Xa(ge),Ys(A,!0),Y()},z=(A,I,D)=>{I.component=A;const W=A.vnode.props;A.vnode=I,A.next=null,op(A,I.props,W,D),up(A,I.children,D),As(),Nl(A),_s()},j=(A,I,D,W,$,H,se,ie,J=!1)=>{const Y=A&&A.children,ge=A?A.shapeFlag:0,ae=I.children,{patchFlag:pe,shapeFlag:be}=I;if(pe>0){if(pe&128){fe(Y,ae,D,W,$,H,se,ie,J);return}else if(pe&256){he(Y,ae,D,W,$,H,se,ie,J);return}}be&8?(ge&16&&Ee(Y,$,H),ae!==Y&&u(D,ae)):ge&16?be&16?fe(Y,ae,D,W,$,H,se,ie,J):Ee(Y,$,H,!0):(ge&8&&u(D,""),be&16&&k(ae,D,W,$,H,se,ie,J))},he=(A,I,D,W,$,H,se,ie,J)=>{A=A||Si,I=I||Si;const Y=A.length,ge=I.length,ae=Math.min(Y,ge);let pe;for(pe=0;pe<ae;pe++){const be=I[pe]=J?Ms(I[pe]):ns(I[pe]);p(A[pe],be,D,null,$,H,se,ie,J)}Y>ge?Ee(A,$,H,!0,!1,ae):k(I,D,W,$,H,se,ie,J,ae)},fe=(A,I,D,W,$,H,se,ie,J)=>{let Y=0;const ge=I.length;let ae=A.length-1,pe=ge-1;for(;Y<=ae&&Y<=pe;){const be=A[Y],Ie=I[Y]=J?Ms(I[Y]):ns(I[Y]);if(ei(be,Ie))p(be,Ie,D,null,$,H,se,ie,J);else break;Y++}for(;Y<=ae&&Y<=pe;){const be=A[ae],Ie=I[pe]=J?Ms(I[pe]):ns(I[pe]);if(ei(be,Ie))p(be,Ie,D,null,$,H,se,ie,J);else break;ae--,pe--}if(Y>ae){if(Y<=pe){const be=pe+1,Ie=be<ge?I[be].el:W;for(;Y<=pe;)p(null,I[Y]=J?Ms(I[Y]):ns(I[Y]),D,Ie,$,H,se,ie,J),Y++}}else if(Y>pe)for(;Y<=ae;)F(A[Y],$,H,!0),Y++;else{const be=Y,Ie=Y,$e=new Map;for(Y=Ie;Y<=pe;Y++){const Rt=I[Y]=J?Ms(I[Y]):ns(I[Y]);Rt.key!=null&&$e.set(Rt.key,Y)}let Fe,ft=0;const ct=pe-Ie+1;let ht=!1,Qt=0;const Ui=new Array(ct);for(Y=0;Y<ct;Y++)Ui[Y]=0;for(Y=be;Y<=ae;Y++){const Rt=A[Y];if(ft>=ct){F(Rt,$,H,!0);continue}let Jt;if(Rt.key!=null)Jt=$e.get(Rt.key);else for(Fe=Ie;Fe<=pe;Fe++)if(Ui[Fe-Ie]===0&&ei(Rt,I[Fe])){Jt=Fe;break}Jt===void 0?F(Rt,$,H,!0):(Ui[Jt-Ie]=Y+1,Jt>=Qt?Qt=Jt:ht=!0,p(Rt,I[Jt],D,null,$,H,se,ie,J),ft++)}const Cl=ht?gp(Ui):Si;for(Fe=Cl.length-1,Y=ct-1;Y>=0;Y--){const Rt=Ie+Y,Jt=I[Rt],Dl=Rt+1<ge?I[Rt+1].el:W;Ui[Y]===0?p(null,Jt,D,Dl,$,H,se,ie,J):ht&&(Fe<0||Y!==Cl[Fe]?Z(Jt,D,Dl,2):Fe--)}}},Z=(A,I,D,W,$=null)=>{const{el:H,type:se,transition:ie,children:J,shapeFlag:Y}=A;if(Y&6){Z(A.component.subTree,I,D,W);return}if(Y&128){A.suspense.move(I,D,W);return}if(Y&64){se.move(A,I,D,ce);return}if(se===ke){s(H,I,D);for(let ae=0;ae<J.length;ae++)Z(J[ae],I,D,W);s(A.anchor,I,D);return}if(se===Jn){v(A,I,D);return}if(W!==2&&Y&1&&ie)if(W===0)ie.beforeEnter(H),s(H,I,D),It(()=>ie.enter(H),$);else{const{leave:ae,delayLeave:pe,afterLeave:be}=ie,Ie=()=>{A.ctx.isUnmounted?n(H):s(H,I,D)},$e=()=>{ae(H,()=>{Ie(),be&&be()})};pe?pe(H,Ie,$e):$e()}else s(H,I,D)},F=(A,I,D,W=!1,$=!1)=>{const{type:H,props:se,ref:ie,children:J,dynamicChildren:Y,shapeFlag:ge,patchFlag:ae,dirs:pe,cacheIndex:be}=A;if(ae===-2&&($=!1),ie!=null&&(As(),br(ie,null,D,A,!0),_s()),be!=null&&(I.renderCache[be]=void 0),ge&256){I.ctx.deactivate(A);return}const Ie=ge&1&&pe,$e=!Li(A);let Fe;if($e&&(Fe=se&&se.onVnodeBeforeUnmount)&&Zt(Fe,I,A),ge&6)Q(A.component,D,W);else{if(ge&128){A.suspense.unmount(D,W);return}Ie&&qs(A,null,I,"beforeUnmount"),ge&64?A.type.remove(A,I,D,ce,W):Y&&!Y.hasOnce&&(H!==ke||ae>0&&ae&64)?Ee(Y,I,D,!1,!0):(H===ke&&ae&384||!$&&ge&16)&&Ee(J,I,D),W&&V(A)}($e&&(Fe=se&&se.onVnodeUnmounted)||Ie)&&It(()=>{Fe&&Zt(Fe,I,A),Ie&&qs(A,null,I,"unmounted")},D)},V=A=>{const{type:I,el:D,anchor:W,transition:$}=A;if(I===ke){xe(D,W);return}if(I===Jn){b(A);return}const H=()=>{n(D),$&&!$.persisted&&$.afterLeave&&$.afterLeave()};if(A.shapeFlag&1&&$&&!$.persisted){const{leave:se,delayLeave:ie}=$,J=()=>se(D,H);ie?ie(A.el,H,J):J()}else H()},xe=(A,I)=>{let D;for(;A!==I;)D=f(A),n(A),A=D;n(I)},Q=(A,I,D)=>{const{bum:W,scope:$,job:H,subTree:se,um:ie,m:J,a:Y,parent:ge,slots:{__:ae}}=A;jl(J),jl(Y),W&&Xn(W),ge&&ye(ae)&&ae.forEach(pe=>{ge.renderCache[pe]=void 0}),$.stop(),H&&(H.flags|=8,F(se,A,I,D)),ie&&It(ie,I),It(()=>{A.isUnmounted=!0},I),I&&I.pendingBranch&&!I.isUnmounted&&A.asyncDep&&!A.asyncResolved&&A.suspenseId===I.pendingId&&(I.deps--,I.deps===0&&I.resolve())},Ee=(A,I,D,W=!1,$=!1,H=0)=>{for(let se=H;se<A.length;se++)F(A[se],I,D,W,$)},G=A=>{if(A.shapeFlag&6)return G(A.component.subTree);if(A.shapeFlag&128)return A.suspense.next();const I=f(A.anchor||A.el),D=I&&I[Dm];return D?f(D):I};let oe=!1;const ee=(A,I,D)=>{A==null?I._vnode&&F(I._vnode,null,null,!0):p(I._vnode||null,A,I,null,null,null,D),I._vnode=A,oe||(oe=!0,Nl(),Wd(),oe=!1)},ce={p,um:F,m:Z,r:V,mt:te,mc:k,pc:j,pbc:_,n:G,o:i};return{render:ee,hydrate:void 0,createApp:ip(ee)}}function vo({type:i,props:e},t){return t==="svg"&&i==="foreignObject"||t==="mathml"&&i==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Ys({effect:i,job:e},t){t?(i.flags|=32,e.flags|=4):(i.flags&=-33,e.flags&=-5)}function hp(i,e){return(!i||i&&!i.pendingBranch)&&e&&!e.persisted}function vf(i,e,t=!1){const s=i.children,n=e.children;if(ye(s)&&ye(n))for(let r=0;r<s.length;r++){const o=s[r];let a=n[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=n[r]=Ms(n[r]),a.el=o.el),!t&&a.patchFlag!==-2&&vf(o,a)),a.type===Yr&&(a.el=o.el),a.type===vt&&!a.el&&(a.el=o.el)}}function gp(i){const e=i.slice(),t=[0];let s,n,r,o,a;const l=i.length;for(s=0;s<l;s++){const c=i[s];if(c!==0){if(n=t[t.length-1],i[n]<c){e[s]=n,t.push(s);continue}for(r=0,o=t.length-1;r<o;)a=r+o>>1,i[t[a]]<c?r=a+1:o=a;c<i[t[r]]&&(r>0&&(e[s]=t[r-1]),t[r]=s)}}for(r=t.length,o=t[r-1];r-- >0;)t[r]=o,o=e[o];return t}function xf(i){const e=i.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:xf(e)}function jl(i){if(i)for(let e=0;e<i.length;e++)i[e].flags|=8}const mp=Symbol.for("v-scx"),pp=()=>Nt(mp);function tt(i,e,t){return Ef(i,e,t)}function Ef(i,e,t=He){const{immediate:s,deep:n,flush:r,once:o}=t,a=lt({},t),l=e&&s||!e&&r!=="post";let c;if(fn){if(r==="sync"){const h=pp();c=h.__watcherHandles||(h.__watcherHandles=[])}else if(!l){const h=()=>{};return h.stop=ls,h.resume=ls,h.pause=ls,h}}const u=at;a.call=(h,g,p)=>qt(h,u,g,p);let d=!1;r==="post"?a.scheduler=h=>{It(h,u&&u.suspense)}:r!=="sync"&&(d=!0,a.scheduler=(h,g)=>{g?h():Xa(h)}),a.augmentJob=h=>{e&&(h.flags|=4),d&&(h.flags|=2,u&&(h.id=u.uid,h.i=u))};const f=Im(i,e,a);return fn&&(c?c.push(f):l&&f()),f}function yp(i,e,t){const s=this.proxy,n=Ze(i)?i.includes(".")?bf(s,i):()=>s[i]:i.bind(s,s);let r;Le(e)?r=e:(r=e.handler,t=e);const o=kn(this),a=Ef(n,r.bind(s),t);return o(),a}function bf(i,e){const t=e.split(".");return()=>{let s=i;for(let n=0;n<t.length&&s;n++)s=s[t[n]];return s}}const vp=(i,e)=>e==="modelValue"||e==="model-value"?i.modelModifiers:i[`${e}Modifiers`]||i[`${Bt(e)}Modifiers`]||i[`${di(e)}Modifiers`];function xp(i,e,...t){if(i.isUnmounted)return;const s=i.vnode.props||He;let n=t;const r=e.startsWith("update:"),o=r&&vp(s,e.slice(7));o&&(o.trim&&(n=t.map(u=>Ze(u)?u.trim():u)),o.number&&(n=t.map(mr)));let a,l=s[a=uo(e)]||s[a=uo(Bt(e))];!l&&r&&(l=s[a=uo(di(e))]),l&&qt(l,i,6,n);const c=s[a+"Once"];if(c){if(!i.emitted)i.emitted={};else if(i.emitted[a])return;i.emitted[a]=!0,qt(c,i,6,n)}}function Tf(i,e,t=!1){const s=e.emitsCache,n=s.get(i);if(n!==void 0)return n;const r=i.emits;let o={},a=!1;if(!Le(i)){const l=c=>{const u=Tf(c,e,!0);u&&(a=!0,lt(o,u))};!t&&e.mixins.length&&e.mixins.forEach(l),i.extends&&l(i.extends),i.mixins&&i.mixins.forEach(l)}return!r&&!a?(je(i)&&s.set(i,null),null):(ye(r)?r.forEach(l=>o[l]=null):lt(o,r),je(i)&&s.set(i,o),o)}function qr(i,e){return!i||!Nr(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ne(i,e[0].toLowerCase()+e.slice(1))||Ne(i,di(e))||Ne(i,e))}function Wl(i){const{type:e,vnode:t,proxy:s,withProxy:n,propsOptions:[r],slots:o,attrs:a,emit:l,render:c,renderCache:u,props:d,data:f,setupState:h,ctx:g,inheritAttrs:p}=i,m=Er(i);let x,E;try{if(t.shapeFlag&4){const b=n||s,S=b;x=ns(c.call(S,b,u,d,h,f,g)),E=a}else{const b=e;x=ns(b.length>1?b(d,{attrs:a,slots:o,emit:l}):b(d,null)),E=e.props?a:Ep(a)}}catch(b){Ji.length=0,Vr(b,i,1),x=Se(vt)}let v=x;if(E&&p!==!1){const b=Object.keys(E),{shapeFlag:S}=v;b.length&&S&7&&(r&&b.some(Na)&&(E=bp(E,r)),v=Ks(v,E,!1,!0))}return t.dirs&&(v=Ks(v,null,!1,!0),v.dirs=v.dirs?v.dirs.concat(t.dirs):t.dirs),t.transition&&cn(v,t.transition),x=v,Er(m),x}const Ep=i=>{let e;for(const t in i)(t==="class"||t==="style"||Nr(t))&&((e||(e={}))[t]=i[t]);return e},bp=(i,e)=>{const t={};for(const s in i)(!Na(s)||!(s.slice(9)in e))&&(t[s]=i[s]);return t};function Tp(i,e,t){const{props:s,children:n,component:r}=i,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return s?ql(s,o,c):!!o;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const f=u[d];if(o[f]!==s[f]&&!qr(c,f))return!0}}}else return(n||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?ql(s,o,c):!0:!!o;return!1}function ql(i,e,t){const s=Object.keys(e);if(s.length!==Object.keys(i).length)return!0;for(let n=0;n<s.length;n++){const r=s[n];if(e[r]!==i[r]&&!qr(t,r))return!0}return!1}function Sp({vnode:i,parent:e},t){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===i&&(s.el=i.el),s===i)(i=e.vnode).el=t,e=e.parent;else break}}const Sf=i=>i.__isSuspense;function Ap(i,e){e&&e.pendingBranch?ye(i)?e.effects.push(...i):e.effects.push(i):Cm(i)}const ke=Symbol.for("v-fgt"),Yr=Symbol.for("v-txt"),vt=Symbol.for("v-cmt"),Jn=Symbol.for("v-stc"),Ji=[];let wt=null;function M(i=!1){Ji.push(wt=i?null:[])}function _p(){Ji.pop(),wt=Ji[Ji.length-1]||null}let un=1;function Yl(i,e=!1){un+=i,i<0&&wt&&e&&(wt.hasOnce=!0)}function Af(i){return i.dynamicChildren=un>0?wt||Si:null,_p(),un>0&&wt&&wt.push(i),i}function B(i,e,t,s,n,r){return Af(T(i,e,t,s,n,r,!0))}function cs(i,e,t,s,n){return Af(Se(i,e,t,s,n,!0))}function dn(i){return i?i.__v_isVNode===!0:!1}function ei(i,e){return i.type===e.type&&i.key===e.key}const _f=({key:i})=>i??null,Zn=({ref:i,ref_key:e,ref_for:t})=>(typeof i=="number"&&(i=""+i),i!=null?Ze(i)||Je(i)||Le(i)?{i:it,r:i,k:e,f:!!t}:i:null);function T(i,e=null,t=null,s=0,n=null,r=i===ke?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&_f(e),ref:e&&Zn(e),scopeId:Yd,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:s,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:it};return a?(Za(l,t),r&128&&i.normalize(l)):t&&(l.shapeFlag|=Ze(t)?8:16),un>0&&!o&&wt&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&wt.push(l),l}const Se=Lp;function Lp(i,e=null,t=null,s=0,n=null,r=!1){if((!i||i===qm)&&(i=vt),dn(i)){const a=Ks(i,e,!0);return t&&Za(a,t),un>0&&!r&&wt&&(a.shapeFlag&6?wt[wt.indexOf(i)]=a:wt.push(a)),a.patchFlag=-2,a}if(Bp(i)&&(i=i.__vccOpts),e){e=Rp(e);let{class:a,style:l}=e;a&&!Ze(a)&&(e.class=Kt(a)),je(l)&&(Ya(l)&&!ye(l)&&(l=lt({},l)),e.style=Ua(l))}const o=Ze(i)?1:Sf(i)?128:zd(i)?64:je(i)?4:Le(i)?2:0;return T(i,e,t,s,n,o,r,!0)}function Rp(i){return i?Ya(i)||ff(i)?lt({},i):i:null}function Ks(i,e,t=!1,s=!1){const{props:n,ref:r,patchFlag:o,children:a,transition:l}=i,c=e?Ip(n||{},e):n,u={__v_isVNode:!0,__v_skip:!0,type:i.type,props:c,key:c&&_f(c),ref:e&&e.ref?t&&r?ye(r)?r.concat(Zn(e)):[r,Zn(e)]:Zn(e):r,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:a,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==ke?o===-1?16:o|16:o,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:l,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&Ks(i.ssContent),ssFallback:i.ssFallback&&Ks(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return l&&s&&cn(u,l.clone(u)),u}function _e(i=" ",e=0){return Se(Yr,null,i,e)}function In(i,e){const t=Se(Jn,null,i);return t.staticCount=e,t}function ve(i="",e=!1){return e?(M(),cs(vt,null,i)):Se(vt,null,i)}function ns(i){return i==null||typeof i=="boolean"?Se(vt):ye(i)?Se(ke,null,i.slice()):dn(i)?Ms(i):Se(Yr,null,String(i))}function Ms(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:Ks(i)}function Za(i,e){let t=0;const{shapeFlag:s}=i;if(e==null)e=null;else if(ye(e))t=16;else if(typeof e=="object")if(s&65){const n=e.default;n&&(n._c&&(n._d=!1),Za(i,n()),n._c&&(n._d=!0));return}else{t=32;const n=e._;!n&&!ff(e)?e._ctx=it:n===3&&it&&(it.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else Le(e)?(e={default:e,_ctx:it},t=32):(e=String(e),s&64?(t=16,e=[_e(e)]):t=8);i.children=e,i.shapeFlag|=t}function Ip(...i){const e={};for(let t=0;t<i.length;t++){const s=i[t];for(const n in s)if(n==="class")e.class!==s.class&&(e.class=Kt([e.class,s.class]));else if(n==="style")e.style=Ua([e.style,s.style]);else if(Nr(n)){const r=e[n],o=s[n];o&&r!==o&&!(ye(r)&&r.includes(o))&&(e[n]=r?[].concat(r,o):o)}else n!==""&&(e[n]=s[n])}return e}function Zt(i,e,t,s=null){qt(i,e,7,[t,s])}const kp=cf();let wp=0;function Cp(i,e,t){const s=i.type,n=(e?e.appContext:i.appContext)||kp,r={uid:wp++,vnode:i,type:s,parent:e,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Sd(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(n.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:gf(s,n),emitsOptions:Tf(s,n),emit:null,emitted:null,propsDefaults:He,inheritAttrs:s.inheritAttrs,ctx:He,data:He,props:He,attrs:He,slots:He,refs:He,setupState:He,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=xp.bind(null,r),i.ce&&i.ce(r),r}let at=null;const Dp=()=>at||it;let Sr,na;{const i=Ur(),e=(t,s)=>{let n;return(n=i[t])||(n=i[t]=[]),n.push(s),r=>{n.length>1?n.forEach(o=>o(r)):n[0](r)}};Sr=e("__VUE_INSTANCE_SETTERS__",t=>at=t),na=e("__VUE_SSR_SETTERS__",t=>fn=t)}const kn=i=>{const e=at;return Sr(i),i.scope.on(),()=>{i.scope.off(),Sr(e)}},zl=()=>{at&&at.scope.off(),Sr(null)};function Lf(i){return i.vnode.shapeFlag&4}let fn=!1;function Pp(i,e=!1,t=!1){e&&na(e);const{props:s,children:n}=i.vnode,r=Lf(i);rp(i,s,r,e),cp(i,n,t||e);const o=r?Op(i,e):void 0;return e&&na(!1),o}function Op(i,e){const t=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,Xm);const{setup:s}=t;if(s){As();const n=i.setupContext=s.length>1?Mp(i):null,r=kn(i),o=Rn(s,i,0,[i.props,n]),a=pd(o);if(_s(),r(),(a||i.sp)&&!Li(i)&&sf(i),a){if(o.then(zl,zl),e)return o.then(l=>{Xl(i,l)}).catch(l=>{Vr(l,i,0)});i.asyncDep=o}else Xl(i,o)}else Rf(i)}function Xl(i,e,t){Le(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:je(e)&&(i.setupState=Hd(e)),Rf(i)}function Rf(i,e,t){const s=i.type;i.render||(i.render=s.render||ls);{const n=kn(i);As();try{Qm(i)}finally{_s(),n()}}}const Fp={get(i,e){return yt(i,"get",""),i[e]}};function Mp(i){const e=t=>{i.exposed=t||{}};return{attrs:new Proxy(i.attrs,Fp),slots:i.slots,emit:i.emit,expose:e}}function zr(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(Hd(za(i.exposed)),{get(e,t){if(t in e)return e[t];if(t in Qi)return Qi[t](i)},has(e,t){return t in e||t in Qi}})):i.proxy}function Np(i,e=!0){return Le(i)?i.displayName||i.name:i.name||e&&i.__name}function Bp(i){return Le(i)&&"__vccOpts"in i}const Ye=(i,e)=>Lm(i,e,fn);function el(i,e,t){const s=arguments.length;return s===2?je(e)&&!ye(e)?dn(e)?Se(i,null,[e]):Se(i,e):Se(i,null,e):(s>3?t=Array.prototype.slice.call(arguments,2):s===3&&dn(t)&&(t=[t]),Se(i,e,t))}const $p="3.5.16";/**
* @vue/runtime-dom v3.5.16
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ra;const Ql=typeof window<"u"&&window.trustedTypes;if(Ql)try{ra=Ql.createPolicy("vue",{createHTML:i=>i})}catch{}const If=ra?i=>ra.createHTML(i):i=>i,Up="http://www.w3.org/2000/svg",Gp="http://www.w3.org/1998/Math/MathML",ys=typeof document<"u"?document:null,Jl=ys&&ys.createElement("template"),Vp={insert:(i,e,t)=>{e.insertBefore(i,t||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,t,s)=>{const n=e==="svg"?ys.createElementNS(Up,i):e==="mathml"?ys.createElementNS(Gp,i):t?ys.createElement(i,{is:t}):ys.createElement(i);return i==="select"&&s&&s.multiple!=null&&n.setAttribute("multiple",s.multiple),n},createText:i=>ys.createTextNode(i),createComment:i=>ys.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>ys.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,t,s,n,r){const o=t?t.previousSibling:e.lastChild;if(n&&(n===r||n.nextSibling))for(;e.insertBefore(n.cloneNode(!0),t),!(n===r||!(n=n.nextSibling)););else{Jl.innerHTML=If(s==="svg"?`<svg>${i}</svg>`:s==="mathml"?`<math>${i}</math>`:i);const a=Jl.content;if(s==="svg"||s==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},ks="transition",Vi="animation",hn=Symbol("_vtc"),kf={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Hp=lt({},Xd,kf),Kp=i=>(i.displayName="Transition",i.props=Hp,i),wf=Kp((i,{slots:e})=>el(Fm,jp(i),e)),zs=(i,e=[])=>{ye(i)?i.forEach(t=>t(...e)):i&&i(...e)},Zl=i=>i?ye(i)?i.some(e=>e.length>1):i.length>1:!1;function jp(i){const e={};for(const O in i)O in kf||(e[O]=i[O]);if(i.css===!1)return e;const{name:t="v",type:s,duration:n,enterFromClass:r=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=r,appearActiveClass:c=o,appearToClass:u=a,leaveFromClass:d=`${t}-leave-from`,leaveActiveClass:f=`${t}-leave-active`,leaveToClass:h=`${t}-leave-to`}=i,g=Wp(n),p=g&&g[0],m=g&&g[1],{onBeforeEnter:x,onEnter:E,onEnterCancelled:v,onLeave:b,onLeaveCancelled:S,onBeforeAppear:w=x,onAppear:L=E,onAppearCancelled:k=v}=e,R=(O,X,te,re)=>{O._enterCancelled=re,Xs(O,X?u:a),Xs(O,X?c:o),te&&te()},_=(O,X)=>{O._isLeaving=!1,Xs(O,d),Xs(O,h),Xs(O,f),X&&X()},N=O=>(X,te)=>{const re=O?L:E,q=()=>R(X,O,te);zs(re,[X,q]),ec(()=>{Xs(X,O?l:r),hs(X,O?u:a),Zl(re)||tc(X,s,p,q)})};return lt(e,{onBeforeEnter(O){zs(x,[O]),hs(O,r),hs(O,o)},onBeforeAppear(O){zs(w,[O]),hs(O,l),hs(O,c)},onEnter:N(!1),onAppear:N(!0),onLeave(O,X){O._isLeaving=!0;const te=()=>_(O,X);hs(O,d),O._enterCancelled?(hs(O,f),nc()):(nc(),hs(O,f)),ec(()=>{O._isLeaving&&(Xs(O,d),hs(O,h),Zl(b)||tc(O,s,m,te))}),zs(b,[O,te])},onEnterCancelled(O){R(O,!1,void 0,!0),zs(v,[O])},onAppearCancelled(O){R(O,!0,void 0,!0),zs(k,[O])},onLeaveCancelled(O){_(O),zs(S,[O])}})}function Wp(i){if(i==null)return null;if(je(i))return[xo(i.enter),xo(i.leave)];{const e=xo(i);return[e,e]}}function xo(i){return jg(i)}function hs(i,e){e.split(/\s+/).forEach(t=>t&&i.classList.add(t)),(i[hn]||(i[hn]=new Set)).add(e)}function Xs(i,e){e.split(/\s+/).forEach(s=>s&&i.classList.remove(s));const t=i[hn];t&&(t.delete(e),t.size||(i[hn]=void 0))}function ec(i){requestAnimationFrame(()=>{requestAnimationFrame(i)})}let qp=0;function tc(i,e,t,s){const n=i._endId=++qp,r=()=>{n===i._endId&&s()};if(t!=null)return setTimeout(r,t);const{type:o,timeout:a,propCount:l}=Yp(i,e);if(!o)return s();const c=o+"end";let u=0;const d=()=>{i.removeEventListener(c,f),r()},f=h=>{h.target===i&&++u>=l&&d()};setTimeout(()=>{u<l&&d()},a+1),i.addEventListener(c,f)}function Yp(i,e){const t=window.getComputedStyle(i),s=g=>(t[g]||"").split(", "),n=s(`${ks}Delay`),r=s(`${ks}Duration`),o=sc(n,r),a=s(`${Vi}Delay`),l=s(`${Vi}Duration`),c=sc(a,l);let u=null,d=0,f=0;e===ks?o>0&&(u=ks,d=o,f=r.length):e===Vi?c>0&&(u=Vi,d=c,f=l.length):(d=Math.max(o,c),u=d>0?o>c?ks:Vi:null,f=u?u===ks?r.length:l.length:0);const h=u===ks&&/\b(transform|all)(,|$)/.test(s(`${ks}Property`).toString());return{type:u,timeout:d,propCount:f,hasTransform:h}}function sc(i,e){for(;i.length<e.length;)i=i.concat(i);return Math.max(...e.map((t,s)=>ic(t)+ic(i[s])))}function ic(i){return i==="auto"?0:Number(i.slice(0,-1).replace(",","."))*1e3}function nc(){return document.body.offsetHeight}function zp(i,e,t){const s=i[hn];s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?i.removeAttribute("class"):t?i.setAttribute("class",e):i.className=e}const rc=Symbol("_vod"),Xp=Symbol("_vsh"),Qp=Symbol(""),Jp=/(^|;)\s*display\s*:/;function Zp(i,e,t){const s=i.style,n=Ze(t);let r=!1;if(t&&!n){if(e)if(Ze(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&er(s,a,"")}else for(const o in e)t[o]==null&&er(s,o,"");for(const o in t)o==="display"&&(r=!0),er(s,o,t[o])}else if(n){if(e!==t){const o=s[Qp];o&&(t+=";"+o),s.cssText=t,r=Jp.test(t)}}else e&&i.removeAttribute("style");rc in i&&(i[rc]=r?s.display:"",i[Xp]&&(s.display="none"))}const oc=/\s*!important$/;function er(i,e,t){if(ye(t))t.forEach(s=>er(i,e,s));else if(t==null&&(t=""),e.startsWith("--"))i.setProperty(e,t);else{const s=e0(i,e);oc.test(t)?i.setProperty(di(s),t.replace(oc,""),"important"):i[s]=t}}const ac=["Webkit","Moz","ms"],Eo={};function e0(i,e){const t=Eo[e];if(t)return t;let s=Bt(e);if(s!=="filter"&&s in i)return Eo[e]=s;s=$r(s);for(let n=0;n<ac.length;n++){const r=ac[n]+s;if(r in i)return Eo[e]=r}return e}const lc="http://www.w3.org/1999/xlink";function cc(i,e,t,s,n,r=Qg(e)){s&&e.startsWith("xlink:")?t==null?i.removeAttributeNS(lc,e.slice(6,e.length)):i.setAttributeNS(lc,e,t):t==null||r&&!Ed(t)?i.removeAttribute(e):i.setAttribute(e,r?"":Wt(t)?String(t):t)}function uc(i,e,t,s,n){if(e==="innerHTML"||e==="textContent"){t!=null&&(i[e]=e==="innerHTML"?If(t):t);return}const r=i.tagName;if(e==="value"&&r!=="PROGRESS"&&!r.includes("-")){const a=r==="OPTION"?i.getAttribute("value")||"":i.value,l=t==null?i.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in i))&&(i.value=l),t==null&&i.removeAttribute(e),i._value=t;return}let o=!1;if(t===""||t==null){const a=typeof i[e];a==="boolean"?t=Ed(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{i[e]=t}catch{}o&&i.removeAttribute(n||e)}function Us(i,e,t,s){i.addEventListener(e,t,s)}function t0(i,e,t,s){i.removeEventListener(e,t,s)}const dc=Symbol("_vei");function s0(i,e,t,s,n=null){const r=i[dc]||(i[dc]={}),o=r[e];if(s&&o)o.value=s;else{const[a,l]=i0(e);if(s){const c=r[e]=o0(s,n);Us(i,a,c,l)}else o&&(t0(i,a,o,l),r[e]=void 0)}}const fc=/(?:Once|Passive|Capture)$/;function i0(i){let e;if(fc.test(i)){e={};let s;for(;s=i.match(fc);)i=i.slice(0,i.length-s[0].length),e[s[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):di(i.slice(2)),e]}let bo=0;const n0=Promise.resolve(),r0=()=>bo||(n0.then(()=>bo=0),bo=Date.now());function o0(i,e){const t=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=t.attached)return;qt(a0(s,t.value),e,5,[s])};return t.value=i,t.attached=r0(),t}function a0(i,e){if(ye(e)){const t=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{t.call(i),i._stopped=!0},e.map(s=>n=>!n._stopped&&s&&s(n))}else return e}const hc=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,l0=(i,e,t,s,n,r)=>{const o=n==="svg";e==="class"?zp(i,s,o):e==="style"?Zp(i,t,s):Nr(e)?Na(e)||s0(i,e,t,s,r):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):c0(i,e,s,o))?(uc(i,e,s),!i.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&cc(i,e,s,o,r,e!=="value")):i._isVueCE&&(/[A-Z]/.test(e)||!Ze(s))?uc(i,Bt(e),s,r,e):(e==="true-value"?i._trueValue=s:e==="false-value"&&(i._falseValue=s),cc(i,e,s,o))};function c0(i,e,t,s){if(s)return!!(e==="innerHTML"||e==="textContent"||e in i&&hc(e)&&Le(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const n=i.tagName;if(n==="IMG"||n==="VIDEO"||n==="CANVAS"||n==="SOURCE")return!1}return hc(e)&&Ze(t)?!1:e in i}const wi=i=>{const e=i.props["onUpdate:modelValue"]||!1;return ye(e)?t=>Xn(e,t):e};function u0(i){i.target.composing=!0}function gc(i){const e=i.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ss=Symbol("_assign"),ot={created(i,{modifiers:{lazy:e,trim:t,number:s}},n){i[Ss]=wi(n);const r=s||n.props&&n.props.type==="number";Us(i,e?"change":"input",o=>{if(o.target.composing)return;let a=i.value;t&&(a=a.trim()),r&&(a=mr(a)),i[Ss](a)}),t&&Us(i,"change",()=>{i.value=i.value.trim()}),e||(Us(i,"compositionstart",u0),Us(i,"compositionend",gc),Us(i,"change",gc))},mounted(i,{value:e}){i.value=e??""},beforeUpdate(i,{value:e,oldValue:t,modifiers:{lazy:s,trim:n,number:r}},o){if(i[Ss]=wi(o),i.composing)return;const a=(r||i.type==="number")&&!/^0\d/.test(i.value)?mr(i.value):i.value,l=e??"";a!==l&&(document.activeElement===i&&i.type!=="range"&&(s&&e===t||n&&i.value.trim()===l)||(i.value=l))}},Mn={deep:!0,created(i,e,t){i[Ss]=wi(t),Us(i,"change",()=>{const s=i._modelValue,n=gn(i),r=i.checked,o=i[Ss];if(ye(s)){const a=Ga(s,n),l=a!==-1;if(r&&!l)o(s.concat(n));else if(!r&&l){const c=[...s];c.splice(a,1),o(c)}}else if(Mi(s)){const a=new Set(s);r?a.add(n):a.delete(n),o(a)}else o(Cf(i,r))})},mounted:mc,beforeUpdate(i,e,t){i[Ss]=wi(t),mc(i,e,t)}};function mc(i,{value:e,oldValue:t},s){i._modelValue=e;let n;if(ye(e))n=Ga(e,s.props.value)>-1;else if(Mi(e))n=e.has(s.props.value);else{if(e===t)return;n=Ln(e,Cf(i,!0))}i.checked!==n&&(i.checked=n)}const si={deep:!0,created(i,{value:e,modifiers:{number:t}},s){const n=Mi(e);Us(i,"change",()=>{const r=Array.prototype.filter.call(i.options,o=>o.selected).map(o=>t?mr(gn(o)):gn(o));i[Ss](i.multiple?n?new Set(r):r:r[0]),i._assigning=!0,Hr(()=>{i._assigning=!1})}),i[Ss]=wi(s)},mounted(i,{value:e}){pc(i,e)},beforeUpdate(i,e,t){i[Ss]=wi(t)},updated(i,{value:e}){i._assigning||pc(i,e)}};function pc(i,e){const t=i.multiple,s=ye(e);if(!(t&&!s&&!Mi(e))){for(let n=0,r=i.options.length;n<r;n++){const o=i.options[n],a=gn(o);if(t)if(s){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=Ga(e,a)>-1}else o.selected=e.has(a);else if(Ln(gn(o),e)){i.selectedIndex!==n&&(i.selectedIndex=n);return}}!t&&i.selectedIndex!==-1&&(i.selectedIndex=-1)}}function gn(i){return"_value"in i?i._value:i.value}function Cf(i,e){const t=e?"_trueValue":"_falseValue";return t in i?i[t]:e}const d0=["ctrl","shift","alt","meta"],f0={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,e)=>d0.some(t=>i[`${t}Key`]&&!e.includes(t))},Is=(i,e)=>{const t=i._withMods||(i._withMods={}),s=e.join(".");return t[s]||(t[s]=(n,...r)=>{for(let o=0;o<e.length;o++){const a=f0[e[o]];if(a&&a(n,e))return}return i(n,...r)})},h0=lt({patchProp:l0},Vp);let yc;function g0(){return yc||(yc=dp(h0))}const m0=(...i)=>{const e=g0().createApp(...i),{mount:t}=e;return e.mount=s=>{const n=y0(s);if(!n)return;const r=e._component;!Le(r)&&!r.render&&!r.template&&(r.template=n.innerHTML),n.nodeType===1&&(n.textContent="");const o=t(n,!1,p0(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),o},e};function p0(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function y0(i){return Ze(i)?document.querySelector(i):i}/*!
 * pinia v2.3.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let Df;const Xr=i=>Df=i,Pf=Symbol();function oa(i){return i&&typeof i=="object"&&Object.prototype.toString.call(i)==="[object Object]"&&typeof i.toJSON!="function"}var Zi;(function(i){i.direct="direct",i.patchObject="patch object",i.patchFunction="patch function"})(Zi||(Zi={}));function v0(){const i=Ad(!0),e=i.run(()=>ne({}));let t=[],s=[];const n=za({install(r){Xr(n),n._a=r,r.provide(Pf,n),r.config.globalProperties.$pinia=n,s.forEach(o=>t.push(o)),s=[]},use(r){return this._a?t.push(r):s.push(r),this},_p:t,_a:null,_e:i,_s:new Map,state:e});return n}const Of=()=>{};function vc(i,e,t,s=Of){i.push(e);const n=()=>{const r=i.indexOf(e);r>-1&&(i.splice(r,1),s())};return!t&&_d()&&Zg(n),n}function gi(i,...e){i.slice().forEach(t=>{t(...e)})}const x0=i=>i(),xc=Symbol(),To=Symbol();function aa(i,e){i instanceof Map&&e instanceof Map?e.forEach((t,s)=>i.set(s,t)):i instanceof Set&&e instanceof Set&&e.forEach(i.add,i);for(const t in e){if(!e.hasOwnProperty(t))continue;const s=e[t],n=i[t];oa(n)&&oa(s)&&i.hasOwnProperty(t)&&!Je(s)&&!Vs(s)?i[t]=aa(n,s):i[t]=s}return i}const E0=Symbol();function b0(i){return!oa(i)||!i.hasOwnProperty(E0)}const{assign:Ps}=Object;function T0(i){return!!(Je(i)&&i.effect)}function S0(i,e,t,s){const{state:n,actions:r,getters:o}=e,a=t.state.value[i];let l;function c(){a||(t.state.value[i]=n?n():{});const u=Tm(t.state.value[i]);return Ps(u,r,Object.keys(o||{}).reduce((d,f)=>(d[f]=za(Ye(()=>{Xr(t);const h=t._s.get(i);return o[f].call(h,h)})),d),{}))}return l=Ff(i,c,e,t,s,!0),l}function Ff(i,e,t={},s,n,r){let o;const a=Ps({actions:{}},t),l={deep:!0};let c,u,d=[],f=[],h;const g=s.state.value[i];!r&&!g&&(s.state.value[i]={}),ne({});let p;function m(k){let R;c=u=!1,typeof k=="function"?(k(s.state.value[i]),R={type:Zi.patchFunction,storeId:i,events:h}):(aa(s.state.value[i],k),R={type:Zi.patchObject,payload:k,storeId:i,events:h});const _=p=Symbol();Hr().then(()=>{p===_&&(c=!0)}),u=!0,gi(d,R,s.state.value[i])}const x=r?function(){const{state:R}=t,_=R?R():{};this.$patch(N=>{Ps(N,_)})}:Of;function E(){o.stop(),d=[],f=[],s._s.delete(i)}const v=(k,R="")=>{if(xc in k)return k[To]=R,k;const _=function(){Xr(s);const N=Array.from(arguments),O=[],X=[];function te(z){O.push(z)}function re(z){X.push(z)}gi(f,{args:N,name:_[To],store:S,after:te,onError:re});let q;try{q=k.apply(this&&this.$id===i?this:S,N)}catch(z){throw gi(X,z),z}return q instanceof Promise?q.then(z=>(gi(O,z),z)).catch(z=>(gi(X,z),Promise.reject(z))):(gi(O,q),q)};return _[xc]=!0,_[To]=R,_},b={_p:s,$id:i,$onAction:vc.bind(null,f),$patch:m,$reset:x,$subscribe(k,R={}){const _=vc(d,k,R.detached,()=>N()),N=o.run(()=>tt(()=>s.state.value[i],O=>{(R.flush==="sync"?u:c)&&k({storeId:i,type:Zi.direct,events:h},O)},Ps({},l,R)));return _},$dispose:E},S=li(b);s._s.set(i,S);const L=(s._a&&s._a.runWithContext||x0)(()=>s._e.run(()=>(o=Ad()).run(()=>e({action:v}))));for(const k in L){const R=L[k];if(Je(R)&&!T0(R)||Vs(R))r||(g&&b0(R)&&(Je(R)?R.value=g[k]:aa(R,g[k])),s.state.value[i][k]=R);else if(typeof R=="function"){const _=v(R,k);L[k]=_,a.actions[k]=R}}return Ps(S,L),Ps(Pe(S),L),Object.defineProperty(S,"$state",{get:()=>s.state.value[i],set:k=>{m(R=>{Ps(R,k)})}}),s._p.forEach(k=>{Ps(S,o.run(()=>k({store:S,app:s._a,pinia:s,options:a})))}),g&&r&&t.hydrate&&t.hydrate(S.$state,g),c=!0,u=!0,S}/*! #__NO_SIDE_EFFECTS__ */function A0(i,e,t){let s,n;const r=typeof e=="function";s=i,n=r?t:e;function o(a,l){const c=np();return a=a||(c?Nt(Pf,null):null),a&&Xr(a),a=Df,a._s.has(s)||(r?Ff(s,e,n,a):S0(s,n,a)),a._s.get(s)}return o.$id=s,o}const Ec="/logo.png";/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Ei=typeof document<"u";function Mf(i){return typeof i=="object"||"displayName"in i||"props"in i||"__vccOpts"in i}function _0(i){return i.__esModule||i[Symbol.toStringTag]==="Module"||i.default&&Mf(i.default)}const Me=Object.assign;function So(i,e){const t={};for(const s in e){const n=e[s];t[s]=Yt(n)?n.map(i):i(n)}return t}const en=()=>{},Yt=Array.isArray,Nf=/#/g,L0=/&/g,R0=/\//g,I0=/=/g,k0=/\?/g,Bf=/\+/g,w0=/%5B/g,C0=/%5D/g,$f=/%5E/g,D0=/%60/g,Uf=/%7B/g,P0=/%7C/g,Gf=/%7D/g,O0=/%20/g;function tl(i){return encodeURI(""+i).replace(P0,"|").replace(w0,"[").replace(C0,"]")}function F0(i){return tl(i).replace(Uf,"{").replace(Gf,"}").replace($f,"^")}function la(i){return tl(i).replace(Bf,"%2B").replace(O0,"+").replace(Nf,"%23").replace(L0,"%26").replace(D0,"`").replace(Uf,"{").replace(Gf,"}").replace($f,"^")}function M0(i){return la(i).replace(I0,"%3D")}function N0(i){return tl(i).replace(Nf,"%23").replace(k0,"%3F")}function B0(i){return i==null?"":N0(i).replace(R0,"%2F")}function mn(i){try{return decodeURIComponent(""+i)}catch{}return""+i}const $0=/\/$/,U0=i=>i.replace($0,"");function Ao(i,e,t="/"){let s,n={},r="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(s=e.slice(0,l),r=e.slice(l+1,a>-1?a:e.length),n=i(r)),a>-1&&(s=s||e.slice(0,a),o=e.slice(a,e.length)),s=K0(s??e,t),{fullPath:s+(r&&"?")+r+o,path:s,query:n,hash:mn(o)}}function G0(i,e){const t=e.query?i(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function bc(i,e){return!e||!i.toLowerCase().startsWith(e.toLowerCase())?i:i.slice(e.length)||"/"}function V0(i,e,t){const s=e.matched.length-1,n=t.matched.length-1;return s>-1&&s===n&&Ci(e.matched[s],t.matched[n])&&Vf(e.params,t.params)&&i(e.query)===i(t.query)&&e.hash===t.hash}function Ci(i,e){return(i.aliasOf||i)===(e.aliasOf||e)}function Vf(i,e){if(Object.keys(i).length!==Object.keys(e).length)return!1;for(const t in i)if(!H0(i[t],e[t]))return!1;return!0}function H0(i,e){return Yt(i)?Tc(i,e):Yt(e)?Tc(e,i):i===e}function Tc(i,e){return Yt(e)?i.length===e.length&&i.every((t,s)=>t===e[s]):i.length===1&&i[0]===e}function K0(i,e){if(i.startsWith("/"))return i;if(!i)return e;const t=e.split("/"),s=i.split("/"),n=s[s.length-1];(n===".."||n===".")&&s.push("");let r=t.length-1,o,a;for(o=0;o<s.length;o++)if(a=s[o],a!==".")if(a==="..")r>1&&r--;else break;return t.slice(0,r).join("/")+"/"+s.slice(o).join("/")}const ws={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var pn;(function(i){i.pop="pop",i.push="push"})(pn||(pn={}));var tn;(function(i){i.back="back",i.forward="forward",i.unknown=""})(tn||(tn={}));function j0(i){if(!i)if(Ei){const e=document.querySelector("base");i=e&&e.getAttribute("href")||"/",i=i.replace(/^\w+:\/\/[^\/]+/,"")}else i="/";return i[0]!=="/"&&i[0]!=="#"&&(i="/"+i),U0(i)}const W0=/^[^#]+#/;function q0(i,e){return i.replace(W0,"#")+e}function Y0(i,e){const t=document.documentElement.getBoundingClientRect(),s=i.getBoundingClientRect();return{behavior:e.behavior,left:s.left-t.left-(e.left||0),top:s.top-t.top-(e.top||0)}}const Qr=()=>({left:window.scrollX,top:window.scrollY});function z0(i){let e;if("el"in i){const t=i.el,s=typeof t=="string"&&t.startsWith("#"),n=typeof t=="string"?s?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!n)return;e=Y0(n,i)}else e=i;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Sc(i,e){return(history.state?history.state.position-e:-1)+i}const ca=new Map;function X0(i,e){ca.set(i,e)}function Q0(i){const e=ca.get(i);return ca.delete(i),e}let J0=()=>location.protocol+"//"+location.host;function Hf(i,e){const{pathname:t,search:s,hash:n}=e,r=i.indexOf("#");if(r>-1){let a=n.includes(i.slice(r))?i.slice(r).length:1,l=n.slice(a);return l[0]!=="/"&&(l="/"+l),bc(l,"")}return bc(t,i)+s+n}function Z0(i,e,t,s){let n=[],r=[],o=null;const a=({state:f})=>{const h=Hf(i,location),g=t.value,p=e.value;let m=0;if(f){if(t.value=h,e.value=f,o&&o===g){o=null;return}m=p?f.position-p.position:0}else s(h);n.forEach(x=>{x(t.value,g,{delta:m,type:pn.pop,direction:m?m>0?tn.forward:tn.back:tn.unknown})})};function l(){o=t.value}function c(f){n.push(f);const h=()=>{const g=n.indexOf(f);g>-1&&n.splice(g,1)};return r.push(h),h}function u(){const{history:f}=window;f.state&&f.replaceState(Me({},f.state,{scroll:Qr()}),"")}function d(){for(const f of r)f();r=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",u)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",u,{passive:!0}),{pauseListeners:l,listen:c,destroy:d}}function Ac(i,e,t,s=!1,n=!1){return{back:i,current:e,forward:t,replaced:s,position:window.history.length,scroll:n?Qr():null}}function ey(i){const{history:e,location:t}=window,s={value:Hf(i,t)},n={value:e.state};n.value||r(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(l,c,u){const d=i.indexOf("#"),f=d>-1?(t.host&&document.querySelector("base")?i:i.slice(d))+l:J0()+i+l;try{e[u?"replaceState":"pushState"](c,"",f),n.value=c}catch(h){console.error(h),t[u?"replace":"assign"](f)}}function o(l,c){const u=Me({},e.state,Ac(n.value.back,l,n.value.forward,!0),c,{position:n.value.position});r(l,u,!0),s.value=l}function a(l,c){const u=Me({},n.value,e.state,{forward:l,scroll:Qr()});r(u.current,u,!0);const d=Me({},Ac(s.value,l,null),{position:u.position+1},c);r(l,d,!1),s.value=l}return{location:s,state:n,push:a,replace:o}}function ty(i){i=j0(i);const e=ey(i),t=Z0(i,e.state,e.location,e.replace);function s(r,o=!0){o||t.pauseListeners(),history.go(r)}const n=Me({location:"",base:i,go:s,createHref:q0.bind(null,i)},e,t);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>e.state.value}),n}function sy(i){return typeof i=="string"||i&&typeof i=="object"}function Kf(i){return typeof i=="string"||typeof i=="symbol"}const jf=Symbol("");var _c;(function(i){i[i.aborted=4]="aborted",i[i.cancelled=8]="cancelled",i[i.duplicated=16]="duplicated"})(_c||(_c={}));function Di(i,e){return Me(new Error,{type:i,[jf]:!0},e)}function gs(i,e){return i instanceof Error&&jf in i&&(e==null||!!(i.type&e))}const Lc="[^/]+?",iy={sensitive:!1,strict:!1,start:!0,end:!0},ny=/[.+*?^${}()[\]/\\]/g;function ry(i,e){const t=Me({},iy,e),s=[];let n=t.start?"^":"";const r=[];for(const c of i){const u=c.length?[]:[90];t.strict&&!c.length&&(n+="/");for(let d=0;d<c.length;d++){const f=c[d];let h=40+(t.sensitive?.25:0);if(f.type===0)d||(n+="/"),n+=f.value.replace(ny,"\\$&"),h+=40;else if(f.type===1){const{value:g,repeatable:p,optional:m,regexp:x}=f;r.push({name:g,repeatable:p,optional:m});const E=x||Lc;if(E!==Lc){h+=10;try{new RegExp(`(${E})`)}catch(b){throw new Error(`Invalid custom RegExp for param "${g}" (${E}): `+b.message)}}let v=p?`((?:${E})(?:/(?:${E}))*)`:`(${E})`;d||(v=m&&c.length<2?`(?:/${v})`:"/"+v),m&&(v+="?"),n+=v,h+=20,m&&(h+=-8),p&&(h+=-20),E===".*"&&(h+=-50)}u.push(h)}s.push(u)}if(t.strict&&t.end){const c=s.length-1;s[c][s[c].length-1]+=.7000000000000001}t.strict||(n+="/?"),t.end?n+="$":t.strict&&!n.endsWith("/")&&(n+="(?:/|$)");const o=new RegExp(n,t.sensitive?"":"i");function a(c){const u=c.match(o),d={};if(!u)return null;for(let f=1;f<u.length;f++){const h=u[f]||"",g=r[f-1];d[g.name]=h&&g.repeatable?h.split("/"):h}return d}function l(c){let u="",d=!1;for(const f of i){(!d||!u.endsWith("/"))&&(u+="/"),d=!1;for(const h of f)if(h.type===0)u+=h.value;else if(h.type===1){const{value:g,repeatable:p,optional:m}=h,x=g in c?c[g]:"";if(Yt(x)&&!p)throw new Error(`Provided param "${g}" is an array but it is not repeatable (* or + modifiers)`);const E=Yt(x)?x.join("/"):x;if(!E)if(m)f.length<2&&(u.endsWith("/")?u=u.slice(0,-1):d=!0);else throw new Error(`Missing required param "${g}"`);u+=E}}return u||"/"}return{re:o,score:s,keys:r,parse:a,stringify:l}}function oy(i,e){let t=0;for(;t<i.length&&t<e.length;){const s=e[t]-i[t];if(s)return s;t++}return i.length<e.length?i.length===1&&i[0]===80?-1:1:i.length>e.length?e.length===1&&e[0]===80?1:-1:0}function Wf(i,e){let t=0;const s=i.score,n=e.score;for(;t<s.length&&t<n.length;){const r=oy(s[t],n[t]);if(r)return r;t++}if(Math.abs(n.length-s.length)===1){if(Rc(s))return 1;if(Rc(n))return-1}return n.length-s.length}function Rc(i){const e=i[i.length-1];return i.length>0&&e[e.length-1]<0}const ay={type:0,value:""},ly=/[a-zA-Z0-9_]/;function cy(i){if(!i)return[[]];if(i==="/")return[[ay]];if(!i.startsWith("/"))throw new Error(`Invalid path "${i}"`);function e(h){throw new Error(`ERR (${t})/"${c}": ${h}`)}let t=0,s=t;const n=[];let r;function o(){r&&n.push(r),r=[]}let a=0,l,c="",u="";function d(){c&&(t===0?r.push({type:0,value:c}):t===1||t===2||t===3?(r.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:u,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function f(){c+=l}for(;a<i.length;){if(l=i[a++],l==="\\"&&t!==2){s=t,t=4;continue}switch(t){case 0:l==="/"?(c&&d(),o()):l===":"?(d(),t=1):f();break;case 4:f(),t=s;break;case 1:l==="("?t=2:ly.test(l)?f():(d(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?u[u.length-1]=="\\"?u=u.slice(0,-1)+l:t=3:u+=l;break;case 3:d(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,u="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),d(),o(),n}function uy(i,e,t){const s=ry(cy(i.path),t),n=Me(s,{record:i,parent:e,children:[],alias:[]});return e&&!n.record.aliasOf==!e.record.aliasOf&&e.children.push(n),n}function dy(i,e){const t=[],s=new Map;e=Cc({strict:!1,end:!0,sensitive:!1},e);function n(d){return s.get(d)}function r(d,f,h){const g=!h,p=kc(d);p.aliasOf=h&&h.record;const m=Cc(e,d),x=[p];if("alias"in d){const b=typeof d.alias=="string"?[d.alias]:d.alias;for(const S of b)x.push(kc(Me({},p,{components:h?h.record.components:p.components,path:S,aliasOf:h?h.record:p})))}let E,v;for(const b of x){const{path:S}=b;if(f&&S[0]!=="/"){const w=f.record.path,L=w[w.length-1]==="/"?"":"/";b.path=f.record.path+(S&&L+S)}if(E=uy(b,f,m),h?h.alias.push(E):(v=v||E,v!==E&&v.alias.push(E),g&&d.name&&!wc(E)&&o(d.name)),qf(E)&&l(E),p.children){const w=p.children;for(let L=0;L<w.length;L++)r(w[L],E,h&&h.children[L])}h=h||E}return v?()=>{o(v)}:en}function o(d){if(Kf(d)){const f=s.get(d);f&&(s.delete(d),t.splice(t.indexOf(f),1),f.children.forEach(o),f.alias.forEach(o))}else{const f=t.indexOf(d);f>-1&&(t.splice(f,1),d.record.name&&s.delete(d.record.name),d.children.forEach(o),d.alias.forEach(o))}}function a(){return t}function l(d){const f=gy(d,t);t.splice(f,0,d),d.record.name&&!wc(d)&&s.set(d.record.name,d)}function c(d,f){let h,g={},p,m;if("name"in d&&d.name){if(h=s.get(d.name),!h)throw Di(1,{location:d});m=h.record.name,g=Me(Ic(f.params,h.keys.filter(v=>!v.optional).concat(h.parent?h.parent.keys.filter(v=>v.optional):[]).map(v=>v.name)),d.params&&Ic(d.params,h.keys.map(v=>v.name))),p=h.stringify(g)}else if(d.path!=null)p=d.path,h=t.find(v=>v.re.test(p)),h&&(g=h.parse(p),m=h.record.name);else{if(h=f.name?s.get(f.name):t.find(v=>v.re.test(f.path)),!h)throw Di(1,{location:d,currentLocation:f});m=h.record.name,g=Me({},f.params,d.params),p=h.stringify(g)}const x=[];let E=h;for(;E;)x.unshift(E.record),E=E.parent;return{name:m,path:p,params:g,matched:x,meta:hy(x)}}i.forEach(d=>r(d));function u(){t.length=0,s.clear()}return{addRoute:r,resolve:c,removeRoute:o,clearRoutes:u,getRoutes:a,getRecordMatcher:n}}function Ic(i,e){const t={};for(const s of e)s in i&&(t[s]=i[s]);return t}function kc(i){const e={path:i.path,redirect:i.redirect,name:i.name,meta:i.meta||{},aliasOf:i.aliasOf,beforeEnter:i.beforeEnter,props:fy(i),children:i.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in i?i.components||null:i.component&&{default:i.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function fy(i){const e={},t=i.props||!1;if("component"in i)e.default=t;else for(const s in i.components)e[s]=typeof t=="object"?t[s]:t;return e}function wc(i){for(;i;){if(i.record.aliasOf)return!0;i=i.parent}return!1}function hy(i){return i.reduce((e,t)=>Me(e,t.meta),{})}function Cc(i,e){const t={};for(const s in i)t[s]=s in e?e[s]:i[s];return t}function gy(i,e){let t=0,s=e.length;for(;t!==s;){const r=t+s>>1;Wf(i,e[r])<0?s=r:t=r+1}const n=my(i);return n&&(s=e.lastIndexOf(n,s-1)),s}function my(i){let e=i;for(;e=e.parent;)if(qf(e)&&Wf(i,e)===0)return e}function qf({record:i}){return!!(i.name||i.components&&Object.keys(i.components).length||i.redirect)}function py(i){const e={};if(i===""||i==="?")return e;const s=(i[0]==="?"?i.slice(1):i).split("&");for(let n=0;n<s.length;++n){const r=s[n].replace(Bf," "),o=r.indexOf("="),a=mn(o<0?r:r.slice(0,o)),l=o<0?null:mn(r.slice(o+1));if(a in e){let c=e[a];Yt(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function Dc(i){let e="";for(let t in i){const s=i[t];if(t=M0(t),s==null){s!==void 0&&(e+=(e.length?"&":"")+t);continue}(Yt(s)?s.map(r=>r&&la(r)):[s&&la(s)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}function yy(i){const e={};for(const t in i){const s=i[t];s!==void 0&&(e[t]=Yt(s)?s.map(n=>n==null?null:""+n):s==null?s:""+s)}return e}const vy=Symbol(""),Pc=Symbol(""),Jr=Symbol(""),sl=Symbol(""),ua=Symbol("");function Hi(){let i=[];function e(s){return i.push(s),()=>{const n=i.indexOf(s);n>-1&&i.splice(n,1)}}function t(){i=[]}return{add:e,list:()=>i.slice(),reset:t}}function Ns(i,e,t,s,n,r=o=>o()){const o=s&&(s.enterCallbacks[n]=s.enterCallbacks[n]||[]);return()=>new Promise((a,l)=>{const c=f=>{f===!1?l(Di(4,{from:t,to:e})):f instanceof Error?l(f):sy(f)?l(Di(2,{from:e,to:f})):(o&&s.enterCallbacks[n]===o&&typeof f=="function"&&o.push(f),a())},u=r(()=>i.call(s&&s.instances[n],e,t,c));let d=Promise.resolve(u);i.length<3&&(d=d.then(c)),d.catch(f=>l(f))})}function _o(i,e,t,s,n=r=>r()){const r=[];for(const o of i)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(Mf(l)){const u=(l.__vccOpts||l)[e];u&&r.push(Ns(u,t,s,o,a,n))}else{let c=l();r.push(()=>c.then(u=>{if(!u)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const d=_0(u)?u.default:u;o.mods[a]=u,o.components[a]=d;const h=(d.__vccOpts||d)[e];return h&&Ns(h,t,s,o,a,n)()}))}}return r}function Oc(i){const e=Nt(Jr),t=Nt(sl),s=Ye(()=>{const l=pt(i.to);return e.resolve(l)}),n=Ye(()=>{const{matched:l}=s.value,{length:c}=l,u=l[c-1],d=t.matched;if(!u||!d.length)return-1;const f=d.findIndex(Ci.bind(null,u));if(f>-1)return f;const h=Fc(l[c-2]);return c>1&&Fc(u)===h&&d[d.length-1].path!==h?d.findIndex(Ci.bind(null,l[c-2])):f}),r=Ye(()=>n.value>-1&&Sy(t.params,s.value.params)),o=Ye(()=>n.value>-1&&n.value===t.matched.length-1&&Vf(t.params,s.value.params));function a(l={}){if(Ty(l)){const c=e[pt(i.replace)?"replace":"push"](pt(i.to)).catch(en);return i.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:s,href:Ye(()=>s.value.href),isActive:r,isExactActive:o,navigate:a}}function xy(i){return i.length===1?i[0]:i}const Ey=tf({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Oc,setup(i,{slots:e}){const t=li(Oc(i)),{options:s}=Nt(Jr),n=Ye(()=>({[Mc(i.activeClass,s.linkActiveClass,"router-link-active")]:t.isActive,[Mc(i.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const r=e.default&&xy(e.default(t));return i.custom?r:el("a",{"aria-current":t.isExactActive?i.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:n.value},r)}}}),by=Ey;function Ty(i){if(!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&!i.defaultPrevented&&!(i.button!==void 0&&i.button!==0)){if(i.currentTarget&&i.currentTarget.getAttribute){const e=i.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return i.preventDefault&&i.preventDefault(),!0}}function Sy(i,e){for(const t in e){const s=e[t],n=i[t];if(typeof s=="string"){if(s!==n)return!1}else if(!Yt(n)||n.length!==s.length||s.some((r,o)=>r!==n[o]))return!1}return!0}function Fc(i){return i?i.aliasOf?i.aliasOf.path:i.path:""}const Mc=(i,e,t)=>i??e??t,Ay=tf({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(i,{attrs:e,slots:t}){const s=Nt(ua),n=Ye(()=>i.route||s.value),r=Nt(Pc,0),o=Ye(()=>{let c=pt(r);const{matched:u}=n.value;let d;for(;(d=u[c])&&!d.components;)c++;return c}),a=Ye(()=>n.value.matched[o.value]);Qn(Pc,Ye(()=>o.value+1)),Qn(vy,a),Qn(ua,n);const l=ne();return tt(()=>[l.value,a.value,i.name],([c,u,d],[f,h,g])=>{u&&(u.instances[d]=c,h&&h!==u&&c&&c===f&&(u.leaveGuards.size||(u.leaveGuards=h.leaveGuards),u.updateGuards.size||(u.updateGuards=h.updateGuards))),c&&u&&(!h||!Ci(u,h)||!f)&&(u.enterCallbacks[d]||[]).forEach(p=>p(c))},{flush:"post"}),()=>{const c=n.value,u=i.name,d=a.value,f=d&&d.components[u];if(!f)return Nc(t.default,{Component:f,route:c});const h=d.props[u],g=h?h===!0?c.params:typeof h=="function"?h(c):h:null,m=el(f,Me({},g,e,{onVnodeUnmounted:x=>{x.component.isUnmounted&&(d.instances[u]=null)},ref:l}));return Nc(t.default,{Component:m,route:c})||m}}});function Nc(i,e){if(!i)return null;const t=i(e);return t.length===1?t[0]:t}const _y=Ay;function Ly(i){const e=dy(i.routes,i),t=i.parseQuery||py,s=i.stringifyQuery||Dc,n=i.history,r=Hi(),o=Hi(),a=Hi(),l=xm(ws);let c=ws;Ei&&i.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const u=So.bind(null,G=>""+G),d=So.bind(null,B0),f=So.bind(null,mn);function h(G,oe){let ee,ce;return Kf(G)?(ee=e.getRecordMatcher(G),ce=oe):ce=G,e.addRoute(ce,ee)}function g(G){const oe=e.getRecordMatcher(G);oe&&e.removeRoute(oe)}function p(){return e.getRoutes().map(G=>G.record)}function m(G){return!!e.getRecordMatcher(G)}function x(G,oe){if(oe=Me({},oe||l.value),typeof G=="string"){const D=Ao(t,G,oe.path),W=e.resolve({path:D.path},oe),$=n.createHref(D.fullPath);return Me(D,W,{params:f(W.params),hash:mn(D.hash),redirectedFrom:void 0,href:$})}let ee;if(G.path!=null)ee=Me({},G,{path:Ao(t,G.path,oe.path).path});else{const D=Me({},G.params);for(const W in D)D[W]==null&&delete D[W];ee=Me({},G,{params:d(D)}),oe.params=d(oe.params)}const ce=e.resolve(ee,oe),De=G.hash||"";ce.params=u(f(ce.params));const A=G0(s,Me({},G,{hash:F0(De),path:ce.path})),I=n.createHref(A);return Me({fullPath:A,hash:De,query:s===Dc?yy(G.query):G.query||{}},ce,{redirectedFrom:void 0,href:I})}function E(G){return typeof G=="string"?Ao(t,G,l.value.path):Me({},G)}function v(G,oe){if(c!==G)return Di(8,{from:oe,to:G})}function b(G){return L(G)}function S(G){return b(Me(E(G),{replace:!0}))}function w(G){const oe=G.matched[G.matched.length-1];if(oe&&oe.redirect){const{redirect:ee}=oe;let ce=typeof ee=="function"?ee(G):ee;return typeof ce=="string"&&(ce=ce.includes("?")||ce.includes("#")?ce=E(ce):{path:ce},ce.params={}),Me({query:G.query,hash:G.hash,params:ce.path!=null?{}:G.params},ce)}}function L(G,oe){const ee=c=x(G),ce=l.value,De=G.state,A=G.force,I=G.replace===!0,D=w(ee);if(D)return L(Me(E(D),{state:typeof D=="object"?Me({},De,D.state):De,force:A,replace:I}),oe||ee);const W=ee;W.redirectedFrom=oe;let $;return!A&&V0(s,ce,ee)&&($=Di(16,{to:W,from:ce}),Z(ce,ce,!0,!1)),($?Promise.resolve($):_(W,ce)).catch(H=>gs(H)?gs(H,2)?H:fe(H):j(H,W,ce)).then(H=>{if(H){if(gs(H,2))return L(Me({replace:I},E(H.to),{state:typeof H.to=="object"?Me({},De,H.to.state):De,force:A}),oe||W)}else H=O(W,ce,!0,I,De);return N(W,ce,H),H})}function k(G,oe){const ee=v(G,oe);return ee?Promise.reject(ee):Promise.resolve()}function R(G){const oe=xe.values().next().value;return oe&&typeof oe.runWithContext=="function"?oe.runWithContext(G):G()}function _(G,oe){let ee;const[ce,De,A]=Ry(G,oe);ee=_o(ce.reverse(),"beforeRouteLeave",G,oe);for(const D of ce)D.leaveGuards.forEach(W=>{ee.push(Ns(W,G,oe))});const I=k.bind(null,G,oe);return ee.push(I),Ee(ee).then(()=>{ee=[];for(const D of r.list())ee.push(Ns(D,G,oe));return ee.push(I),Ee(ee)}).then(()=>{ee=_o(De,"beforeRouteUpdate",G,oe);for(const D of De)D.updateGuards.forEach(W=>{ee.push(Ns(W,G,oe))});return ee.push(I),Ee(ee)}).then(()=>{ee=[];for(const D of A)if(D.beforeEnter)if(Yt(D.beforeEnter))for(const W of D.beforeEnter)ee.push(Ns(W,G,oe));else ee.push(Ns(D.beforeEnter,G,oe));return ee.push(I),Ee(ee)}).then(()=>(G.matched.forEach(D=>D.enterCallbacks={}),ee=_o(A,"beforeRouteEnter",G,oe,R),ee.push(I),Ee(ee))).then(()=>{ee=[];for(const D of o.list())ee.push(Ns(D,G,oe));return ee.push(I),Ee(ee)}).catch(D=>gs(D,8)?D:Promise.reject(D))}function N(G,oe,ee){a.list().forEach(ce=>R(()=>ce(G,oe,ee)))}function O(G,oe,ee,ce,De){const A=v(G,oe);if(A)return A;const I=oe===ws,D=Ei?history.state:{};ee&&(ce||I?n.replace(G.fullPath,Me({scroll:I&&D&&D.scroll},De)):n.push(G.fullPath,De)),l.value=G,Z(G,oe,ee,I),fe()}let X;function te(){X||(X=n.listen((G,oe,ee)=>{if(!Q.listening)return;const ce=x(G),De=w(ce);if(De){L(Me(De,{replace:!0,force:!0}),ce).catch(en);return}c=ce;const A=l.value;Ei&&X0(Sc(A.fullPath,ee.delta),Qr()),_(ce,A).catch(I=>gs(I,12)?I:gs(I,2)?(L(Me(E(I.to),{force:!0}),ce).then(D=>{gs(D,20)&&!ee.delta&&ee.type===pn.pop&&n.go(-1,!1)}).catch(en),Promise.reject()):(ee.delta&&n.go(-ee.delta,!1),j(I,ce,A))).then(I=>{I=I||O(ce,A,!1),I&&(ee.delta&&!gs(I,8)?n.go(-ee.delta,!1):ee.type===pn.pop&&gs(I,20)&&n.go(-1,!1)),N(ce,A,I)}).catch(en)}))}let re=Hi(),q=Hi(),z;function j(G,oe,ee){fe(G);const ce=q.list();return ce.length?ce.forEach(De=>De(G,oe,ee)):console.error(G),Promise.reject(G)}function he(){return z&&l.value!==ws?Promise.resolve():new Promise((G,oe)=>{re.add([G,oe])})}function fe(G){return z||(z=!G,te(),re.list().forEach(([oe,ee])=>G?ee(G):oe()),re.reset()),G}function Z(G,oe,ee,ce){const{scrollBehavior:De}=i;if(!Ei||!De)return Promise.resolve();const A=!ee&&Q0(Sc(G.fullPath,0))||(ce||!ee)&&history.state&&history.state.scroll||null;return Hr().then(()=>De(G,oe,A)).then(I=>I&&z0(I)).catch(I=>j(I,G,oe))}const F=G=>n.go(G);let V;const xe=new Set,Q={currentRoute:l,listening:!0,addRoute:h,removeRoute:g,clearRoutes:e.clearRoutes,hasRoute:m,getRoutes:p,resolve:x,options:i,push:b,replace:S,go:F,back:()=>F(-1),forward:()=>F(1),beforeEach:r.add,beforeResolve:o.add,afterEach:a.add,onError:q.add,isReady:he,install(G){const oe=this;G.component("RouterLink",by),G.component("RouterView",_y),G.config.globalProperties.$router=oe,Object.defineProperty(G.config.globalProperties,"$route",{enumerable:!0,get:()=>pt(l)}),Ei&&!V&&l.value===ws&&(V=!0,b(n.location).catch(De=>{}));const ee={};for(const De in ws)Object.defineProperty(ee,De,{get:()=>l.value[De],enumerable:!0});G.provide(Jr,oe),G.provide(sl,Ud(ee)),G.provide(ua,l);const ce=G.unmount;xe.add(G),G.unmount=function(){xe.delete(G),xe.size<1&&(c=ws,X&&X(),X=null,l.value=ws,V=!1,z=!1),ce()}}};function Ee(G){return G.reduce((oe,ee)=>oe.then(()=>R(ee)),Promise.resolve())}return Q}function Ry(i,e){const t=[],s=[],n=[],r=Math.max(e.matched.length,i.matched.length);for(let o=0;o<r;o++){const a=e.matched[o];a&&(i.matched.find(c=>Ci(c,a))?s.push(a):t.push(a));const l=i.matched[o];l&&(e.matched.find(c=>Ci(c,l))||n.push(l))}return[t,s,n]}function Ni(){return Nt(Jr)}function Zr(i){return Nt(sl)}function Yf(i,e){return function(){return i.apply(e,arguments)}}const{toString:Iy}=Object.prototype,{getPrototypeOf:il}=Object,{iterator:eo,toStringTag:zf}=Symbol,to=(i=>e=>{const t=Iy.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),zt=i=>(i=i.toLowerCase(),e=>to(e)===i),so=i=>e=>typeof e===i,{isArray:Bi}=Array,yn=so("undefined");function ky(i){return i!==null&&!yn(i)&&i.constructor!==null&&!yn(i.constructor)&&_t(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const Xf=zt("ArrayBuffer");function wy(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&Xf(i.buffer),e}const Cy=so("string"),_t=so("function"),Qf=so("number"),io=i=>i!==null&&typeof i=="object",Dy=i=>i===!0||i===!1,tr=i=>{if(to(i)!=="object")return!1;const e=il(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(zf in i)&&!(eo in i)},Py=zt("Date"),Oy=zt("File"),Fy=zt("Blob"),My=zt("FileList"),Ny=i=>io(i)&&_t(i.pipe),By=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||_t(i.append)&&((e=to(i))==="formdata"||e==="object"&&_t(i.toString)&&i.toString()==="[object FormData]"))},$y=zt("URLSearchParams"),[Uy,Gy,Vy,Hy]=["ReadableStream","Request","Response","Headers"].map(zt),Ky=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function wn(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let s,n;if(typeof i!="object"&&(i=[i]),Bi(i))for(s=0,n=i.length;s<n;s++)e.call(null,i[s],s,i);else{const r=t?Object.getOwnPropertyNames(i):Object.keys(i),o=r.length;let a;for(s=0;s<o;s++)a=r[s],e.call(null,i[a],a,i)}}function Jf(i,e){e=e.toLowerCase();const t=Object.keys(i);let s=t.length,n;for(;s-- >0;)if(n=t[s],e===n.toLowerCase())return n;return null}const ii=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Zf=i=>!yn(i)&&i!==ii;function da(){const{caseless:i}=Zf(this)&&this||{},e={},t=(s,n)=>{const r=i&&Jf(e,n)||n;tr(e[r])&&tr(s)?e[r]=da(e[r],s):tr(s)?e[r]=da({},s):Bi(s)?e[r]=s.slice():e[r]=s};for(let s=0,n=arguments.length;s<n;s++)arguments[s]&&wn(arguments[s],t);return e}const jy=(i,e,t,{allOwnKeys:s}={})=>(wn(e,(n,r)=>{t&&_t(n)?i[r]=Yf(n,t):i[r]=n},{allOwnKeys:s}),i),Wy=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),qy=(i,e,t,s)=>{i.prototype=Object.create(e.prototype,s),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},Yy=(i,e,t,s)=>{let n,r,o;const a={};if(e=e||{},i==null)return e;do{for(n=Object.getOwnPropertyNames(i),r=n.length;r-- >0;)o=n[r],(!s||s(o,i,e))&&!a[o]&&(e[o]=i[o],a[o]=!0);i=t!==!1&&il(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},zy=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const s=i.indexOf(e,t);return s!==-1&&s===t},Xy=i=>{if(!i)return null;if(Bi(i))return i;let e=i.length;if(!Qf(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},Qy=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&il(Uint8Array)),Jy=(i,e)=>{const s=(i&&i[eo]).call(i);let n;for(;(n=s.next())&&!n.done;){const r=n.value;e.call(i,r[0],r[1])}},Zy=(i,e)=>{let t;const s=[];for(;(t=i.exec(e))!==null;)s.push(t);return s},ev=zt("HTMLFormElement"),tv=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,n){return s.toUpperCase()+n}),Bc=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),sv=zt("RegExp"),eh=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),s={};wn(t,(n,r)=>{let o;(o=e(n,r,i))!==!1&&(s[r]=o||n)}),Object.defineProperties(i,s)},iv=i=>{eh(i,(e,t)=>{if(_t(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=i[t];if(_t(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},nv=(i,e)=>{const t={},s=n=>{n.forEach(r=>{t[r]=!0})};return Bi(i)?s(i):s(String(i).split(e)),t},rv=()=>{},ov=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e;function av(i){return!!(i&&_t(i.append)&&i[zf]==="FormData"&&i[eo])}const lv=i=>{const e=new Array(10),t=(s,n)=>{if(io(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[n]=s;const r=Bi(s)?[]:{};return wn(s,(o,a)=>{const l=t(o,n+1);!yn(l)&&(r[a]=l)}),e[n]=void 0,r}}return s};return t(i,0)},cv=zt("AsyncFunction"),uv=i=>i&&(io(i)||_t(i))&&_t(i.then)&&_t(i.catch),th=((i,e)=>i?setImmediate:e?((t,s)=>(ii.addEventListener("message",({source:n,data:r})=>{n===ii&&r===t&&s.length&&s.shift()()},!1),n=>{s.push(n),ii.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",_t(ii.postMessage)),dv=typeof queueMicrotask<"u"?queueMicrotask.bind(ii):typeof process<"u"&&process.nextTick||th,fv=i=>i!=null&&_t(i[eo]),U={isArray:Bi,isArrayBuffer:Xf,isBuffer:ky,isFormData:By,isArrayBufferView:wy,isString:Cy,isNumber:Qf,isBoolean:Dy,isObject:io,isPlainObject:tr,isReadableStream:Uy,isRequest:Gy,isResponse:Vy,isHeaders:Hy,isUndefined:yn,isDate:Py,isFile:Oy,isBlob:Fy,isRegExp:sv,isFunction:_t,isStream:Ny,isURLSearchParams:$y,isTypedArray:Qy,isFileList:My,forEach:wn,merge:da,extend:jy,trim:Ky,stripBOM:Wy,inherits:qy,toFlatObject:Yy,kindOf:to,kindOfTest:zt,endsWith:zy,toArray:Xy,forEachEntry:Jy,matchAll:Zy,isHTMLForm:ev,hasOwnProperty:Bc,hasOwnProp:Bc,reduceDescriptors:eh,freezeMethods:iv,toObjectSet:nv,toCamelCase:tv,noop:rv,toFiniteNumber:ov,findKey:Jf,global:ii,isContextDefined:Zf,isSpecCompliantForm:av,toJSONObject:lv,isAsyncFn:cv,isThenable:uv,setImmediate:th,asap:dv,isIterable:fv};function Re(i,e,t,s,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),n&&(this.response=n,this.status=n.status?n.status:null)}U.inherits(Re,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:U.toJSONObject(this.config),code:this.code,status:this.status}}});const sh=Re.prototype,ih={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{ih[i]={value:i}});Object.defineProperties(Re,ih);Object.defineProperty(sh,"isAxiosError",{value:!0});Re.from=(i,e,t,s,n,r)=>{const o=Object.create(sh);return U.toFlatObject(i,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),Re.call(o,i.message,e,t,s,n),o.cause=i,o.name=i.name,r&&Object.assign(o,r),o};const hv=null;function fa(i){return U.isPlainObject(i)||U.isArray(i)}function nh(i){return U.endsWith(i,"[]")?i.slice(0,-2):i}function $c(i,e,t){return i?i.concat(e).map(function(n,r){return n=nh(n),!t&&r?"["+n+"]":n}).join(t?".":""):e}function gv(i){return U.isArray(i)&&!i.some(fa)}const mv=U.toFlatObject(U,{},null,function(e){return/^is[A-Z]/.test(e)});function no(i,e,t){if(!U.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=U.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,m){return!U.isUndefined(m[p])});const s=t.metaTokens,n=t.visitor||u,r=t.dots,o=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&U.isSpecCompliantForm(e);if(!U.isFunction(n))throw new TypeError("visitor must be a function");function c(g){if(g===null)return"";if(U.isDate(g))return g.toISOString();if(U.isBoolean(g))return g.toString();if(!l&&U.isBlob(g))throw new Re("Blob is not supported. Use a Buffer instead.");return U.isArrayBuffer(g)||U.isTypedArray(g)?l&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function u(g,p,m){let x=g;if(g&&!m&&typeof g=="object"){if(U.endsWith(p,"{}"))p=s?p:p.slice(0,-2),g=JSON.stringify(g);else if(U.isArray(g)&&gv(g)||(U.isFileList(g)||U.endsWith(p,"[]"))&&(x=U.toArray(g)))return p=nh(p),x.forEach(function(v,b){!(U.isUndefined(v)||v===null)&&e.append(o===!0?$c([p],b,r):o===null?p:p+"[]",c(v))}),!1}return fa(g)?!0:(e.append($c(m,p,r),c(g)),!1)}const d=[],f=Object.assign(mv,{defaultVisitor:u,convertValue:c,isVisitable:fa});function h(g,p){if(!U.isUndefined(g)){if(d.indexOf(g)!==-1)throw Error("Circular reference detected in "+p.join("."));d.push(g),U.forEach(g,function(x,E){(!(U.isUndefined(x)||x===null)&&n.call(e,x,U.isString(E)?E.trim():E,p,f))===!0&&h(x,p?p.concat(E):[E])}),d.pop()}}if(!U.isObject(i))throw new TypeError("data must be an object");return h(i),e}function Uc(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function nl(i,e){this._pairs=[],i&&no(i,this,e)}const rh=nl.prototype;rh.append=function(e,t){this._pairs.push([e,t])};rh.toString=function(e){const t=e?function(s){return e.call(this,s,Uc)}:Uc;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function pv(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function oh(i,e,t){if(!e)return i;const s=t&&t.encode||pv;U.isFunction(t)&&(t={serialize:t});const n=t&&t.serialize;let r;if(n?r=n(e,t):r=U.isURLSearchParams(e)?e.toString():new nl(e,t).toString(s),r){const o=i.indexOf("#");o!==-1&&(i=i.slice(0,o)),i+=(i.indexOf("?")===-1?"?":"&")+r}return i}class Gc{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){U.forEach(this.handlers,function(s){s!==null&&e(s)})}}const ah={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},yv=typeof URLSearchParams<"u"?URLSearchParams:nl,vv=typeof FormData<"u"?FormData:null,xv=typeof Blob<"u"?Blob:null,Ev={isBrowser:!0,classes:{URLSearchParams:yv,FormData:vv,Blob:xv},protocols:["http","https","file","blob","url","data"]},rl=typeof window<"u"&&typeof document<"u",ha=typeof navigator=="object"&&navigator||void 0,bv=rl&&(!ha||["ReactNative","NativeScript","NS"].indexOf(ha.product)<0),Tv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Sv=rl&&window.location.href||"http://localhost",Av=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:rl,hasStandardBrowserEnv:bv,hasStandardBrowserWebWorkerEnv:Tv,navigator:ha,origin:Sv},Symbol.toStringTag,{value:"Module"})),xt={...Av,...Ev};function _v(i,e){return no(i,new xt.classes.URLSearchParams,Object.assign({visitor:function(t,s,n,r){return xt.isNode&&U.isBuffer(t)?(this.append(s,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}function Lv(i){return U.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Rv(i){const e={},t=Object.keys(i);let s;const n=t.length;let r;for(s=0;s<n;s++)r=t[s],e[r]=i[r];return e}function lh(i){function e(t,s,n,r){let o=t[r++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=r>=t.length;return o=!o&&U.isArray(n)?n.length:o,l?(U.hasOwnProp(n,o)?n[o]=[n[o],s]:n[o]=s,!a):((!n[o]||!U.isObject(n[o]))&&(n[o]=[]),e(t,s,n[o],r)&&U.isArray(n[o])&&(n[o]=Rv(n[o])),!a)}if(U.isFormData(i)&&U.isFunction(i.entries)){const t={};return U.forEachEntry(i,(s,n)=>{e(Lv(s),n,t,0)}),t}return null}function Iv(i,e,t){if(U.isString(i))try{return(e||JSON.parse)(i),U.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(i)}const Cn={transitional:ah,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,r=U.isObject(e);if(r&&U.isHTMLForm(e)&&(e=new FormData(e)),U.isFormData(e))return n?JSON.stringify(lh(e)):e;if(U.isArrayBuffer(e)||U.isBuffer(e)||U.isStream(e)||U.isFile(e)||U.isBlob(e)||U.isReadableStream(e))return e;if(U.isArrayBufferView(e))return e.buffer;if(U.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return _v(e,this.formSerializer).toString();if((a=U.isFileList(e))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return no(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return r||n?(t.setContentType("application/json",!1),Iv(e)):e}],transformResponse:[function(e){const t=this.transitional||Cn.transitional,s=t&&t.forcedJSONParsing,n=this.responseType==="json";if(U.isResponse(e)||U.isReadableStream(e))return e;if(e&&U.isString(e)&&(s&&!this.responseType||n)){const o=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?Re.from(a,Re.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:xt.classes.FormData,Blob:xt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};U.forEach(["delete","get","head","post","put","patch"],i=>{Cn.headers[i]={}});const kv=U.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),wv=i=>{const e={};let t,s,n;return i&&i.split(`
`).forEach(function(o){n=o.indexOf(":"),t=o.substring(0,n).trim().toLowerCase(),s=o.substring(n+1).trim(),!(!t||e[t]&&kv[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Vc=Symbol("internals");function Ki(i){return i&&String(i).trim().toLowerCase()}function sr(i){return i===!1||i==null?i:U.isArray(i)?i.map(sr):String(i)}function Cv(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(i);)e[s[1]]=s[2];return e}const Dv=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function Lo(i,e,t,s,n){if(U.isFunction(s))return s.call(this,e,t);if(n&&(e=t),!!U.isString(e)){if(U.isString(s))return e.indexOf(s)!==-1;if(U.isRegExp(s))return s.test(e)}}function Pv(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function Ov(i,e){const t=U.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+t,{value:function(n,r,o){return this[s].call(this,e,n,r,o)},configurable:!0})})}let Lt=class{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function r(a,l,c){const u=Ki(l);if(!u)throw new Error("header name must be a non-empty string");const d=U.findKey(n,u);(!d||n[d]===void 0||c===!0||c===void 0&&n[d]!==!1)&&(n[d||l]=sr(a))}const o=(a,l)=>U.forEach(a,(c,u)=>r(c,u,l));if(U.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(U.isString(e)&&(e=e.trim())&&!Dv(e))o(wv(e),t);else if(U.isObject(e)&&U.isIterable(e)){let a={},l,c;for(const u of e){if(!U.isArray(u))throw TypeError("Object iterator must return a key-value pair");a[c=u[0]]=(l=a[c])?U.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}o(a,t)}else e!=null&&r(t,e,s);return this}get(e,t){if(e=Ki(e),e){const s=U.findKey(this,e);if(s){const n=this[s];if(!t)return n;if(t===!0)return Cv(n);if(U.isFunction(t))return t.call(this,n,s);if(U.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ki(e),e){const s=U.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Lo(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let n=!1;function r(o){if(o=Ki(o),o){const a=U.findKey(s,o);a&&(!t||Lo(s,s[a],a,t))&&(delete s[a],n=!0)}}return U.isArray(e)?e.forEach(r):r(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const r=t[s];(!e||Lo(this,this[r],r,e,!0))&&(delete this[r],n=!0)}return n}normalize(e){const t=this,s={};return U.forEach(this,(n,r)=>{const o=U.findKey(s,r);if(o){t[o]=sr(n),delete t[r];return}const a=e?Pv(r):String(r).trim();a!==r&&delete t[r],t[a]=sr(n),s[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return U.forEach(this,(s,n)=>{s!=null&&s!==!1&&(t[n]=e&&U.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(n=>s.set(n)),s}static accessor(e){const s=(this[Vc]=this[Vc]={accessors:{}}).accessors,n=this.prototype;function r(o){const a=Ki(o);s[a]||(Ov(n,o),s[a]=!0)}return U.isArray(e)?e.forEach(r):r(e),this}};Lt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);U.reduceDescriptors(Lt.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(s){this[t]=s}}});U.freezeMethods(Lt);function Ro(i,e){const t=this||Cn,s=e||t,n=Lt.from(s.headers);let r=s.data;return U.forEach(i,function(a){r=a.call(t,r,n.normalize(),e?e.status:void 0)}),n.normalize(),r}function ch(i){return!!(i&&i.__CANCEL__)}function $i(i,e,t){Re.call(this,i??"canceled",Re.ERR_CANCELED,e,t),this.name="CanceledError"}U.inherits($i,Re,{__CANCEL__:!0});function uh(i,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?i(t):e(new Re("Request failed with status code "+t.status,[Re.ERR_BAD_REQUEST,Re.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Fv(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function Mv(i,e){i=i||10;const t=new Array(i),s=new Array(i);let n=0,r=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=s[r];o||(o=c),t[n]=l,s[n]=c;let d=r,f=0;for(;d!==n;)f+=t[d++],d=d%i;if(n=(n+1)%i,n===r&&(r=(r+1)%i),c-o<e)return;const h=u&&c-u;return h?Math.round(f*1e3/h):void 0}}function Nv(i,e){let t=0,s=1e3/e,n,r;const o=(c,u=Date.now())=>{t=u,n=null,r&&(clearTimeout(r),r=null),i.apply(null,c)};return[(...c)=>{const u=Date.now(),d=u-t;d>=s?o(c,u):(n=c,r||(r=setTimeout(()=>{r=null,o(n)},s-d)))},()=>n&&o(n)]}const Ar=(i,e,t=3)=>{let s=0;const n=Mv(50,250);return Nv(r=>{const o=r.loaded,a=r.lengthComputable?r.total:void 0,l=o-s,c=n(l),u=o<=a;s=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:c||void 0,estimated:c&&a&&u?(a-o)/c:void 0,event:r,lengthComputable:a!=null,[e?"download":"upload"]:!0};i(d)},t)},Hc=(i,e)=>{const t=i!=null;return[s=>e[0]({lengthComputable:t,total:i,loaded:s}),e[1]]},Kc=i=>(...e)=>U.asap(()=>i(...e)),Bv=xt.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,xt.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(xt.origin),xt.navigator&&/(msie|trident)/i.test(xt.navigator.userAgent)):()=>!0,$v=xt.hasStandardBrowserEnv?{write(i,e,t,s,n,r){const o=[i+"="+encodeURIComponent(e)];U.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),U.isString(s)&&o.push("path="+s),U.isString(n)&&o.push("domain="+n),r===!0&&o.push("secure"),document.cookie=o.join("; ")},read(i){const e=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Uv(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function Gv(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function dh(i,e,t){let s=!Uv(e);return i&&(s||t==!1)?Gv(i,e):e}const jc=i=>i instanceof Lt?{...i}:i;function ci(i,e){e=e||{};const t={};function s(c,u,d,f){return U.isPlainObject(c)&&U.isPlainObject(u)?U.merge.call({caseless:f},c,u):U.isPlainObject(u)?U.merge({},u):U.isArray(u)?u.slice():u}function n(c,u,d,f){if(U.isUndefined(u)){if(!U.isUndefined(c))return s(void 0,c,d,f)}else return s(c,u,d,f)}function r(c,u){if(!U.isUndefined(u))return s(void 0,u)}function o(c,u){if(U.isUndefined(u)){if(!U.isUndefined(c))return s(void 0,c)}else return s(void 0,u)}function a(c,u,d){if(d in e)return s(c,u);if(d in i)return s(void 0,c)}const l={url:r,method:r,data:r,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,u,d)=>n(jc(c),jc(u),d,!0)};return U.forEach(Object.keys(Object.assign({},i,e)),function(u){const d=l[u]||n,f=d(i[u],e[u],u);U.isUndefined(f)&&d!==a||(t[u]=f)}),t}const fh=i=>{const e=ci({},i);let{data:t,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:r,headers:o,auth:a}=e;e.headers=o=Lt.from(o),e.url=oh(dh(e.baseURL,e.url,e.allowAbsoluteUrls),i.params,i.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let l;if(U.isFormData(t)){if(xt.hasStandardBrowserEnv||xt.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((l=o.getContentType())!==!1){const[c,...u]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([c||"multipart/form-data",...u].join("; "))}}if(xt.hasStandardBrowserEnv&&(s&&U.isFunction(s)&&(s=s(e)),s||s!==!1&&Bv(e.url))){const c=n&&r&&$v.read(r);c&&o.set(n,c)}return e},Vv=typeof XMLHttpRequest<"u",Hv=Vv&&function(i){return new Promise(function(t,s){const n=fh(i);let r=n.data;const o=Lt.from(n.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:c}=n,u,d,f,h,g;function p(){h&&h(),g&&g(),n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}let m=new XMLHttpRequest;m.open(n.method.toUpperCase(),n.url,!0),m.timeout=n.timeout;function x(){if(!m)return;const v=Lt.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders()),S={data:!a||a==="text"||a==="json"?m.responseText:m.response,status:m.status,statusText:m.statusText,headers:v,config:i,request:m};uh(function(L){t(L),p()},function(L){s(L),p()},S),m=null}"onloadend"in m?m.onloadend=x:m.onreadystatechange=function(){!m||m.readyState!==4||m.status===0&&!(m.responseURL&&m.responseURL.indexOf("file:")===0)||setTimeout(x)},m.onabort=function(){m&&(s(new Re("Request aborted",Re.ECONNABORTED,i,m)),m=null)},m.onerror=function(){s(new Re("Network Error",Re.ERR_NETWORK,i,m)),m=null},m.ontimeout=function(){let b=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const S=n.transitional||ah;n.timeoutErrorMessage&&(b=n.timeoutErrorMessage),s(new Re(b,S.clarifyTimeoutError?Re.ETIMEDOUT:Re.ECONNABORTED,i,m)),m=null},r===void 0&&o.setContentType(null),"setRequestHeader"in m&&U.forEach(o.toJSON(),function(b,S){m.setRequestHeader(S,b)}),U.isUndefined(n.withCredentials)||(m.withCredentials=!!n.withCredentials),a&&a!=="json"&&(m.responseType=n.responseType),c&&([f,g]=Ar(c,!0),m.addEventListener("progress",f)),l&&m.upload&&([d,h]=Ar(l),m.upload.addEventListener("progress",d),m.upload.addEventListener("loadend",h)),(n.cancelToken||n.signal)&&(u=v=>{m&&(s(!v||v.type?new $i(null,i,m):v),m.abort(),m=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const E=Fv(n.url);if(E&&xt.protocols.indexOf(E)===-1){s(new Re("Unsupported protocol "+E+":",Re.ERR_BAD_REQUEST,i));return}m.send(r||null)})},Kv=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let s=new AbortController,n;const r=function(c){if(!n){n=!0,a();const u=c instanceof Error?c:this.reason;s.abort(u instanceof Re?u:new $i(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,r(new Re(`timeout ${e} of ms exceeded`,Re.ETIMEDOUT))},e);const a=()=>{i&&(o&&clearTimeout(o),o=null,i.forEach(c=>{c.unsubscribe?c.unsubscribe(r):c.removeEventListener("abort",r)}),i=null)};i.forEach(c=>c.addEventListener("abort",r));const{signal:l}=s;return l.unsubscribe=()=>U.asap(a),l}},jv=function*(i,e){let t=i.byteLength;if(t<e){yield i;return}let s=0,n;for(;s<t;)n=s+e,yield i.slice(s,n),s=n},Wv=async function*(i,e){for await(const t of qv(i))yield*jv(t,e)},qv=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},Wc=(i,e,t,s)=>{const n=Wv(i,e);let r=0,o,a=l=>{o||(o=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await n.next();if(c){a(),l.close();return}let d=u.byteLength;if(t){let f=r+=d;t(f)}l.enqueue(new Uint8Array(u))}catch(c){throw a(c),c}},cancel(l){return a(l),n.return()}},{highWaterMark:2})},ro=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",hh=ro&&typeof ReadableStream=="function",Yv=ro&&(typeof TextEncoder=="function"?(i=>e=>i.encode(e))(new TextEncoder):async i=>new Uint8Array(await new Response(i).arrayBuffer())),gh=(i,...e)=>{try{return!!i(...e)}catch{return!1}},zv=hh&&gh(()=>{let i=!1;const e=new Request(xt.origin,{body:new ReadableStream,method:"POST",get duplex(){return i=!0,"half"}}).headers.has("Content-Type");return i&&!e}),qc=64*1024,ga=hh&&gh(()=>U.isReadableStream(new Response("").body)),_r={stream:ga&&(i=>i.body)};ro&&(i=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!_r[e]&&(_r[e]=U.isFunction(i[e])?t=>t[e]():(t,s)=>{throw new Re(`Response type '${e}' is not supported`,Re.ERR_NOT_SUPPORT,s)})})})(new Response);const Xv=async i=>{if(i==null)return 0;if(U.isBlob(i))return i.size;if(U.isSpecCompliantForm(i))return(await new Request(xt.origin,{method:"POST",body:i}).arrayBuffer()).byteLength;if(U.isArrayBufferView(i)||U.isArrayBuffer(i))return i.byteLength;if(U.isURLSearchParams(i)&&(i=i+""),U.isString(i))return(await Yv(i)).byteLength},Qv=async(i,e)=>{const t=U.toFiniteNumber(i.getContentLength());return t??Xv(e)},Jv=ro&&(async i=>{let{url:e,method:t,data:s,signal:n,cancelToken:r,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:c,headers:u,withCredentials:d="same-origin",fetchOptions:f}=fh(i);c=c?(c+"").toLowerCase():"text";let h=Kv([n,r&&r.toAbortSignal()],o),g;const p=h&&h.unsubscribe&&(()=>{h.unsubscribe()});let m;try{if(l&&zv&&t!=="get"&&t!=="head"&&(m=await Qv(u,s))!==0){let S=new Request(e,{method:"POST",body:s,duplex:"half"}),w;if(U.isFormData(s)&&(w=S.headers.get("content-type"))&&u.setContentType(w),S.body){const[L,k]=Hc(m,Ar(Kc(l)));s=Wc(S.body,qc,L,k)}}U.isString(d)||(d=d?"include":"omit");const x="credentials"in Request.prototype;g=new Request(e,{...f,signal:h,method:t.toUpperCase(),headers:u.normalize().toJSON(),body:s,duplex:"half",credentials:x?d:void 0});let E=await fetch(g,f);const v=ga&&(c==="stream"||c==="response");if(ga&&(a||v&&p)){const S={};["status","statusText","headers"].forEach(R=>{S[R]=E[R]});const w=U.toFiniteNumber(E.headers.get("content-length")),[L,k]=a&&Hc(w,Ar(Kc(a),!0))||[];E=new Response(Wc(E.body,qc,L,()=>{k&&k(),p&&p()}),S)}c=c||"text";let b=await _r[U.findKey(_r,c)||"text"](E,i);return!v&&p&&p(),await new Promise((S,w)=>{uh(S,w,{data:b,headers:Lt.from(E.headers),status:E.status,statusText:E.statusText,config:i,request:g})})}catch(x){throw p&&p(),x&&x.name==="TypeError"&&/Load failed|fetch/i.test(x.message)?Object.assign(new Re("Network Error",Re.ERR_NETWORK,i,g),{cause:x.cause||x}):Re.from(x,x&&x.code,i,g)}}),ma={http:hv,xhr:Hv,fetch:Jv};U.forEach(ma,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const Yc=i=>`- ${i}`,Zv=i=>U.isFunction(i)||i===null||i===!1,mh={getAdapter:i=>{i=U.isArray(i)?i:[i];const{length:e}=i;let t,s;const n={};for(let r=0;r<e;r++){t=i[r];let o;if(s=t,!Zv(t)&&(s=ma[(o=String(t)).toLowerCase()],s===void 0))throw new Re(`Unknown adapter '${o}'`);if(s)break;n[o||"#"+r]=s}if(!s){const r=Object.entries(n).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?r.length>1?`since :
`+r.map(Yc).join(`
`):" "+Yc(r[0]):"as no adapter specified";throw new Re("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:ma};function Io(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new $i(null,i)}function zc(i){return Io(i),i.headers=Lt.from(i.headers),i.data=Ro.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),mh.getAdapter(i.adapter||Cn.adapter)(i).then(function(s){return Io(i),s.data=Ro.call(i,i.transformResponse,s),s.headers=Lt.from(s.headers),s},function(s){return ch(s)||(Io(i),s&&s.response&&(s.response.data=Ro.call(i,i.transformResponse,s.response),s.response.headers=Lt.from(s.response.headers))),Promise.reject(s)})}const ph="1.10.0",oo={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{oo[i]=function(s){return typeof s===i||"a"+(e<1?"n ":" ")+i}});const Xc={};oo.transitional=function(e,t,s){function n(r,o){return"[Axios v"+ph+"] Transitional option '"+r+"'"+o+(s?". "+s:"")}return(r,o,a)=>{if(e===!1)throw new Re(n(o," has been removed"+(t?" in "+t:"")),Re.ERR_DEPRECATED);return t&&!Xc[o]&&(Xc[o]=!0,console.warn(n(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(r,o,a):!0}};oo.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function ex(i,e,t){if(typeof i!="object")throw new Re("options must be an object",Re.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let n=s.length;for(;n-- >0;){const r=s[n],o=e[r];if(o){const a=i[r],l=a===void 0||o(a,r,i);if(l!==!0)throw new Re("option "+r+" must be "+l,Re.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Re("Unknown option "+r,Re.ERR_BAD_OPTION)}}const ir={assertOptions:ex,validators:oo},es=ir.validators;let oi=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Gc,response:new Gc}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const r=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ci(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:r}=t;s!==void 0&&ir.assertOptions(s,{silentJSONParsing:es.transitional(es.boolean),forcedJSONParsing:es.transitional(es.boolean),clarifyTimeoutError:es.transitional(es.boolean)},!1),n!=null&&(U.isFunction(n)?t.paramsSerializer={serialize:n}:ir.assertOptions(n,{encode:es.function,serialize:es.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ir.assertOptions(t,{baseUrl:es.spelling("baseURL"),withXsrfToken:es.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=r&&U.merge(r.common,r[t.method]);r&&U.forEach(["delete","get","head","post","put","patch","common"],g=>{delete r[g]}),t.headers=Lt.concat(o,r);const a=[];let l=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(l=l&&p.synchronous,a.unshift(p.fulfilled,p.rejected))});const c=[];this.interceptors.response.forEach(function(p){c.push(p.fulfilled,p.rejected)});let u,d=0,f;if(!l){const g=[zc.bind(this),void 0];for(g.unshift.apply(g,a),g.push.apply(g,c),f=g.length,u=Promise.resolve(t);d<f;)u=u.then(g[d++],g[d++]);return u}f=a.length;let h=t;for(d=0;d<f;){const g=a[d++],p=a[d++];try{h=g(h)}catch(m){p.call(this,m);break}}try{u=zc.call(this,h)}catch(g){return Promise.reject(g)}for(d=0,f=c.length;d<f;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=ci(this.defaults,e);const t=dh(e.baseURL,e.url,e.allowAbsoluteUrls);return oh(t,e.params,e.paramsSerializer)}};U.forEach(["delete","get","head","options"],function(e){oi.prototype[e]=function(t,s){return this.request(ci(s||{},{method:e,url:t,data:(s||{}).data}))}});U.forEach(["post","put","patch"],function(e){function t(s){return function(r,o,a){return this.request(ci(a||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}oi.prototype[e]=t(),oi.prototype[e+"Form"]=t(!0)});let tx=class yh{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(r){t=r});const s=this;this.promise.then(n=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](n);s._listeners=null}),this.promise.then=n=>{let r;const o=new Promise(a=>{s.subscribe(a),r=a}).then(n);return o.cancel=function(){s.unsubscribe(r)},o},e(function(r,o,a){s.reason||(s.reason=new $i(r,o,a),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new yh(function(n){e=n}),cancel:e}}};function sx(i){return function(t){return i.apply(null,t)}}function ix(i){return U.isObject(i)&&i.isAxiosError===!0}const pa={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(pa).forEach(([i,e])=>{pa[e]=i});function vh(i){const e=new oi(i),t=Yf(oi.prototype.request,e);return U.extend(t,oi.prototype,e,{allOwnKeys:!0}),U.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return vh(ci(i,n))},t}const Xe=vh(Cn);Xe.Axios=oi;Xe.CanceledError=$i;Xe.CancelToken=tx;Xe.isCancel=ch;Xe.VERSION=ph;Xe.toFormData=no;Xe.AxiosError=Re;Xe.Cancel=Xe.CanceledError;Xe.all=function(e){return Promise.all(e)};Xe.spread=sx;Xe.isAxiosError=ix;Xe.mergeConfig=ci;Xe.AxiosHeaders=Lt;Xe.formToJSON=i=>lh(U.isHTMLForm(i)?new FormData(i):i);Xe.getAdapter=mh.getAdapter;Xe.HttpStatusCode=pa;Xe.default=Xe;const{Axios:qI,AxiosError:YI,CanceledError:zI,isCancel:XI,CancelToken:QI,VERSION:JI,all:ZI,Cancel:e1,isAxiosError:t1,spread:s1,toFormData:i1,AxiosHeaders:n1,HttpStatusCode:r1,formToJSON:o1,getAdapter:a1,mergeConfig:l1}=Xe,nx="/api",dt=Xe.create({baseURL:nx});dt.interceptors.request.use(i=>{const e=localStorage.getItem("access");return e&&(i.headers.Authorization=`Bearer ${e}`),i},i=>Promise.reject(i));dt.interceptors.response.use(i=>i,i=>(i.response&&i.response.status===401&&(localStorage.removeItem("access"),localStorage.removeItem("refresh"),localStorage.removeItem("username"),window.location.href="/login"),Promise.reject(i)));const xh=async(i,e)=>{const t=await dt.post("/token/",{username:i,password:e});return localStorage.setItem("access",t.data.access),localStorage.setItem("refresh",t.data.refresh),t.data},rx=async(i,e,t,s)=>(await dt.post("/auth/register/",{username:i,email:e,password:t,password2:s})).data,nr=async(i={})=>(await dt.get("/videos/",{params:i})).data,ox=async i=>(await dt.get(`/bookmarks/${i}/`)).data,ax=async()=>{localStorage.removeItem("access"),localStorage.removeItem("refresh"),localStorage.removeItem("username")},lx=async i=>(await dt.post("/scrape-metadata/",{url:i})).data,cx=async i=>(await dt.post("/bookmarks/manual-create/",i)).data,ux=async i=>(await dt.get(`/profile/${i}/`)).data,dx=async()=>(await dt.get("/profile/me/")).data,fx=async i=>(await dt.patch("/profile/me/",i,{headers:{"Content-Type":"multipart/form-data"}})).data,hx=async i=>dt.post("/auth/password-reset/",{email:i}),gx=async({uidb64:i,token:e,new_password1:t,new_password2:s})=>dt.post("/auth/password-reset-confirm/",{uidb64:i,token:e,new_password1:t,new_password2:s}),Es=ne(!!localStorage.getItem("access")),ol=ne(localStorage.getItem("username"));function Lr(){Es.value=!!localStorage.getItem("access"),ol.value=localStorage.getItem("username")}window.addEventListener("storage",()=>{Es.value=!!localStorage.getItem("access"),ol.value=localStorage.getItem("username")});const ds=(i,e)=>{const t=i.__vccOpts||i;for(const[s,n]of e)t[s]=n;return t},mx={class:"min-h-screen flex flex-col"},px={class:"sticky top-0 z-50 bg-surface/70 backdrop-blur-md shadow-md"},yx={class:"container mx-auto"},vx={class:"flex items-center justify-between h-16 px-4"},xx={class:"hidden md:flex items-center space-x-4"},Ex={key:0,class:"w-7 h-7 text-text-main",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},bx={key:1,class:"w-7 h-7 text-text-main",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},Tx={class:"hidden md:flex items-center space-x-2"},Sx={key:0,class:"md:hidden fixed top-16 inset-x-0 bottom-0 z-40"},Ax={class:"relative flex w-full max-w-xs flex-col h-full bg-surface p-4 sm:p-6 shadow-2xl"},_x={class:"flex-1 space-y-2"},Lx={class:"mt-auto pt-6 border-t border-gray-200/80"},Rx={class:"space-y-3"},Ix={class:"flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8"},kx={class:"rounded-2xl bg-surface/80 shadow-xl border border-gray-700 backdrop-blur-lg transition-all"},wx={class:"p-4 sm:p-6"},Cx={class:"bg-surface/70 backdrop-blur-md border-t border-gray-700 shadow-inner mt-auto"},Dx={class:"container mx-auto px-4 py-8 sm:px-6 lg:px-8"},Px={class:"grid grid-cols-1 md:grid-cols-4 gap-8"},Ox={class:"col-span-1"},Fx={class:"space-y-2"},Mx={class:"col-span-1"},Nx={class:"space-y-2"},Bx={class:"mt-8 pt-4 border-t border-gray-700 text-center"},$x={class:"text-sm text-text-secondary"},Ux={__name:"App",setup(i){const e=Ni(),t=new Date().getFullYear(),s=ne(!1),n=Ye(()=>ol.value||localStorage.getItem("username")),r=async()=>{try{await ax(),Lr(),e.push({name:"home"})}catch{Lr(),e.push({name:"home"})}s.value=!1},o=()=>{e.push({name:"CreateBookmark"}),s.value=!1};return(a,l)=>{const c=Ls("router-link"),u=Ls("router-view");return M(),B("div",mx,[T("header",px,[T("div",yx,[T("div",vx,[Se(c,{to:{name:"home"},class:"flex items-center space-x-2 group"},{default:Ge(()=>l[6]||(l[6]=[T("img",{src:Ec,alt:"Site Logo",class:"site-logo"},null,-1),T("span",{class:"ml-2 px-2 py-0.5 rounded-full bg-blue-100/70 text-xs font-semibold text-blue-700 uppercase tracking-wider shadow-sm"}," Beta ",-1)])),_:1,__:[6]}),T("nav",xx,[Se(c,{to:{name:"home"},class:"text-sm font-medium text-text-main hover:text-primary transition"},{default:Ge(()=>l[7]||(l[7]=[_e(" Home ")])),_:1,__:[7]}),pt(Es)?(M(),cs(c,{key:0,to:{name:"user-profile",params:{username:n.value}},class:"text-sm font-medium text-text-main hover:text-primary transition"},{default:Ge(()=>l[8]||(l[8]=[_e(" Profile ")])),_:1,__:[8]},8,["to"])):ve("",!0),pt(Es)?(M(),B("button",{key:1,onClick:o,class:"inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium bg-primary/90 text-white shadow-lg hover:bg-primary transition focus:outline-none focus:ring-2 focus:ring-blue-400/40"},l[9]||(l[9]=[T("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[T("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),_e(" Add Bookmark ")]))):ve("",!0)]),T("button",{class:"md:hidden flex items-center justify-center p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-400",onClick:l[0]||(l[0]=d=>s.value=!s.value),"aria-label":"Open navigation"},[s.value?(M(),B("svg",bx,l[11]||(l[11]=[T("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):(M(),B("svg",Ex,l[10]||(l[10]=[T("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 6h16M4 12h16M4 18h16"},null,-1)])))]),T("div",Tx,[pt(Es)?(M(),B("button",{key:1,onClick:r,class:"px-4 py-1.5 rounded-full text-sm font-medium text-text-main bg-surface/60 shadow hover:bg-red-500/20 transition focus:outline-none focus:ring-2 focus:ring-red-400/40"}," Log out ")):(M(),B(ke,{key:0},[Se(c,{to:{name:"login"},class:"px-4 py-1.5 rounded-full text-sm font-medium text-text-main bg-surface/60 shadow hover:bg-surface/80 transition focus:outline-none focus:ring-2 focus:ring-blue-400/40"},{default:Ge(()=>l[12]||(l[12]=[_e(" Log in ")])),_:1,__:[12]}),Se(c,{to:{name:"register"},class:"px-4 py-1.5 rounded-full text-sm font-semibold bg-primary/90 text-white shadow-lg hover:bg-primary transition focus:outline-none focus:ring-2 focus:ring-blue-400/40"},{default:Ge(()=>l[13]||(l[13]=[_e(" Sign up ")])),_:1,__:[13]})],64))])])])]),Se(wf,{name:"slide"},{default:Ge(()=>[s.value?(M(),B("div",Sx,[T("div",{onClick:l[1]||(l[1]=d=>s.value=!1),class:"absolute inset-0 bg-black/40 backdrop-blur-sm","aria-hidden":"true"}),T("div",Ax,[T("nav",_x,[Se(c,{to:{name:"home"},onClick:l[2]||(l[2]=d=>s.value=!1),class:"flex items-center px-3 py-2 rounded-md text-base font-medium text-text-main hover:bg-background transition-colors"},{default:Ge(()=>l[14]||(l[14]=[_e(" Home ")])),_:1,__:[14]}),pt(Es)?(M(),cs(c,{key:0,to:{name:"user-profile",params:{username:n.value}},onClick:l[3]||(l[3]=d=>s.value=!1),class:"flex items-center px-3 py-2 rounded-md text-base font-medium text-text-main hover:bg-background transition-colors"},{default:Ge(()=>l[15]||(l[15]=[_e(" Profile ")])),_:1,__:[15]},8,["to"])):ve("",!0)]),T("div",Lx,[T("div",Rx,[pt(Es)?(M(),B("button",{key:0,onClick:o,class:"w-full inline-flex items-center justify-center px-4 py-2.5 rounded-lg text-base font-medium bg-primary/90 text-white shadow-lg hover:bg-primary transition"},l[16]||(l[16]=[T("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[T("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),_e(" Add Bookmark ")]))):ve("",!0),pt(Es)?(M(),B("button",{key:2,onClick:r,class:"w-full flex items-center justify-center px-4 py-2.5 rounded-lg text-base font-medium text-text-main bg-background hover:bg-surface transition"}," Log out ")):(M(),B(ke,{key:1},[Se(c,{to:{name:"login"},onClick:l[4]||(l[4]=d=>s.value=!1),class:"w-full flex items-center justify-center px-4 py-2.5 rounded-lg text-base font-medium text-text-main bg-background hover:bg-surface transition"},{default:Ge(()=>l[17]||(l[17]=[_e(" Log in ")])),_:1,__:[17]}),Se(c,{to:{name:"register"},onClick:l[5]||(l[5]=d=>s.value=!1),class:"w-full flex items-center justify-center px-4 py-2.5 rounded-lg text-base font-semibold bg-primary/90 text-white shadow-lg hover:bg-primary transition"},{default:Ge(()=>l[18]||(l[18]=[_e(" Sign up ")])),_:1,__:[18]})],64))])])])])):ve("",!0)]),_:1}),T("main",Ix,[T("div",kx,[T("div",wx,[Se(u)])])]),T("footer",Cx,[T("div",Dx,[T("div",Px,[l[25]||(l[25]=In('<div class="col-span-1 md:col-span-2" data-v-d81cc89a><div class="flex items-center mb-4" data-v-d81cc89a><img src="'+Ec+'" alt="MyVidVault Logo" class="h-9 aspect-square object-contain drop-shadow-md" data-v-d81cc89a></div><p class="text-text-main text-sm mb-4 max-w-md" data-v-d81cc89a> Your personal video collection manager. Save, organize, and discover videos from across the web in one convenient place. </p><div class="flex space-x-4" data-v-d81cc89a><a href="https://discord.gg/eevztZDqg3" target="_blank" rel="noopener noreferrer" class="rounded-full bg-surface/70 p-2 shadow hover:bg-primary/20 transition" data-v-d81cc89a><span class="sr-only" data-v-d81cc89a>Discord</span><svg class="h-6 w-6 text-primary" fill="currentColor" viewBox="0 0 24 24" data-v-d81cc89a><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z" data-v-d81cc89a></path></svg></a><a href="https://x.com/Myvidvault" target="_blank" rel="noopener noreferrer" class="rounded-full bg-surface/70 p-2 shadow hover:bg-primary/20 transition" data-v-d81cc89a><span class="sr-only" data-v-d81cc89a>Twitter</span><svg class="h-6 w-6 text-primary" fill="currentColor" viewBox="0 0 24 24" data-v-d81cc89a><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" data-v-d81cc89a></path></svg></a></div></div>',1)),T("div",Ox,[l[21]||(l[21]=T("h3",{class:"text-sm font-semibold uppercase tracking-wider text-text-secondary mb-4"}," Resources ",-1)),T("ul",Fx,[T("li",null,[Se(c,{to:{name:"contact"},class:"text-base text-text-main hover:text-primary transition"},{default:Ge(()=>l[19]||(l[19]=[_e(" Contact Us ")])),_:1,__:[19]})]),T("li",null,[Se(c,{to:{name:"careers"},class:"text-base text-primary hover:underline"},{default:Ge(()=>l[20]||(l[20]=[_e(" Volunteer Opportunities ")])),_:1,__:[20]})])])]),T("div",Mx,[l[24]||(l[24]=T("h3",{class:"text-sm font-semibold uppercase tracking-wider text-text-secondary mb-4"}," Legal ",-1)),T("ul",Nx,[T("li",null,[Se(c,{to:{name:"privacy"},class:"text-base text-text-main hover:text-primary transition"},{default:Ge(()=>l[22]||(l[22]=[_e(" Privacy Policy ")])),_:1,__:[22]})]),T("li",null,[Se(c,{to:{name:"terms"},class:"text-base text-text-main hover:text-primary transition"},{default:Ge(()=>l[23]||(l[23]=[_e(" Terms of Service ")])),_:1,__:[23]})])])])]),T("div",Bx,[T("p",$x,"  "+ue(pt(t))+" MyVidVault. All rights reserved. ",1),l[26]||(l[26]=T("p",{class:"mt-2 text-sm"},[T("a",{href:"https://throne.com/myvidvault",target:"_blank",rel:"noopener noreferrer",class:"text-primary hover:underline"}," Support MyVidVault ")],-1))])])])])}}},Gx=ds(Ux,[["__scopeId","data-v-d81cc89a"]]),Qc="orientationFilter",al=A0("orientation",()=>{const i=[{id:"all",name:"All"},{id:"straight",name:"Straight"},{id:"gay",name:"Gay"},{id:"bi",name:"Bi"},{id:"trans",name:"Trans"},{id:"sfw",name:"SFW"}],e=ne(localStorage.getItem(Qc)||"all");function t(s){e.value=s,localStorage.setItem(Qc,s)}return{orientationFilters:i,selectedOrientation:e,setOrientation:t}}),Vx={class:"flex flex-row flex-wrap gap-1"},Hx=["onClick"],rr={__name:"OrientationFilter",setup(i){const e=al();return(t,s)=>(M(),B("div",Vx,[(M(!0),B(ke,null,Et(pt(e).orientationFilters,n=>(M(),B("button",{key:n.id,onClick:r=>pt(e).setOrientation(n.id),class:Kt([pt(e).selectedOrientation===n.id?"bg-primary/20 text-primary shadow-sm":"bg-surface text-text-secondary hover:bg-background","px-3 py-1.5 rounded-md text-xs sm:text-sm font-medium focus:outline-none transition-all"])},ue(n.name),11,Hx))),128))]))}},Kx={key:0,class:"mb-4"},jx={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 animate-fade-in"},Wx={key:2,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-4"},qx={class:"relative aspect-video bg-background"},Yx=["alt"],zx={class:"p-2 flex-1 flex flex-col"},Xx={class:"font-semibold text-xs mb-1 line-clamp-2 text-text-main"},Qx={key:0,class:"flex flex-wrap gap-1 my-1"},Jx=["onClick"],Zx={class:"flex items-center gap-2 mt-auto"},eE={class:"text-xs truncate max-w-[80px] text-text-secondary"},tE={key:3,class:"fixed bottom-0 left-0 right-0 p-4 flex justify-center items-center z-50"},sE={class:"flex items-center gap-2 bg-surface/80 backdrop-blur-md border border-gray-700 rounded-full shadow-lg px-4 py-2"},iE=["disabled"],nE={class:"text-sm text-text-secondary px-2 font-medium"},rE=["disabled"],oE={__name:"BookmarkGrid",props:{fetchBookmarks:{type:Function,required:!0},showPagination:{type:Boolean,default:!0},filters:{type:Object,default:()=>({})},showSearch:{type:Boolean,default:!1},currentPage:{type:Number,default:1}},emits:["update:search","update:page"],setup(i,{emit:e}){const t=i,s=e,n=ne(!1),r=ne([]),o=ne(25),a=ne(0),l=ne(t.filters.q||"");let c=null;const u=Ye(()=>Math.max(1,Math.ceil(a.value/o.value))),d=async()=>{n.value=!0;try{const E={page:t.currentPage,page_size:o.value,...t.filters,...l.value?{q:l.value}:{}},v=await t.fetchBookmarks(E);r.value=v.results.map(b=>({...b,thumbnail:null})),a.value=v.count}catch{r.value=[],a.value=0}n.value=!1};function f(){s("update:search",l.value),s("update:page",1)}function h(E){l.value=E}tt(l,()=>{clearTimeout(c),c=setTimeout(()=>{f()},300)});function g(){t.currentPage>1&&s("update:page",t.currentPage-1)}function p(){t.currentPage<u.value&&s("update:page",t.currentPage+1)}fi(d);const m={mounted:(E,v)=>{const b=new IntersectionObserver(S=>{S.forEach(w=>{if(w.isIntersecting){const L=v.value;L&&L.thumbnail_url?E.src=L.thumbnail_url:E.src="/media/default.jpg",b.unobserve(E)}})},{rootMargin:"0px 0px 200px 0px"});b.observe(E)}};tt(()=>[t.currentPage,t.filters],d,{deep:!0});const x=E=>{E.target.src="/media/default.jpg"};return(E,v)=>{const b=Ls("router-link");return M(),B("div",null,[i.showSearch?(M(),B("div",Kx,[Be(T("input",{"onUpdate:modelValue":v[0]||(v[0]=S=>l.value=S),type:"text",placeholder:"Search by title, description, or tag...",class:"w-full px-3 py-2 border border-gray-600 rounded shadow-sm focus:outline-none focus:ring focus:border-primary bg-surface text-text-main placeholder-text-secondary"},null,512),[[ot,l.value]])])):ve("",!0),n.value?(M(),B("div",jx,[(M(),B(ke,null,Et(8,S=>T("div",{key:S,class:"rounded-lg bg-surface shadow border border-gray-700 flex flex-col overflow-hidden min-h-[180px]"},v[1]||(v[1]=[T("div",{class:"aspect-video bg-background animate-pulse"},null,-1),T("div",{class:"h-4 w-2/3 bg-background rounded animate-pulse mt-2 mx-4"},null,-1)]))),64))])):(M(),B("div",Wx,[(M(!0),B(ke,null,Et(r.value,S=>(M(),cs(b,{key:S.id,to:{name:"bookmark-detail",params:{id:S.id}},class:"group rounded-lg bg-surface shadow border border-gray-700 flex flex-col transition hover:shadow-lg overflow-hidden relative"},{default:Ge(()=>[T("div",qx,[Be(T("img",{alt:S.title,onError:x,class:"object-cover w-full h-full transition-transform duration-200 group-hover:scale-105"},null,40,Yx),[[m,S]]),v[2]||(v[2]=T("div",{class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition bg-black/40"},[T("svg",{class:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[T("path",{d:"M8 5v14l11-7z"})])],-1))]),T("div",zx,[T("h2",Xx,ue(S.title),1),S.tags&&S.tags.length?(M(),B("div",Qx,[(M(!0),B(ke,null,Et(S.tags.slice(0,2),w=>(M(),B("button",{key:w,onClick:Is(L=>h(w),["prevent"]),class:"px-1.5 py-0.5 bg-primary/10 text-primary/80 rounded-full text-[10px] font-semibold hover:bg-primary/20 transition"},ue(w),9,Jx))),128))])):ve("",!0),T("div",Zx,[T("span",eE,ue(S.user_username),1)])])]),_:2},1032,["to"]))),128))])),i.showPagination&&u.value>1?(M(),B("div",tE,[T("div",sE,[T("button",{class:"px-4 py-2 bg-surface border border-gray-600 text-text-main rounded-full text-sm font-medium hover:bg-background disabled:opacity-50 transition",disabled:i.currentPage===1,onClick:g}," Previous ",8,iE),T("span",nE,"Page "+ue(i.currentPage)+" of "+ue(u.value),1),T("button",{class:"px-4 py-2 bg-surface border border-gray-600 text-text-main rounded-full text-sm font-medium hover:bg-background disabled:opacity-50 transition",disabled:i.currentPage===u.value,onClick:p}," Next ",8,rE)])])):ve("",!0)])}}},or=ds(oE,[["__scopeId","data-v-d4c018f6"]]),aE={class:"container mx-auto px-4 py-6"},lE={class:"flex-grow"},cE={class:"mb-4 text-sm text-text-secondary"},uE={class:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},dE={class:"border-b border-gray-700 overflow-hidden"},fE={class:"-mb-px flex space-x-4 sm:space-x-6 overflow-x-auto pb-px","aria-label":"Sort Tabs"},hE=["onClick"],gE={class:"flex flex-wrap gap-2 w-full sm:w-auto items-center"},mE={class:"flex items-center gap-1 flex-shrink-0 py-1 px-1 rounded-md bg-surface w-full sm:w-auto"},Jc=25,pE={__name:"Home",setup(i){const e=Zr(),t=Ni(),s=al(),n=ne(Number(e.query.page)||1),r=ne(e.query.sort||"all"),o=ne(e.query.q||""),a=[{id:"all",name:"All"},{id:"popular",name:"Popular"},{id:"random",name:"Random"},{id:"following",name:"Following"}];e.query.orientation&&s.selectedOrientation!==e.query.orientation&&s.setOrientation(e.query.orientation),tt([n,r,()=>s.selectedOrientation,o],([h,g,p,m])=>{t.replace({query:{...e.query,page:h,sort:g,orientation:p,q:m}})}),tt(()=>e.query,h=>{h.page&&(n.value=Number(h.page)),h.sort&&(r.value=h.sort),h.orientation&&s.selectedOrientation!==h.orientation&&s.setOrientation(h.orientation),h.q!==void 0&&(o.value=h.q)});const l=ne(0),c=Ye(()=>Math.max(1,Math.ceil(l.value/Jc))),u=Ye(()=>{const h={page:n.value,page_size:Jc,sort:r.value};return s.selectedOrientation!=="all"&&(h.orientation=s.selectedOrientation),o.value&&(h.q=o.value),r.value==="following"&&(h.following=!0),h}),d=async h=>{const g=await nr(h);return l.value=g.count,g};function f(h){o.value=h,n.value=1}return tt(r,()=>{n.value=1}),tt(()=>s.selectedOrientation,()=>{n.value=1}),(h,g)=>(M(),B("div",aE,[T("div",lE,[g[2]||(g[2]=T("h1",{class:"text-2xl font-semibold mb-1 text-text-main"},"Explore Bookmarks",-1)),T("div",cE," Page "+ue(n.value)+" of "+ue(c.value)+" ("+ue(l.value)+" results) ",1),T("div",uE,[T("div",dE,[T("nav",fE,[(M(),B(ke,null,Et(a,p=>T("button",{key:p.id,onClick:m=>r.value=p.id,class:Kt([r.value===p.id?"border-primary text-primary":"border-transparent text-text-secondary hover:text-text-main hover:border-gray-600","whitespace-nowrap py-3 px-1 sm:px-2 border-b-2 font-medium text-sm focus:outline-none transition-colors duration-150 ease-in-out"])},ue(p.name),11,hE)),64))])]),T("div",gE,[T("div",mE,[g[1]||(g[1]=T("span",{class:"text-sm font-medium text-text-secondary hidden sm:inline pl-2"},"Filter:",-1)),Se(rr)])])]),Se(or,{fetchBookmarks:d,filters:u.value,showPagination:!0,showSearch:!0,currentPage:n.value,"onUpdate:search":f,"onUpdate:page":g[0]||(g[0]=p=>n.value=p)},null,8,["filters","currentPage"])])]))}},yE=ds(pE,[["__scopeId","data-v-ae28ad76"]]),le=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},vE=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=xE},xE=Number.MAX_SAFE_INTEGER||9007199254740991;let me=function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i}({}),P=function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i}({}),y=function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i}({});var Ce={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},de={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class mi{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class EE{constructor(e,t,s,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new mi(e),this.fast_=new mi(t),this.defaultTTFB_=n,this.ttfb_=new mi(e)}update(e,t){const{slow_:s,fast_:n,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new mi(e,s.getEstimate(),s.getTotalWeight())),n.halfLife!==t&&(this.fast_=new mi(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new mi(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,n=e/1e3,r=s/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function bE(i,e,t){return(e=SE(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ue(){return Ue=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},Ue.apply(null,arguments)}function Zc(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,s)}return t}function Ve(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Zc(Object(t),!0).forEach(function(s){bE(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Zc(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function TE(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function SE(i){var e=TE(i,"string");return typeof e=="symbol"?e:e+""}class Xt{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Bs,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Bs=function(){},AE={trace:Bs,debug:Bs,log:Bs,warn:Bs,info:Bs,error:Bs};function ya(){return Ue({},AE)}function _E(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):Bs}function eu(i,e,t){return e[i]?e[i].bind(e):_E(i,t)}const va=ya();function LE(i,e,t){const s=ya();if(typeof console=="object"&&i===!0||typeof i=="object"){const n=["debug","log","info","warn","error"];n.forEach(r=>{s[r]=eu(r,i,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.7`)}catch{return ya()}n.forEach(r=>{va[r]=eu(r,i)})}else Ue(va,s);return s}const Oe=va;function js(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function RE(i){return typeof self<"u"&&i===self.ManagedMediaSource}function Eh(i,e){const t=Object.keys(i),s=Object.keys(e),n=t.length,r=s.length;return!n||!r||n===r&&!t.some(o=>s.indexOf(o)===-1)}function Ct(i,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(i);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=i.length;let s,n,r,o="",a=0;for(;a<t;){if(s=i[a++],s===0&&e)return o;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:n=i[a++],o+=String.fromCharCode((s&31)<<6|n&63);break;case 14:n=i[a++],r=i[a++],o+=String.fromCharCode((s&15)<<12|(n&63)<<6|(r&63)<<0);break}}return o}const ti={hexDump:function(i){let e="";for(let t=0;t<i.length;t++){let s=i[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}};function bh(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function IE(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ko={exports:{}},tu;function kE(){return tu||(tu=1,function(i,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):c;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var g=n.exec(h.path);h.netLoc=g[1],h.path=g[2]}h.netLoc&&!h.path&&(h.path="/");var p={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(p.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)p.path=h.path,f.params||(p.params=h.params,f.query||(p.query=h.query));else{var m=h.path,x=m.substring(0,m.lastIndexOf("/")+1)+f.path;p.path=a.normalizePath(x)}return p.path===null&&(p.path=u.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(p)},parseURL:function(l){var c=s.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(r,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};i.exports=a})()}(ko)),ko.exports}var ll=kE();class cl{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ke={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Th{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,CE(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let n;s.length===1?n=(t==null?void 0:t.byteRangeEndOffset)||0:n=parseInt(s[1]),this._byteRange=[n,parseInt(s[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ke.AUDIO]:null,[Ke.VIDEO]:null,[Ke.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new cl),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ll.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ke.AUDIO]=null,e[Ke.VIDEO]=null,e[Ke.AUDIOVIDEO]=null}}function et(i){return i.sn!=="initSegment"}class wo extends Th{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(le(e)&&le(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const s=Object.keys(this.levelkeys);if(s.length===1)return this._decryptdata=this.levelkeys[s[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=le(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),s=t.length;if(s>1||s===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!le(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return et(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,n,r,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:s,startDTS:n,endDTS:r,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,s),l.startDTS=Math.min(l.startDTS,n),l.endDTS=Math.max(l.endDTS,r)}}class wE extends Th{constructor(e,t,s,n,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Sh(i,e){const t=Object.getPrototypeOf(i);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||Sh(t,e)}}function CE(i,e){const t=Sh(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const su=Math.pow(2,32)-1,DE=[].push,Ah={video:1,audio:2,id3:3,text:4};function rt(i){return String.fromCharCode.apply(null,i)}function _h(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Te(i,e){const t=Lh(i,e);return t<0?4294967296+t:t}function iu(i,e){let t=Te(i,e);return t*=Math.pow(2,32),t+=Te(i,e+4),t}function Lh(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function PE(i){const e=i.byteLength;for(let t=0;t<e;){const s=Te(i,t);if(s>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=s>1?t+s:e}return!1}function we(i,e){const t=[];if(!e.length)return t;const s=i.byteLength;for(let n=0;n<s;){const r=Te(i,n),o=rt(i.subarray(n+4,n+8)),a=r>1?n+r:s;if(o===e[0])if(e.length===1)t.push(i.subarray(n+8,a));else{const l=we(i.subarray(n+8,a),e.slice(1));l.length&&DE.apply(t,l)}n=a}return t}function OE(i){const e=[],t=i[0];let s=8;const n=Te(i,s);s+=4;let r=0,o=0;t===0?(r=Te(i,s),o=Te(i,s+4),s+=8):(r=iu(i,s),o=iu(i,s+8),s+=16),s+=2;let a=i.length+o;const l=_h(i,s);s+=2;for(let c=0;c<l;c++){let u=s;const d=Te(i,u);u+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return Oe.warn("SIDX has hierarchical references (not supported)"),null;const g=Te(i,u);u+=4,e.push({referenceSize:f,subsegmentDuration:g,info:{duration:g/n,start:a,end:a+f-1}}),a+=f,u+=4,s=u}return{earliestPresentationTime:r,timescale:n,version:t,referencesCount:l,references:e}}function Rh(i){const e=[],t=we(i,["moov","trak"]);for(let n=0;n<t.length;n++){const r=t[n],o=we(r,["tkhd"])[0];if(o){let a=o[0];const l=Te(o,a===0?12:20),c=we(r,["mdia","mdhd"])[0];if(c){a=c[0];const u=Te(c,a===0?12:20),d=we(r,["mdia","hdlr"])[0];if(d){const f=rt(d.subarray(8,12)),h={soun:Ke.AUDIO,vide:Ke.VIDEO}[f],g=we(r,["mdia","minf","stbl","stsd"])[0],p=FE(g);h?(e[l]={timescale:u,type:h,stsd:p},e[h]=Ve({timescale:u,id:l},p)):e[l]={timescale:u,type:f,stsd:p}}}}}return we(i,["moov","mvex","trex"]).forEach(n=>{const r=Te(n,4),o=e[r];o&&(o.default={duration:Te(n,12),flags:Te(n,20)})}),e}function FE(i){const e=i.subarray(8),t=e.subarray(86),s=rt(e.subarray(4,8));let n=s,r;const o=s==="enca"||s==="encv";if(o){const c=we(e,[s])[0].subarray(s==="enca"?28:78);we(c,["sinf"]).forEach(d=>{const f=we(d,["schm"])[0];if(f){const h=rt(f.subarray(4,8));if(h==="cbcs"||h==="cenc"){const g=we(d,["frma"])[0];g&&(n=rt(g))}}})}const a=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const l=we(t,["avcC"])[0];l&&l.length>3&&(n+="."+Bn(l[1])+Bn(l[2])+Bn(l[3]),r=Nn(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=we(e,[s])[0],c=we(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=Co(c,u),u+=2;const d=c[u++];if(d&128&&(u+=2),d&64&&(u+=c[u++]),c[u++]!==4)break;u=Co(c,u);const f=c[u++];if(f===64)n+="."+Bn(f);else break;if(u+=12,c[u++]!==5)break;u=Co(c,u);const h=c[u++];let g=(h&248)>>3;g===31&&(g+=1+((h&7)<<3)+((c[u]&224)>>5)),n+="."+g}break}case"hvc1":case"hev1":{const l=we(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],d=c&31,f=Te(l,2),h=(c&32)>>5?"H":"L",g=l[12],p=l.subarray(6,12);n+="."+u+d,n+="."+ME(f).toString(16).toUpperCase(),n+="."+h+g;let m="";for(let x=p.length;x--;){const E=p[x];(E||m)&&(m="."+E.toString(16).toUpperCase()+m)}n+=m}r=Nn(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=Nn(n,t)||n;break}case"vp09":{const l=we(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],d=l[6]>>4&15;n+="."+is(c)+"."+is(u)+"."+is(d)}break}case"av01":{const l=we(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,d=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,h=(l[2]&32)>>5,g=c===2&&f?h?12:10:f?10:8,p=(l[2]&16)>>4,m=(l[2]&8)>>3,x=(l[2]&4)>>2,E=l[2]&3;n+="."+c+"."+is(u)+d+"."+is(g)+"."+p+"."+m+x+E+"."+is(1)+"."+is(1)+"."+is(1)+"."+0,r=Nn("dav1",t)}break}}return{codec:n,encrypted:o,supplemental:r}}function Nn(i,e){const t=we(e,["dvvC"]),s=t.length?t[0]:we(e,["dvcC"])[0];if(s){const n=s[2]>>1&127,r=s[2]<<5&32|s[3]>>3&31;return i+"."+is(n)+"."+is(r)}}function ME(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function Co(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function Bn(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function is(i){return(i<10?"0":"")+i}function NE(i,e){if(!i||!e)return i;const t=e.keyId;return t&&e.isCommonEncryption&&we(i,["moov","trak"]).forEach(n=>{const o=we(n,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=we(o,["enca"]);const l=a.length>0;l||(a=we(o,["encv"])),a.forEach(c=>{const u=l?c.subarray(28):c.subarray(78);we(u,["sinf"]).forEach(f=>{const h=BE(f);if(h){const g=h.subarray(8,24);g.some(p=>p!==0)||(Oe.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${ti.hexDump(g)} -> ${ti.hexDump(t)}`),h.set(t,8))}})})}),i}function BE(i){const e=we(i,["schm"])[0];if(e){const t=rt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return we(i,["schi","tenc"])[0]}return null}function $E(i,e,t){const s={},n=we(i,["moof","traf"]);for(let r=0;r<n.length;r++){const o=n[r],a=we(o,["tfhd"])[0],l=Te(a,4),c=e[l];if(!c)continue;const u=s[l]||(s[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type}),d=we(o,["tfdt"])[0];if(d){const v=d[0];let b=Te(d,4);v===1&&(b===su?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(b*=su+1,b+=Te(d,8))),le(b)&&(!le(u.start)||b<u.start)&&(u.start=b)}const f=c.default,h=Te(a,0)|(f==null?void 0:f.flags);let g=(f==null?void 0:f.duration)||0;h&8&&(h&2?g=Te(a,12):g=Te(a,8));const p=we(o,["trun"]);let m=u.start||0,x=0,E=g;for(let v=0;v<p.length;v++){const b=p[v],S=Te(b,4),w=u.sampleCount;u.sampleCount+=S;const L=b[3]&1,k=b[3]&4,R=b[2]&1,_=b[2]&2,N=b[2]&4,O=b[2]&8;let X=8,te=S;for(L&&(X+=4),k&&S&&(!(b[X+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=w),X+=4,R?(E=Te(b,X),X+=4):E=g,_&&(X+=4),O&&(X+=4),m+=E,x+=E,te--);te--;)R?(E=Te(b,X),X+=4):E=g,_&&(X+=4),N&&(b[X+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(te+1),u.keyFrameStart=m),X+=4),O&&(X+=4),m+=E,x+=E;!x&&g&&(x+=g*S)}u.duration+=x}if(!Object.keys(s).some(r=>s[r].duration)){let r=1/0,o=0;const a=we(i,["sidx"]);for(let l=0;l<a.length;l++){const c=OE(a[l]);if(c!=null&&c.references){r=Math.min(r,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((d,f)=>d+f.info.duration||0,0);o=Math.max(o,u+c.earliestPresentationTime/c.timescale)}}o&&le(o)&&Object.keys(s).forEach(l=>{s[l].duration||(s[l].duration=o*s[l].timescale-s[l].start)})}return s}function UE(i){const e={valid:null,remainder:null},t=we(i,["moof"]);if(t.length<2)return e.remainder=i,e;const s=t[t.length-1];return e.valid=i.slice(0,s.byteOffset-8),e.remainder=i.slice(s.byteOffset-8),e}function $t(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function nu(i,e){const t=[],s=e.samples,n=e.timescale,r=e.id;let o=!1;return we(s,["moof"]).map(l=>{const c=l.byteOffset-8;we(l,["traf"]).map(d=>{const f=we(d,["tfdt"]).map(h=>{const g=h[0];let p=Te(h,4);return g===1&&(p*=Math.pow(2,32),p+=Te(h,8)),p/n})[0];return f!==void 0&&(i=f),we(d,["tfhd"]).map(h=>{const g=Te(h,4),p=Te(h,0)&16777215,m=(p&1)!==0,x=(p&2)!==0,E=(p&8)!==0;let v=0;const b=(p&16)!==0;let S=0;const w=(p&32)!==0;let L=8;g===r&&(m&&(L+=8),x&&(L+=4),E&&(v=Te(h,L),L+=4),b&&(S=Te(h,L),L+=4),w&&(L+=4),e.type==="video"&&(o=ao(e.codec)),we(d,["trun"]).map(k=>{const R=k[0],_=Te(k,0)&16777215,N=(_&1)!==0;let O=0;const X=(_&4)!==0,te=(_&256)!==0;let re=0;const q=(_&512)!==0;let z=0;const j=(_&1024)!==0,he=(_&2048)!==0;let fe=0;const Z=Te(k,4);let F=8;N&&(O=Te(k,F),F+=4),X&&(F+=4);let V=O+c;for(let xe=0;xe<Z;xe++){if(te?(re=Te(k,F),F+=4):re=v,q?(z=Te(k,F),F+=4):z=S,j&&(F+=4),he&&(R===0?fe=Te(k,F):fe=Lh(k,F),F+=4),e.type===Ke.VIDEO){let Q=0;for(;Q<z;){const Ee=Te(s,V);if(V+=4,GE(o,s[V])){const G=s.subarray(V,V+Ee);ul(G,o?2:1,i+fe/n,t)}V+=Ee,Q+=Ee+4}}i+=re/n}}))})})}),t}function ao(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function GE(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function ul(i,e,t,s){const n=Ih(i);let r=0;r+=e;let o=0,a=0,l=0;for(;r<n.length;){o=0;do{if(r>=n.length)break;l=n[r++],o+=l}while(l===255);a=0;do{if(r>=n.length)break;l=n[r++],a+=l}while(l===255);const c=n.length-r;let u=r;if(a<c)r+=a;else if(a>c){Oe.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(n[u++]===181){const f=_h(n,u);if(u+=2,f===49){const h=Te(n,u);if(u+=4,h===1195456820){const g=n[u++];if(g===3){const p=n[u++],m=31&p,x=64&p,E=x?2+m*3:0,v=new Uint8Array(E);if(x){v[0]=p;for(let b=1;b<E;b++)v[b]=n[u++]}s.push({type:g,payloadType:o,pts:t,bytes:v})}}}}}else if(o===5&&a>16){const d=[];for(let g=0;g<16;g++){const p=n[u++].toString(16);d.push(p.length==1?"0"+p:p),(g===3||g===5||g===7||g===9)&&d.push("-")}const f=a-16,h=new Uint8Array(f);for(let g=0;g<f;g++)h[g]=n[u++];s.push({payloadType:o,pts:t,uuid:d.join(""),userData:Ct(h),userDataBytes:h})}}}function Ih(i){const e=i.byteLength,t=[];let s=1;for(;s<e-2;)i[s]===0&&i[s+1]===0&&i[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return i;const n=e-t.length,r=new Uint8Array(n);let o=0;for(s=0;s<n;o++,s++)o===t[0]&&(o++,t.shift()),r[s]=i[o];return r}function VE(i){const e=i[0];let t="",s="",n=0,r=0,o=0,a=0,l=0,c=0;if(e===0){for(;rt(i.subarray(c,c+1))!=="\0";)t+=rt(i.subarray(c,c+1)),c+=1;for(t+=rt(i.subarray(c,c+1)),c+=1;rt(i.subarray(c,c+1))!=="\0";)s+=rt(i.subarray(c,c+1)),c+=1;s+=rt(i.subarray(c,c+1)),c+=1,n=Te(i,12),r=Te(i,16),a=Te(i,20),l=Te(i,24),c=28}else if(e===1){c+=4,n=Te(i,c),c+=4;const d=Te(i,c);c+=4;const f=Te(i,c);for(c+=4,o=2**32*d+f,vE(o)||(o=Number.MAX_SAFE_INTEGER,Oe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=Te(i,c),c+=4,l=Te(i,c),c+=4;rt(i.subarray(c,c+1))!=="\0";)t+=rt(i.subarray(c,c+1)),c+=1;for(t+=rt(i.subarray(c,c+1)),c+=1;rt(i.subarray(c,c+1))!=="\0";)s+=rt(i.subarray(c,c+1)),c+=1;s+=rt(i.subarray(c,c+1)),c+=1}const u=i.subarray(c,i.byteLength);return{schemeIdUri:t,value:s,timeScale:n,presentationTime:o,presentationTimeDelta:r,eventDuration:a,id:l,payload:u}}function HE(i,...e){const t=e.length;let s=8,n=t;for(;n--;)s+=e[n].byteLength;const r=new Uint8Array(s);for(r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=s&255,r.set(i,4),n=0,s=8;n<t;n++)r.set(e[n],s),s+=e[n].byteLength;return r}function KE(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let s,n;s=0,n=new Uint8Array;let r;s>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),HE([112,115,115,104],new Uint8Array([s,0,0,0]),i,r,n,o,t||new Uint8Array)}const kh=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Pi={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function dl(i,e){const t=Pi[e];return!!t&&!!t[i.slice(0,4)]}function xa(i,e,t=!0){return!i.split(",").some(s=>!fl(s,e,t))}function fl(i,e,t=!0){var s;const n=js(t);return(s=n==null?void 0:n.isTypeSupported(vn(i,e)))!=null?s:!1}function vn(i,e){return`${e}/mp4;codecs=${i}`}function ru(i){if(i){const e=i.substring(0,4);return Pi.video[e]}return 2}function Rr(i){const e=kh();return i.split(",").reduce((t,s)=>{const r=e&&ao(s)?9:Pi.video[s];return r?(r*2+t)/(t?3:2):(Pi.audio[s]+t)/(t?2:1)},0)}const Do={};function jE(i,e=!0){if(Do[i])return Do[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let n=0;n<t.length;n++){var s;if(fl(t[n],"audio",e))return Do[i]=t[n],t[n];if(t[n]==="mp3"&&(s=js(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return i}const WE=/flac|opus|mp4a\.40\.34/i;function Ir(i,e=!0){return i.replace(WE,t=>jE(t.toLowerCase(),e))}function qE(i,e){const t=[];if(i){const s=i.split(",");for(let n=0;n<s.length;n++)dl(s[n],"video")||t.push(s[n])}return e&&t.push(e),t.join(",")}function ar(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(ou(i,"audio")||ou(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let s=t.length;s--;)if(t[s].substring(0,4)===i.substring(0,4))return t[s]}return t[0]}}return e||i}function ou(i,e){return dl(i,e)&&fl(i,e)}function YE(i){const e=i.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function zE(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return i}function au(i){const e=js(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ea(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const wh={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Ch(i,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:i}}function XE(i,e,t,s,n,r){const o=i.videoCodec,a=i.audioCodec?i.audioGroups:null,l=r==null?void 0:r.audioCodec,c=r==null?void 0:r.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(a!=null&&a.length)try{a.length===1&&a[0]?d=e.groups[a[0]].channels:d=a.reduce((f,h)=>{if(h){const g=e.groups[h];if(!g)throw new Error(`Audio track group ${h} not found`);Object.keys(g.channels).forEach(p=>{f[p]=(f[p]||0)+g.channels[p]})}return f},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(f=>ao(f))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(s,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(n,8e6))||!!d&&le(u)&&Object.keys(d).some(f=>parseInt(f)>u)}function Dh(i,e,t,s={}){const n=i.videoCodec;if(!n&&!i.audioCodec||!t)return Promise.resolve(wh);const r=[],o=QE(i),a=o.length,l=JE(i,e,a>0),c=l.length;for(let u=a||1*c||1;u--;){const d={type:"media-source"};if(a&&(d.video=o[u%a]),c){d.audio=l[u%c];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}r.push(d)}if(n){const u=navigator.userAgent;if(n.split(",").some(d=>ao(d))&&kh())return Promise.resolve(Ch(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),r))}return Promise.all(r.map(u=>{const d=eb(u);return s[d]||(s[d]=t.decodingInfo(u))})).then(u=>({supported:!u.some(d=>!d.supported),configurations:r,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:r,decodingInfoResults:[],error:u}))}function QE(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),s=Ph(i),n=i.width||640,r=i.height||480,o=i.frameRate||30,a=i.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:vn(zE(l),"video"),width:n,height:r,bitrate:s,framerate:o};return a!=="sdr"&&(c.transferFunction=a),c}):[]}function JE(i,e,t){var s;const n=(s=i.audioCodec)==null?void 0:s.split(","),r=Ph(i);return n&&i.audioGroups?i.audioGroups.reduce((o,a)=>{var l;const c=a?(l=e.groups[a])==null?void 0:l.tracks:null;return c?c.reduce((u,d)=>{if(d.groupId===a){const f=parseFloat(d.channels||"");n.forEach(h=>{const g={contentType:vn(h,"audio"),bitrate:t?ZE(h,r):r};f&&(g.channels=""+f),u.push(g)})}return u},o):o},[]):[]}function ZE(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Ph(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function eb(i){let e="";const{audio:t,video:s}=i;if(s){const n=Ea(s.contentType);e+=`${n}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const n=Ea(t.contentType);e+=`${s?"_":""}${n}_c${t.channels}`}return e}const ba=["NONE","TYPE-0","TYPE-1",null];function tb(i){return ba.indexOf(i)>-1}const kr=["SDR","PQ","HLG"];function sb(i){return!!i&&kr.indexOf(i)>-1}var lr={No:"",Yes:"YES",v2:"v2"};function lu(i){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=i,n=s<e/2;return e&&n?t?lr.v2:lr.Yes:lr.No}class cu{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class xn{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return uu(this._audioGroups,e)}hasSubtitleGroup(e){return uu(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function uu(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function ib(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function nb(i,e){let t=!1,s=[];if(i&&(t=i!=="SDR",s=[i]),e){s=e.allowedVideoRanges||kr.slice(0);const n=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&ib(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const rb=i=>{const e=new WeakSet;return(t,s)=>{if(i&&(s=i(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},qe=(i,e)=>JSON.stringify(i,rb(e));function ob(i,e,t,s,n){const r=Object.keys(i),o=s==null?void 0:s.channels,a=s==null?void 0:s.audioCodec,l=n==null?void 0:n.videoCodec,c=o&&parseInt(o)===2;let u=!1,d=!1,f=1/0,h=1/0,g=1/0,p=1/0,m=0,x=[];const{preferHDR:E,allowedVideoRanges:v}=nb(e,n);for(let k=r.length;k--;){const R=i[r[k]];u||(u=R.channels[2]>0),f=Math.min(f,R.minHeight),h=Math.min(h,R.minFramerate),g=Math.min(g,R.minBitrate),v.filter(N=>R.videoRanges[N]>0).length>0&&(d=!0)}f=le(f)?f:0,h=le(h)?h:0;const b=Math.max(1080,f),S=Math.max(30,h);g=le(g)?g:t,t=Math.max(g,t),d||(e=void 0);const w=r.length>1;return{codecSet:r.reduce((k,R)=>{const _=i[R];if(R===k)return k;if(x=d?v.filter(N=>_.videoRanges[N]>0):[],w){if(_.minBitrate>t)return ts(R,`min bitrate of ${_.minBitrate} > current estimate of ${t}`),k;if(!_.hasDefaultAudio)return ts(R,"no renditions with default or auto-select sound found"),k;if(a&&R.indexOf(a.substring(0,4))%5!==0)return ts(R,`audio codec preference "${a}" not found`),k;if(o&&!c){if(!_.channels[o])return ts(R,`no renditions with ${o} channel sound found (channels options: ${Object.keys(_.channels)})`),k}else if((!a||c)&&u&&_.channels[2]===0)return ts(R,"no renditions with stereo sound found"),k;if(_.minHeight>b)return ts(R,`min resolution of ${_.minHeight} > maximum of ${b}`),k;if(_.minFramerate>S)return ts(R,`min framerate of ${_.minFramerate} > maximum of ${S}`),k;if(!x.some(N=>_.videoRanges[N]>0))return ts(R,`no variants with VIDEO-RANGE of ${qe(x)} found`),k;if(l&&R.indexOf(l.substring(0,4))%5!==0)return ts(R,`video codec preference "${l}" not found`),k;if(_.maxScore<m)return ts(R,`max score of ${_.maxScore} < selected max of ${m}`),k}return k&&(Rr(R)>=Rr(k)||_.fragmentError>i[k].fragmentError)?k:(p=_.minIndex,m=_.maxScore,R)},void 0),videoRanges:x,preferHDR:E,minFramerate:h,minBitrate:g,minIndex:p}}function ts(i,e){Oe.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function Oh(i){return i.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const n=t.channels||"2";return s.channels[n]=(s.channels[n]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function ab(i,e,t,s){return i.slice(t,s+1).reduce((n,r,o)=>{if(!r.codecSet)return n;const a=r.audioGroups;let l=n[r.codecSet];l||(n[r.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,r.bitrate);const c=Math.min(r.height,r.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,r.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,r.score),l.fragmentError+=r.fragmentError,l.videoRanges[r.videoRange]=(l.videoRanges[r.videoRange]||0)+1,a&&a.forEach(u=>{if(!u)return;const d=e.groups[u];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+d.channels[f]}))}),n},{})}function du(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}=i;return{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}}function os(i,e,t){if("attrs"in i){const s=e.indexOf(i);if(s!==-1)return s}for(let s=0;s<e.length;s++){const n=e[s];if(ai(i,n,t))return s}return-1}function ai(i,e,t){const{groupId:s,name:n,lang:r,assocLang:o,default:a}=i,l=i.forced;return(s===void 0||e.groupId===s)&&(n===void 0||e.name===n)&&(r===void 0||lb(r,e.lang))&&(r===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in i)||cb(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function lb(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function cb(i,e=""){const t=i.split(","),s=e.split(",");return t.length===s.length&&!t.some(n=>s.indexOf(n)===-1)}function Zs(i,e){const{audioCodec:t,channels:s}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function ub(i,e,t,s,n){const r=e[s],a=e.reduce((f,h,g)=>{const p=h.uri;return(f[p]||(f[p]=[])).push(g),f},{})[r.uri];a.length>1&&(s=Math.max.apply(Math,a));const l=r.videoRange,c=r.frameRate,u=r.codecSet.substring(0,4),d=fu(e,s,f=>{if(f.videoRange!==l||f.frameRate!==c||f.codecSet.substring(0,4)!==u)return!1;const h=f.audioGroups,g=t.filter(p=>!h||h.indexOf(p.groupId)!==-1);return os(i,g,n)>-1});return d>-1?d:fu(e,s,f=>{const h=f.audioGroups,g=t.filter(p=>!h||h.indexOf(p.groupId)!==-1);return os(i,g,n)>-1})}function fu(i,e,t){for(let s=e;s>-1;s--)if(t(i[s]))return s;for(let s=e+1;s<i.length;s++)if(t(i[s]))return s;return-1}function wr(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class db extends Xt{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:n,partCurrent:r,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!n||!l)return;const c=performance.now(),u=r?r.stats:n.stats,d=r?r.duration:n.duration,f=c-u.loading.start,h=o.minAutoLevel,g=n.level,p=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||g<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const m=p>-1&&p!==g,x=!!t||m;if(!x&&(l.paused||!l.playbackRate||!l.readyState))return;const E=o.mainForwardBufferInfo;if(!x&&E===null)return;const v=this.bwEstimator.getEstimateTTFB(),b=Math.abs(l.playbackRate);if(f<=Math.max(v,1e3*(d/(b*2))))return;const S=E?E.len/b:0,w=u.loading.first?u.loading.first-u.loading.start:-1,L=u.loaded&&w>-1,k=this.getBwEstimate(),R=o.levels,_=R[g],N=Math.max(u.loaded,Math.round(d*(n.bitrate||_.averageBitrate)/8));let O=L?f-w:f;O<1&&L&&(O=Math.min(f,u.loaded*8/k));const X=L?u.loaded*1e3/O:0,te=v/1e3,re=X?(N-u.loaded)/X:N*8/k+te;if(re<=S)return;const q=X?X*8:k,z=((s=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,j=this.hls.config.abrBandWidthUpFactor;let he=Number.POSITIVE_INFINITY,fe;for(fe=g-1;fe>h;fe--){const xe=R[fe].maxBitrate,Q=!R[fe].details||z;if(he=this.getTimeToLoadFrag(te,q,d*xe,Q),he<Math.min(S,d+te))break}if(he>=re||he>d*10)return;L?this.bwEstimator.sample(f-Math.min(v,w),u.loaded):this.bwEstimator.sampleTTFB(f);const Z=R[fe].maxBitrate;this.getBwEstimate()*j>Z&&this.resetEstimator(Z);const F=this.findBestLevel(Z,h,fe,0,S,1,1);F>-1&&(fe=F),this.warn(`Fragment ${n.sn}${r?" part "+r.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${S.toFixed(3)} s
      Estimated load time for current fragment: ${re.toFixed(3)} s
      Estimated load time for down switch fragment: ${he.toFixed(3)} s
      TTFB estimate: ${w|0} ms
      Current BW estimate: ${le(k)?k|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${fe} @ ${Z|0} bps`),o.nextLoadLevel=o.nextAutoLevel=fe,this.clearTimer();const V=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===fe&&fe>0){const xe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${fe>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${xe.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,fe>h){let Q=this.findBestLevel(this.hls.levels[h].bitrate,h,fe,0,xe,1,1);Q===-1&&(Q=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Q,this.resetEstimator(this.hls.levels[Q].bitrate)}}};m||re>he*2?V():this.timer=self.setInterval(V,he*1e3),o.trigger(y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new EE(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(y.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var n;this.fragCurrent=s,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case P.BUFFER_ADD_CODEC_ERROR:case P.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case P.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:n,partCurrent:r}=this;if(s&&n&&s.sn===n.sn&&s.level===n.level){const o=performance.now(),a=r?r.stats:s.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,s,n){const r=e+s/t,o=n?e+this.lastLevelLoadSec:0;return r+o}onLevelLoaded(e,t){const s=this.hls.config,{loading:n}=t.stats,r=n.end-n.first;le(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const n=s?s.stats:t.stats;if(t.type===de.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=s?s.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+n.loaded,l=(o.loaded?o.loaded.duration:0)+r;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const r={stats:n,frag:t,part:s,id:t.type};this.onFragBuffered(y.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:n}=t,r=n!=null&&n.stats.loaded?n.stats:s.stats;if(r.aborted||this.ignoreFragment(s))return;const o=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==de.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,n,1,1);if(r>-1)return r;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=s&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,r)&&o[e].loadError<=o[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:n,config:r,minAutoLevel:o}=s,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=r.abrBandWidthFactor,d=r.abrBandWidthUpFactor;if(c){const m=this.findBestLevel(l,o,n,c,0,u,d);if(m>=0)return this.rebufferNotice=-1,m}let f=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!c){const m=this.bitrateTestDelay;m&&(f=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-m,this.info(`bitrate test took ${Math.round(1e3*m)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=d=1)}const h=this.findBestLevel(l,o,n,c,f,u,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const g=s.levels[o],p=s.loadLevelObj;return p&&(g==null?void 0:g.bitrate)<p.bitrate?o:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,n,r,o,a){var l;const c=n+r,u=this.lastLoadedFragLevel,d=u===-1?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:h}=this,{levels:g,allAudioTracks:p,loadLevel:m,config:x}=this.hls;if(g.length===1)return 0;const E=g[d],v=!!((l=this.hls.latestLevelDetails)!=null&&l.live),b=m===-1||u===-1;let S,w="SDR",L=(E==null?void 0:E.frameRate)||0;const{audioPreference:k,videoPreference:R}=x,_=this.audioTracksByGroup||(this.audioTracksByGroup=Oh(p));let N=-1;if(b){if(this.firstSelection!==-1)return this.firstSelection;const z=this.codecTiers||(this.codecTiers=ab(g,_,t,s)),j=ob(z,w,e,k,R),{codecSet:he,videoRanges:fe,minFramerate:Z,minBitrate:F,minIndex:V,preferHDR:xe}=j;N=V,S=he,w=xe?fe[fe.length-1]:fe[0],L=Z,e=Math.max(e,F),this.log(`picked start tier ${qe(j)}`)}else S=E==null?void 0:E.codecSet,w=E==null?void 0:E.videoRange;const O=h?h.duration:f?f.duration:0,X=this.bwEstimator.getEstimateTTFB()/1e3,te=[];for(let z=s;z>=t;z--){var re,q;const j=g[z],he=z>d;if(!j)continue;if(x.useMediaCapabilities&&!j.supportedResult&&!j.supportedPromise){const Ee=navigator.mediaCapabilities;typeof(Ee==null?void 0:Ee.decodingInfo)=="function"&&XE(j,_,w,L,e,k)?(j.supportedPromise=Dh(j,_,Ee,this.supportedCache),j.supportedPromise.then(G=>{if(!this.hls)return;j.supportedResult=G;const oe=this.hls.levels,ee=oe.indexOf(j);G.error?this.warn(`MediaCapabilities decodingInfo error: "${G.error}" for level ${ee} ${qe(G)}`):G.supported?G.decodingInfoResults.some(ce=>ce.smooth===!1||ce.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${ee} not smooth or powerEfficient: ${qe(G)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${ee} ${qe(G)}`),ee>-1&&oe.length>1&&(this.log(`Removing unsupported level ${ee}`),this.hls.removeLevel(ee),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):j.supportedResult=wh}if((S&&j.codecSet!==S||w&&j.videoRange!==w||he&&L>j.frameRate||!he&&L>0&&L<j.frameRate||(re=j.supportedResult)!=null&&(q=re.decodingInfoResults)!=null&&q.some(Ee=>Ee.smooth===!1))&&(!b||z!==N)){te.push(z);continue}const fe=j.details,Z=(h?fe==null?void 0:fe.partTarget:fe==null?void 0:fe.averagetargetduration)||O;let F;he?F=a*e:F=o*e;const V=O&&n>=O*2&&r===0?j.averageBitrate:j.maxBitrate,xe=this.getTimeToLoadFrag(X,F,V*Z,fe===void 0);if(F>=V&&(z===u||j.loadError===0&&j.fragmentError===0)&&(xe<=X||!le(xe)||v&&!this.bitrateTestDelay||xe<c)){const Ee=this.forcedAutoLevel;return z!==m&&(Ee===-1||Ee!==m)&&(te.length&&this.trace(`Skipped level(s) ${te.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${g[te[0]].codecs}" ${g[te[0]].videoRange}; not compatible with "${S}" ${w}`),this.info(`switch candidate:${d}->${z} adjustedbw(${Math.round(F)})-bitrate=${Math.round(F-V)} ttfb:${X.toFixed(1)} avgDuration:${Z.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${xe.toFixed(1)} firstSelection:${b} codecSet:${j.codecSet} videoRange:${j.videoRange} hls.loadLevel:${m}`)),b&&(this.firstSelection=z),z}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const Fh={search:function(i,e){let t=0,s=i.length-1,n=null,r=null;for(;t<=s;){n=(t+s)/2|0,r=i[n];const o=e(r);if(o>0)t=n+1;else if(o<0)s=n-1;else return r}return null}};function fb(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!le(e))return null;const s=i[0].programDateTime;if(e<(s||0))return null;const n=i[i.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let r=0;r<i.length;++r){const o=i[r];if(gb(e,t,o))return o}return null}function ui(i,e,t=0,s=0,n=.005){let r=null;if(i){r=e[1+i.sn-e[0].sn]||null;const a=i.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),r&&i.level!==r.level&&r.end<=i.end&&(r=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!i||i.level===r.level)&&hu(t,s,r)===0||hb(r,i,Math.min(n,s))))return r;const o=Fh.search(e,hu.bind(null,t,s));return o&&(o!==i||!r)?o:r}function hb(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((n,r)=>(r[0]==="INF"&&(n+=parseFloat(r[1])),n),t);return i.start<=s}return!1}function hu(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=i?1:t.start-s>i&&t.start?-1:0}function gb(i,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>i}function Mh(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let s=i.fragments;const{fragmentHint:n}=i;n&&(s=s.concat(n));let r;return Fh.search(s,o=>o.cc<e?1:o.cc>e?-1:(r=o,o.end<=t?1:o.start>t?-1:0)),r||null}return null}function Cr(i){switch(i.details){case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_TIMEOUT:case P.LEVEL_LOAD_TIMEOUT:case P.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function gu(i,e){const t=Cr(e);return i.default[`${t?"timeout":"error"}Retry`]}function hl(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function mu(i){return Ve(Ve({},i),{errorRetry:null,timeoutRetry:null})}function Dr(i,e,t,s){if(!i)return!1;const n=s==null?void 0:s.code,r=e<i.maxNumRetry&&(mb(n)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,s,r):r}function mb(i){return i===0&&navigator.onLine===!1||!!i&&(i<400||i>499)}var mt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Gt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class pb extends Xt{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(y.ERROR,this.onError,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(y.ERROR,this.onError,this),e.off(y.ERROR,this.onErrorOut,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===de.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const n=this.hls,r=t.context;switch(t.details){case P.FRAG_LOAD_ERROR:case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_ERROR:case P.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case P.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=En();return}case P.FRAG_GAP:case P.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=mt.SendAlternateToPenaltyBox;return}case P.LEVEL_EMPTY_ERROR:case P.LEVEL_PARSING_ERROR:{var o,a;const c=t.parent===de.MAIN?t.level:n.loadLevel;t.details===P.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(a=o.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case P.LEVEL_LOAD_ERROR:case P.LEVEL_LOAD_TIMEOUT:typeof(r==null?void 0:r.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case P.AUDIO_TRACK_LOAD_ERROR:case P.AUDIO_TRACK_LOAD_TIMEOUT:case P.SUBTITLE_LOAD_ERROR:case P.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const c=n.loadLevelObj;if(c&&(r.type===Ce.AUDIO_TRACK&&c.hasAudioGroup(r.groupId)||r.type===Ce.SUBTITLE_TRACK&&c.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=mt.SendAlternateToPenaltyBox,t.errorAction.flags=Gt.MoveAllAlternatesMatchingHost;return}}return;case P.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const c=n.loadLevelObj,u=c==null?void 0:c.attrs["HDCP-LEVEL"];u?t.errorAction={action:mt.SendAlternateToPenaltyBox,flags:Gt.MoveAllAlternatesMatchingHDCP,hdcpLevel:u}:this.keySystemError(t)}return;case P.BUFFER_ADD_CODEC_ERROR:case P.REMUX_ALLOC_ERROR:case P.BUFFER_APPEND_ERROR:if(!t.errorAction){var l;t.errorAction=this.getLevelSwitchAction(t,(l=t.level)!=null?l:n.loadLevel)}return;case P.INTERNAL_EXCEPTION:case P.BUFFER_APPENDING_ERROR:case P.BUFFER_FULL_ERROR:case P.LEVEL_SWITCH_ERROR:case P.BUFFER_STALLED_ERROR:case P.BUFFER_SEEK_OVER_HOLE:case P.BUFFER_NUDGE_ON_STALL:t.errorAction=En();return}t.type===me.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,n=gu(s.config.playlistLoadPolicy,e),r=this.playlistError++;if(Dr(n,r,Cr(e),e.response))return{action:mt.RetryRequest,flags:Gt.None,retryConfig:n,retryCount:r};const a=this.getLevelSwitchAction(e,t);return n&&(a.retryConfig=n,a.retryCount=r),a}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),n=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:o}=t.config,a=gu(e.details.startsWith("key")?o:r,e),l=t.levels.reduce((u,d)=>u+d.fragmentError,0);if(n&&(e.details!==P.FRAG_GAP&&n.fragmentError++,Dr(a,l,Cr(e),e.response)))return{action:mt.RetryRequest,flags:Gt.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,s);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const n=this.hls.levels[t];if(n){var r,o;const c=e.details;n.loadError++,c===P.BUFFER_APPEND_ERROR&&n.fragmentError++;let u=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:g}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const p=(r=e.frag)==null?void 0:r.type,x=(p===de.AUDIO&&c===P.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===P.BUFFER_ADD_CODEC_ERROR||c===P.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:w})=>n.audioCodec!==w),v=e.sourceBufferName==="video"&&(c===P.BUFFER_ADD_CODEC_ERROR||c===P.BUFFER_APPEND_ERROR)&&d.some(({codecSet:w,audioCodec:L})=>n.codecSet!==w&&n.audioCodec===L),{type:b,groupId:S}=(o=e.context)!=null?o:{};for(let w=d.length;w--;){const L=(w+f)%d.length;if(L!==f&&L>=h&&L<=g&&d[L].loadError===0){var a,l;const k=d[L];if(c===P.FRAG_GAP&&p===de.MAIN&&e.frag){const R=d[L].details;if(R){const _=ui(e.frag,R.fragments,e.frag.start);if(_!=null&&_.gap)continue}}else{if(b===Ce.AUDIO_TRACK&&k.hasAudioGroup(S)||b===Ce.SUBTITLE_TRACK&&k.hasSubtitleGroup(S))continue;if(p===de.AUDIO&&(a=n.audioGroups)!=null&&a.some(R=>k.hasAudioGroup(R))||p===de.SUBTITLE&&(l=n.subtitleGroups)!=null&&l.some(R=>k.hasSubtitleGroup(R))||x&&n.audioCodec===k.audioCodec||!x&&n.audioCodec!==k.audioCodec||v&&n.codecSet===k.codecSet)continue}u=L;break}}if(u>-1&&s.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:mt.SendAlternateToPenaltyBox,flags:Gt.None,nextAutoLevel:u}}return{action:mt.SendAlternateToPenaltyBox,flags:Gt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case mt.DoNothing:break;case mt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==P.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:n,hdcpLevel:r,nextAutoLevel:o}=s;switch(n){case Gt.None:this.switchLevel(e,o);break;case Gt.MoveAllAlternatesMatchingHDCP:r&&(t.maxHdcpLevel=ba[ba.indexOf(r)-1],s.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}s.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===P.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=Ea(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r][`${e.sourceBufferName}Codec`]===s&&this.hls.removeLevel(r)}}}function En(i){const e={action:mt.DoNothing,flags:Gt.None};return i&&(e.resolved=!0),e}var st={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class yb{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let n=s.length;n--;){const r=s[n];if(!r)break;const o=r.end;if(r.start<=e&&o!==null&&e<=o)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:n}=this,r=Object.keys(n);for(let o=r.length;o--;){const a=n[r[o]];if((a==null?void 0:a.body.type)===t&&(!s||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,s,n,r){this.timeRanges&&(this.timeRanges[e]=t);const o=(n==null?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||r)){l.body.type===s&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const d=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,n=pi(s),r=this.fragments[n];if(!r||r.buffered&&s.gap)return;const o=!s.relurl;Object.keys(t).forEach(a=>{const l=s.elementaryStreams[a];if(!l)return;const c=t[a],u=o||l.partial===!0;r.range[a]=this.getBufferedTimes(s,e.part,u,c)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=s.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),$n(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=pu(s,n=>n.fragment.sn>=e))}fragBuffered(e,t){const s=pi(e);let n=this.fragments[s];!n&&t&&(n=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(e,t,s,n){const r={time:[],partial:s},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<n.length;u++){const d=n.start(u)-this.bufferPadding,f=n.end(u)+this.bufferPadding;if(c>=d&&l<=f){r.time.push({startPTS:Math.max(o,n.start(u)),endPTS:Math.min(a,n.end(u))});break}else if(o<f&&a>d){const h=Math.max(o,n.start(u)),g=Math.min(a,n.end(u));g>h&&(r.partial=!0,r.time.push({startPTS:h,endPTS:g}))}else if(a<=d)break}return r}getPartialFragment(e){let t=null,s,n,r,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&$n(u)&&(n=u.body.start-a,r=u.body.end+a,e>=n&&e<=r&&(s=Math.min(e-n,r-e),o<=s&&(t=u.body,o=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||$n(t))}getState(e){const t=pi(e),s=this.fragments[t];return s?s.buffered?$n(s)?st.PARTIAL:st.OK:st.APPENDING:st.NOT_LOADED}isTimeBuffered(e,t,s){let n,r;for(let o=0;o<s.length;o++){if(n=s.start(o)-this.bufferPadding,r=s.end(o)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,n=t.part?null:t,r=pi(s);this.fragments[r]={body:s,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:n,timeRanges:r,type:o}=t;if(s.sn==="initSegment")return;const a=s.type;if(n){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(n)}this.timeRanges=r;const l=r[o];this.detectEvictedFragments(o,l,a,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=pi(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let n=s.length;n--;){const r=t[s[n]];if((r==null?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,n,r){n&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==s||n&&!l.gap||l.start<t&&l.end>e&&(a.buffered||r)&&this.removeFragment(l)})}removeFragment(e){const t=pi(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const n=e.sn;this.activePartLists[e.type]=pu(s,r=>r.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const s=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;s&&s.forEach(n=>n.clearElementaryStreamInfo())}}function $n(i){var e,t,s;return i.buffered&&(i.body.gap||((e=i.range.video)==null?void 0:e.partial)||((t=i.range.audio)==null?void 0:t.partial)||((s=i.range.audiovideo)==null?void 0:s.partial))}function pi(i){return`${i.type}_${i.level}_${i.sn}`}function pu(i,e){return i.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Ws={cbc:0,ctr:1};class vb{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Ws.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ws.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function xb(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class Eb{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let n=0;n<4;n++)s[n]=t.getUint32(n*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,n=s[0],r=s[1],o=s[2],a=s[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],f=l[3],h=new Uint32Array(256);let g=0,p=0,m=0;for(m=0;m<256;m++)m<128?h[m]=m<<1:h[m]=m<<1^283;for(m=0;m<256;m++){let x=p^p<<1^p<<2^p<<3^p<<4;x=x>>>8^x&255^99,e[g]=x,t[x]=g;const E=h[g],v=h[E],b=h[v];let S=h[x]*257^x*16843008;n[g]=S<<24|S>>>8,r[g]=S<<16|S>>>16,o[g]=S<<8|S>>>24,a[g]=S,S=b*16843009^v*65537^E*257^g*16843008,c[x]=S<<24|S>>>8,u[x]=S<<16|S>>>16,d[x]=S<<8|S>>>24,f[x]=S,g?(g=E^h[h[h[b^E]]],p^=h[h[p]]):g=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,n=0;for(;n<t.length&&s;)s=t[n]===this.key[n],n++;if(s)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const o=this.ksRows=(r+6+1)*4;let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,h=this.invSubMix,g=h[0],p=h[1],m=h[2],x=h[3];let E,v;for(a=0;a<o;a++){if(a<r){E=c[a]=t[a];continue}v=E,a%r===0?(v=v<<8|v>>>24,v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[v&255],v^=f[a/r|0]<<24):r>6&&a%r===4&&(v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[v&255]),c[a]=E=(c[a-r]^v)>>>0}for(l=0;l<o;l++)a=o-l,l&3?v=c[a]:v=c[a-4],l<4||a<=4?u[l]=v:u[l]=g[d[v>>>24]]^p[d[v>>>16&255]]^m[d[v>>>8&255]]^x[d[v&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const n=this.keySize+6,r=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(s);let h=f[0],g=f[1],p=f[2],m=f[3];const x=new Int32Array(e),E=new Int32Array(x.length);let v,b,S,w,L,k,R,_,N,O,X,te,re,q;const z=this.networkToHostOrderSwap;for(;t<x.length;){for(N=z(x[t]),O=z(x[t+1]),X=z(x[t+2]),te=z(x[t+3]),L=N^r[0],k=te^r[1],R=X^r[2],_=O^r[3],re=4,q=1;q<n;q++)v=l[L>>>24]^c[k>>16&255]^u[R>>8&255]^d[_&255]^r[re],b=l[k>>>24]^c[R>>16&255]^u[_>>8&255]^d[L&255]^r[re+1],S=l[R>>>24]^c[_>>16&255]^u[L>>8&255]^d[k&255]^r[re+2],w=l[_>>>24]^c[L>>16&255]^u[k>>8&255]^d[R&255]^r[re+3],L=v,k=b,R=S,_=w,re=re+4;v=o[L>>>24]<<24^o[k>>16&255]<<16^o[R>>8&255]<<8^o[_&255]^r[re],b=o[k>>>24]<<24^o[R>>16&255]<<16^o[_>>8&255]<<8^o[L&255]^r[re+1],S=o[R>>>24]<<24^o[_>>16&255]<<16^o[L>>8&255]<<8^o[k&255]^r[re+2],w=o[_>>>24]<<24^o[L>>16&255]<<16^o[k>>8&255]<<8^o[R&255]^r[re+3],E[t]=z(v^h),E[t+1]=z(w^g),E[t+2]=z(S^p),E[t+3]=z(b^m),h=N,g=O,p=X,m=te,t=t+4}return E.buffer}}class bb{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=Tb(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function Tb(i){switch(i){case Ws.cbc:return"AES-CBC";case Ws.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const Sb=16;class gl{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?xb(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,n){return this.useSoftware?new Promise((r,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,s,n);const l=this.flush();l?r(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,n)}softwareDecrypt(e,t,s,n){const{currentIV:r,currentResult:o,remainderData:a}=this;if(n!==Ws.cbc||t.byteLength!==16)return Oe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=$t(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;r&&(s=r);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new Eb),c.expandKey(t);const u=o;return this.currentResult=c.decrypt(l.buffer,0,s),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,s,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,n));this.key=t,this.fastAesKey=new bb(this.subtle,t,n)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new vb(this.subtle,new Uint8Array(s),n).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(Oe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,n)))}onWebCryptoError(e,t,s,n){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,n);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%Sb;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(Oe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const yu=Math.pow(2,17);class Ab{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new vs({type:me.NETWORK_ERROR,details:P.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,r=n.fLoader,o=n.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(xu(e));return}else e.gap=!1;const c=this.loader=r?new r(n):new o(n),u=vu(e);e.loader=c;const d=mu(n.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:yu};e.stats=c.stats;const h={onSuccess:(g,p,m,x)=>{this.resetLoader(e,c);let E=g.data;m.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(E.slice(0,16)),E=E.slice(16)),a({frag:e,part:null,payload:E,networkDetails:x})},onError:(g,p,m,x)=>{this.resetLoader(e,c),l(new vs({type:me.NETWORK_ERROR,details:P.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ve({url:s,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:m,stats:x}))},onAbort:(g,p,m)=>{this.resetLoader(e,c),l(new vs({type:me.NETWORK_ERROR,details:P.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:m,stats:g}))},onTimeout:(g,p,m)=>{this.resetLoader(e,c),l(new vs({type:me.NETWORK_ERROR,details:P.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:m,stats:g}))}};t&&(h.onProgress=(g,p,m,x)=>t({frag:e,part:null,payload:m,networkDetails:x})),c.load(u,f,h)})}loadPart(e,t,s){this.abort();const n=this.config,r=n.fLoader,o=n.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(xu(e,t));return}const c=this.loader=r?new r(n):new o(n),u=vu(e,t);e.loader=c;const d=mu(n.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:yu};t.stats=c.stats,c.load(u,f,{onSuccess:(h,g,p,m)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const x={frag:e,part:t,payload:h.data,networkDetails:m};s(x),a(x)},onError:(h,g,p,m)=>{this.resetLoader(e,c),l(new vs({type:me.NETWORK_ERROR,details:P.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ve({url:u.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:p,stats:m}))},onAbort:(h,g,p)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new vs({type:me.NETWORK_ERROR,details:P.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:p,stats:h}))},onTimeout:(h,g,p)=>{this.resetLoader(e,c),l(new vs({type:me.NETWORK_ERROR,details:P.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:p,stats:h}))}})})}updateStatsFromPart(e,t){const s=e.stats,n=t.stats,r=n.total;if(s.loaded+=n.loaded,r){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(s.loaded/r),l),d=(l-c)*Math.round(s.loaded/c);s.total=s.loaded+d}else s.total=Math.max(s.loaded,s.total);const o=s.loading,a=n.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function vu(i,e=null){const t=e||i,s={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(le(n)&&le(r)){var o;let a=n,l=r;if(i.sn==="initSegment"&&_b((o=i.decryptdata)==null?void 0:o.method)){const c=r-n;c%16&&(l=r+(16-c%16)),n!==0&&(s.resetIV=!0,a=n-16)}s.rangeStart=a,s.rangeEnd=l}return s}function xu(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),s={type:me.MEDIA_ERROR,details:P.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(s.part=e),(e||i).stats.aborted=!0,new vs(s)}function _b(i){return i==="AES-128"||i==="AES-256"}class vs extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Nh extends Xt{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class ml{constructor(e,t,s,n=0,r=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Un(),this.buffering={audio:Un(),video:Un(),audiovideo:Un()},this.level=e,this.sn=t,this.id=s,this.size=n,this.part=r,this.partial=o}}function Un(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Eu={length:0,start:()=>0,end:()=>0};class Ae{static isBuffered(e,t){if(e){const s=Ae.getBuffered(e);for(let n=s.length;n--;)if(t>=s.start(n)&&t<=s.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=Ae.getBuffered(e);return Ae.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const n=Ae.bufferedRanges(e);if(n.length)return Ae.bufferedInfo(n,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((u,d)=>u.start-d.start||d.end-u.end);let n=-1,r=[];if(s)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(n=u);const d=r.length;if(d){const f=r[d-1].end;e[u].start-f<s?e[u].end>f&&(r[d-1].end=e[u].end):r.push(e[u])}else r.push(e[u])}else r=e;let o=0,a,l=t,c=t;for(let u=0;u<r.length;u++){const d=r[u].start,f=r[u].end;if(n===-1&&t>=d&&t<=f&&(n=u),t+s>=d&&t<f)l=d,c=f,o=c-t;else if(t+s<d){a=d;break}}return{len:o,start:l||0,end:c||0,nextStart:a,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||Eu}catch(t){return Oe.log("failed to get media.buffered",t),Eu}}}const Bh=/\{\$([a-zA-Z0-9-_]+)\}/g;function bu(i){return Bh.test(i)}function Ta(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(Bh,s=>{const n=s.substring(2,s.length-1),r=t==null?void 0:t[n];return r===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),s):r})}return e}function Tu(i,e,t){let s=i.variableList;s||(i.variableList=s={});let n,r;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(n))r=o.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(o){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else n=e.NAME,r=e.VALUE;n in s?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):s[n]=r||""}function Lb(i,e,t){const s=e.IMPORT;if(t&&s in t){let n=i.variableList;n||(i.variableList=n={}),n[s]=t[s]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const Rb=/^(\d+)x(\d+)$/,Su=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ze{constructor(e,t){typeof e=="string"&&(e=ze.parseAttrList(e,t)),Ue(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)s[n]=parseInt(t.slice(n*2,n*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((n,r)=>(n[r.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Rb.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const n={},r='"';for(Su.lastIndex=0;(s=Su.exec(e))!==null;){const o=s[1].trim();let a=s[2];const l=a.indexOf(r)===0&&a.lastIndexOf(r)===a.length-1;let c=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))a=Ta(t,a);else if(!c&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Oe.warn(`${e}: attribute ${o} is missing quotes`)}n[o]=a}return n}}const Ib="com.apple.hls.interstitial";function kb(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function wb(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class $h{constructor(e,t,s=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(n=t==null?void 0:t.tagOrder)!=null?n:s,t){const r=t.attr;for(const o in r)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==r[o]){Oe.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Ue(new ze({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);le(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Oe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(le(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Ib}get isValid(){return!!this.id&&!this._badValueForSameId&&le(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Cb=10;class Db{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?le(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Cb}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Ri(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function pl(i){switch(i){case"AES-128":case"AES-256":return Ws.cbc;case"AES-256-CTR":return Ws.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function Uh(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function Sa(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function Pb(i){const e=Sa(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Ob(i){const e=function(s,n,r){const o=s[n];s[n]=s[r],s[r]=o};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function Fb(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),n=s[s.length-1].split(",");if(n.length===2){const r=n[0]==="base64",o=n[1];r?(s.splice(-1,1),t=Uh(o)):t=Pb(o)}}return t}const Pr=typeof self<"u"?self:void 0;var Qe={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},At={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Aa(i){switch(i){case At.FAIRPLAY:return Qe.FAIRPLAY;case At.PLAYREADY:return Qe.PLAYREADY;case At.WIDEVINE:return Qe.WIDEVINE;case At.CLEARKEY:return Qe.CLEARKEY}}function Au(i){switch(i){case Qe.FAIRPLAY:return At.FAIRPLAY;case Qe.PLAYREADY:return At.PLAYREADY;case Qe.WIDEVINE:return At.WIDEVINE;case Qe.CLEARKEY:return At.CLEARKEY}}function cr(i){const{drmSystems:e,widevineLicenseUrl:t}=i,s=e?[Qe.FAIRPLAY,Qe.WIDEVINE,Qe.PLAYREADY,Qe.CLEARKEY].filter(n=>!!e[n]):[];return!s[Qe.WIDEVINE]&&t&&s.push(Qe.WIDEVINE),s}const Gh=function(i){return Pr!=null&&(i=Pr.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Mb(i,e,t,s){let n;switch(i){case Qe.FAIRPLAY:n=["cenc","sinf"];break;case Qe.WIDEVINE:case Qe.PLAYREADY:n=["cenc"];break;case Qe.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return Nb(n,e,t,s)}function Nb(i,e,t,s){return[{initDataTypes:i,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function Bb(i){var e;return i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function $b(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=Uh(a).subarray(0,16);return Ob(l),l}}return null}let Gn={};class lo{static clearKeyUriToKeyIdMap(){Gn={}}constructor(e,t,s,n=[1],r=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=n,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Ri(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(bh(o)))}matches(e){var t,s;return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&e.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((t=e.iv)==null?void 0:t.join(","))===((s=this.iv)==null?void 0:s.join(","))}isSupported(){if(this.method){if(Ri(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case At.FAIRPLAY:case At.WIDEVINE:case At.PLAYREADY:case At.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(Ri(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Oe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const s=Ub(e);return new lo(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.pssh&&this.keyId)return this;const t=Fb(this.uri);if(t)switch(this.keyFormat){case At.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){const s=t.length-22;this.keyId=t.subarray(s,s+16)}break;case At.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=KE(s,null,t),this.keyId=$b(t);break}default:{let s=t.subarray(0,16);if(s.length!==16){const n=new Uint8Array(16);n.set(s,16-s.length),s=n}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s=Gn[this.uri];if(!s){const n=Object.keys(Gn).length%Number.MAX_SAFE_INTEGER;s=new Uint8Array(16),new DataView(s.buffer,12,4).setUint32(0,n),Gn[this.uri]=s}this.keyId=s}return this}}function Ub(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const _u=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Lu=/#EXT-X-MEDIA:(.*)/g,Gb=/^#EXT(?:INF|-X-TARGETDURATION):/m,Po=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Vb=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class as{static findGroup(e,t){for(let s=0;s<e.length;s++){const n=e[s];if(n.id===t)return n}}static resolve(e,t){return ll.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Gb.test(e)}static parseMasterPlaylist(e,t){const s=bu(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},r=[];_u.lastIndex=0;let o;for(;(o=_u.exec(e))!=null;)if(o[1]){var a;const c=new ze(o[1],n),u=Ta(n,o[2]),d={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:as.resolve(u,t)},f=c.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),ku(c.CODECS,d);const h=c["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},ku(h,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||r.push(d),n.levels.push(d)}else if(o[3]){const c=o[3],u=o[4];switch(c){case"SESSION-DATA":{const d=new ze(u,n),f=d["DATA-ID"];f&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[f]=d);break}case"SESSION-KEY":{const d=Ru(u,t,n);d.encrypted&&d.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(d)):Oe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const d=new ze(u,n);Tu(n,d,t)}break}case"CONTENT-STEERING":{const d=new ze(u,n);n.contentSteering={uri:as.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=Iu(u);break}}}const l=r.length>0&&r.length<n.levels.length;return n.levels=l?r:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,s){let n;const r={},o=s.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Lu.lastIndex=0;(n=Lu.exec(e))!==null;){const c=new ze(n[1],s),u=c.TYPE;if(u){const d=a[u],f=r[u]||[];r[u]=f;const h=c.LANGUAGE,g=c["ASSOC-LANGUAGE"],p=c.CHANNELS,m=c.CHARACTERISTICS,x=c["INSTREAM-ID"],E={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||h||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:h,url:c.URI?as.resolve(c.URI,t):""};if(g&&(E.assocLang=g),p&&(E.channels=p),m&&(E.characteristics=m),x&&(E.instreamId=x),d!=null&&d.length){const v=as.findGroup(d,E.groupId)||d[0];wu(E,v,"audioCodec"),wu(E,v,"textCodec")}f.push(E)}}return r}static parseLevelPlaylist(e,t,s,n,r,o){var a;const l={url:t},c=new Db(t),u=c.fragments,d=[];let f=null,h=0,g=0,p=0,m=0,x=0,E=null,v=new wo(n,l),b,S,w,L=-1,k=!1,R=null,_;if(Po.lastIndex=0,c.m3u8=e,c.hasVariableRefs=bu(e),((a=Po.exec(e))==null?void 0:a[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(b=Po.exec(e))!==null;){k&&(k=!1,v=new wo(n,l),v.playlistOffset=p,v.start=p,v.sn=h,v.cc=m,x&&(v.bitrate=x),v.level=s,f&&(v.initSegment=f,f.rawProgramDateTime&&(v.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),R&&(v.setByteRange(R),R=null)));const te=b[1];if(te){v.duration=parseFloat(te);const re=(" "+b[2]).slice(1);v.title=re||null,v.tagList.push(re?["INF",te,re]:["INF",te])}else if(b[3]){if(le(v.duration)){v.playlistOffset=p,v.start=p,w&&Du(v,w,c),v.sn=h,v.level=s,v.cc=m,u.push(v);const re=(" "+b[3]).slice(1);v.relurl=Ta(c,re),_a(v,E,d),E=v,p+=v.duration,h++,g=0,k=!0}}else{if(b=b[0].match(Vb),!b){Oe.warn("No matches on slow regex match for level playlist!");continue}for(S=1;S<b.length&&b[S]===void 0;S++);const re=(" "+b[S]).slice(1),q=(" "+b[S+1]).slice(1),z=b[S+2]?(" "+b[S+2]).slice(1):null;switch(re){case"BYTERANGE":E?v.setByteRange(q,E):v.setByteRange(q);break;case"PROGRAM-DATE-TIME":v.rawProgramDateTime=q,v.tagList.push(["PROGRAM-DATE-TIME",q]),L===-1&&(L=u.length);break;case"PLAYLIST-TYPE":c.type&&ms(c,re,b),c.type=q.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?ms(c,re,b):u.length>0&&Pu(c,re,b),h=c.startSN=parseInt(q);break;case"SKIP":{c.skippedSegments&&ms(c,re,b);const j=new ze(q,c),he=j.decimalInteger("SKIPPED-SEGMENTS");if(le(he)){c.skippedSegments+=he;for(let Z=he;Z--;)u.push(null);h+=he}const fe=j.enumeratedString("RECENTLY-REMOVED-DATERANGES");fe&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(fe.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&ms(c,re,b),c.targetduration=Math.max(parseInt(q),1);break;case"VERSION":c.version!==null&&ms(c,re,b),c.version=parseInt(q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||ms(c,re,b),c.live=!1;break;case"#":(q||z)&&v.tagList.push(z?[q,z]:[q]);break;case"DISCONTINUITY":m++,v.tagList.push(["DIS"]);break;case"GAP":v.gap=!0,v.tagList.push([re]);break;case"BITRATE":v.tagList.push([re,q]),x=parseInt(q)*1e3,le(x)?v.bitrate=x:x=0;break;case"DATERANGE":{const j=new ze(q,c),he=new $h(j,c.dateRanges[j.ID],c.dateRangeTagCount);c.dateRangeTagCount++,he.isValid||c.skippedSegments?c.dateRanges[he.id]=he:Oe.warn(`Ignoring invalid DATERANGE tag: "${q}"`),v.tagList.push(["EXT-X-DATERANGE",q]);break}case"DEFINE":{{const j=new ze(q,c);"IMPORT"in j?Lb(c,j,o):Tu(c,j,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?ms(c,re,b):u.length>0&&Pu(c,re,b),c.startCC=m=parseInt(q);break;case"KEY":{const j=Ru(q,t,c);if(j.isSupported()){if(j.method==="NONE"){w=void 0;break}w||(w={});const he=w[j.keyFormat];he!=null&&he.matches(j)||(he&&(w=Ue({},w)),w[j.keyFormat]=j)}else Oe.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${q}"`);break}case"START":c.startTimeOffset=Iu(q);break;case"MAP":{const j=new ze(q,c);if(v.duration){const he=new wo(n,l);Cu(he,j,s,w),f=he,v.initSegment=f,f.rawProgramDateTime&&!v.rawProgramDateTime&&(v.rawProgramDateTime=f.rawProgramDateTime)}else{const he=v.byteRangeEndOffset;if(he){const fe=v.byteRangeStartOffset;R=`${he-fe}@${fe}`}else R=null;Cu(v,j,s,w),f=v,k=!0}f.cc=m;break}case"SERVER-CONTROL":{_&&ms(c,re,b),_=new ze(q),c.canBlockReload=_.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=_.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&_.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=_.optionalFloat("PART-HOLD-BACK",0),c.holdBack=_.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&ms(c,re,b);const j=new ze(q);c.partTarget=j.decimalFloatingPoint("PART-TARGET");break}case"PART":{let j=c.partList;j||(j=c.partList=[]);const he=g>0?j[j.length-1]:void 0,fe=g++,Z=new ze(q,c),F=new wE(Z,v,l,fe,he);j.push(F),v.duration+=F.duration;break}case"PRELOAD-HINT":{const j=new ze(q,c);c.preloadHint=j;break}case"RENDITION-REPORT":{const j=new ze(q,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(j);break}default:Oe.warn(`line parsed but not handled: ${b}`);break}}}E&&!E.relurl?(u.pop(),p-=E.duration,c.partList&&(c.fragmentHint=E)):c.partList&&(_a(v,E,d),v.cc=m,c.fragmentHint=v,w&&Du(v,w,c)),c.targetduration||(c.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const N=u.length,O=u[0],X=u[N-1];if(p+=c.skippedSegments*c.targetduration,p>0&&N&&X){c.averagetargetduration=p/N;const te=X.sn;c.endSN=te!=="initSegment"?te:0,c.live||(X.endList=!0),O&&c.startCC===void 0&&(c.startCC=O.cc),L>0&&(Kb(u,L),O&&d.unshift(O))}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(p+=c.fragmentHint.duration),c.totalduration=p,d.length&&c.dateRangeTagCount&&O&&Vh(d,c),c.endCC=m,c}}function Vh(i,e){const t=i.length;if(!t)return;const s=i[t-1],n=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let o=r.length;o--;){const a=e.dateRanges[r[o]],l=a.startDate.getTime();a.tagAnchor=s.ref;for(let c=t;c--;){const u=Hb(e,l,i,c,n);if(u!==-1){a.tagAnchor=e.fragments[u].ref;break}}}}function Hb(i,e,t,s,n){const r=t[s];if(r){const a=r.programDateTime;if(e>=a||s===0){var o;const l=(((o=t[s+1])==null?void 0:o.start)||n)-r.start;if(e<=a+l*1e3){const c=t[s].sn-i.startSN,u=i.fragments;if(u.length>t.length){const f=(t[s+1]||u[u.length-1]).sn-i.startSN;for(let h=f;h>c;h--){const g=u[h].programDateTime;if(e>=g&&e<g+u[h].duration*1e3)return h}}return c}}}return-1}function Ru(i,e,t){var s,n;const r=new ze(i,t),o=(s=r.METHOD)!=null?s:"",a=r.URI,l=r.hexadecimalInteger("IV"),c=r.KEYFORMATVERSIONS,u=(n=r.KEYFORMAT)!=null?n:"identity";a&&r.IV&&!l&&Oe.error(`Invalid IV: ${r.IV}`);const d=a?as.resolve(a,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new lo(o,d,u,f,l,r.KEYID)}function Iu(i){const t=new ze(i).decimalFloatingPoint("TIME-OFFSET");return le(t)?t:null}function ku(i,e){let t=(i||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const n=t.filter(r=>dl(r,s));n.length&&(e[`${s}Codec`]=n.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>n.indexOf(r)===-1))}),e.unknownCodecs=t}function wu(i,e,t){const s=e[t];s&&(i[t]=s)}function Kb(i,e){let t=i[e];for(let s=e;s--;){const n=i[s];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function _a(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Cu(i,e,t,s){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",s&&(i.levelkeys=s),i.initSegment=null}function Du(i,e,t){i.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&s.push(i)}function ms(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Pu(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Oo(i,e){const t=e.startPTS;if(le(t)){let s=0,n;e.sn>i.sn?(s=t-i.start,n=i):(s=i.start-t,n=e),n.duration!==s&&n.setDuration(s)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function Hh(i,e,t,s,n,r){s-t<=0&&(Oe.warn("Fragment should have a positive duration",e),s=t+e.duration,r=n+e.duration);let a=t,l=s;const c=e.startPTS,u=e.endPTS;if(le(c)){const m=Math.abs(c-t);le(e.deltaPTS)?e.deltaPTS=Math.max(m,e.deltaPTS):e.deltaPTS=m,a=Math.max(t,c),t=Math.min(t,c),n=Math.min(n,e.startDTS),l=Math.min(s,u),s=Math.max(s,u),r=Math.max(r,e.endDTS)}const d=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=a,e.startDTS=n,e.endPTS=s,e.minEndPTS=l,e.endDTS=r;const f=e.sn;if(!i||f<i.startSN||f>i.endSN)return 0;let h;const g=f-i.startSN,p=i.fragments;for(p[g]=e,h=g;h>0;h--)Oo(p[h],p[h-1]);for(h=g;h<p.length-1;h++)Oo(p[h],p[h+1]);return i.fragmentHint&&Oo(p[p.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,d}function jb(i,e){if(i===e)return;let t=null;const s=i.fragments;for(let c=s.length-1;c>=0;c--){const u=s[c].initSegment;if(u){t=u;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let n;Yb(i,e,(c,u,d,f)=>{if((!e.startCC||e.skippedSegments)&&u.cc!==c.cc){const h=c.cc-u.cc;for(let g=d;g<f.length;g++)f[g].cc+=h;e.endCC=f[f.length-1].cc}le(c.startPTS)&&le(c.endPTS)&&(u.setStart(u.startPTS=c.startPTS),u.startDTS=c.startDTS,u.maxStartPTS=c.maxStartPTS,u.endPTS=c.endPTS,u.endDTS=c.endDTS,u.minEndPTS=c.minEndPTS,u.setDuration(c.endPTS-c.startPTS),u.duration&&(n=u),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(u.elementaryStreams=c.elementaryStreams),u.loader=c.loader,c.hasStats&&(u.stats=c.stats),c.initSegment&&(u.initSegment=c.initSegment,t=c.initSegment)});const r=e.fragments,o=e.fragmentHint?r.concat(e.fragmentHint):r;if(t&&o.forEach(c=>{var u;c&&(!c.initSegment||c.initSegment.relurl===((u=t)==null?void 0:u.relurl))&&(c.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=r.some(c=>!c),e.deltaUpdateFailed){Oe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)r.shift();e.startSN=r[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Wb(i.dateRanges,e));const c=i.fragments.filter(u=>u.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let u=1;u<o.length;u++)o[u].programDateTime===null&&_a(o[u],o[u-1],c);Vh(c,e)}e.endCC=r[r.length-1].cc}if(!e.startCC){var a;const c=Wh(i,e.startSN-1);e.startCC=(a=c==null?void 0:c.cc)!=null?a:r[0].cc}qb(i.partList,e.partList,(c,u)=>{u.elementaryStreams=c.elementaryStreams,u.stats=c.stats}),n?Hh(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):Kh(i,e),r.length&&(e.totalduration=e.edge-r[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const l=e.advancedDateTime;if(e.advanced&&l){const c=e.edge;e.driftStart||(e.driftStartTime=l,e.driftStart=c),e.driftEndTime=l,e.driftEnd=c}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function Wb(i,e){const{dateRanges:t,recentlyRemovedDateranges:s}=e,n=Ue({},i);s&&s.forEach(a=>{delete n[a]});const o=Object.keys(n).length;return o&&Object.keys(t).forEach(a=>{const l=n[a],c=new $h(t[a].attr,l);c.isValid?(n[a]=c,l||(c.tagOrder+=o)):Oe.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${qe(t[a].attr)}"`)}),n}function qb(i,e,t){if(i&&e){let s=0;for(let n=0,r=i.length;n<=r;n++){const o=i[n],a=e[n+s];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):s--}}}function Yb(i,e,t){const s=e.skippedSegments,n=Math.max(i.startSN,e.startSN)-e.startSN,r=(i.fragmentHint?1:0)+(s?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,o=e.startSN-i.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let c=n;c<=r;c++){const u=l[o+c];let d=a[c];if(s&&!d&&u&&(d=e.fragments[c]=u),u&&d){if(t(u,d,c,a),u.url&&u.url!==d.url){e.playlistParsingError=Ou(`media sequence mismatch ${d.sn}:`,i,e,u,d);return}else if(u.cc!==d.cc){e.playlistParsingError=Ou(`discontinuity sequence mismatch (${u.cc}!=${d.cc})`,i,e,u,d);return}}}}function Ou(i,e,t,s,n){return new Error(`${i} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Kh(i,e,t=!0){const s=e.startSN+e.skippedSegments-i.startSN,n=i.fragments,r=s>=0;let o=0;if(r&&s<n.length)o=n[s].start;else if(r&&e.startSN===i.endSN+1)o=i.fragmentEnd;else if(r&&t)o=i.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=i.fragmentStart;else return;La(e,o)}function La(i,e){if(e){const t=i.fragments;for(let s=i.skippedSegments;s<t.length;s++)t[s].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function jh(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const s=i.fragments;if(s.length&&t*4>e){const r=s[s.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function Wh(i,e,t){if(!i)return null;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function Fu(i,e,t){return i?qh(i.partList,e,t):null}function qh(i,e,t){if(i)for(let s=i.length;s--;){const n=i[s];if(n.index===t&&n.fragment.sn===e)return n}return null}function Yh(i){i.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function sn(i,e){for(let s=0,n=i.length;s<n;s++){var t;if(((t=i[s])==null?void 0:t.cc)===e)return i[s]}return null}function zb(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function Mu(i,e){if(i){const t=i.start+e;i.start=i.startPTS=t,i.endPTS=t+i.duration}}function zh(i,e){const t=e.fragments;for(let s=0,n=t.length;s<n;s++)Mu(t[s],i);e.fragmentHint&&Mu(e.fragmentHint,i),e.alignedSliding=!0}function Xb(i,e){i&&(Xh(e,i),!e.alignedSliding&&i&&Or(e,i),!e.alignedSliding&&i&&!e.skippedSegments&&Kh(i,e,!1))}function Xh(i,e){if(!zb(e,i))return;const t=Math.min(e.endCC,i.endCC),s=sn(e.fragments,t),n=sn(i.fragments,t);if(!s||!n)return;Oe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=s.start-n.start;zh(r,i)}function Or(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,s=e.fragments;if(!t.length||!s.length)return;let n,r;const o=Math.min(e.endCC,i.endCC);e.startCC<o&&i.startCC<o&&(n=sn(s,o),r=sn(t,o)),(!n||!r)&&(n=s[Math.floor(s.length/2)],r=sn(t,n.cc)||t[Math.floor(t.length/2)]);const a=n.programDateTime,l=r.programDateTime;if(!a||!l)return;const c=(l-a)/1e3-(r.start-n.start);zh(c,i)}const Qb={toString:function(i){let e="";const t=i.length;for(let s=0;s<t;s++)e+=`[${i.start(s).toFixed(3)}-${i.end(s).toFixed(3)}]`;return e}},K={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class yl extends Nh{constructor(e,t,s,n,r){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=K.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:c,state:u}=this,d=l?l.currentTime:0,f=Ae.bufferInfo(c||l,d,o.maxBufferHole),h=!f.len;if(this.log(`Media seeking to ${le(d)?d.toFixed(3):d}, state: ${u}, ${h?"out of":"in"} buffer`),this.state===K.ENDED)this.resetLoadingState();else if(a){const g=o.maxFragLookUpTolerance,p=a.start-g,m=a.start+a.duration+g;if(h||m<f.start||p>f.end){const x=d>m;(d<p||x)&&(x&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(d>g&&(this.lastCurrentTime=d),!this.loadingParts){const p=Math.max(f.end,d),m=this.shouldLoadParts(this.getLevelDetails(),p);m&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${p.toFixed(2)}`),this.loadingParts=m)}}this.hls.hasEnoughToStart||(this.log(`Setting ${h?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,h&&(this.startPosition=d)),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new Ab(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new gl(e.config)}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===K.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=K.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,n=this.config.timelineOffset||0;if(s<=n)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=Ae.bufferedInfo(r,e.start,0));const o=e.nextStart;if(o&&o>n&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return Ae.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),s.addEventListener("seeking",this.onMediaSeeking),s.addEventListener("ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===K.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),n.removeEventListener("seeking",this.onMediaSeeking),n.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=K.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const n=r=>{const o=r.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(o,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,s,n).then(r=>{if(!r)return;const o=this.state,a=r.frag;if(this.fragContextChanged(a)){(o===K.FRAG_LOADING||!this.fragCurrent&&o===K.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=K.IDLE);return}"payload"in r&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(y.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===K.STOPPED||this.state===K.ERROR||(this.warn(`Frag error: ${(r==null?void 0:r.message)||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===st.APPENDING){const r=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,r),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===st.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:s};this.hls.trigger(y.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const n=s==null?void 0:s.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:n}=this,{frag:r,payload:o}=s,a=r.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&Ri(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,pl(a.method)).catch(c=>{throw n.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:r}),c}).then(c=>{const u=self.performance.now();return n.trigger(y.FRAG_DECRYPTED,{frag:r,payload:c,stats:{tstart:l,tdecrypt:u}}),s.payload=c,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===K.STOPPED||this.state===K.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==K.STOPPED&&(this.state=K.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?Qb.toString(Ae.getBuffered(s)):"(detached)"})`),et(e)){var n;if(e.type!==de.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=K.IDLE;return}}const r=(n=this.levels)==null?void 0:n[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=K.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:n,partsLoaded:r}=e,o=!r||r.length===0||r.some(l=>!l),a=new ml(s.level,s.sn,s.stats.chunkCount+1,0,n?n.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,n){var r;this.fragCurrent=e;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;e.encrypted&&!((r=e.decryptdata)!=null&&r.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=K.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(y.KEY_LOADED,d),this.state===K.KEY_LOADING&&(this.state=K.IDLE),d}),this.hls.trigger(y.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(et(e)&&(!l||e.sn!==l.sn)){const d=this.shouldLoadParts(t.details,e.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=d)}if(s=Math.max(e.start,s||0),this.loadingParts&&et(e)){const d=o.partList;if(d&&n){s>e.end&&o.fragmentHint&&(e=o.fragmentHint);const f=this.getNextPart(d,e,s);if(f>-1){const h=d[f];e=this.fragCurrent=h.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${h.index} (${f}/${d.length-1}) of ${this.fragInfo(e,!1,h)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=K.FRAG_LOADING;let g;return a?g=a.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,h,t,n)).catch(p=>this.handleFragLoadError(p)):g=this.doFragPartsLoad(e,h,t,n).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(y.FRAG_LOADING,{frag:e,part:h,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}else if(!e.url||this.loadedEndOfParts(d,s))return Promise.resolve(null)}}if(et(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${o?"["+o.startSN+"-"+o.endSN+"]":""}, target: ${parseFloat(s.toFixed(3))}`),le(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=K.FRAG_LOADING;const c=this.config.progressive;let u;return c&&a?u=a.then(d=>!d||this.fragContextChanged(d==null?void 0:d.frag)?null:this.fragmentLoader.load(e,n)).catch(d=>this.handleFragLoadError(d)):u=Promise.all([this.fragmentLoader.load(e,c?n:void 0),a]).then(([d])=>(!c&&d&&n&&n(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(y.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,s,n){return new Promise((r,o)=>{var a;const l=[],c=(a=s.details)==null?void 0:a.partList,u=d=>{this.fragmentLoader.loadPart(e,d,n).then(f=>{l[d.index]=f;const h=f.part;this.hls.trigger(y.FRAG_LOADED,f);const g=Fu(s.details,e.sn,d.index+1)||qh(c,e.sn,d.index+1);if(g)u(g);else return r({frag:e,part:h,partsLoaded:l})}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===P.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(y.ERROR,t)}else this.hls.trigger(y.ERROR,{type:me.OTHER_ERROR,details:P.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==K.PARSING){!this.fragCurrent&&this.state!==K.STOPPED&&this.state!==K.ERROR&&(this.state=K.IDLE);return}const{frag:s,part:n,level:r}=t,o=self.performance.now();s.stats.parsing.end=o,n&&(n.stats.parsing.end=o);const a=this.getLevelDetails(),c=a&&s.sn>a.endSN||this.shouldLoadParts(a,s.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(s,n,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var s;const r=e.partList[0],o=r.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=o){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:n,sn:r,part:o}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const a=t[n],l=a.details,c=o>-1?Fu(l,r,o):null,u=c?c.fragment:Wh(l,r,s);return u?(s&&s!==u&&(u.stats=s.stats),{frag:u,part:c,level:a}):null}bufferFragmentData(e,t,s,n,r){var o;if(!e||this.state!==K.PARSING)return;const{data1:a,data2:l}=e;let c=a;if(a&&l&&(c=$t(a,l)),!((o=c)!=null&&o.length))return;const u=this.initPTS[t.cc],d=u?-u.baseTime/u.timescale:void 0,f={type:e.type,frag:t,part:s,chunkMeta:n,offset:d,parent:t.type,data:c};if(this.hls.trigger(y.BUFFER_APPENDING,f),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ae.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,n=Ae.bufferInfo(t,s,0),r=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),a=Math.max(Math.min(e.start-o,n.end-o),s+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var s;const n=this.getLoadPosition();if(!le(n))return null;const o=this.lastCurrentTime>n||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,o)}getFwdBufferInfoAtPos(e,t,s,n){const r=Ae.bufferInfo(e,t,n);if(r.len===0&&r.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,s);if(o&&(r.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(r.nextStart,o.end)-t,n);return Ae.bufferInfo(e,t,a)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,n=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-t*3,s.maxMaxBufferLength/2,n);return r>=n?(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=de.MAIN){var s;const n=(s=this.fragmentTracker)==null?void 0:s.getAppendedFrag(e,t);return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const s=t.fragments,n=s.length;if(!n)return null;const{config:r}=this,o=s[0].start,a=r.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=r.initialLiveManifestSize;if(n<d)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,g=l?(f!==-1&&f>=o?f:h)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=o&&(l=s[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const d=l.sn-t.startSN;u=this.filterReplacedPrimary(s[d+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===st.OK||s===st.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,n,r){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&s.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,n,0);if(a!==null&&s.len+a.len>=r){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Nu(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Nu(this.hls.config)&&e.type!==de.SUBTITLE){const s=this.hls.interstitialsManager,n=s==null?void 0:s.bufferingItem;if(n){const o=n.event;if(o){if(o.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&(t==null?void 0:t.live)===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const r=s==null?void 0:s.playerQueue;if(r)for(let o=r.length;o--;){const a=r[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let n=-1,r=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,n>-1&&s<c.start)break;const u=c.loaded;u?n=-1:(r||c.independent||o)&&c.fragment===t&&(n=a),r=u}return n}loadedEndOfParts(e,t){const s=e[e.length-1];return s&&t>s.start&&s.loaded}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let n=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),n=fb(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const o=t[r-e.startSN];s.cc===o.cc&&(n=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=Mh(e,s.cc,s.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(n=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,s){const{config:n}=this;let{fragPrevious:r}=this,{fragments:o,endSN:a}=s;const{fragmentHint:l}=s,{maxFragLookUpTolerance:c}=n,u=s.partList,d=!!(this.loadingParts&&u!=null&&u.length&&l);d&&l&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let f;if(e<t){var h;const p=e<this.lastCurrentTime||e>t-c||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:c;f=ui(r,o,e,p)}else f=o[o.length-1];if(f){const g=f.sn-s.startSN,p=this.fragmentTracker.getState(f);if((p===st.OK||p===st.PARTIAL&&f.gap)&&(r=f),r&&f.sn===r.sn&&(!d||u[0].fragment.sn>f.sn||!s.live&&!d)&&r&&f.level===r.level){const x=o[g+1];f.sn<a&&this.fragmentTracker.getState(x)!==st.OK?f=x:f=null}}return f}alignPlaylists(e,t,s){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,o=!t,a=e.alignedSliding&&le(r);if(o||!a&&!r){Xb(s,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),l}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const n=this.timelineOffset;if(s===-1){const r=this.startTimeOffset!==null,o=r?this.startTimeOffset:e.startTimeOffset;o!==null&&le(o)?(s=t+o,o<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${o} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+n}this.nextLoadPosition=s+n}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&et(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==K.FRAG_LOADING_WAITING_RETRY)&&(this.state=K.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const g=this.getCurrentContext(t.chunkMeta);g&&(t.frag=g.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var n;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(n=this.fragCurrent)==null?void 0:n.url}`);return}const r=t.details===P.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(s,!0);const o=t.errorAction,{action:a,flags:l,retryCount:c=0,retryConfig:u}=o||{},d=!!o&&!!u,f=d&&a===mt.RetryRequest,h=d&&!o.resolved&&l===Gt.MoveAllAlternatesMatchingHost;if(!f&&h&&et(s)&&!s.endList)this.resetFragmentErrors(e),this.treatAsGap(s),o.resolved=!0;else if((f||h)&&c<u.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const g=hl(u,c);this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${c+1}/${u.maxNumRetry} in ${g}ms`),o.resolved=!0,this.retryDate=self.performance.now()+g,this.state=K.FRAG_LOADING_WAITING_RETRY}else if(u&&o)if(this.resetFragmentErrors(e),c<u.maxNumRetry)!r&&a!==mt.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else a===mt.SendAlternateToPenaltyBox?this.state=K.WAITING_LEVEL:this.state=K.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===K.PARSING||this.state===K.PARSED){const t=e.frag,s=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,s),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len,(t==null?void 0:t.duration)||10);const o=!r;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===de.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==K.STOPPED&&(this.state=K.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const n=Ae.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,s),this.state===K.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==K.STOPPED&&(this.state=K.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,n){const r=s.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const f=n?0:Hh(r,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS);return this.hls.trigger(y.LEVEL_PTS_UPDATED,{details:r,level:s,drift:f,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var a;if(s.fragmentError===0&&this.treatAsGap(e,s),((a=this.transmuxer)==null?void 0:a.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=K.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(y.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===de.MAIN?"level":"track"}fragInfo(e,t=!0,s){var n,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((n=t&&!s?e.startPTS:(s||e).start)!=null?n:NaN).toFixed(3)}-${((r=t&&!s?e.endPTS:(s||e).end)!=null?r:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Nu(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class Qh{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Jb(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Jb(i,e){const t=new Uint8Array(e);let s=0;for(let n=0;n<i.length;n++){const r=i[n];t.set(r,s),s+=r.length}return t}var Fo={exports:{}},Bu;function Zb(){return Bu||(Bu=1,function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function r(l,c,u,d,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var h=new n(u,d||l,f),g=t?t+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],h]:l._events[g].push(h):(l._events[g]=h,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new s:delete l._events[c]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,g=new Array(h);f<h;f++)g[f]=d[f].fn;return g},a.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,f,h,g){var p=t?t+c:c;if(!this._events[p])return!1;var m=this._events[p],x=arguments.length,E,v;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),x){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,d),!0;case 4:return m.fn.call(m.context,u,d,f),!0;case 5:return m.fn.call(m.context,u,d,f,h),!0;case 6:return m.fn.call(m.context,u,d,f,h,g),!0}for(v=1,E=new Array(x-1);v<x;v++)E[v-1]=arguments[v];m.fn.apply(m.context,E)}else{var b=m.length,S;for(v=0;v<b;v++)switch(m[v].once&&this.removeListener(c,m[v].fn,void 0,!0),x){case 1:m[v].fn.call(m[v].context);break;case 2:m[v].fn.call(m[v].context,u);break;case 3:m[v].fn.call(m[v].context,u,d);break;case 4:m[v].fn.call(m[v].context,u,d,f);break;default:if(!E)for(S=1,E=new Array(x-1);S<x;S++)E[S-1]=arguments[S];m[v].fn.apply(m[v].context,E)}}return!0},a.prototype.on=function(c,u,d){return r(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return r(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,f){var h=t?t+c:c;if(!this._events[h])return this;if(!u)return o(this,h),this;var g=this._events[h];if(g.fn)g.fn===u&&(!f||g.once)&&(!d||g.context===d)&&o(this,h);else{for(var p=0,m=[],x=g.length;p<x;p++)(g[p].fn!==u||f&&!g[p].once||d&&g[p].context!==d)&&m.push(g[p]);m.length?this._events[h]=m.length===1?m[0]:m:o(this,h)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,i.exports=a}(Fo)),Fo.exports}var eT=Zb(),vl=IE(eT);const bn="1.6.7",Oi={};function tT(){return typeof __HLS_WORKER_BUNDLE__=="function"}function sT(){const i=Oi[bn];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return Oi[bn]=n,n}function iT(i){const e=Oi[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Oi[i]=n,n}function nT(i){const e=Oi[i||bn];if(e&&e.clientCount--===1){const{worker:s,objectURL:n}=e;delete Oi[i||bn],n&&self.URL.revokeObjectURL(n),s.terminate()}}function Jh(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function xl(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function co(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function Tn(i,e){const t=e;let s=0;for(;xl(i,e);){s+=10;const n=co(i,e+6);s+=n,Jh(i,e+10)&&(s+=10),e+=s}if(s>0)return i.subarray(t,t+s)}function rT(i,e,t,s){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],o=r>>2&15;if(o>12){const h=new Error(`invalid ADTS sampling index:${o}`);i.emit(y.ERROR,y.ERROR,{type:me.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const a=(r>>6&3)+1,l=e[t+3]>>6&3|(r&1)<<2,c="mp4a.40."+a,u=n[o];let d=o;(a===5||a===29)&&(d-=3);const f=[a<<3|(d&14)>>1,(d&1)<<7|l<<3];return Oe.log(`manifest codec:${s}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:s}}function Zh(i,e){return i[e]===255&&(i[e+1]&246)===240}function eg(i,e){return i[e+1]&1?7:9}function El(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function oT(i,e){return e+5<i.length}function Fr(i,e){return e+1<i.length&&Zh(i,e)}function aT(i,e){return oT(i,e)&&Zh(i,e)&&El(i,e)<=i.length-e}function lT(i,e){if(Fr(i,e)){const t=eg(i,e);if(e+t>=i.length)return!1;const s=El(i,e);if(s<=t)return!1;const n=e+s;return n===i.length||Fr(i,n)}return!1}function tg(i,e,t,s,n){if(!i.samplerate){const r=rT(e,t,s,n);if(!r)return;Ue(i,r)}}function sg(i){return 1024*9e4/i}function cT(i,e){const t=eg(i,e);if(e+t<=i.length){const s=El(i,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function ig(i,e,t,s,n){const r=sg(i.samplerate),o=s+n*r,a=cT(e,t);let l;if(a){const{frameLength:d,headerLength:f}=a,h=f+d,g=Math.max(0,t+h-e.length);g?(l=new Uint8Array(h-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+h);const p={unit:l,pts:o};return g||i.samples.push(p),{sample:p,length:h,missing:g}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}function uT(i,e){return xl(i,e)&&co(i,e+6)+10<=i.length-e}function dT(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Mo(i,e=0,t=1/0){return fT(i,e,t,Uint8Array)}function fT(i,e,t,s){const n=hT(i);let r=1;"BYTES_PER_ELEMENT"in s&&(r=s.BYTES_PER_ELEMENT);const o=gT(i)?i.byteOffset:0,a=(o+i.byteLength)/r,l=(o+e)/r,c=Math.floor(Math.max(0,Math.min(l,a))),u=Math.floor(Math.min(c+Math.max(t,0),a));return new s(n,c,u-c)}function hT(i){return i instanceof ArrayBuffer?i:i.buffer}function gT(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function mT(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=i.data.subarray(1).indexOf(0);if(s===-1)return;const n=Ct(Mo(i.data,1,s)),r=i.data[2+s],o=i.data.subarray(3+s).indexOf(0);if(o===-1)return;const a=Ct(Mo(i.data,3+s,o));let l;return n==="-->"?l=Ct(Mo(i.data,4+s+o)):l=dT(i.data.subarray(4+s+o)),e.mimeType=n,e.pictureType=r,e.description=a,e.data=l,e}function pT(i){if(i.size<2)return;const e=Ct(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function yT(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const s=Ct(i.data.subarray(t),!0);t+=s.length+1;const n=Ct(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=Ct(i.data.subarray(1));return{key:i.type,info:"",data:e}}function vT(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const s=Ct(i.data.subarray(t),!0);t+=s.length+1;const n=Ct(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=Ct(i.data);return{key:i.type,info:"",data:e}}function xT(i){return i.type==="PRIV"?pT(i):i.type[0]==="W"?vT(i):i.type==="APIC"?mT(i):yT(i)}function ET(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=co(i,4),s=10;return{type:e,size:t,data:i.subarray(s,s+t)}}const Vn=10,bT=10;function ng(i){let e=0;const t=[];for(;xl(i,e);){const s=co(i,e+6);i[e+5]>>6&1&&(e+=Vn),e+=Vn;const n=e+s;for(;e+bT<n;){const r=ET(i.subarray(e)),o=xT(r);o&&t.push(o),e+=r.size+Vn}Jh(i,e)&&(e+=Vn)}return t}function rg(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function TT(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function bl(i){const e=ng(i);for(let t=0;t<e.length;t++){const s=e[t];if(rg(s))return TT(s)}}let kt=function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i}({});function rs(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Tl{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=$t(this.cachedData,e),this.cachedData=null);let s=Tn(e,0),n=s?s.length:0,r;const o=this._audioTrack,a=this._id3Track,l=s?bl(s):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&le(l))&&(this.basePTS=ST(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:kt.audioId3,duration:Number.POSITIVE_INFINITY});n<c;){if(this.canParse(e,n)){const u=this.appendFrame(o,e,n);u?(this.frameIndex++,this.lastPTS=u.sample.pts,n+=u.length,r=n):n=c}else uT(e,n)?(s=Tn(e,n),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:kt.audioId3,duration:Number.POSITIVE_INFINITY}),n+=s.length,r=n):n++;if(n===c&&r!==c){const u=e.slice(r);this.cachedData?this.cachedData=$t(this.cachedData,u):this.cachedData=u}}return{audioTrack:o,videoTrack:rs(),id3Track:a,textTrack:rs()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:rs(),id3Track:this._id3Track,textTrack:rs()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const ST=(i,e,t)=>{if(le(i))return i*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let Hn=null;const AT=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],_T=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],LT=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],RT=[0,1,1,4];function og(i,e,t,s,n){if(t+24>e.length)return;const r=ag(e,t);if(r&&t+r.frameLength<=e.length){const o=r.samplesPerFrame*9e4/r.sampleRate,a=s+n*o,l={unit:e.subarray(t,t+r.frameLength),pts:a,dts:a};return i.config=[],i.channelCount=r.channelCount,i.samplerate=r.sampleRate,i.samples.push(l),{sample:l,length:r.frameLength,missing:0}}}function ag(i,e){const t=i[e+1]>>3&3,s=i[e+1]>>1&3,n=i[e+2]>>4&15,r=i[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&r!==3){const o=i[e+2]>>1&1,a=i[e+3]>>6,l=t===3?3-s:s===3?3:4,c=AT[l*14+n-1]*1e3,d=_T[(t===3?0:t===2?1:2)*3+r],f=a===3?1:2,h=LT[t][s],g=RT[s],p=h*8*g,m=Math.floor(h*c/d+o)*g;if(Hn===null){const v=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Hn=v?parseInt(v[1]):0}return!!Hn&&Hn<=87&&s===2&&c>=224e3&&a===0&&(i[e+3]=i[e+3]|128),{sampleRate:d,channelCount:f,frameLength:m,samplesPerFrame:p}}}function Sl(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function lg(i,e){return e+1<i.length&&Sl(i,e)}function IT(i,e){return Sl(i,e)&&4<=i.length-e}function cg(i,e){if(e+1<i.length&&Sl(i,e)){const s=ag(i,e);let n=4;s!=null&&s.frameLength&&(n=s.frameLength);const r=e+n;return r===i.length||lg(i,r)}return!1}class kT extends Tl{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Tn(e,0);let n=(s==null?void 0:s.length)||0;if(cg(e,n))return!1;for(let r=e.length;n<r;n++)if(lT(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return aT(e,t)}appendFrame(e,t,s){tg(e,this.observer,t,s,e.manifestCodec);const n=ig(e,t,s,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const ug=(i,e)=>{let t=0,s=5;e+=s;const n=new Uint32Array(1),r=new Uint32Array(1),o=new Uint8Array(1);for(;s>0;){o[0]=i[e];const a=Math.min(s,8),l=8-a;r[0]=4278190080>>>24+l<<l,n[0]=(o[0]&r[0])>>l,t=t?t<<a|n[0]:n[0],e+=1,s-=a}return t};class wT extends Tl{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const n=dg(e,t,s,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=Tn(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&bl(t)!==void 0&&ug(e,s)<16}}function dg(i,e,t,s,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const a=[48e3,44100,32e3][r],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+r]*2;if(t+u>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[t+6]<<8|e[t+7])>>12-f&1,p=[2,1,2,3,3,4,4,5][d]+h,m=e[t+5]>>3,x=e[t+5]&7,E=new Uint8Array([r<<6|m<<1|x>>2,(x&3)<<6|d<<3|h<<2|l>>4,l<<4&224]),v=1536/a*9e4,b=s+n*v,S=e.subarray(t,t+u);return i.config=E,i.channelCount=p,i.samplerate=a,i.samples.push({unit:S,pts:b}),u}class CT extends Tl{resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Tn(e,0);let s=(t==null?void 0:t.length)||0;if(t&&e[s]===11&&e[s+1]===119&&bl(t)!==void 0&&ug(e,s)<=16)return!1;for(let n=e.length;s<n;s++)if(cg(e,s))return Oe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return IT(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return og(e,t,s,this.basePTS,this.frameIndex)}}const DT=/\/emsg[-/]ID3/i;class PT{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,n){const r=this.videoTrack=rs("video",1),o=this.audioTrack=rs("audio",1),a=this.txtTrack=rs("text",1);if(this.id3Track=rs("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=Rh(e);if(l.video){const{id:c,timescale:u,codec:d,supplemental:f}=l.video;r.id=c,r.timescale=a.timescale=u,r.codec=d,r.supplemental=f}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;o.id=c,o.timescale=u,o.codec=d}a.id=Ah.text,r.sampleDuration=0,r.duration=o.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return PE(e)}demux(e,t){this.timeOffset=t;let s=e;const n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=$t(this.remainderData,e));const a=UE(s);this.remainderData=a.remainder,n.samples=a.valid||new Uint8Array}else n.samples=s;const o=this.extractID3Track(n,t);return r.samples=nu(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return s.samples=nu(e,t),{videoTrack:t,audioTrack:rs(),id3Track:n,textTrack:rs()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const n=we(e.samples,["emsg"]);n&&n.forEach(r=>{const o=VE(r);if(DT.test(o.schemeIdUri)){const a=$u(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;s.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:kt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=$u(o,t);s.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:kt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function $u(i,e){return le(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class OT{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new gl(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ws.cbc)}decryptAacSample(e,t,s){const n=e[t].unit;if(n.length<=16)return;const r=n.subarray(16,n.length-n.length%16),o=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);n.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)})}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)s.set(e.subarray(r,r+16),n);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)e.set(s.subarray(n,n+16),r);return e}decryptAvcSample(e,t,s,n,r){const o=Ih(r.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{r.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,n)})}decryptAvcSamples(e,t,s,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){n();return}const r=e[t].units;for(;!(s>=r.length);s++){const o=r[s];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,s,n,o),!this.decrypter.isSync()))return}}}}class fg{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,n;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const r=s.units;n=r[r.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,n=s.length;if(n){const r=s[n-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const n=t.byteLength;let r=e.naluState||0;const o=r,a=[];let l=0,c,u,d,f=-1,h=0;for(r===-1&&(f=0,h=this.getNALuType(t,0),r=0,l=1);l<n;){if(c=t[l++],!r){r=c?0:1;continue}if(r===1){r=c?0:2;continue}if(!c)r=3;else if(c===1){if(u=l-r-1,f>=0){const g={data:t.subarray(f,u),type:h};a.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(o&&l<=4-o&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-o)),u>0&&(g.data=$t(g.data,t.subarray(0,u)),g.state=0))}l<n?(d=this.getNALuType(t,l),f=l,h=d,r=0):r=-1}else r=0}if(f>=0&&r>=0){const g={data:t.subarray(f,n),type:h,state:r};a.push(g)}if(a.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=$t(g.data,t))}return e.naluState=r,a}}class nn{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");n.set(e.subarray(s,s+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&Oe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Uu extends fg{parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let o=this.VideoSample,a,l=!1;s.data=null,o&&r.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(c=>{var u,d;switch(c.type){case 1:{let p=!1;a=!0;const m=c.data;if(l&&m.length>4){const x=this.readSliceType(m);(x===2||x===4||x===7||x===9)&&(p=!0)}if(p){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.frame=!0,o.key=p;break}case 5:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,ul(c.data,1,s.pts,t.samples);break}case 7:{var h,g;a=!0,l=!0;const p=c.data,m=this.readSPS(p);if(!e.sps||e.width!==m.width||e.height!==m.height||((h=e.pixelRatio)==null?void 0:h[0])!==m.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==m.pixelRatio[1]){e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.sps=[p];const x=p.subarray(1,4);let E="avc1.";for(let v=0;v<3;v++){let b=x[v].toString(16);b.length<2&&(b="0"+b),E+=b}e.codec=E}break}case 8:a=!0,e.pps=[c.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(c)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new nn(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,n=8,r;for(let o=0;o<e;o++)n!==0&&(r=t.readEG(),n=(s+r+256)%256),s=n===0?s:n}readSPS(e){const t=new nn(e);let s=0,n=0,r=0,o=0,a,l,c;const u=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),h=t.readBoolean.bind(t),g=t.skipBits.bind(t),p=t.skipEG.bind(t),m=t.skipUEG.bind(t),x=this.skipScalingList.bind(this);u();const E=u();if(d(5),g(3),u(),m(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){const k=f();if(k===3&&g(1),m(),m(),g(1),h())for(l=k!==3?8:12,c=0;c<l;c++)h()&&(c<6?x(16,t):x(64,t))}m();const v=f();if(v===0)f();else if(v===1)for(g(1),p(),p(),a=f(),c=0;c<a;c++)p();m(),g(1);const b=f(),S=f(),w=d(1);w===0&&g(1),g(1),h()&&(s=f(),n=f(),r=f(),o=f());let L=[1,1];if(h()&&h())switch(u()){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:{L=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((b+1)*16-s*2-n*2),height:(2-w)*(S+1)*16-(w?2:4)*(r+o),pixelRatio:L}}}class Gu extends fg{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let o=this.VideoSample,a,l=!1;s.data=null,o&&r.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(c=>{var u,d;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,ul(c.data,2,s.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ue(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(c.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in h.params)e.params[g]=h.params[g]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(c.data);for(const g in h)e.params[g]=h[g]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:a=!1;break}o&&a&&o.units.push(c)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[s]=e[n],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new nn(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:n}}readSPS(e){const t=new nn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const n=t.readBits(2),r=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),g=t.readUByte(),p=t.readUByte(),m=t.readUByte(),x=t.readUByte(),E=[],v=[];for(let $=0;$<s;$++)E.push(t.readBoolean()),v.push(t.readBoolean());if(s>0)for(let $=s;$<8;$++)t.readBits(2);for(let $=0;$<s;$++)E[$]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),v[$]&&t.readUByte();t.readUEG();const b=t.readUEG();b==3&&t.skipBits(1);const S=t.readUEG(),w=t.readUEG(),L=t.readBoolean();let k=0,R=0,_=0,N=0;L&&(k+=t.readUEG(),R+=t.readUEG(),_+=t.readUEG(),N+=t.readUEG());const O=t.readUEG(),X=t.readUEG(),te=t.readUEG(),re=t.readBoolean();for(let $=re?0:s;$<=s;$++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let H=0;H<4;H++)for(let se=0;se<(H===3?2:6);se++)if(!t.readBoolean())t.readUEG();else{const J=Math.min(64,1<<4+(H<<1));H>1&&t.readEG();for(let Y=0;Y<J;Y++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const j=t.readUEG();let he=0;for(let $=0;$<j;$++){let H=!1;if($!==0&&(H=t.readBoolean()),H){$===j&&t.readUEG(),t.readBoolean(),t.readUEG();let se=0;for(let ie=0;ie<=he;ie++){const J=t.readBoolean();let Y=!1;J||(Y=t.readBoolean()),(J||Y)&&se++}he=se}else{const se=t.readUEG(),ie=t.readUEG();he=se+ie;for(let J=0;J<se;J++)t.readUEG(),t.readBoolean();for(let J=0;J<ie;J++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const $=t.readUEG();for(let H=0;H<$;H++){for(let se=0;se<te+4;se++)t.readBits(1);t.readBits(1)}}let Z=0,F=1,V=1,xe=!0,Q=1,Ee=0;t.readBoolean(),t.readBoolean();let G=!1;if(t.readBoolean()){if(t.readBoolean()){const ge=t.readUByte(),ae=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],pe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];ge>0&&ge<16?(F=ae[ge-1],V=pe[ge-1]):ge===255&&(F=t.readBits(16),V=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),G=t.readBoolean(),G&&(k+=t.readUEG(),R+=t.readUEG(),_+=t.readUEG(),N+=t.readUEG()),t.readBoolean()&&(Q=t.readBits(32),Ee=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const pe=t.readBoolean(),be=t.readBoolean();let Ie=!1;(pe||be)&&(Ie=t.readBoolean(),Ie&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ie&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let $e=0;$e<=s;$e++){xe=t.readBoolean();const Fe=xe||t.readBoolean();let ft=!1;Fe?t.readEG():ft=t.readBoolean();const ct=ft?1:t.readUEG()+1;if(pe)for(let ht=0;ht<ct;ht++)t.readUEG(),t.readUEG(),Ie&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(be)for(let ht=0;ht<ct;ht++)t.readUEG(),t.readUEG(),Ie&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),Z=t.readUEG())}let ee=S,ce=w;if(L||G){let $=1,H=1;b===1?$=H=2:b==2&&($=2),ee=S-$*R-$*k,ce=w-H*N-H*_}const De=n?["A","B","C"][n]:"",A=a<<24|l<<16|c<<8|u;let I=0;for(let $=0;$<32;$++)I=(I|(A>>$&1)<<31-$)>>>0;let D=I.toString(16);return o===1&&D==="2"&&(D="6"),{codecString:`hvc1.${De}${o}.${D}.${r?"H":"L"}${x}.B0`,params:{general_tier_flag:r,general_profile_idc:o,general_profile_space:n,general_profile_compatibility_flags:[a,l,c,u],general_constraint_indicator_flags:[d,f,h,g,p,m],general_level_idc:x,bit_depth:O+8,bit_depth_luma_minus8:O,bit_depth_chroma_minus8:X,min_spatial_segmentation_idc:Z,chroma_format_idc:b,frame_rate:{fixed:xe,fps:Ee/Q}},width:ee,height:ce,pixelRatio:[F,V]}}readPPS(e){const t=new nn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let o=1;return r&&n?o=0:r?o=3:n&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const nt=188;class $s{constructor(e,t,s,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=n,this.videoParser=null}static probe(e,t){const s=$s.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(nt*5,t-nt)+1,n=0;for(;n<s;){let r=!1,o=-1,a=0;for(let l=n;l<t;l+=nt)if(e[l]===71&&(t-l===nt||e[l+nt]===71)){if(a++,o===-1&&(o=l,o!==0&&(s=Math.min(o+nt*99,e.length-nt)+1)),r||(r=Ra(e,l)===0),r&&a>1&&(o===0&&a>2||l+nt>s))return o}else{if(a)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Ah[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=$s.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=$s.createTrack("audio",n),this._id3Track=$s.createTrack("id3"),this._txtTrack=$s.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,n=!1){s||(this.sampleAes=null);let r;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,d=o.pesData,f=a.pid,h=l.pid,g=a.pesData,p=l.pesData,m=null,x=this.pmtParsed,E=this._pmtId,v=e.length;if(this.remainderData&&(e=$t(this.remainderData,e),v=e.length,this.remainderData=null),v<nt&&!n)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const b=Math.max(0,$s.syncOffset(e));v-=(v-b)%nt,v<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,v,e.buffer.byteLength-v));let S=0;for(let L=b;L<v;L+=nt)if(e[L]===71){const k=!!(e[L+1]&64),R=Ra(e,L),_=(e[L+3]&48)>>4;let N;if(_>1){if(N=L+5+e[L+4],N===L+nt)continue}else N=L+4;switch(R){case u:if(k){if(d&&(r=yi(d,this.logger))){if(this.videoParser===null)switch(o.segmentCodec){case"avc":this.videoParser=new Uu;break;case"hevc":this.videoParser=new Gu;break}this.videoParser!==null&&this.videoParser.parsePES(o,c,r,!1)}d={data:[],size:0}}d&&(d.data.push(e.subarray(N,L+nt)),d.size+=L+nt-N);break;case f:if(k){if(g&&(r=yi(g,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break;case"ac3":this.parseAC3PES(a,r);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(N,L+nt)),g.size+=L+nt-N);break;case h:k&&(p&&(r=yi(p,this.logger))&&this.parseID3PES(l,r),p={data:[],size:0}),p&&(p.data.push(e.subarray(N,L+nt)),p.size+=L+nt-N);break;case 0:k&&(N+=e[N]+1),E=this._pmtId=FT(e,N);break;case E:{k&&(N+=e[N]+1);const O=MT(e,N,this.typeSupported,s,this.observer,this.logger);u=O.videoPid,u>0&&(o.pid=u,o.segmentCodec=O.segmentVideoCodec),f=O.audioPid,f>0&&(a.pid=f,a.segmentCodec=O.segmentAudioCodec),h=O.id3Pid,h>0&&(l.pid=h),m!==null&&!x&&(this.logger.warn(`MPEG-TS PMT found at ${L} after unknown PID '${m}'. Backtracking to sync byte @${b} to parse all TS packets.`),m=null,L=b-188),x=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=R;break}}else S++;S>0&&Ia(this.observer,new Error(`Found ${S} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=g,l.pesData=p;const w={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return n&&this.extractRemainingSamples(w),w}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:n,textTrack:r}=e,o=s.pesData,a=t.pesData,l=n.pesData;let c;if(o&&(c=yi(o,this.logger))){if(this.videoParser===null)switch(s.segmentCodec){case"avc":this.videoParser=new Uu;break;case"hevc":this.videoParser=new Gu;break}this.videoParser!==null&&(this.videoParser.parsePES(s,r,c,!0),s.pesData=null)}else s.pesData=o;if(a&&(c=yi(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=yi(l,this.logger))?(this.parseID3PES(n,c),n.pesData=null):n.pesData=l}demuxSampleAes(e,t,s){const n=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new OT(this.observer,this.config,t);return this.decrypt(n,r)}decrypt(e,t){return new Promise(s=>{const{audioTrack:n,videoTrack:r}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{s(e)}):s(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const n=this.aacOverFlow;let r=t.data;if(n){this.aacOverFlow=null;const d=n.missing,f=n.sample.unit.byteLength;if(d===-1)r=$t(n.sample.unit,r);else{const h=f-d;n.sample.unit.set(r.subarray(0,d),h),e.samples.push(n.sample),s=n.missing}}let o,a;for(o=s,a=r.length;o<a-1&&!Fr(r,o);o++);if(o!==s){let d;const f=o<a-1;if(f?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",Ia(this.observer,new Error(d),f,this.logger),!f)return}tg(e,this.observer,r,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(n){const d=sg(e.samplerate);l=n.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;o<a;)if(u=ig(e,r,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;o<a-1&&!Fr(r,o);o++);}parseMPEGPES(e,t){const s=t.data,n=s.length;let r=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<n;)if(lg(s,o)){const l=og(e,s,o,a,r);if(l)o+=l.length,r++;else break}else o++}parseAC3PES(e,t){{const s=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=s.length;let o=0,a=0,l;for(;a<r&&(l=dg(e,s,a,n,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=Ue({},t,{type:this._videoTrack?kt.emsg:kt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function Ra(i,e){return((i[e+1]&31)<<8)+i[e+2]}function FT(i,e){return(i[e+10]&31)<<8|i[e+11]}function MT(i,e,t,s,n,r){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(i[e+1]&15)<<8|i[e+2],l=e+3+a-4,c=(i[e+10]&15)<<8|i[e+11];for(e+=12+c;e<l;){const u=Ra(i,e),d=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!s){No("ADTS AAC",r);break}case 15:o.audioPid===-1&&(o.audioPid=u);break;case 21:o.id3Pid===-1&&(o.id3Pid=u);break;case 219:if(!s){No("H.264",r);break}case 27:o.videoPid===-1&&(o.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="mp3");break;case 193:if(!s){No("AC-3",r);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let f=e+5,h=d;for(;h>2;){switch(i[f]){case 106:t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=u,o.segmentAudioCodec="ac3");break}const p=i[f+1]+2;f+=p,h-=p}}break;case 194:case 135:return Ia(n,new Error("Unsupported EC-3 in M2TS found"),void 0,r),o;case 36:o.videoPid===-1&&(o.videoPid=u,o.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=d+5}return o}function Ia(i,e,t,s){s.warn(`parsing error: ${e.message}`),i.emit(y.ERROR,y.ERROR,{type:me.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function No(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function yi(i,e){let t=0,s,n,r,o,a;const l=i.data;if(!i||i.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=$t(l[0],l[1]),l.splice(1,1);if(s=l[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(n=(s[4]<<8)+s[5],n&&n>i.size-6)return null;const u=s[7];u&192&&(o=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,u&64?(a=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),r=s[8];let d=r+9;if(i.size<=d)return null;i.size-=d;const f=new Uint8Array(i.size);for(let h=0,g=l.length;h<g;h++){s=l[h];let p=s.byteLength;if(d)if(d>p){d-=p;continue}else s=s.subarray(d),p-=d,d=0;f.set(s,t),t+=p}return n&&(n-=r+3),{data:f,pts:o,dts:a,len:n}}return null}class NT{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Cs=Math.pow(2,32)-1;class C{static init(){C.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in C.types)C.types.hasOwnProperty(e)&&(C.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);C.HDLR_TYPES={video:t,audio:s};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);C.STTS=C.STSC=C.STCO=r,C.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),C.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),C.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),C.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);C.FTYP=C.box(C.types.ftyp,o,l,o,a),C.DINF=C.box(C.types.dinf,C.box(C.types.dref,n))}static box(e,...t){let s=8,n=t.length;const r=n;for(;n--;)s+=t[n].byteLength;const o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=s&255,o.set(e,4),n=0,s=8;n<r;n++)o.set(t[n],s),s+=t[n].byteLength;return o}static hdlr(e){return C.box(C.types.hdlr,C.HDLR_TYPES[e])}static mdat(e){return C.box(C.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Cs+1)),n=Math.floor(t%(Cs+1));return C.box(C.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return C.box(C.types.mdia,C.mdhd(e.timescale||0,e.duration||0),C.hdlr(e.type),C.minf(e))}static mfhd(e){return C.box(C.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?C.box(C.types.minf,C.box(C.types.smhd,C.SMHD),C.DINF,C.stbl(e)):C.box(C.types.minf,C.box(C.types.vmhd,C.VMHD),C.DINF,C.stbl(e))}static moof(e,t,s){return C.box(C.types.moof,C.mfhd(e),C.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=C.trak(e[t]);return C.box.apply(null,[C.types.moov,C.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(C.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=C.trex(e[t]);return C.box.apply(null,[C.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Cs+1)),n=Math.floor(t%(Cs+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return C.box(C.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let n,r;for(n=0;n<t.length;n++)r=t[n].flags,s[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return C.box(C.types.sdtp,s)}static stbl(e){return C.box(C.types.stbl,C.stsd(e),C.box(C.types.stts,C.STTS),C.box(C.types.stsc,C.STSC),C.box(C.types.stsz,C.STSZ),C.box(C.types.stco,C.STCO))}static avc1(e){let t=[],s=[],n,r,o;for(n=0;n<e.sps.length;n++)r=e.sps[n],o=r.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)r=e.pps[n],o=r.byteLength,s.push(o>>>8&255),s.push(o&255),s=s.concat(Array.prototype.slice.call(r));const a=C.box(C.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return C.box(C.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,C.box(C.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),C.box(C.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return C.box(C.types.mp4a,C.audioStsd(e),C.box(C.types.esds,C.esds(e)))}static mp3(e){return C.box(C.types[".mp3"],C.audioStsd(e))}static ac3(e){return C.box(C.types["ac-3"],C.audioStsd(e),C.box(C.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return C.box(C.types.stsd,C.STSD,C.mp4a(e));if(t==="ac3"&&e.config)return C.box(C.types.stsd,C.STSD,C.ac3(e));if(t==="mp3"&&e.codec==="mp3")return C.box(C.types.stsd,C.STSD,C.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return C.box(C.types.stsd,C.STSD,C.avc1(e));if(t==="hevc"&&e.vps)return C.box(C.types.stsd,C.STSD,C.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),n=e.width||0,r=e.height||0,o=Math.floor(s/(Cs+1)),a=Math.floor(s%(Cs+1));return C.box(C.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const s=C.sdtp(e),n=e.id,r=Math.floor(t/(Cs+1)),o=Math.floor(t%(Cs+1));return C.box(C.types.traf,C.box(C.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),C.box(C.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,o>>24,o>>16&255,o>>8&255,o&255])),C.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,C.box(C.types.trak,C.tkhd(e),C.mdia(e))}static trex(e){const t=e.id;return C.box(C.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],n=s.length,r=12+16*n,o=new Uint8Array(r);let a,l,c,u,d,f;for(t+=8+r,o.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<n;a++)l=s[a],c=l.duration,u=l.size,d=l.flags,f=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return C.box(C.types.trun,o)}static initSegment(e){C.types||C.init();const t=C.moov(e);return $t(C.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],n=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let o=r.length;for(let g=0;g<s.length;g+=1){o+=3;for(let p=0;p<s[g].length;p+=1)o+=2+s[g][p].length}const a=new Uint8Array(o);a.set(r,0),o=r.length;const l=s.length-1;for(let g=0;g<s.length;g+=1){a.set(new Uint8Array([32+g|(g===l?128:0),0,s[g].length]),o),o+=3;for(let p=0;p<s[g].length;p+=1)a.set(new Uint8Array([s[g][p].length>>8,s[g][p].length&255]),o),o+=2,a.set(s[g][p],o),o+=s[g][p].length}const c=C.box(C.types.hvcC,a),u=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return C.box(C.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,C.box(C.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),C.box(C.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}}C.types=void 0;C.HDLR_TYPES=void 0;C.STTS=void 0;C.STSC=void 0;C.STCO=void 0;C.STSZ=void 0;C.VMHD=void 0;C.SMHD=void 0;C.STSD=void 0;C.FTYP=void 0;C.DINF=void 0;const hg=9e4;function Al(i,e,t=1,s=!1){const n=i*e*t;return s?Math.round(n):n}function BT(i,e,t=1,s=!1){return Al(i,e,1/t,s)}function ji(i,e=!1){return Al(i,1e3,1/hg,e)}function $T(i,e=1){return Al(i,hg,1/e)}const UT=10*1e3,GT=1024,VT=1152,HT=1536;let vi=null,Bo=null;function Vu(i,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class ur extends Xt{constructor(e,t,s,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,vi===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);vi=o?parseInt(o[1]):0}if(Bo===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);Bo=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,n=e.reduce((r,o)=>{let a=o.pts,l=a-r;return l<-4294967296&&(t=!0,a=Ot(a,s),l=a-r),l>0?r:a},s);return t&&this.debug("PTS rollover detected"),n}remux(e,t,s,n,r,o,a,l){let c,u,d,f,h,g,p=r,m=r;const x=e.pid>-1,E=t.pid>-1,v=t.samples.length,b=e.samples.length>0,S=a&&v>0||v>1;if((!x||b)&&(!E||S)||this.ISGenerated||a){if(this.ISGenerated){var L,k,R,_;const te=this.videoTrackConfig;(te&&(t.width!==te.width||t.height!==te.height||((L=t.pixelRatio)==null?void 0:L[0])!==((k=te.pixelRatio)==null?void 0:k[0])||((R=t.pixelRatio)==null?void 0:R[1])!==((_=te.pixelRatio)==null?void 0:_[1]))||!te&&S||this.nextAudioTs===null&&b)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,r,o));const N=this.isVideoContiguous;let O=-1,X;if(S&&(O=KT(t.samples),!N&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,O>0){this.warn(`Dropped ${O} out of ${v} video samples due to a missing keyframe`);const te=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(O),t.dropped+=O,m+=(t.samples[0].pts-te)/t.inputTimeScale,X=m}else O===-1&&(this.warn(`No keyframe found out of ${v} video samples`),g=!1);if(this.ISGenerated){if(b&&S){const te=this.getVideoStartPts(t.samples),q=(Ot(e.samples[0].pts,te)-te)/t.inputTimeScale;p+=Math.max(0,q),m+=Math.max(0,-q)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,r,o)),u=this.remuxAudio(e,p,this.isAudioContiguous,o,E||S||l===de.AUDIO?m:void 0),S){const te=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,r,o)),c=this.remuxVideo(t,m,N,te)}}else S&&(c=this.remuxVideo(t,m,N,0));c&&(c.firstKeyFrame=O,c.independent=O!==-1,c.firstKeyFramePTS=X)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(h=gg(s,r,this._initPTS,this._initDTS)),n.samples.length&&(f=mg(n,r,this._initPTS))),{audio:u,video:c,initSegment:d,independent:g,text:f,id3:h}}generateIS(e,t,s,n){const r=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let u=!c||n,d="audio/mp4",f,h,g,p;if(u&&(f=h=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):C.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(p=e.id,g=e.inputTimeScale,!c||g!==c.timescale?f=h=r[0].pts-Math.round(g*s):u=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:C.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(p=t.id,g=t.inputTimeScale,!c||g!==c.timescale){const m=this.getVideoStartPts(o),x=Math.round(g*s);h=Math.min(h,Ot(o[0].dts,m)-x),f=Math.min(f,m-x)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:f,timescale:g},this._initDTS={baseTime:h,timescale:g}):f=g=void 0,{tracks:l,initPTS:f,timescale:g,trackId:p}}remuxVideo(e,t,s,n){const r=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS,u=c.baseTime*r/c.timescale;let d=this.nextVideoTs,f=8,h=this.videoSampleDuration,g,p,m=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,E=!1;if(!s||d===null){const Z=u+t*r,F=o[0].pts-Ot(o[0].dts,o[0].pts);vi&&d!==null&&Math.abs(Z-F-(d+u))<15e3?s=!0:d=Z-F-u}const v=d+u;for(let Z=0;Z<l;Z++){const F=o[Z];F.pts=Ot(F.pts,v),F.dts=Ot(F.dts,v),F.dts<o[Z>0?Z-1:Z].dts&&(E=!0)}E&&o.sort(function(Z,F){const V=Z.dts-F.dts,xe=Z.pts-F.pts;return V||xe}),g=o[0].dts,p=o[o.length-1].dts;const b=p-g,S=b?Math.round(b/(l-1)):h||e.inputTimeScale/30;if(s){const Z=g-v,F=Z>S,V=Z<-1;if((F||V)&&(F?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ji(Z,!0)} ms (${Z}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ji(-Z,!0)} ms (${Z}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!V||v>=o[0].pts||vi)){g=v;const xe=o[0].pts-Z;if(F)o[0].dts=g,o[0].pts=xe;else{let Q=!0;for(let Ee=0;Ee<o.length&&!(o[Ee].dts>xe&&Q);Ee++){const G=o[Ee].pts;if(o[Ee].dts-=Z,o[Ee].pts-=Z,Ee<o.length-1){const oe=o[Ee+1].pts,ee=o[Ee].pts,ce=oe<=ee,De=oe<=G;Q=ce==De}}}this.log(`Video: Initial PTS/DTS adjusted: ${ji(xe,!0)}/${ji(g,!0)}, delta: ${ji(Z,!0)} ms`)}}g=Math.max(0,g);let w=0,L=0,k=g;for(let Z=0;Z<l;Z++){const F=o[Z],V=F.units,xe=V.length;let Q=0;for(let Ee=0;Ee<xe;Ee++)Q+=V[Ee].data.length;L+=Q,w+=xe,F.length=Q,F.dts<k?(F.dts=k,k+=S/4|0||1):k=F.dts,m=Math.min(F.pts,m),x=Math.max(F.pts,x)}p=o[l-1].dts;const R=L+4*w+8;let _;try{_=new Uint8Array(R)}catch(Z){this.observer.emit(y.ERROR,y.ERROR,{type:me.MUX_ERROR,details:P.REMUX_ALLOC_ERROR,fatal:!1,error:Z,bytes:R,reason:`fail allocating video mdat ${R}`});return}const N=new DataView(_.buffer);N.setUint32(0,R),_.set(C.types.mdat,4);let O=!1,X=Number.POSITIVE_INFINITY,te=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,q=Number.NEGATIVE_INFINITY;for(let Z=0;Z<l;Z++){const F=o[Z],V=F.units;let xe=0;for(let G=0,oe=V.length;G<oe;G++){const ee=V[G],ce=ee.data,De=ee.data.byteLength;N.setUint32(f,De),f+=4,_.set(ce,f),f+=De,xe+=4+De}let Q;if(Z<l-1)h=o[Z+1].dts-F.dts,Q=o[Z+1].pts-F.pts;else{const G=this.config,oe=Z>0?F.dts-o[Z-1].dts:S;if(Q=Z>0?F.pts-o[Z-1].pts:S,G.stretchShortVideoTrack&&this.nextAudioTs!==null){const ee=Math.floor(G.maxBufferHole*r),ce=(n?m+n*r:this.nextAudioTs+u)-F.pts;ce>ee?(h=ce-oe,h<0?h=oe:O=!0,this.log(`It is approximately ${ce/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=oe}else h=oe}const Ee=Math.round(F.pts-F.dts);X=Math.min(X,h),re=Math.max(re,h),te=Math.min(te,Q),q=Math.max(q,Q),a.push(Vu(F.key,h,xe,Ee))}if(a.length){if(vi){if(vi<70){const Z=a[0].flags;Z.dependsOn=2,Z.isNonSync=0}}else if(Bo&&q-te<re-X&&S/re<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let Z=g;for(let F=0,V=a.length;F<V;F++){const xe=Z+a[F].duration,Q=Z+a[F].cts;if(F<V-1){const Ee=xe+a[F+1].cts;a[F].duration=Ee-Q}else a[F].duration=F?a[F-1].duration:S;a[F].cts=0,Z=xe}}}h=O||!h?S:h;const z=p+h;this.nextVideoTs=d=z-u,this.videoSampleDuration=h,this.isVideoContiguous=!0;const fe={data1:C.moof(e.sequenceNumber++,g,Ue(e,{samples:a})),data2:_,startPTS:(m-u)/r,endPTS:(x+h-u)/r,startDTS:(g-u)/r,endDTS:d/r,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,fe}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return VT;case"ac3":return HT;default:return GT}}remuxAudio(e,t,s,n,r){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,c=this.getSamplesPerFrame(e),u=c*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],g=r!==void 0;let p=e.samples,m=f?0:8,x=this.nextAudioTs||-1;const E=d.baseTime*o/d.timescale,v=E+t*o;if(this.isAudioContiguous=s=s||p.length&&x>0&&(n&&Math.abs(v-(x+E))<9e3||Math.abs(Ot(p[0].pts,v)-(x+E))<20*u),p.forEach(function(q){q.pts=Ot(q.pts,v)}),!s||x<0){if(p=p.filter(q=>q.pts>=0),!p.length)return;r===0?x=0:n&&!g?x=Math.max(0,v-E):x=p[0].pts-E}if(e.segmentCodec==="aac"){const q=this.config.maxAudioFramesDrift;for(let z=0,j=x+E;z<p.length;z++){const he=p[z],fe=he.pts,Z=fe-j,F=Math.abs(1e3*Z/o);if(Z<=-q*u&&g)z===0&&(this.warn(`Audio frame @ ${(fe/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*Z/o)} ms.`),this.nextAudioTs=x=fe-E,j=fe);else if(Z>=q*u&&F<UT&&g){let V=Math.round(Z/u);for(j=fe-V*u;j<0&&V&&u;)V--,j+=u;z===0&&(this.nextAudioTs=x=j-E),this.warn(`Injecting ${V} audio frames @ ${((j-E)/o).toFixed(3)}s due to ${Math.round(1e3*Z/o)} ms gap.`);for(let xe=0;xe<V;xe++){let Q=NT.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Q||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Q=he.unit.subarray()),p.splice(z,0,{unit:Q,pts:j}),j+=u,z++}}he.pts=j,j+=u}}let b=null,S=null,w,L=0,k=p.length;for(;k--;)L+=p[k].unit.byteLength;for(let q=0,z=p.length;q<z;q++){const j=p[q],he=j.unit;let fe=j.pts;if(S!==null){const F=h[q-1];F.duration=Math.round((fe-S)/l)}else if(s&&e.segmentCodec==="aac"&&(fe=x+E),b=fe,L>0){L+=m;try{w=new Uint8Array(L)}catch(F){this.observer.emit(y.ERROR,y.ERROR,{type:me.MUX_ERROR,details:P.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:L,reason:`fail allocating audio mdat ${L}`});return}f||(new DataView(w.buffer).setUint32(0,L),w.set(C.types.mdat,4))}else return;w.set(he,m);const Z=he.byteLength;m+=Z,h.push(Vu(!0,c,Z,0)),S=fe}const R=h.length;if(!R)return;const _=h[h.length-1];x=S-E,this.nextAudioTs=x+l*_.duration;const N=f?new Uint8Array(0):C.moof(e.sequenceNumber++,b/l,Ue({},e,{samples:h}));e.samples=[];const O=(b-E)/o,X=x/o,re={data1:N,data2:w,startPTS:O,endPTS:X,startDTS:O,endDTS:X,type:"audio",hasAudio:!0,hasVideo:!1,nb:R};return this.isAudioContiguous=!0,re}}function Ot(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function KT(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function gg(i,e,t,s){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let a=0;a<n;a++){const l=i.samples[a];l.pts=Ot(l.pts-t.baseTime*r/t.timescale,e*r)/r,l.dts=Ot(l.dts-s.baseTime*r/s.timescale,e*r)/r}const o=i.samples;return i.samples=[],{samples:o}}function mg(i,e,t){const s=i.samples.length;if(!s)return;const n=i.inputTimeScale;for(let o=0;o<s;o++){const a=i.samples[o];a.pts=Ot(a.pts-t.baseTime*n/t.timescale,e*n)/n}i.samples.sort((o,a)=>o.pts-a.pts);const r=i.samples;return i.samples=[],{samples:r}}class jT extends Xt{constructor(e,t,s,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,n){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(NE(e,n)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const n=this.initData=Rh(e);n.audio&&(t=Hu(n.audio,Ke.AUDIO,this)),n.video&&(s=Hu(n.video,Ke.VIDEO,this));const r={};n.audio&&n.video?r.audiovideo={container:"video/mp4",codec:t+","+s,supplemental:n.video.supplemental,initSegment:e,id:"main"}:n.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?r.video={container:"video/mp4",codec:s,supplemental:n.video.supplemental,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,s,n,r,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:n,id3:s,initSegment:void 0};le(u)||(u=this.lastEndTime=r||0);const f=t.samples;if(!(f!=null&&f.length))return d;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((a=g)!=null&&a.length||(this.generateInitSegment(f),g=this.initData),!((l=g)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const p=$E(f,g,this),m=g.audio?p[g.audio.id]:null,x=g.video?p[g.video.id]:null,E=Kn(x,1/0),v=Kn(m,1/0),b=Kn(x,0,!0),S=Kn(m,0,!0);let w,L=r,k=0;if(m&&(!x||!c&&v<E||c&&c.trackId===g.audio.id)?(h.trackId=g.audio.id,w=m,k=S-v):x&&(h.trackId=g.video.id,w=x,k=b-E),w){const q=w.timescale;L=w.start/q,h.initPTS=w.start-r*q,h.timescale=q,c||(this.initPTS=c={baseTime:h.initPTS,timescale:q,trackId:h.trackId})}(o||!c)&&(WT(c,L,r,k)||h.timescale!==c.timescale)&&(h.initPTS=L-r,h.timescale=1,c&&c.timescale===1&&this.warn(`Adjusting initPTS @${r} from ${c.baseTime/c.timescale} to ${h.initPTS}`),this.initPTS=c={baseTime:h.initPTS,timescale:1});const R=e?L-c.baseTime/c.timescale:u,_=R+k;k>0?this.lastEndTime=_:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const N=!!g.audio,O=!!g.video;let X="";N&&(X+="audio"),O&&(X+="video");const te={data1:f,startPTS:R,startDTS:R,endPTS:_,endDTS:_,type:X,hasAudio:N,hasVideo:O,nb:1,dropped:0};d.audio=N&&!O?te:void 0,d.video=O?te:void 0;const re=x==null?void 0:x.sampleCount;if(re){const q=x.keyFrameIndex,z=q!==-1;te.nb=re,te.dropped=q===0||this.isVideoContiguous?0:z?q:re,te.independent=z,te.firstKeyFrame=q,z&&x.keyFrameStart&&(te.firstKeyFramePTS=(x.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(d.independent=z),this.isVideoContiguous||(this.isVideoContiguous=z),te.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${q}/${re} dropped: ${te.dropped} start: ${te.firstKeyFramePTS||"NA"}`)}return d.initSegment=h,d.id3=gg(s,r,c,c),n.samples.length&&(d.text=mg(n,r,c)),d}}function Kn(i,e,t=!1){return(i==null?void 0:i.start)!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function WT(i,e,t,s){if(i===null)return!0;const n=Math.max(s,1),r=e-i.baseTime/i.timescale;return Math.abs(r-t)>n}function Hu(i,e,t){const s=i==null?void 0:i.codec;return s&&s.length>4?s:e===Ke.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?Ir(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let xs;try{xs=self.performance.now.bind(self.performance)}catch{xs=Date.now}const dr=[{demux:PT,remux:jT},{demux:$s,remux:ur},{demux:kT,remux:ur},{demux:CT,remux:ur}];dr.splice(2,0,{demux:wT,remux:ur});class Ku{constructor(e,t,s,n,r,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,n){const r=s.transmuxing;r.executeStart=xs();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;n&&(this.currentTransmuxState=n);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:g}=n||a,{audioCodec:p,videoCodec:m,defaultInitPts:x,duration:E,initSegmentData:v}=l,b=qT(o,t);if(b&&Ri(b.method)){const k=this.getDecrypter(),R=pl(b.method);if(k.isSync()){let _=k.softwareDecrypt(o,b.key.buffer,b.iv.buffer,R);if(s.part>-1){const O=k.flush();_=O&&O.buffer}if(!_)return r.executeEnd=xs(),$o(s);o=new Uint8Array(_)}else return this.asyncResult=!0,this.decryptionPromise=k.webCryptoDecrypt(o,b.key.buffer,b.iv.buffer,R).then(_=>{const N=this.push(_,null,s);return this.decryptionPromise=null,N}),this.decryptionPromise}const S=this.needsProbing(u,d);if(S){const k=this.configureTransmuxer(o);if(k)return this.logger.warn(`[transmuxer] ${k.message}`),this.observer.emit(y.ERROR,y.ERROR,{type:me.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,fatal:!1,error:k,reason:k.message}),r.executeEnd=xs(),$o(s)}(u||d||g||S)&&this.resetInitSegment(v,p,m,E,t),(u||g||S)&&this.resetInitialTimestamp(x),c||this.resetContiguity();const w=this.transmux(o,b,h,f,s);this.asyncResult=Sn(w);const L=this.currentTransmuxState;return L.contiguous=!0,L.discontinuity=!1,L.trackSwitch=!1,r.executeEnd=xs(),w}flush(e){const t=e.transmuxing;t.executeStart=xs();const{decrypter:s,currentTransmuxState:n,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const o=[],{timeOffset:a}=n;if(s){const d=s.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=xs();const d=[$o(e)];return this.asyncResult?Promise.resolve(d):d}const u=l.flush(a);return Sn(u)?(this.asyncResult=!0,u.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,u,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,s){const{audioTrack:n,videoTrack:r,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===de.MAIN?"level":"track"} ${s.level}`);const u=this.remuxer.remux(n,r,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:s}),s.transmuxing.executeEnd=xs()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,n,r){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,s,n),a.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,n,r){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,s,n,r):o=this.transmuxUnencrypted(e,s,n,r),o}transmuxUnencrypted(e,t,s,n){const{audioTrack:r,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,o,a,l,t,s,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,s,n,r){return this.demuxer.demuxSampleAes(e,t,s).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,s,n,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:n}=this;let r;for(let d=0,f=dr.length;d<f;d++){var o;if((o=dr[d].demux)!=null&&o.probe(e,this.logger)){r=dr[d];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=r.remux,u=r.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(s,t,n,this.logger)),(!a||!(a instanceof u))&&(this.demuxer=new u(s,t,n,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new gl(this.config)),e}}function qT(i,e){let t=null;return i.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const $o=i=>({remuxResult:{},chunkMeta:i});function Sn(i){return"then"in i&&i.then instanceof Function}class YT{constructor(e,t,s,n,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=n,this.defaultInitPts=r||null}}class zT{constructor(e,t,s,n,r,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=n,this.timeOffset=r,this.initSegmentChange=o}}let ju=0;class pg{constructor(e,t,s,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=ju++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(y.ERROR,{type:me.OTHER_ERROR,details:P.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=n;const o=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===y.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new vl,this.observer.on(y.FRAG_DECRYPTED,o),this.observer.on(y.ERROR,o);const a=au(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(r.workerPath||tT()){try{r.workerPath?(l.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=iT(r.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=sT());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:qe(r)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new Ku(this.observer,a,r,"",t,e.logger)}return}}this.transmuxer=new Ku(this.observer,a,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=ju++;const t=this.hls.config,s=au(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:qe(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),nT(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,n,r,o,a,l,c,u){var d,f;c.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:g}=this,p=o?o.start:r.start,m=r.decryptdata,x=this.frag,E=!(x&&r.cc===x.cc),v=!(x&&c.level===x.level),b=x?c.sn-x.sn:-1,S=this.part?c.part-this.part.index:-1,w=b===0&&c.id>1&&c.id===(x==null?void 0:x.stats.chunkCount),L=!v&&(b===1||b===0&&(S===1||w&&S<=0)),k=self.performance.now();(v||b||r.stats.parsing.start===0)&&(r.stats.parsing.start=k),o&&(S||!L)&&(o.stats.parsing.start=k);const R=!(x&&((d=r.initSegment)==null?void 0:d.url)===((f=x.initSegment)==null?void 0:f.url)),_=new zT(E,L,l,v,p,R);if(!L||E||R){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===de.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${E}
        trackSwitch: ${v}
        contiguous: ${L}
        accurateTimeOffset: ${l}
        timeOffset: ${p}
        initSegmentChange: ${R}`);const N=new YT(s,n,t,a,u);this.configureTransmuxer(N)}if(this.frag=r,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:m,chunkMeta:c,state:_},e instanceof ArrayBuffer?[e]:[]);else if(g){const N=g.push(e,m,c,_);Sn(N)?N.then(O=>{this.handleTransmuxComplete(O)}).catch(O=>{this.transmuxerError(O,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(N)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const n=s.flush(e);Sn(n)?n.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Wu=100;class XT extends yl{constructor(e,t,s){super(e,t,s,"audio-stream-controller",de.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r}){if(s===de.MAIN){const o=t.cc,a=this.fragCurrent;if(this.initPTS[o]={baseTime:n,timescale:r},this.log(`InitPTS for cc: ${o} found from main: ${n}/${r}`),this.mainAnchor=t,this.state===K.WAITING_INIT_PTS){const l=this.waitingData;(!l&&!this.loadingParts||l&&l.frag.cc!==o)&&this.syncWithAnchor(t,l==null?void 0:l.frag)}else!this.hls.hasEnoughToStart&&a&&a.cc!==o?(a.abortRequests(),this.syncWithAnchor(t,a)):this.state===K.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const n=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&(n==null?void 0:n.cc)===t.cc)return;const r=(n||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=Mh(o,r,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===K.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=K.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(Wu),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=K.IDLE):this.state=K.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case K.IDLE:this.doTickIdle();break;case K.WAITING_TRACK:{const{levels:t,trackId:s}=this,n=t==null?void 0:t[s],r=n==null?void 0:n.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=K.WAITING_INIT_PTS}break}case K.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),s=this.retryDate;if(!s||t>=s||(e=this.media)!=null&&e.seeking){const{levels:n,trackId:r}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((n==null?void 0:n[r])||null),this.state=K.IDLE}break}case K.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:s,part:n,cache:r,complete:o}=t,a=this.mainAnchor;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.state=K.FRAG_LOADING;const l=r.flush().buffer,c={frag:s,part:n,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),o&&super._handleFragmentLoadComplete(c)}else a&&a.cc!==t.frag.cc&&this.syncWithAnchor(a,t.frag)}else this.state=K.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:n,trackId:r}=this,o=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(s!=null&&s[r]))return;const a=s[r],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=K.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,Ke.AUDIO,de.AUDIO));const u=this.getFwdBufferInfo(c,de.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(y.BUFFER_EOS,{type:"audio"}),this.state=K.ENDED;return}const d=u.len,f=t.maxBufferLength,h=l.fragments,g=h[0].start,p=this.getLoadPosition(),m=this.flushing?p:u.end;if(this.switchingTrack&&n){const v=p;l.PTSKnown&&v<g&&(u.end>g||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=g+.05)}if(d>=f&&!this.switchingTrack&&m<h[h.length-1].start)return;let x=this.getNextFragment(m,l);if(x&&this.isLoopLoading(x,m)&&(x=this.getNextFragmentLoopLoading(x,l,u,de.MAIN,f)),!x){this.bufferFlushed=!0;return}let E=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&E&&et(x)&&!x.endList&&(!l.live||!this.loadingParts&&m<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(E)===st.OK&&(this.mainFragLoading=E=null),E&&et(E))){if(x.start>E.end){const b=this.fragmentTracker.getFragAtPos(m,de.MAIN);b&&b.end>E.end&&(E=b,this.mainFragLoading={frag:b,targetBufferTime:null})}if(x.start>E.end)return}this.loadFragment(x,a,m)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new xn(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==K.STOPPED&&(this.setInterval(Wu),this.state=K.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(y.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:n}=this,{details:r,id:o,groupId:a,track:l}=t;if(!n){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const c=this.mainDetails;if(!c||r.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==K.STOPPED&&(this.state=K.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const u=n[o];let d=0;if(r.live||(s=u.details)!=null&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(u.details){var f;d=this.alignPlaylists(r,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}r.alignedSliding||(Xh(r,c),r.alignedSliding||Or(r,c),d=r.fragmentStart)}u.details=r,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,d),this.hls.trigger(y.AUDIO_TRACK_UPDATED,{details:r,id:o,groupId:t.groupId}),this.state===K.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=K.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=l[a];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const d=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new pg(this.hls,de.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[s.cc],g=(t=s.initSegment)==null?void 0:t.data;if(h!==void 0){const m=n?n.index:-1,x=m!==-1,E=new ml(s.level,s.sn,s.stats.chunkCount,r.byteLength,m,x);f.push(r,g,d,"",s,n,u.totalduration,!1,E,h)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:p}=this.waitingData=this.waitingData||{frag:s,part:n,cache:new Qh,complete:!1};p.push(new Uint8Array(r)),this.state!==K.STOPPED&&(this.state=K.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===de.MAIN&&et(t.frag)&&(this.mainFragLoading=t,this.state===K.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:n}=t;if(s.type!==de.AUDIO){!this.audioOnly&&s.type===de.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(et(s)){this.fragPrevious=s;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(y.AUDIO_TRACK_SWITCHED,Ve({},r)))}this.fragBufferedComplete(s,n),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=K.ERROR;return}switch(t.details){case P.FRAG_GAP:case P.FRAG_PARSING_ERROR:case P.FRAG_DECRYPT_ERROR:case P.FRAG_LOAD_ERROR:case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_ERROR:case P.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(de.AUDIO,t);break;case P.AUDIO_TRACK_LOAD_ERROR:case P.AUDIO_TRACK_LOAD_TIMEOUT:case P.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===K.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===Ce.AUDIO_TRACK&&(this.state=K.IDLE);break;case P.BUFFER_ADD_CODEC_ERROR:case P.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case P.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case P.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ke.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ke.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===K.ENDED&&(this.state=K.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,de.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:n}=this,{remuxResult:r,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{details:d}=u,{audio:f,text:h,id3:g,initSegment:p}=r;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=K.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){const m=l.initSegment||l;this._bufferInitSegment(u,p.tracks,m,o),n.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:s,tracks:p.tracks})}if(f){const{startPTS:m,endPTS:x,startDTS:E,endDTS:v}=f;c&&(c.elementaryStreams[Ke.AUDIO]={startPTS:m,endPTS:x,startDTS:E,endDTS:v}),l.setElementaryStreamInfo(Ke.AUDIO,m,x,E,v),this.bufferFragmentData(f,l,c,o)}if(g!=null&&(t=g.samples)!=null&&t.length){const m=Ue({id:s,frag:l,details:d},g);n.trigger(y.FRAG_PARSING_METADATA,m)}if(h){const m=Ue({id:s,frag:l,details:d},h);n.trigger(y.FRAG_PARSING_USERDATA,m)}}_bufferInitSegment(e,t,s,n){if(this.state!==K.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=de.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${o}/${r.codec}]`),o&&o.split(",").length===1&&(r.levelCodec=o),this.hls.trigger(y.BUFFER_CODECS,t);const a=r.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:s,part:null,chunkMeta:n,parent:s.type,data:a};this.hls.trigger(y.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===st.NOT_LOADED||n===st.PARTIAL){var r;if(!et(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=K.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Or(t.details,o)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:n,characteristics:r,audioCodec:o,channels:a}=this.bufferedTrack;ai({name:t,lang:s,assocLang:n,characteristics:r,audioCodec:o,channels:a},e,Zs)||(wr(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(y.AUDIO_TRACK_SWITCHED,Ve({},e))}}class _l extends Xt{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const n=t==null?void 0:t.renditionReports;if(n){let r=-1;for(let o=0;o<n.length;o++){const a=n[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===e){r=o;break}else l===e.substring(0,l.length)&&(r=o)}if(r!==-1){const o=n[r],a=parseInt(o["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let l=parseInt(o["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=s&&lu(s);return new cu(a,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:n,stats:r}=t,o=self.performance.now(),a=r.loading.first?Math.max(0,o-r.loading.first):0;n.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==n.appliedTimelineOffset){const u=Math.max(l||0,0);n.appliedTimelineOffset=u,n.fragments.forEach(d=>{d.start=d.playlistOffset+u})}if(n.live||s!=null&&s.live){const u="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(s),s&&n.fragments.length>0){jb(s,n);const E=n.playlistParsingError;if(E){this.warn(E);const v=this.hls;if(!v.config.ignorePlaylistParsingErrors){var c;const{networkDetails:b}=t;v.trigger(y.ERROR,{type:me.NETWORK_ERROR,details:P.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:E,reason:E.message,level:t.level||void 0,parent:(c=n.fragments[0])==null?void 0:c.type,networkDetails:b,stats:r});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=r.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(n.edge-f)*1e3,g=jh(n,h);if(n.requestScheduled+g<o?n.requestScheduled=o:n.requestScheduled+=g,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let p,m,x;if(n.canBlockReload&&n.endSN&&n.advanced){const E=this.hls.config.lowLatencyMode,v=n.lastPartSn,b=n.endSN,S=n.lastPartIndex,w=S!==-1,L=v===b;w?L?(m=b+1,x=E?0:S):(m=v,x=E?S+1:n.maxPartIndex):m=b+1;const k=n.age,R=k+n.ageHeader;let _=Math.min(R-n.partTarget,n.targetduration*1.5);if(_>0){if(R>n.targetduration*3)this.log(`Playlist last advanced ${k.toFixed(2)}s ago. Omitting segment and part directives.`),m=void 0,x=void 0;else if(s!=null&&s.tuneInGoal&&R-n.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${_} with playlist age: ${n.age}`),_=0;else{const N=Math.floor(_/n.targetduration);if(m+=N,x!==void 0){const O=Math.round(_%n.targetduration/n.partTarget);x+=O}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${k.toFixed(2)}s goal: ${_} skip sn ${N} to part ${x}`)}n.tuneInGoal=_}if(p=this.getDeliveryDirectives(n,t.deliveryDirectives,m,x),E||!L){n.requestScheduled=o,this.loadingPlaylist(u,p);return}}else(n.canBlockReload||n.canSkipUntil)&&(p=this.getDeliveryDirectives(n,t.deliveryDirectives,m,x));p&&m!==void 0&&n.canBlockReload&&(n.requestScheduled=r.loading.first+Math.max(g-a*2,g/2)),this.scheduleLoading(u,p,n)}else this.clearTimer()}scheduleLoading(e,t,s){const n=s||e.details;if(!n){this.loadingPlaylist(e,t);return}const r=self.performance.now(),o=n.requestScheduled;if(r>=o){this.loadingPlaylist(e,t);return}const a=o-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,s,n){let r=lu(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,n=t.part,r=lr.No),new cu(s,n,r)}checkRetry(e){const t=e.details,s=Cr(e),n=e.errorAction,{action:r,retryCount:o=0,retryConfig:a}=n||{},l=!!n&&!!a&&(r===mt.RetryRequest||!n.resolved&&r===mt.SendAlternateToPenaltyBox);if(l){var c;if(o>=a.maxNumRetry)return!1;if(s&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=hl(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,n.resolved=!0}return l}}function yg(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!An(i[t].attrs,e[t].attrs))return!1;return!0}function An(i,e,t){const s=i["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>i[n]!==e[n])}function ka(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class QT extends _l{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,o=this.tracksInGroup[s];if(!o||o.groupId!==n){this.warn(`Audio track with id:${s} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${s} "${o.name}" lang:${o.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||(n==null?void 0:n.length)!==(s==null?void 0:s.length)||s!=null&&s.some(a=>(n==null?void 0:n.indexOf(a))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!s||s.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,h)=>{f.id=h});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!r&&l){const f=os(l,a,Zs);if(f>-1)r=a[f];else{const h=os(l,this.tracks);r=this.tracks[h]}}let c=this.findTrackId(r);c===-1&&r&&(c=this.findTrackId(null));const u={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${s==null?void 0:s.join(",")}`),this.hls.trigger(y.AUDIO_TRACKS_UPDATED,u);const d=this.trackId;if(c!==-1&&d===-1)this.setAudioTrack(c);else if(a.length&&d===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ce.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const n=this.currentTrack;if(n&&ai(e,n,Zs))return n;const r=os(e,this.tracksInGroup,Zs);if(r>-1){const o=this.tracksInGroup[r];return this.setAudioTrack(r),o}else if(n){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=ub(e,t.levels,s,o,Zs);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=os(e,s);if(o>-1)return s[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e],r=n.details&&!n.details.live;if(e===this.trackId&&n===s&&r||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(y.AUDIO_TRACK_SWITCHING,Ve({},n)),r))return;const o=this.switchParams(n.url,s==null?void 0:s.details,n.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(!(this.selectDefaultTrack&&!n.default)&&(!e||ai(e,n,Zs)))return s}if(e){const{name:s,lang:n,assocLang:r,characteristics:o,audioCodec:a,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(ai({name:s,lang:n,assocLang:r,characteristics:o,audioCodec:a,channels:l},u,Zs))return c}for(let c=0;c<t.length;c++){const u=t[c];if(An(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(An(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&wr(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(y.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}}class JT{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(r){var s;if(n.onError(r),this.queues===null||this.tracks===null)return;const o=(s=this.tracks[e])==null?void 0:s.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],n=s==null?void 0:s.buffer;return n?`SourceBuffer${n.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const qu=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,vg="HlsJsTrackRemovedError";class ZT extends Error{constructor(e){super(e),this.name=vg}}class eS extends Xt{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:n,mediaSource:r}=this;s&&this.log("Media source opened"),!(!n||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(y.MEDIA_ATTACHED,{media:n,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:n}=this;s!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=RE(js(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_APPENDING,this.onBufferAppending,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.BUFFER_EOS,this.onBufferEos,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.FRAG_PARSED,this.onFragParsed,this),e.on(y.FRAG_CHANGED,this.onFragChanged,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_APPENDING,this.onBufferAppending,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_EOS,this.onBufferEos,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.FRAG_PARSED,this.onFragParsed,this),e.off(y.FRAG_CHANGED,this.onFragChanged,this),e.off(y.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const o=this.isQueued();(r||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?Ue(s,n.tracks):this.sourceBuffers.forEach(r=>{const[o]=r;o&&(s[o]=Ue({},this.tracks[o]),this.removeBuffer(o)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media,n=js(this.appendSource);if(this.transferData=this.overrides=void 0,s&&n){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(o),r)this._objectUrl=s.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{s.removeAttribute("src");const l=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||l&&o instanceof l,Yu(s),tS(s,a),s.load()}catch{s.src=a}else s.src=a}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,n=t.tracks,r=n?Object.keys(n):null,o=r?r.length:0,a=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(n&&r&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${qe(s,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${qe(n,(l,c)=>l==="initSegment"?void 0:c)}}`),!Eh(n,s)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(s)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(y.MEDIA_DETACHING,{}),this.onMediaAttaching(y.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,r.forEach(l=>{const c=l,u=n[c];if(u){const d=u.buffer;if(d){const f=this.fragmentTracker,h=u.id;if(f.hasFragments(h)||f.hasParts(h)){const m=Ae.getBuffered(d);f.detectEvictedFragments(c,m,h,null,!0)}const g=Uo(c),p=[c,d];this.sourceBuffers[g]=p,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:r,_objectUrl:o}=this;if(r){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=r.readyState==="open";try{const l=r.sourceBuffers;for(let c=l.length;c--;)a&&l[c].abort(),r.removeSourceBuffer(l[c]);a&&r.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),s||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(n.removeAttribute("src"),this.appendSource&&Yu(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(y.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Uo(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new JT(this.tracks)}onBufferCodecs(e,t){const s=this.tracks,n=Object.keys(t);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);const r="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),o=!r&&this.sourceBufferCount&&this.media&&n.some(a=>!s[a]);if(r||o){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${n}" SourceBuffers`);return}n.forEach(a=>{var l,c,u;const d=t[a],{id:f,codec:h,levelCodec:g,container:p,metadata:m,supplemental:x}=d;let E=s[a];const v=(l=this.transferData)==null||(c=l.tracks)==null?void 0:c[a],b=v!=null&&v.buffer?v:E,S=(b==null?void 0:b.pendingCodec)||(b==null?void 0:b.codec),w=b==null?void 0:b.levelCodec;E||(E=s[a]={buffer:void 0,listeners:[],codec:h,supplemental:x,container:p,levelCodec:g,metadata:m,id:f});const L=ar(S,w),k=L==null?void 0:L.replace(qu,"$1");let R=ar(h,g);const _=(u=R)==null?void 0:u.replace(qu,"$1");R&&L&&k!==_&&(a.slice(0,5)==="audio"&&(R=Ir(R,this.appendSource)),this.log(`switching codec ${S} to ${R}`),R!==(E.pendingCodec||E.codec)&&(E.pendingCodec=R),E.container=p,this.appendChangeType(a,p,R))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const n=`${t};codecs=${s}`,r={label:`change-type=${n}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),a.changeType(n),o.codec=s,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,n=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,de.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>n||l!=null&&l.buffer&&Ae.isBuffered(l.buffer,n)||((a=this.fragmentTracker.getAppendedFrag(n,de.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:n,type:r,parent:o,frag:a,part:l,chunkMeta:c,offset:u}=t,d=c.buffering[r],{sn:f,cc:h}=a,g=self.performance.now();d.start=g;const p=a.stats.buffering,m=l?l.stats.buffering:null;p.start===0&&(p.start=g),m&&m.start===0&&(m.start=g);const x=s.audio;let E=!1;r==="audio"&&(x==null?void 0:x.container)==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const v=s.video,b=v==null?void 0:v.buffer;if(b&&f!=="initSegment"){const L=l||a,k=this.blockedAudioAppend;if(r==="audio"&&o!=="main"&&!this.blockedAudioAppend){const _=L.start+L.duration*.05,N=b.buffered,O=this.currentOp("video");!N.length&&!O?this.blockAudio(L):!O&&!Ae.isBuffered(b,_)&&this.lastVideoAppendEnd<_&&this.blockAudio(L)}else if(r==="video"){const R=L.end;if(k){const _=k.frag.start;(R>_||R<this.lastVideoAppendEnd||Ae.isBuffered(b,_))&&this.unblockAudio()}this.lastVideoAppendEnd=R}}const S=(l||a).start,w={label:`append-${r}`,execute:()=>{var L;d.executeStart=self.performance.now();const k=(L=this.tracks[r])==null?void 0:L.buffer;k&&(E?this.updateTimestampOffset(k,S,.1,r,f,h):u!==void 0&&le(u)&&this.updateTimestampOffset(k,u,1e-6,r,f,h)),this.appendExecutor(n,r)},onStart:()=>{},onComplete:()=>{const L=self.performance.now();d.executeEnd=d.end=L,p.first===0&&(p.first=L),m&&m.first===0&&(m.first=L);const k={};this.sourceBuffers.forEach(([R,_])=>{R&&(k[R]=Ae.getBuffered(_))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(y.BUFFER_APPENDED,{type:r,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:k})},onError:L=>{var k;const R={type:me.MEDIA_ERROR,parent:a.type,details:P.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:a,part:l,chunkMeta:c,error:L,err:L,fatal:!1},_=(k=this.media)==null?void 0:k.error;if(L.code===DOMException.QUOTA_EXCEEDED_ERR||L.name=="QuotaExceededError"||"quota"in L)R.details=P.BUFFER_FULL_ERROR;else if(L.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!_)R.errorAction=En(!0);else if(L.name===vg&&this.sourceBufferCount===0)R.errorAction=En(!0);else{const N=++this.appendErrors[r];this.warn(`Failed ${N}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${_||"no media error"})`),(N>=this.hls.config.appendErrorMaxRetry||_)&&(R.fatal=!0)}this.hls.trigger(y.ERROR,R)}};this.append(w,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(y.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:s,startOffset:n,endOffset:r}=t;s?this.append(this.getFlushOp(s,n,r),s):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,n,r),o)})}onFragParsed(e,t){const{frag:s,part:n}=t,r=[],o=n?n.elementaryStreams:s.elementaryStreams;o[Ke.AUDIOVIDEO]?r.push("audiovideo"):(o[Ke.AUDIO]&&r.push("audio"),o[Ke.VIDEO]&&r.push("video"));const a=()=>{const l=self.performance.now();s.stats.buffering.end=l,n&&(n.stats.buffering.end=l);const c=n?n.stats:s.stats;this.hls.trigger(y.FRAG_BUFFERED,{frag:s,part:n,stats:c,id:s.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(a,r).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,s;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((s=this.tracks[e])==null?void 0:s.ending))})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const n=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})&&(n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(y.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(y.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===P.BUFFER_APPEND_ERROR&&t.frag){var s;const n=(s=t.errorAction)==null?void 0:s.nextAutoLevel;le(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const n=e.config,r=s.currentTime,o=t.levelTargetDuration,a=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(le(a)&&a>=0){const l=Math.max(a,o),c=Math.floor(r/o)*o-l;this.flushBackBuffer(r,o,c)}if(le(n.frontBufferFlushThreshold)&&n.frontBufferFlushThreshold>0){const l=Math.max(n.maxBufferLength,n.frontBufferFlushThreshold),c=Math.max(l,o),u=Math.floor(r/o)*o+c;this.flushFrontBuffer(r,o,u)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const a=Ae.getBuffered(r);if(a.length>0&&s>a.start(0)){var o;this.hls.trigger(y.BACK_BUFFER_REACHED,{bufferEnd:s});const l=this.tracks[n];if((o=this.details)!=null&&o.live)this.hls.trigger(y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(l!=null&&l.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:n})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const o=Ae.getBuffered(r),a=o.length;if(a<2)return;const l=o.start(a-1),c=o.end(a-1);if(s>l||e>=l&&e<=c)return;this.hls.trigger(y.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||(s==null?void 0:s.readyState)!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&s.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,n);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return le(r)?{duration:r}:null;const o=this.media.duration,a=le(s.duration)?s.duration:0;return n>a&&n>o||!le(o)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:s}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(le(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${s}.`),n.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${qe(s)}`),this.tracksReady){var n;const r=(n=this.transferData)==null?void 0:n.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const n=this.tracks[t];e[t]={buffer:s,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(y.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const o=r,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),c=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${qe(a)}`);try{const u=s.addSourceBuffer(c),d=Uo(o),f=[o,u];t[d]=f,a.buffer=u}catch(u){var n;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(o),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[o],this.hls.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:o,mimeType:c,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let n=e.codec;s&&(t==="video"||t==="audiovideo")&&xa(s,"video")&&(n=qE(n,s));const r=ar(n,e.levelCodec);return r?t.slice(0,5)==="audio"?Ir(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(y.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s==null?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${n}`,t),this.hls.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const r=this.currentOp(e);r&&r.onError(n)}updateTimestampOffset(e,t,s,n,r,o){const a=t-e.timestampOffset;Math.abs(a)>=s&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:n,mediaSource:r}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!n||!r||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=le(n.duration)?n.duration:1/0,c=le(r.duration)?r.duration:1/0,u=Math.max(0,t),d=Math.min(s,l,c);d>u&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${u},${d}] from the ${e} SourceBuffer`),a.remove(u,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],n=s==null?void 0:s.buffer;if(!n)throw new ZT(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,n=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(o=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const n=(s=this.tracks[t])==null?void 0:s.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const n=this.tracks[e];if(!n)return;const r=n.buffer;if(!r)return;const o=s.bind(this,e);n.listeners.push({event:t,listener:o}),r.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(n=>{s.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function Yu(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function tS(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Uo(i){return i==="audio"?1:0}class Ll{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&le(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((n,r)=>this.isLevelAllowed(n)&&r<=e);return this.clientRect=null,Ll.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const n=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let r=e.length-1;const o=Math.max(t,s);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&n(l,e[a+1])){r=a;break}}return r}}const sS={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},St=sS,iS={HLS:"h"},nS=iS,rS="CMCD-Object",oS="CMCD-Request",aS="CMCD-Session",lS="CMCD-Status",qi={OBJECT:rS,REQUEST:oS,SESSION:aS,STATUS:lS},cS={[qi.OBJECT]:["br","ab","d","ot","tb","tpb","lb","tab","lab","url"],[qi.REQUEST]:["pb","bl","tbl","dl","ltc","mtp","nor","nrr","rc","sn","sta","su","ttfb","ttfbb","ttlb","cmsdd","cmsds","smrt","df","cs"],[qi.SESSION]:["cid","pr","sf","sid","st","v","msd"],[qi.STATUS]:["bs","bsd","cdn","rtp","bg","pt","ec","e"]};class Fi{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof Fi?s:new Fi(s))),this.value=e,this.params=t}}const uS="Dict";function dS(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function fS(i,e,t,s){return new Error(`failed to ${i} "${dS(e)}" as ${t}`,{cause:s})}function us(i,e,t){return fS("serialize",i,e,t)}class xg{constructor(e){this.description=e}}const zu="Bare Item",hS="Boolean";function gS(i){if(typeof i!="boolean")throw us(i,hS);return i?"?1":"?0"}function mS(i){return btoa(String.fromCharCode(...i))}const pS="Byte Sequence";function yS(i){if(ArrayBuffer.isView(i)===!1)throw us(i,pS);return`:${mS(i)}:`}const vS="Integer";function xS(i){return i<-999999999999999||999999999999999<i}function Eg(i){if(xS(i))throw us(i,vS);return i.toString()}function ES(i){return`@${Eg(i.getTime()/1e3)}`}function bg(i,e){if(i<0)return-bg(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const n=Math.floor(i*t);return(n%2===0?n:n+1)/t}else return Math.round(i*t)/t}const bS="Decimal";function TS(i){const e=bg(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw us(i,bS);const t=e.toString();return t.includes(".")?t:`${t}.0`}const SS="String",AS=/[\x00-\x1f\x7f]+/;function _S(i){if(AS.test(i))throw us(i,SS);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function LS(i){return i.description||i.toString().slice(7,-1)}const RS="Token";function Xu(i){const e=LS(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw us(e,RS);return e}function wa(i){switch(typeof i){case"number":if(!le(i))throw us(i,zu);return Number.isInteger(i)?Eg(i):TS(i);case"string":return _S(i);case"symbol":return Xu(i);case"boolean":return gS(i);case"object":if(i instanceof Date)return ES(i);if(i instanceof Uint8Array)return yS(i);if(i instanceof xg)return Xu(i);default:throw us(i,zu)}}const IS="Key";function Ca(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw us(i,IS);return i}function Rl(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${Ca(e)}`:`;${Ca(e)}=${wa(t)}`).join("")}function Tg(i){return i instanceof Fi?`${wa(i.value)}${Rl(i.params)}`:wa(i)}function kS(i){return`(${i.value.map(Tg).join(" ")})${Rl(i.params)}`}function wS(i,e={whitespace:!0}){if(typeof i!="object")throw us(i,uS);const t=i instanceof Map?i.entries():Object.entries(i),s=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([n,r])=>{r instanceof Fi||(r=new Fi(r));let o=Ca(n);return r.value===!0?o+=Rl(r.params):(o+="=",Array.isArray(r.value)?o+=kS(r):o+=Tg(r)),o}).join(`,${s}`)}function CS(i,e){return wS(i,e)}function DS(i){return["ot","sf","st","e","sta"].includes(i)}function PS(i){return typeof i=="number"?le(i):i!=null&&i!==""&&i!==!1}function OS(i,e){const t=new URL(i),s=new URL(e);if(t.origin!==s.origin)return i;const n=t.pathname.split("/").slice(1),r=s.pathname.split("/").slice(1,-1);for(;n[0]===r[0];)n.shift(),r.shift();for(;r.length;)r.shift(),n.unshift("..");return n.join("/")}const fr=i=>Math.round(i),FS=(i,e)=>(e!=null&&e.baseUrl&&(i=OS(i,e.baseUrl)),encodeURIComponent(i)),jn=i=>fr(i/100)*100,MS={br:fr,d:fr,bl:jn,dl:jn,mtp:jn,nor:FS,rtp:jn,tb:fr};function NS(i,e){const t={};if(i==null||typeof i!="object")return t;const s=Object.keys(i).sort(),n=Ue({},MS,e==null?void 0:e.formatters),r=e==null?void 0:e.filter;return s.forEach(o=>{if((r==null?void 0:r(o))===!1)return;let a=i[o];const l=n[o];l&&(a=l(a,e)),!(o==="v"&&a===1)&&(o=="pr"&&a===1||PS(a)&&(DS(o)&&typeof a=="string"&&(a=new xg(a)),t[o]=a))}),t}function Sg(i,e={}){return i?CS(NS(i,e),Ue({whitespace:!1},e)):""}function BS(i,e={}){const t={};if(!i)return t;const s=Object.entries(i),n=Object.entries(cS).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),r=s.reduce((o,a)=>{var l,c;const[u,d]=a,f=((l=n.find(h=>h[1].includes(u)))===null||l===void 0?void 0:l[0])||qi.REQUEST;return(c=o[f])!==null&&c!==void 0||(o[f]={}),o[f][u]=d,o},{});return Object.entries(r).reduce((o,[a,l])=>(o[a]=Sg(l,e),o),t)}function $S(i,e,t){return Ue(i,BS(e,t))}const US="CMCD";function GS(i,e={}){if(!i)return"";const t=Sg(i,e);return`${US}=${encodeURIComponent(t)}`}const Qu=/CMCD=[^&#]+/;function VS(i,e,t){const s=GS(e,t);if(!s)return i;if(Qu.test(i))return i.replace(Qu,s);const n=i.includes("?")?"&":"?";return`${i}${n}${s}`}class HS{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:St.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=n=>{try{const{frag:r,part:o}=n,a=this.hls.levels[r.level],l=this.getObjectType(r),c={d:(o||r).duration*1e3,ot:l};(l===St.VIDEO||l===St.AUDIO||l==St.MUXED)&&(c.br=a.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=o?this.getNextPart(o):this.getNextFrag(r);u!=null&&u.url&&u.url!==r.url&&(c.nor=u.url),this.apply(n,c)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHED,this.onMediaDetached,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHED,this.onMediaDetached,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,n;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:nS.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ue(t,this.createData());const s=t.ot===St.INIT||t.ot===St.VIDEO||t.ot===St.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((o,a)=>(n.includes(a)&&(o[a]=t[a]),o),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),$S(e.headers,t,r)):e.url=VS(e.url,t,r)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const n=e.sn-s.startSN;return s.fragments[n+1]}}getNextPart(e){var t,s;const{index:n,fragment:r}=e,o=(t=this.hls.levels[r.level])==null||(s=t.details)==null?void 0:s.partList;if(o){const{sn:a}=r;for(let l=o.length-1;l>=0;l--){const c=o[l];if(c.index===n&&c.fragment.sn===a)return o[l+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return St.TIMED_TEXT;if(e.sn==="initSegment")return St.INIT;if(t==="audio")return St.AUDIO;if(t==="main")return this.hls.audioTracks.length?St.VIDEO:St.MUXED}getTopBandwidth(e){let t=0,s;const n=this.hls;if(e===St.AUDIO)s=n.audioTracks;else{const r=n.maxAutoLevel,o=r>-1?r+1:n.levels.length;s=n.levels.slice(0,o)}return s.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===St.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:Ae.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,o,a){t(r),this.loader.load(r,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,o,a){t(r),this.loader.load(r,o,a)}}}}const KS=3e5;class jS extends Xt{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((s==null?void 0:s.action)===mt.SendAlternateToPenaltyBox&&s.flags===Gt.MoveAllAlternatesMatchingHost){const n=this.levels;let r=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:c}=t.context;a&&n?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!r&&n&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),s.resolved=this.pathwayId!==o),t.details===P.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${n&&n.length} priorities: ${qe(r)} penalized: ${qe(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,n=performance.now();Object.keys(s).forEach(r=>{n-s[r]>KS&&delete s[r]});for(let r=0;r<e.length;r++){const o=e[r];if(o in s)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,Yh(t),this.hls.trigger(y.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,s){const n=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<n.length;r++)if(t===Ce.AUDIO_TRACK&&n[r].hasAudioGroup(e)||t===Ce.SUBTITLE_TRACK&&n[r].hasSubtitleGroup(e))return n[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},n={};e.forEach(r=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=r;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const d=new ze(u.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(s[d.AUDIO]=f,d.AUDIO=f),h&&(n[d.SUBTITLES]=h,d.SUBTITLES=h);const g=Ag(u.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),p=new xn({attrs:d,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:g,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let m=1;m<u.audioGroups.length;m++)p.addGroupId("audio",`${u.audioGroups[m]}_clone_${o}`);if(u.subtitleGroups)for(let m=1;m<u.subtitleGroups.length;m++)p.addGroupId("text",`${u.subtitleGroups[m]}_clone_${o}`);return p});t.push(...c),Ju(this.audioTracks,s,l,o),Ju(this.subtitleTracks,n,l,o)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+u)}const r={responseType:"json",url:n.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,d,f,h)=>{this.log(`Loaded steering manifest: "${n}"`);const g=u.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":p,"PATHWAY-CLONES":m,"PATHWAY-PRIORITY":x}=g;if(p)try{this.uri=new self.URL(p,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||f.url),m&&this.clonePathways(m);const E={steeringManifest:g,url:n.toString()};this.hls.trigger(y.STEERING_MANIFEST_LOADED,E),x&&this.updatePathwayPriority(x)},onError:(u,d,f,h)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let g=this.timeToLoad*1e3;if(u.code===429){const p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){const m=p.getResponseHeader("Retry-After");m&&(g=parseFloat(m)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,g)},onTimeout:(u,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(r,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const n=(s=this.hls)==null?void 0:s.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Ju(i,e,t,s){i&&Object.keys(e).forEach(n=>{const r=i.filter(o=>o.groupId===n).map(o=>{const a=Ue({},o);return a.details=void 0,a.attrs=new ze(a.attrs),a.url=a.attrs.URI=Ag(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[n],a.attrs["PATHWAY-ID"]=s,a});i.push(...r)})}function Ag(i,e,t,s){const{HOST:n,PARAMS:r,[t]:o}=s;let a;e&&(a=o==null?void 0:o[e],a&&(i=a));const l=new self.URL(i);return n&&!a&&(l.host=n),r&&Object.keys(r).sort().forEach(c=>{c&&l.searchParams.set(c,r[c])}),l.href}function Ft(i,e,t){Ht(i,e,t),i.addEventListener(e,t)}function Ht(i,e,t){i.removeEventListener(e,t)}class Ii extends Xt{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Ii.CDMCleanupPromise?[Ii.CDMCleanupPromise]:[],this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onWaitingForKey=null}registerListeners(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(y.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(y.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,n=t[e];if(n)return n.licenseUrl;if(e===Qe.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(o,a,l)=>!!o&&l.indexOf(o)===a,n=t.map(o=>o.audioCodec).filter(s),r=t.map(o=>o.videoCodec).filter(s);return n.length+r.length===0&&r.push("avc1.42e01e"),new Promise((o,a)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,n,r).then(d=>o({keySystem:u,mediaKeys:d})).catch(d=>{c.length?l(c):d instanceof Pt?a(d):a(new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${s}`;return Gh===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return s(e,t)}getMediaKeysPromise(e,t,s){const n=Mb(e,t,s,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let o=r==null?void 0:r.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${qe(n)}`),o=this.requestMediaKeySystemAccess(e,n);const a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),a.mediaKeys=l.createMediaKeys().then(u=>(this.log(`Media-keys created for "${e}"`),a.hasMediaKeys=!0,c.then(d=>d?this.setMediaKeysServerCertificate(u,e,d):u))),a.mediaKeys.catch(u=>{this.error(`Failed to create media-keys for "${e}"}: ${u}`)}),a.mediaKeys})}return o.then(()=>r.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${ti.hexDump(e.keyId||[])}`);const n=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),n=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return ti.hexDump(e.keyId)}updateKeySession(e,t){var s;const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${ti.hexDump(((s=e.decryptdata)==null?void 0:s.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Au(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const r=Au(n);r?t(r):s(new Error(`Unable to find format for key-system "${n}"`))}).catch(s))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=cr(this.config),s=e.map(Aa).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(s)}loadKey(e){const t=e.keyInfo.decryptdata,s=this.getKeyIdString(t),n=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);let r=this.keyIdToKeySessionPromise[s];return r||(r=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(a,l).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:a,mediaKeys:l,decryptdata:t}))))),(this.keyIdToKeySessionPromise[s]=r.then(a=>{const l="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(a,l,c,"playlist-key")})).catch(a=>this.handleError(a))),r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Pt?this.hls.trigger(y.ERROR,e.data):this.hls.trigger(y.ERROR,{type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),s=this.keyIdToKeySessionPromise[t];if(!s){const n=Aa(e.keyFormat),r=n?[n]:cr(this.config);return this.attemptKeySystemAccess(r)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=cr(this.config)),e.length===0)throw new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${qe({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(s).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>s.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,s,n){var r,o;const a=(r=this.config.drmSystems)==null||(o=r[e.keySystem])==null?void 0:o.generateRequest;if(a)try{const g=a.call(this.hls,t,s,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,s=g.initData?g.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(g){var l;if(this.warn(g.message),(l=this.hls)!=null&&l.config.debug)throw g}if(s===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${n}": ${c} (init data type: ${t} length: ${s?s.byteLength:null})`);const u=new vl,d=e._onmessage=g=>{const p=e.mediaKeysSession;if(!p){u.emit("error",new Error("invalid state"));return}const{messageType:m,message:x}=g;this.log(`"${m}" message event for session "${p.sessionId}" message size: ${x.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,x).catch(E=>{u.eventNames().length?u.emit("error",E):this.handleError(E)}):m==="license-release"?e.keySystem===Qe.FAIRPLAY&&(this.updateKeySession(e,Sa("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${m}"`)},f=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const m=e.keyStatus;u.emit("keyStatus",m),m==="expired"&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};Ft(e.mediaKeysSession,"message",d),Ft(e.mediaKeysSession,"keystatuseschange",f);const h=new Promise((g,p)=>{u.on("error",p),u.on("keyStatus",m=>{m.startsWith("usable")?g():m==="output-restricted"?p(new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):m==="internal-error"?p(new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${m}"`)):m==="expired"?p(new Error("key expired while generating request")):this.warn(`unhandled key status change "${m}"`)})});return e.mediaKeysSession.generateRequest(t,s).then(()=>{var g;this.log(`Request generated for key-session "${(g=e.mediaKeysSession)==null?void 0:g.sessionId}" keyId: ${c}`)}).catch(g=>{throw new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_NO_SESSION,error:g,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>h).catch(g=>{throw u.removeAllListeners(),this.removeSession(e),g}).then(()=>(u.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,s)=>{if(typeof s=="string"&&typeof t=="object"){const n=s;s=t,t=n}this.log(`key status change "${t}" for keyStatuses keyId: ${ti.hexDump("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))} session keyId: ${ti.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,s=t.loader,n=new s(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:r},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,g,p)=>{o(f.data)},onError:(f,h,g,p)=>{a(new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:Ve({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${r}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,g)=>{a(new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(f,h,g)=>{a(new Error("aborted"))}};n.load(l,u,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((n,r)=>{e.setServerCertificate(s).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${s==null?void 0:s.byteLength}) on "${t}"`),n(e)}).catch(o=>{r(new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(n=>{throw new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:n,fatal:!0},n.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(s,"application/xml"),r=n.querySelectorAll("HttpHeader");if(r.length>0){let u;for(let d=0,f=r.length;d<f;d++){var o,a;u=r[d];const h=(o=u.querySelector("name"))==null?void 0:o.textContent,g=(a=u.querySelector("value"))==null?void 0:a.textContent;h&&g&&e.setRequestHeader(h,g)}}const l=n.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Sa(atob(c))}setupLicenseXHR(e,t,s,n){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,n)}).catch(o=>{if(!s.decryptdata)throw o;return e.open("POST",t,!0),r.call(this.hls,e,t,s,n)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((n,r)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,a,o,e)}catch(u){this.error(u)}n(l)}else{const l=s.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||a.status>=400&&a.status<500)r(new Pt({type:me.KEY_SYSTEM_ERROR,details:P.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(n,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==Qe.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Ft(s,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(Ht(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,lo.clearKeyUriToKeyIdMap();const n=s.length;Ii.CDMCleanupPromise=Promise.all(s.map(r=>this.removeSession(r)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(r=>{var o;this.log(`Could not clear media keys: ${r}`),(o=this.hls)==null||o.trigger(y.ERROR,{type:me.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${r}`)})}))).catch(r=>{var o;this.log(`Could not close sessions and clear media keys: ${r}`),(o=this.hls)==null||o.trigger(y.ERROR,{type:me.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${r}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((n,r)=>(n.indexOf(r.keyFormat)===-1&&n.push(r.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);n>-1&&this.mediaKeySessions.splice(n,1);const{drmSystemOptions:r}=this.config;return(Bb(r)?new Promise((a,l)=>{self.setTimeout(()=>l(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(a)}):Promise.resolve()).catch(a=>{var l;this.log(`Could not remove session: ${a}`),(l=this.hls)==null||l.trigger(y.ERROR,{type:me.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${a}`)})}).then(()=>t.close()).catch(a=>{var l;this.log(`Could not close session: ${a}`),(l=this.hls)==null||l.trigger(y.ERROR,{type:me.OTHER_ERROR,details:P.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${a}`)})})}}}Ii.CDMCleanupPromise=void 0;class Pt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class WS{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const n=performance.now();if(t){if(this.lastTime){const r=n-this.lastTime,o=s-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/r,c=this.hls;if(c.trigger(y.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:s}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(y.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function _g(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function Lg(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){Oe.debug(`[texttrack-utils]: ${s}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,i.addCue(n)}catch(n){Oe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(i.mode=t)}function Ti(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let s=i.cues.length;s--;)e&&i.cues[s].removeEventListener("enter",e),i.removeCue(i.cues[s]);t==="disabled"&&(i.mode=t)}function Da(i,e,t,s){const n=i.mode;if(n==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const r=YS(i.cues,e,t);for(let o=0;o<r.length;o++)(!s||s(r[o]))&&i.removeCue(r[o])}n==="disabled"&&(i.mode=n)}function qS(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let s=0,n=t,r;for(;s<=n;)if(r=Math.floor((n+s)/2),e<i[r].startTime)n=r-1;else if(e>i[r].startTime&&s<t)s=r+1;else return r;return i[s].startTime-e<e-i[n].startTime?s:n}function YS(i,e,t){const s=[],n=qS(i,e);if(n>-1)for(let r=n,o=i.length;r<o;r++){const a=i[r];if(a.startTime>=e&&a.endTime<=t)s.push(a);else if(a.startTime>t)return s}return s}function hr(i){const e=[];for(let t=0;t<i.length;t++){const s=i[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(i[t])}return e}class zS extends _l{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=hr(this.media.textTracks);for(let r=0;r<s.length;r++)if(s[r].mode==="hidden")t=s[r];else if(s[r].mode==="showing"){t=s[r];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;hr(s.textTracks).forEach(o=>{Ti(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,o=this.tracksInGroup[s];if(!o||o.groupId!==n){this.warn(`Subtitle track with id:${s} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${s} "${o.name}" lang:${o.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||(n==null?void 0:n.length)!==(s==null?void 0:s.length)||s!=null&&s.some(o=>(n==null?void 0:n.indexOf(o))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!s||s.indexOf(u.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,d)=>{u.id=d});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!r&&a){this.selectDefaultTrack=!1;const u=os(a,o);if(u>-1)r=o[u];else{const d=os(a,this.tracks);r=this.tracks[d]}}let l=this.findTrackId(r);l===-1&&r&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${s==null?void 0:s.join(",")}" group-id`),this.hls.trigger(y.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const r=t[n];if(!(s&&!r.default||!s&&!e)&&(!e||ai(r,e)))return n}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(An(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(An(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(ka(n,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ce.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&ai(e,s))return s;const n=os(e,this.tracksInGroup);if(n>-1){const r=this.tracksInGroup[n];return this.setSubtitleTrack(n),r}else{if(s)return null;{const r=os(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(y.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=hr(e.textTracks),s=this.currentTrack;let n;if(s&&(n=t.filter(r=>ka(s,r))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==n&&(r.mode="disabled")}),n){const r=this.subtitleDisplay?"showing":"hidden";n.mode!==r&&(n.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!le(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!n.details&&!n.details.live;if(e===this.trackId&&n===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:u}=n;this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const d=this.switchParams(n.url,s==null?void 0:s.details,n.details);this.loadPlaylist(d)}}function XS(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?r:r&3|8).toString(16)})}}}function rn(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const ki=.025;let Mr=function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i}({});function QS(i,e,t){return`${i.identifier}-${t+1}-${rn(e)}`}class JS{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Go(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=Go(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=le(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Go(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ki))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Mr.Range:Mr.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return ZS(this)}}function Go(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<ki)?e.start:e.start+e.duration}function Rg(i,e,t){const s=new self.URL(i,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Vo(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function ZS(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function bi(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class eA{constructor(e,t,s,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger(y.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=n;let o=n.uri;try{o=Rg(o,t.primarySessionId).href}catch{}r.loadSource(o);const a=()=>{this.hasDetails=!0};r.once(y.LEVEL_LOADED,a),r.once(y.AUDIO_TRACK_LOADED,a),r.once(y.SUBTITLE_TRACK_LOADED,a),r.on(y.MEDIA_ATTACHING,(l,{media:c})=>{this.removeMediaListeners(),this.mediaAttached=c,this.interstitial.playoutLimit&&(c.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(y.BUFFER_APPENDED,()=>{const d=this.bufferedEnd;this.reachedPlayout(d)&&(this._bufferedEosTime=d,r.trigger(y.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var e;return((e=this.interstitial)==null?void 0:e.appendInPlace)||!1}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const s=this.timelineOffset,n=Ae.bufferInfo(e,s,0);return this.getAssetTime(n.end)>=this._bufferedEosTime-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ae.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){const e=this.hls;if(this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){this.hls.on(e,t)}once(e,t,s){this.hls.once(e,t)}off(e,t,s){this.hls.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${bi(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Zu=.033;class tA extends Xt{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(r=n[s])!=null&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let n=0;n<s.length;n++){let r=s[n];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return n}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let n=e;n<=t&&s[n];n++){const r=s[n].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var s;if(((s=t[n].event)==null?void 0:s.identifier)===e)return n}return-1}findAssetIndex(e,t){const s=e.assetList,n=s.length;if(n>1)for(let r=0;r<n;r++){const o=s[r];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&t<a+(o.duration||0))return r}}return 0}get assetIdAtEnd(){var e,t;const s=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(s){const n=s.assetList,r=n[n.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:n}=s,r=this.events,o=this.parseDateRanges(n,{url:s.url},t),a=Object.keys(n),l=r?r.filter(c=>!a.includes(c.identifier)):[];o.length&&o.sort((c,u)=>{const d=c.cue.pre,f=c.cue.post,h=u.cue.pre,g=u.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!g)return 1;if(g&&!f)return-1;if(!d&&!h&&!f&&!g){const p=c.startTime,m=u.startTime;if(p!==m)return p-m}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=o,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[]){const s=this.events||[];if(s.length||t.length||this.length<2){const n=this.items,r=this.parseSchedule(s,e);(t.length||(n==null?void 0:n.length)!==r.length||r.some((a,l)=>Math.abs(a.playout.start-n[l].playout.start)>.005||Math.abs(a.playout.end-n[l].playout.end)>.005))&&(this.items=r,this.onScheduleUpdate(t,n))}}parseDateRanges(e,t,s){const n=[],r=Object.keys(e);for(let o=0;o<r.length;o++){const a=r[o],l=e[a];if(l.isInterstitial){let c=this.eventMap[a];c?c.setDateRange(l):(c=new JS(l,t),this.eventMap[a]=c,s===!1&&(c.appendInPlace=s)),n.push(c)}}return n}parseSchedule(e,t){const s=[],n=t.main.details,r=n.live?1/0:n.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,d)=>{const f=u.cue.pre,h=u.cue.post,g=e[d-1]||null,p=u.appendInPlace,m=h?r:u.startOffset,x=u.duration,E=u.timelineOccupancy===Mr.Range?x:0,v=u.resumptionOffset,b=(g==null?void 0:g.startTime)===m,S=m+u.cumulativeDuration;let w=p?S+x:m+v;if(f||!h&&m<=0){const k=c;c+=E,u.timelineStart=S;const R=o;o+=x,s.push({event:u,start:S,end:w,playout:{start:R,end:o},integrated:{start:k,end:c}})}else if(m<=r){if(!b){const _=m-l;if(_>Zu){const N=l,O=c;c+=_;const X=o;o+=_;const te={previousEvent:e[d-1]||null,nextEvent:u,start:N,end:N+_,playout:{start:X,end:o},integrated:{start:O,end:c}};s.push(te)}else _>0&&g&&(g.cumulativeDuration+=_,s[s.length-1].end=m)}h&&(w=S),u.timelineStart=S;const k=c;c+=E;const R=o;o+=x,s.push({event:u,start:S,end:w,playout:{start:R,end:o},integrated:{start:k,end:c}})}else return;const L=u.resumeTime;h||L>r?l=r:l=L}),l<r){var a;const u=l,d=c,f=r-l;c+=f;const h=o;o+=f,s.push({previousEvent:((a=s[s.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:u+f,playout:{start:h,end:o},integrated:{start:d,end:c}})}this.setDurations(r,o,c)}else s.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,n=s.live?1/0:s.edge;let r=0,o=-1;e.forEach((a,l)=>{const c=a.cue.pre,u=a.cue.post,d=c?0:u?n:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=r:(r=0,o=d),!u&&a.snapOptions.in&&(a.resumeAnchor=ui(null,s.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Zu&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const h=le(a.resumeOffset)?a.resumeOffset:a.duration;r+=h})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(s-n)>ki?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${n}`),!1):t?!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(s>=l)return this.log(`"${e.identifier}" resumption ${s} past ${o} playlist end ${l}`),!1;const c=ui(null,a.fragments,s);if(!c)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const u=o==="audio"?.175:0;return Math.abs(c.start-s)<ki+u||Math.abs(c.end-s)<ki+u?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${s} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,n=!1,r=!1;e.assetList.forEach((o,a)=>{const l=t+s;o.startOffset=s,o.timelineStart=l,n||(n=o.duration===null),r||(r=!!o.error);const c=o.error?0:o.duration||0;s+=c}),n&&!r?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ds(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class sA{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let n;try{n=Rg(s,this.hls.sessionId,e.baseUrl)}catch(f){const h=this.assignAssetListError(e,P.ASSET_LIST_LOAD_ERROR,f,s);this.hls.trigger(y.ERROR,h);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,o=r.loader,a=new o(r),l={responseType:"json",url:n.href},c=r.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,g,p)=>{const m=f.data,x=m==null?void 0:m.ASSETS;if(!Array.isArray(x)){const E=this.assignAssetListError(e,P.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,h,p);this.hls.trigger(y.ERROR,E);return}e.assetListResponse=m,this.hls.trigger(y.ASSET_LIST_LOADED,{event:e,assetListResponse:m,networkDetails:p})},onError:(f,h,g,p)=>{const m=this.assignAssetListError(e,P.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,p,g);this.hls.trigger(y.ERROR,m)},onTimeout:(f,h,g)=>{const p=this.assignAssetListError(e,P.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,g);this.hls.trigger(y.ERROR,p)}};return a.load(l,u,d),this.hls.trigger(y.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,s,n,r,o){return e.error=s,{type:me.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:s,networkDetails:o,stats:r}}}function ed(i){i==null||i.play().catch(()=>{})}class iA extends Xt{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;const n=s-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const o=n<=-.01;this.timelinePos=s,this.bufferedPos=s;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(s,s-n)&&this.updateSchedule(),this.checkBuffer(),o&&s<a.start||s>=a.end){var l;const f=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o){const h=this.findItemIndex(a);if(f>h){const g=this.schedule.findJumpRestrictedIndex(h+1,f);if(g>h){this.setSchedulePosition(g);return}}}this.setSchedulePosition(f);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(a)){const f=a.event.assetList[0];f&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,f))}return}const u=c.timelineStart,d=c.duration||0;(o&&s<u||s>=u+d)&&this.setScheduleToAssetAtTime(s,c)},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(s>=n.end){this.timelinePos=n.end;const a=this.findItemIndex(n);this.setSchedulePosition(a+1)}const r=this.playingAsset;if(!r)return;const o=r.timelineStart+(r.duration||0);s>=o&&this.setScheduleToAssetAtTime(s,r)},this.onScheduleUpdate=(s,n)=>{const r=this.schedule,o=this.playingItem,a=r.events||[],l=r.items||[],c=r.durations,u=s.map(g=>g.identifier),d=!!(a.length||u.length);(d||n)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(g=>Ds(g))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`),this.playerQueue.forEach(g=>{if(g.interstitial.appendInPlace){const p=g.assetItem.timelineStart,m=g.timelineOffset-p;if(m)try{g.timelineOffset=p}catch(x){Math.abs(m)>ki&&this.warn(`${x} ("${g.assetId}" ${g.timelineOffset}->${p})`)}}});let f=null;if(o){const g=this.updateItem(o,this.timelinePos);this.itemsMatch(o,g)&&(this.playingItem=g,this.waitingItem=this.endedItem=null,f=()=>this.trimInPlace(g,o))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const h=this.bufferingItem;if(h){const g=this.updateItem(h,this.bufferedPos);this.itemsMatch(h,g)?(this.bufferingItem=g,f||(f=()=>this.trimInPlace(g,h))):h.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(h.event,null))}if(s.forEach(g=>{g.assetList.forEach(p=>{this.clearAssetPlayer(p.identifier,null)})}),d||n){if(this.hls.trigger(y.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(o)&&u.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}f&&f(),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new sA(e),this.schedule=new tA(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(y.MEDIA_ENDED,this.onMediaEnded,this),e.on(y.ERROR,this.onError,this),e.on(y.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(y.MEDIA_ENDED,this.onMediaEnded,this),e.off(y.ERROR,this.onError,this),e.off(y.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Ht(e,"play",this.onPlay),Ht(e,"pause",this.onPause),Ht(e,"seeking",this.onSeeking),Ht(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Ft(s,"seeking",this.onSeeking),Ft(s,"timeupdate",this.onTimeupdate),Ft(s,"play",this.onPlay),Ft(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!n){this.clearScheduleState();const r=this.findItemIndex(s);this.setSchedulePosition(r)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(this.media=null,!s&&(n&&this.removeMediaListeners(n),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=d=>d&&e.getAssetPlayer(d.identifier),n=(d,f,h,g,p)=>{if(d){let m=d[f].start;const x=d.event;if(x){if(f==="playout"||x.timelineOccupancy!==Mr.Point){const E=s(h);(E==null?void 0:E.interstitial)===x&&(m+=E.assetItem.startOffset+E[p])}}else{const E=g==="bufferedPos"?o():e[g];m+=E-d.start}return m}return 0},r=(d,f)=>{if(d!==0&&f!=="primary"&&e.schedule.length){var h;const g=e.schedule.findItemIndexAtTime(d),p=(h=e.schedule.items)==null?void 0:h[g];if(p){const m=p[f].start-p.start;return d+m}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var f;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:e.schedule.durations[d]},l=(d,f)=>{var h,g;const p=e.effectivePlayingItem;if(p!=null&&(h=p.event)!=null&&h.restrictions.skip)return;e.log(`seek to ${d} "${f}"`);const m=e.effectivePlayingItem,x=e.schedule.findItemIndexAtTime(d,f),E=(g=e.schedule.items)==null?void 0:g[x],v=e.getBufferingPlayer(),b=v==null?void 0:v.interstitial,S=b==null?void 0:b.appendInPlace,w=m&&e.itemsMatch(m,E);if(m&&(S||w)){const k=s(e.playingAsset),R=(k==null?void 0:k.media)||e.primaryMedia;if(R){const _=f==="primary"?R.currentTime:n(m,f,e.playingAsset,"timelinePos","currentTime"),N=d-_,O=(S?_:R.currentTime)+N;if(O>=0&&(!k||S||O<=k.duration)){R.currentTime=O;return}}}if(E){let k=d;if(f!=="primary"){const _=E[f].start,N=d-_;k=E.start+N}const R=!e.isInterstitial(E);if((!e.isInterstitial(m)||m.event.appendInPlace)&&(R||E.event.appendInPlace)){const _=e.media||(S?v==null?void 0:v.media:null);_&&(_.currentTime=k)}else if(m){const _=e.findItemIndex(m);if(x>_){const O=e.schedule.findJumpRestrictedIndex(_+1,x);if(O>_){e.setSchedulePosition(O);return}}let N=0;if(R)e.timelinePos=k,e.checkBuffer();else{var L;const O=E==null||(L=E.event)==null?void 0:L.assetList;if(O){const X=d-(E[f]||E).start;for(let te=O.length;te--;){const re=O[te];if(re.duration&&X>=re.startOffset&&X<re.startOffset+re.duration){N=te;break}}}}e.setSchedulePosition(x,N)}}},c=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},u={get currentTime(){const d=c(),f=e.effectivePlayingItem;return f&&f===d?n(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=c(),h=e.effectivePlayingItem;h&&h===f&&l(d+h.playout.start,"playout")},get duration(){const d=c();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=c())==null?void 0:d.event.assetList;return f?f.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=(d=c())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};this.manager={get events(){var d,f;return((d=e.schedule)==null||(f=d.events)==null?void 0:f.slice(0))||[]},get schedule(){var d,f;return((d=e.schedule)==null||(f=d.items)==null?void 0:f.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return r(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const h=e.findItemIndex(d);if(f.appendInPlace){const g=d.playout.start+d.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(f,h,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,s;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(r=this.primaryMedia);const o=(s=r)==null?void 0:s.currentTime;if(!(o===void 0||!le(o)))return o}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,n=e.media;if(s&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${qe(r)}`),this.detachedData=r}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var s,n;if(e.media===t)return;let r=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,c=(s=this.detachedData)==null?void 0:s.mediaSource;let u;if(o.media)l&&(r=o.transferMedia(),this.detachedData=r),u="Primary";else if(c){const h=this.getBufferingPlayer();h?(r=h.transferMedia(),u=`${h}`):u="detached MediaSource"}else u="detached media";if(!r){if(c)r=this.detachedData,this.log(`using detachedData: MediaSource ${qe(r)}`);else if(!this.detachedData||o.media===t){const h=this.playerQueue;h.length>1&&h.forEach(g=>{if(a&&g.interstitial.appendInPlace!==l){const p=g.interstitial;this.clearInterstitial(g.interstitial,null),p.appendInPlace=!1,p.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${p}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=r&&"mediaSource"in r&&((n=r.mediaSource)==null?void 0:n.readyState)!=="closed",f=d&&r?r:t;if(this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${u}`),f===r){const h=a&&e.assetId===this.schedule.assetIdAtEnd;f.overrides={duration:this.schedule.duration,endOfStream:!a||h,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,n=this.effectivePlayingItem;if(s===-1){const r=this.hls.startPosition;if(this.timelinePos=r,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(r>=0||!this.primaryLive){const o=this.timelinePos=r>0?r:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(n&&!this.playingItem){const r=e.findItemIndex(n);this.setSchedulePosition(r)}}advanceAfterAssetEnded(e,t,s){const n=Vo(e,s);if(!e.isAssetPastPlayoutLimit(n))this.setSchedulePosition(t,n);else{const r=this.schedule.items;if(r){const o=t+1,a=r.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.timelinePos=l,this.checkBuffer()),this.setSchedulePosition(o)}}}setScheduleToAssetAtTime(e,t){const s=this.schedule,n=t.parentIdentifier,r=s.getEvent(n);if(r){const o=s.findEventIndex(n),a=s.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,o,a-1)}}setSchedulePosition(e,t){const s=this.schedule.items;if(!s||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const n=e>=0?s[e]:null,r=this.playingItem,o=this.playingLastItem;if(this.isInterstitial(r)){var a;const c=r.event,u=this.playingAsset,d=u==null?void 0:u.identifier,f=d?this.getAssetPlayer(d):null;if(f&&d&&(!this.eventItemsMatch(r,n)||t!==void 0&&d!==((a=c.assetList)==null?void 0:a[t].identifier))){var l;const h=c.findAssetIndex(u);if(this.log(`INTERSTITIAL_ASSET_ENDED ${h+1}/${c.assetList.length} ${bi(u)}`),this.endedAsset=u,this.playingAsset=null,this.hls.trigger(y.INTERSTITIAL_ASSET_ENDED,{asset:u,assetListIndex:h,event:c,schedule:s.slice(0),scheduleIndex:e,player:f}),r!==this.playingItem){this.itemsMatch(r,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),h);return}this.retreiveMediaSource(d,n),f.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&f.detachMedia()}if(!this.eventItemsMatch(r,n)&&(this.endedItem=r,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${Ds(r)}`),c.hasPlayed=!0,this.hls.trigger(y.INTERSTITIAL_ENDED,{event:c,schedule:s.slice(0),scheduleIndex:e}),c.cue.once)){this.updateSchedule();const h=this.schedule.items;if(n&&h){const g=this.findItemIndex(n);this.advanceSchedule(g,h,t,r,o)}return}}this.advanceSchedule(e,s,t,r,o)}advanceSchedule(e,t,s,n,r){const o=e>=0?t[e]:null,a=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(c=>{const u=c.interstitial,d=this.schedule.findEventIndex(u.identifier);(d<e||d>e+1)&&this.clearInterstitial(u,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const c=o.event;if(s===void 0){s=this.schedule.findAssetIndex(c,this.timelinePos);const h=Vo(c,s-1);if(c.isAssetPastPlayoutLimit(h)){this.advanceAfterAssetEnded(c,e,s);return}s=h}const u=this.waitingItem;this.assetsBuffered(o,a)||this.setBufferingItem(o);let d=this.preloadAssets(c,s);if(this.eventItemsMatch(o,u||n)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${Ds(o)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(y.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!a){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const f=c.assetList[s];if(!f){const h=t[e+1],g=this.media;h&&g&&!this.isInterstitial(h)&&g.currentTime<h.start&&(g.currentTime=this.timelinePos=h.start),this.advanceAfterAssetEnded(c,e,s||0);return}if(d||(d=this.getAssetPlayer(f.identifier)),d===null||d.destroyed){const h=c.assetList.length;this.warn(`asset ${s+1}/${h} player destroyed ${c}`),d=this.createAssetPlayer(c,f,s)}if(!this.eventItemsMatch(o,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(f))return;this.startAssetPlayer(d,s,t,e,a),this.shouldPlay&&ed(d.media)}else o!==null?(this.resumePrimary(o,e,n),this.shouldPlay&&ed(this.hls.media)):r&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var n;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ds(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.timelinePos=o),this.attachPrimary(o,e)}if(!s)return;const r=this.schedule.items;r&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ds(e)}`),this.hls.trigger(y.INTERSTITIALS_PRIMARY_RESUMED,{schedule:r.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(s<n.fragmentStart||s>n.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ae.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,n),s&&this.startLoadingPrimaryAt(e,s)),s||(this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((s=n.mainForwardBufferInfo)==null?void 0:s.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(y.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(y.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const s=this.hls.levels[t.level],n=Ve(Ve({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Ve(Ve({},this.altSelection),{},{audio:s});return}const r=Ve(Ve({},n),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Ve(Ve({},this.altSelection),{},{subtitles:s});return}const r=Ve(Ve({},n),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=du(t);this.playerQueue.forEach(n=>n.hls.setAudioOption(t)||n.hls.setAudioOption(s))}onSubtitleTrackSwitch(e,t){const s=du(t);this.playerQueue.forEach(n=>n.hls.setSubtitleOption(t)||t.id!==-1&&n.hls.setSubtitleOption(s))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const r=t[n];if(r.cue.post){var s;const o=this.schedule.findEventIndex(r.identifier),a=(s=this.schedule.items)==null?void 0:s[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){const s=this.schedule.items;if(e&&s){const n=this.findItemIndex(e,t);return s[n]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(r.identifier,null)});const s=e.end+.25,n=Ae.bufferInfo(this.primaryMedia,s,0);(n.end>s||(n.nextStart||0)>s)&&(this.attachPrimary(s,null),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const s=Ae.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,t,e)}updateBufferedPos(e,t,s){const n=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var c,u;const d=this.findItemIndex(r),f=Math.min(d+1,t.length-1),h=t[f];if((l===-1&&r&&e>=r.end||(c=h.event)!=null&&c.appendInPlace&&e+.01>=h.start)&&(l=f),f-a>1&&(r==null||(u=r.event)==null?void 0:u.appendInPlace)===!1)return;if(this.bufferedPos=e,l>d&&l>a)this.bufferedToItem(h);else{const g=this.primaryDetails;this.primaryLive&&g&&e>g.edge-g.targetduration&&h.start<g.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else s&&o&&!this.itemsMatch(o,r)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const r=this.getAssetPlayer(n.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:n,events:r}=s;if(!n||!r)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ds(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),this.playbackDisabled||(o?e.event.assetList.forEach(c=>{const u=this.getAssetPlayer(c.identifier);u&&u.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering()))),this.hls.trigger(y.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,n=s.assetList.length===0&&!s.assetListLoader,r=s.cue.once;if(n||!r){const o=this.preloadAssets(s,t);if(o!=null&&o.interstitial.appendInPlace){const a=s.assetList[t],l=this.primaryMedia;a&&l&&this.bufferAssetPlayer(o,l)}}}preloadAssets(e,t){const s=e.assetUrl,n=e.assetList.length,r=n===0&&!e.assetListLoader,o=e.cue.once;if(r){const l=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const f=u-l;f>0&&(c=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:n} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),s)return this.createAsset(e,0,0,l,e.duration,s);const d=this.assetListLoader.loadAssetList(e,c);d&&(e.assetListLoader=d)}else if(!o&&n){for(let l=t;l<n;l++){const c=e.assetList[l],u=this.getAssetPlayerQueueIndex(c.identifier);(u===-1||this.playerQueue[u].destroyed)&&!c.error&&this.createAssetPlayer(e,c,l)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(y.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,n,r,o){const a={parentIdentifier:e.identifier,identifier:QS(e,o,t),duration:r,startOffset:s,timelineStart:n,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,s){const n=this.hls,r=n.userConfig;let o=r.videoPreference;const a=n.loadLevelObj||n.levels[n.currentLevel];(o||a)&&(o=Ue({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=n.audioTracks[n.audioTrack],c=n.subtitleTracks[n.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const v=this.timelinePos-t.timelineStart;if(v>1){const b=t.duration;b&&v<b&&(u=v)}}const d=t.identifier,f=Ve(Ve({},r),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||r.audioPreference,subtitlePreference:c||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const h=f.cmcd;h!=null&&h.sessionId&&h.contentId&&(f.cmcd=Ue({},h,{contentId:rn(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const g=new eA(this.HlsPlayerClass,f,e,t);this.playerQueue.push(g),e.assetList[s]=t;const p=v=>{if(v.live){const w=new Error(`Interstitials MUST be VOD assets ${e}`),L={fatal:!0,type:me.OTHER_ERROR,details:P.INTERSTITIAL_ASSET_ITEM_ERROR,error:w};this.handleAssetItemError(L,e,this.schedule.findEventIndex(e.identifier),s,w.message);return}const b=v.edge-v.fragmentStart,S=t.duration;(S===null||b>S)&&(this.log(`Interstitial asset "${d}" duration change ${S} > ${b}`),t.duration=b,this.updateSchedule())};g.on(y.LEVEL_UPDATED,(v,{details:b})=>p(b)),g.on(y.LEVEL_PTS_UPDATED,(v,{details:b})=>p(b));const m=(v,b)=>{const S=this.getAssetPlayer(d);if(S&&b.tracks){S.off(y.BUFFER_CODECS,m),S.tracks=b.tracks;const w=this.primaryMedia;this.bufferingAsset===S.assetItem&&w&&!S.media&&this.bufferAssetPlayer(S,w)}};g.on(y.BUFFER_CODECS,m);const x=()=>{var v;const b=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${b}`),!b)return;const S=this.schedule.findEventIndex(e.identifier),w=(v=this.schedule.items)==null?void 0:v[S];if(this.isInterstitial(w)){const k=e.findAssetIndex(t),R=Vo(e,k);if(!e.isAssetPastPlayoutLimit(R))this.bufferedToItem(w,R);else{var L;const _=(L=this.schedule.items)==null?void 0:L[S+1];_&&this.bufferedToItem(_)}}};g.on(y.BUFFERED_TO_END,x);const E=v=>()=>{if(!this.getAssetPlayer(d))return;this.shouldPlay=!0;const S=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,S,v)};return g.once(y.MEDIA_ENDED,E(s)),g.once(y.PLAYOUT_LIMIT_REACHED,E(1/0)),g.on(y.ERROR,(v,b)=>{const S=this.getAssetPlayer(d);if(b.details===P.BUFFER_STALLED_ERROR){if(S!=null&&S.media){const w=S.currentTime,L=S.duration-w;w&&e.appendInPlace&&L/S.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${d} ${e} at ${S.media.currentTime}`),x()):(this.warn(`Stalled at ${w} of ${w+L} in asset ${d} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(b,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${b.error} ${e}`)}),g.on(y.DESTROYING,()=>{if(!this.getAssetPlayer(d))return;const b=new Error(`Asset player destroyed unexpectedly ${d}`),S={fatal:!0,type:me.OTHER_ERROR,details:P.INTERSTITIAL_ASSET_ITEM_ERROR,error:b};this.handleAssetItemError(S,e,this.schedule.findEventIndex(e.identifier),s,b.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${bi(t)}`),this.hls.trigger(y.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:g}),g}clearInterstitial(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&Ds(t)}`);const n=this.playerQueue[s];this.transferMediaFromPlayer(n,t),this.playerQueue.splice(s,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,n,r){const{interstitial:o,assetItem:a,assetId:l}=e,c=o.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,s[n]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${bi(a)}`),this.hls.trigger(y.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:s.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,n;const{interstitial:r,assetItem:o}=e,a=this.schedule.findEventIndex(r.identifier),l=(s=this.schedule.items)==null?void 0:s[a];if(!l)return;this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const u=r.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const d=(c==null?void 0:c.tracks)||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(u&&o!==this.playingAsset){if(!e.tracks)return;if(d&&!Eh(d,e.tracks)){const f=new Error(`Asset ${bi(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),h={fatal:!0,type:me.OTHER_ERROR,details:P.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},g=r.findAssetIndex(o);this.handleAssetItemError(h,r,a,g,f.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,s,n,r){if(e.details===P.BUFFER_STALLED_ERROR)return;const o=t.assetList[n];this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&bi(o)} ${e.error}`);const a=o==null?void 0:o.identifier,l=this.getAssetPlayerQueueIndex(a),c=this.playerQueue[l]||null,u=this.schedule.items,d=Ue({},e,{fatal:!1,errorAction:En(!0),asset:o,assetListIndex:n,event:t,schedule:u,scheduleIndex:s,player:c});if(this.hls.trigger(y.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,h=new Error(r);if(o&&(this.clearAssetPlayer(a,null),o.error=h),!t.assetList.some(g=>!g.error))t.error=h;else{for(let g=n;g<t.assetList.length;g++)this.resetAssetPlayer(t.assetList[g].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):f&&f.identifier===a&&this.advanceAfterAssetEnded(t,s,n)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(this.updateSchedule(),s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${s?Ds(s):"<none>"} error: ${e.error}`);let n=this.timelinePos;n===-1&&(n=this.hls.startPosition);const r=this.updateItem(s,n);this.itemsMatch(s,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));const o=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(e,t){var s;const n=t.event,r=n.identifier,o=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(r))return;const a=n.timelineStart,l=n.duration;let c=0;o.forEach((g,p)=>{const m=parseFloat(g.DURATION);this.createAsset(n,p,c,a+c,m,g.URI),c+=m}),n.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${l}) ${n}`);const u=this.waitingItem,d=(u==null?void 0:u.event.identifier)===r;this.updateSchedule();const f=(s=this.bufferingItem)==null?void 0:s.event;if(d){var h;const g=this.schedule.findEventIndex(r),p=(h=this.schedule.items)==null?void 0:h[g];if(p){if(!this.playingItem&&this.timelinePos>p.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==g){n.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${n}`),this.primaryFallback(n);return}this.setBufferingItem(p)}this.setSchedulePosition(g)}else if((f==null?void 0:f.identifier)===r&&f.appendInPlace){const g=n.assetList[0],p=this.getAssetPlayer(g.identifier),m=this.primaryMedia;g&&p&&m&&this.bufferAssetPlayer(p,m)}}onError(e,t){switch(t.details){case P.ASSET_LIST_PARSING_ERROR:case P.ASSET_LIST_LOAD_ERROR:case P.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&this.primaryFallback(s);break}case P.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const td=500;class nA extends yl{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",de.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=K.IDLE,this.setInterval(td),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:n}=t;if(this.fragContextChanged(s)||(et(s)&&(this.fragPrevious=s),this.state=K.IDLE),!n)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let o;const a=s.start;for(let c=0;c<r.length;c++)if(a>=r[c].start&&a<=r[c].end){o=r[c];break}const l=s.start+s.duration;o?o.end=l:(o={start:a,end:l},r.push(o)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:n}=t;if(s===0&&n!==Number.POSITIVE_INFINITY){const r=n-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=r){o.shift();continue}else if(o[a].start<r)o[a].start=r;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(s,r,de.SUBTITLE)}}onError(e,t){const s=t.frag;(s==null?void 0:s.type)===de.SUBTITLE&&(t.details===P.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==K.STOPPED&&(this.state=K.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&yg(this.levels,t)){this.levels=t.map(s=>new xn(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const n=new xn(s);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,de.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==K.STOPPED&&this.setInterval(td)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:n,levels:r}=this,{details:o,id:a}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=r[a];if(a>=r.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(s=l.details)!=null&&s.live){if(o.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(Or(o,d),c=o.fragmentStart):f&&(c=f.start,La(o,c));else{var u;c=this.alignPlaylists(o,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&f&&(c=f.start,La(o,c))}d&&!this.startFragRequested&&this.setStartPosition(d,c)}l.details=o,this.levelLastLoaded=l,a===n&&(this.hls.trigger(y.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===K.IDLE&&(ui(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,n=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&n!=null&&n.key&&n.iv&&Ri(n.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(s),n.key.buffer,n.iv.buffer,pl(n.method)).catch(a=>{throw r.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();r.trigger(y.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=K.IDLE})}}doTick(){if(!this.media){this.state=K.IDLE;return}if(this.state===K.IDLE){const{currentTrackId:e,levels:t}=this,s=t==null?void 0:t[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:n}=this,r=this.getLoadPosition(),o=Ae.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,n.maxBufferHole),{end:a,len:l}=o,c=s.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const d=c.fragments,f=d.length,h=c.edge;let g=null;const p=this.fragPrevious;if(a<h){const E=n.maxFragLookUpTolerance,v=a>h-E?0:E;g=ui(p,d,Math.max(d[0].start,a),v),!g&&p&&p.start<d[0].start&&(g=d[0])}else g=d[f-1];if(g=this.filterReplacedPrimary(g,s.details),!g)return;const m=g.sn-c.startSN,x=d[m-1];if(x&&x.cc===g.cc&&this.fragmentTracker.getState(x)===st.NOT_LOADED&&(g=x),this.fragmentTracker.getState(g)===st.NOT_LOADED){const E=this.mapToInitFragWhenRequired(g);E&&this.loadFragment(E,s,a)}}}loadFragment(e,t,s){et(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new rA(this.tracksBuffered[this.currentTrackId]||[])}}class rA{constructor(e){this.buffered=void 0;const t=(s,n,r)=>{if(n=n>>>0,n>r-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${r})`);return e[n][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const oA={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ig=i=>String.fromCharCode(oA[i]||i),Ut=15,ps=100,aA={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},lA={17:2,18:4,21:6,22:8,23:10,19:13,20:15},cA={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},uA={25:2,26:4,29:6,30:8,31:10,27:13,28:15},dA=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class fA{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;Oe.log(`${this.time} [${e}] ${s}`)}}}const Qs=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class kg{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const n=t[s];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class hA{constructor(){this.uchar=" ",this.penState=new kg}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class gA{constructor(e){this.chars=[],this.pos=0,this.currPenState=new kg,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ps;t++)this.chars.push(new hA);this.logger=e}equals(e){for(let t=0;t<ps;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ps;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ps;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ps&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ps)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Ig(e);if(this.pos>=ps){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ps;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<ps;s++){const n=this.chars[s].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ho{constructor(e){this.rows=[],this.currRow=Ut-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Ut;t++)this.rows.push(new gA(e));this.logger=e}reset(){for(let e=0;e<Ut;e++)this.rows[e].clear();this.currRow=Ut-1}equals(e){let t=!0;for(let s=0;s<Ut;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Ut;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ut;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+qe(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Ut;a++)this.rows[a].clear();const r=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[r].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[r+c])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,o=Math.max(r-1,0);s.setCursor(e.indent),e.color=s.chars[o].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+qe(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",n=-1;for(let r=0;r<Ut;r++){const o=this.rows[r].getTextString();o&&(n=r+1,e?t.push("Row "+n+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class sd{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ho(s),this.nonDisplayedMemory=new Ho(s),this.lastOutputScreen=new Ho(s),this.currRollUpRow=this.displayedMemory.rows[Ut-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Ut-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[s]}this.logger.log(2,"MIDROW: "+qe(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class id{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=pA(),this.logger=void 0;const n=this.logger=new fA;this.channels=[null,new sd(e,t,n),new sd(e+1,s,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const n=t[s]&127,r=t[s+1]&127;let o=!1,a=null;if(n===0&&r===0)continue;this.logger.log(3,()=>"["+Qs([t[s],t[s+1]])+"] -> ("+Qs([n,r])+")");const l=this.cmdHistory;if(n>=16&&n<=31){if(mA(n,r,l)){Wn(null,null,l),this.logger.log(3,()=>"Repeated command ("+Qs([n,r])+") is dropped");continue}Wn(n,r,this.cmdHistory),o=this.parseCmd(n,r),o||(o=this.parseMidrow(n,r)),o||(o=this.parsePAC(n,r)),o||(o=this.parseBackgroundAttributes(n,r))}else Wn(null,null,l);if(!o&&(a=this.parseChars(n,r),a)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Qs([n,r])+" orig: "+Qs([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(s||n))return!1;const r=e===20||e===21||e===23?1:2,o=this.channels[r];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[s];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Qs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(n||r))return!1;const o=e<=23?1:2;t>=64&&t<=95?s=o===1?aA[e]:cA[e]:s=o===1?lA[e]:uA[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(s,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let s;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,n.underline=(s&1)===1,s<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((s-16)/2)*4,n}parseChars(e,t){let s,n=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let o;r===17?o=t+80:r===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+Ig(o)+"' in channel "+s),n=[o]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+Qs(n).join(",")),n}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(s||n))return!1;let r;const o={};e===16||e===24?(r=Math.floor((t-32)/2),o.background=dA[r],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Wn(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Wn(i,e,t){t.a=i,t.b=e}function mA(i,e,t){return t.a===i&&t.b===e}function pA(){return{a:null,b:null}}var Il=function(){if(Pr!=null&&Pr.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const c=l.toLowerCase();return~a.indexOf(c)?c:!1}function s(a){return t(i,a)}function n(a){return t(e,a)}function r(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)a[d]=u[d]}return a}function o(a,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let f="",h=!1,g=a,p=l,m=c,x=null,E="",v=!0,b="auto",S="start",w=50,L="middle",k=50,R="middle";Object.defineProperty(u,"id",r({},d,{get:function(){return f},set:function(_){f=""+_}})),Object.defineProperty(u,"pauseOnExit",r({},d,{get:function(){return h},set:function(_){h=!!_}})),Object.defineProperty(u,"startTime",r({},d,{get:function(){return g},set:function(_){if(typeof _!="number")throw new TypeError("Start time must be set to a number.");g=_,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",r({},d,{get:function(){return p},set:function(_){if(typeof _!="number")throw new TypeError("End time must be set to a number.");p=_,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",r({},d,{get:function(){return m},set:function(_){m=""+_,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",r({},d,{get:function(){return x},set:function(_){x=_,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",r({},d,{get:function(){return E},set:function(_){const N=s(_);if(N===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",r({},d,{get:function(){return v},set:function(_){v=!!_,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",r({},d,{get:function(){return b},set:function(_){if(typeof _!="number"&&_!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");b=_,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",r({},d,{get:function(){return S},set:function(_){const N=n(_);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");S=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",r({},d,{get:function(){return w},set:function(_){if(_<0||_>100)throw new Error("Position must be between 0 and 100.");w=_,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",r({},d,{get:function(){return L},set:function(_){const N=n(_);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");L=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",r({},d,{get:function(){return k},set:function(_){if(_<0||_>100)throw new Error("Size must be between 0 and 100.");k=_,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",r({},d,{get:function(){return R},set:function(_){const N=n(_);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");R=N,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class yA{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function wg(i){function e(s,n,r,o){return(s|0)*3600+(n|0)*60+(r|0)+parseFloat(o||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class vA{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let n=0;n<s.length;++n)if(t===s[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function Cg(i,e,t,s){const n=s?i.split(s):[i];for(const r in n){if(typeof n[r]!="string")continue;const o=n[r].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const Pa=new Il(0,0,""),qn=Pa.align==="middle"?"middle":"center";function xA(i,e,t){const s=i;function n(){const a=wg(i);if(a===null)throw new Error("Malformed timestamp: "+s);return i=i.replace(/^[^\sa-zA-Z-]+/,""),a}function r(a,l){const c=new vA;Cg(a,function(f,h){let g;switch(f){case"region":for(let p=t.length-1;p>=0;p--)if(t[p].id===h){c.set(f,t[p].region);break}break;case"vertical":c.alt(f,h,["rl","lr"]);break;case"line":g=h.split(","),c.integer(f,g[0]),c.percent(f,g[0])&&c.set("snapToLines",!1),c.alt(f,g[0],["auto"]),g.length===2&&c.alt("lineAlign",g[1],["start",qn,"end"]);break;case"position":g=h.split(","),c.percent(f,g[0]),g.length===2&&c.alt("positionAlign",g[1],["start",qn,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,h);break;case"align":c.alt(f,h,["start",qn,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&Pa.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",qn);let d=c.get("position","auto");d==="auto"&&Pa.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){i=i.replace(/^\s+/,"")}if(o(),e.startTime=n(),o(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);i=i.slice(3),o(),e.endTime=n(),o(),r(i,e)}function Dg(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class EA{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new yA,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let r=t.buffer,o=0;for(r=Dg(r);o<r.length&&r[o]!=="\r"&&r[o]!==`
`;)++o;const a=r.slice(0,o);return r[o]==="\r"&&++o,r[o]===`
`&&++o,t.buffer=r.slice(o),a}function n(r){Cg(r,function(o,a){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=s();const a=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:r=s(),t.state){case"HEADER":/:/.test(r)?n(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new Il(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{xA(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=r.indexOf("-->")!==-1;if(!r||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const bA=/\r\n|\n\r|\n|\r/g,Ko=function(e,t,s=0){return e.slice(s,s+t.length)===t},TA=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!le(t)||!le(s)||!le(n)||!le(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*n,t+=60*60*1e3*r,t};function kl(i,e,t){return rn(i.toString())+rn(e.toString())+rn(t)}const SA=function(e,t,s){let n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(o=r)!=null&&o.new;){var o;e.ccOffset+=n.start-r.start,n.new=!1,n=r,r=e[n.prevCC]}e.presentationOffset=s};function AA(i,e,t,s,n,r,o){const a=new EA,l=Ct(new Uint8Array(i)).trim().replace(bA,`
`).split(`
`),c=[],u=e?$T(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,g,p=!0;a.oncue=function(m){const x=t[s];let E=t.ccOffset;const v=(f-u)/9e4;if(x!=null&&x.new&&(h!==void 0?E=t.ccOffset=x.start:SA(t,s,v)),v){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}E=v-t.presentationOffset}const b=m.endTime-m.startTime,S=Ot((m.startTime+E-h)*9e4,n*9e4)/9e4;m.startTime=Math.max(S,0),m.endTime=Math.max(S+b,0);const w=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(w)),m.id||(m.id=kl(m.startTime,m.endTime,w)),m.endTime>0&&c.push(m)},a.onparsingerror=function(m){g=m},a.onflush=function(){if(g){o(g);return}r(c)},l.forEach(m=>{if(p)if(Ko(m,"X-TIMESTAMP-MAP=")){p=!1,m.slice(16).split(",").forEach(x=>{Ko(x,"LOCAL:")?d=x.slice(6):Ko(x,"MPEGTS:")&&(f=parseInt(x.slice(7)))});try{h=TA(d)/1e3}catch(x){g=x}return}else m===""&&(p=!1);a.parse(m+`
`)}),a.flush()}const jo="stpp.ttml.im1t",Pg=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Og=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,_A={left:"start",center:"center",right:"end",start:"start",end:"end"};function nd(i,e,t,s){const n=we(new Uint8Array(i),["mdat"]);if(n.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const r=n.map(a=>Ct(a)),o=BT(e.baseTime,1,e.timescale);try{r.forEach(a=>t(LA(a,o)))}catch(a){s(a)}}function LA(i,e){const n=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(r).reduce((d,f)=>(d[f]=n.getAttribute(`ttp:${f}`)||r[f],d),{}),a=n.getAttribute("xml:space")!=="preserve",l=rd(Wo(n,"styling","style")),c=rd(Wo(n,"layout","region")),u=Wo(n,"body","[begin]");return[].map.call(u,d=>{const f=Fg(d,a);if(!f||!d.hasAttribute("begin"))return null;const h=Yo(d.getAttribute("begin"),o),g=Yo(d.getAttribute("dur"),o);let p=Yo(d.getAttribute("end"),o);if(h===null)throw od(d);if(p===null){if(g===null)throw od(d);p=h+g}const m=new Il(h-e,p-e,f);m.id=kl(m.startTime,m.endTime,m.text);const x=c[d.getAttribute("region")],E=l[d.getAttribute("style")],v=RA(x,E,l),{textAlign:b}=v;if(b){const S=_A[b];S&&(m.lineAlign=S),m.align=b}return Ue(m,v),m}).filter(d=>d!==null)}function Wo(i,e,t){const s=i.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function rd(i){return i.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function Fg(i,e){return[].slice.call(i.childNodes).reduce((t,s,n)=>{var r;return s.nodeName==="br"&&n?t+`
`:(r=s.childNodes)!=null&&r.length?Fg(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function RA(i,e,t){const s="http://www.w3.org/ns/ttml#styling";let n=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(n=t[o]),r.reduce((a,l)=>{const c=qo(e,s,l)||qo(i,s,l)||qo(n,s,l);return c&&(a[l]=c),a},{})}function qo(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function od(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Yo(i,e){if(!i)return null;let t=wg(i);return t===null&&(Pg.test(i)?t=IA(i,e):Og.test(i)&&(t=kA(i,e))),t}function IA(i,e){const t=Pg.exec(i),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function kA(i,e){const t=Og.exec(i),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Yn{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class wA{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ld(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Yn(this,"textTrack1"),t=new Yn(this,"textTrack2"),s=new Yn(this,"textTrack3"),n=new Yn(this,"textTrack4");this.cea608Parser1=new id(1,e,t),this.cea608Parser2=new id(3,s,n)}addCues(e,t,s,n,r){let o=!1;for(let a=r.length;a--;){const l=r[a],c=CA(l[0],l[1],t,s);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],s),o=!0,c/(s-t)>.5))return}if(o||r.push([t,s]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,s,n)}else{const a=this.Cues.newCue(null,t,s,n);this.hls.trigger(y.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r}){const{unparsedVttFrags:o}=this;s===de.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:r}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.initPTS[a.frag.cc]?this.onFragLoaded(y.FRAG_LOADED,a):this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let n=0;n<s.textTracks.length;n++){const r=s.textTracks[n];if(ad(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:n}=this,{label:r,languageCode:o}=t[e],a=this.getExistingTrack(r,o);if(a)s[e]=a,Ti(s[e]),_g(s[e],n);else{const l=this.createTextTrack("captions",r,o);l&&(l[e]=!0,s[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,n={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,s){const n=this.media;if(n)return n.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:n}=this;Object.keys(n).forEach(r=>{Ti(n[r]),delete n[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ld(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)Ti(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],n=s.some(r=>r.textCodec===jo);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(yg(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const o=this.media,a=o?hr(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&ad(a[f],l)){d=a[f],a[f]=null;break}d&&(u=d)}if(u)Ti(u);else{const d=Mg(l);u=this.createTextTrack(d,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),a!=null&&a.length){const l=a.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const n=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!n)return;const r=`textTrack${n[1]}`,o=this.captionsProperties[r];o&&(o.label=s.name,s.lang&&(o.languageCode=s.lang),o.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===de.MAIN){var s,n;const{cea608Parser1:r,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=t.frag,u=(s=(n=t.part)==null?void 0:n.index)!=null?s:-1;r&&o&&(c!==a+1||c===a&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(r.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:s,payload:n}=t;if(s.type===de.SUBTITLE)if(n.byteLength){const r=s.decryptdata,o="stats"in t;if(r==null||!r.encrypted||o){const a=this.tracks[s.level],l=this.vttCCs;l[s.cc]||(l[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),a&&a.textCodec===jo?this._parseIMSC1(s,n):this._parseVTTs(t)}}else this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;nd(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),s.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{s.logger.log(`Failed to parse IMSC1: ${n}`),s.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:s,payload:n}=e,{initPTS:r,unparsedVttFrags:o}=this,a=r.length-1;if(!r[s.cc]&&a===-1){o.push(e);return}const l=this.hls,c=(t=s.initSegment)!=null&&t.data?$t(s.initSegment.data,new Uint8Array(n)).buffer:n;AA(c,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,u=>{this._appendCues(u,s.level),l.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},u=>{const d=u.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(s,n),l.logger.log(`Failed to parse VTT cue: ${u}`),!(d&&a>s.cc)&&l.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:u})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||nd(t,this.initPTS[e.cc],()=>{s.textCodec=jo,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(r=>Lg(n,r))}else{const n=this.tracks[t];if(!n)return;const r=n.default?"default":"subtitles"+t;s.trigger(y.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===de.SUBTITLE&&this.onFragLoaded(y.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:n}=t;if(!(s.type===de.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let r=0;r<n.length;r++){const o=n[r].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(n[r].pts,a[0]),this.cea608Parser2.addData(n[r].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:n,type:r}){const{media:o}=this;if(!(!o||o.currentTime<s)){if(!r||r==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>Da(a[l],t,s))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>Da(a[l],t,n))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let n=2;for(let r=0;r<s;r++){const o=e[n++],a=127&e[n++],l=127&e[n++];if(a===0&&l===0)continue;if((4&o)!==0){const u=3&o;(u===0||u===1)&&(t[u].push(a),t[u].push(l))}}return t}}function Mg(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function ad(i,e){return!!i&&i.kind===Mg(e)&&ka(e,i)}function CA(i,e,t,s){return Math.min(e,s)-Math.max(i,t)}function ld(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const DA=/\s/,PA={newCue(i,e,t,s){const n=[];let r,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<s.rows.length;f++)if(r=s.rows[f],a=!0,l=0,c="",!r.isEmpty()){var d;for(let p=0;p<r.chars.length;p++)DA.test(r.chars[p].uchar)&&a?l++:(c+=r.chars[p].uchar,a=!1);r.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const h=Dg(c.trim()),g=kl(e,t,h);i!=null&&(d=i.cues)!=null&&d.getCueById(g)||(o=new u(e,t,h),o.id=g,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),n.push(o))}return i&&n.length&&(n.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),n.forEach(f=>Lg(i,f))),n}};function OA(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const FA=/(\d+)-(\d+)\/(\d+)/;class cd{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||$A,this.controller=new self.AbortController,this.stats=new cl}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const r=MA(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=l&&le(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(Sn(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},c-(h-n.loading.start)),!d.ok){const{status:p,statusText:m}=d;throw new UA(m||"fetch, bad network response",p,d)}n.loading.first=h,n.total=BA(d.headers)||n.total;const g=(f=this.callbacks)==null?void 0:f.onProgress;return g&&le(t.highWaterMark)?this.loadProgressively(d,n,e,t.highWaterMark,g):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,h;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const p=d[a];p&&(n.loaded=n.total=p);const m={url:g.url,data:d,code:g.status},x=(f=this.callbacks)==null?void 0:f.onProgress;x&&!le(t.highWaterMark)&&x(n,e,d,g),(h=this.callbacks)==null||h.onSuccess(m,n,e,g)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const h=d&&d.code||0,g=d?d.message:null;(f=this.callbacks)==null||f.onError({code:h,text:g},e,d?d.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,n=0,r){const o=new Qh,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&r(t,s,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return t.loaded+=d,d<n||o.dataLength?(o.push(u),o.dataLength>=n&&r(t,s,o.flush().buffer,e)):r(t,s,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function MA(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ue({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function NA(i){const e=FA.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function BA(i){const e=i.get("Content-Range");if(e){const s=NA(e);if(le(s))return s}const t=i.get("Content-Length");if(t)return parseInt(t)}function $A(i,e){return new self.Request(i.url,e)}class UA extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const GA=/^age:\s*[\d.]+\s*$/im;class Ng{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new cl,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return r(s,t.url)}).catch(o=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),r(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:s.status,text:o.message},t,s,n)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:o}=s.loadPolicy;if(n)for(const a in n)e.setRequestHeader(a,n[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&le(r)?r:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const n=t.readyState,r=this.config;if(!s.aborted&&n>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const g=u??t.response;if(g!=null){var o,a;s.loading.end=Math.max(self.performance.now(),s.loading.first);const p=t.responseType==="arraybuffer"?g.byteLength:g.length;s.loaded=s.total=p,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const m=(o=this.callbacks)==null?void 0:o.onProgress;m&&m(s,e,g,t);const x={url:t.responseURL,data:g,code:c};(a=this.callbacks)==null||a.onSuccess(x,s,e,t);return}}const d=r.loadPolicy.errorRetry,f=s.retry,h={url:e.url,data:void 0,code:c};if(Dr(d,f,!1,h))this.retry(d);else{var l;Oe.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Dr(e,t,!0))this.retry(e);else{var s;Oe.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=hl(e,s.retry),s.retry++,Oe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&GA.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const VA={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},HA=Ve(Ve({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Ng,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:db,bufferController:eS,capLevelController:Ll,errorController:pb,fpsController:WS,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Gh,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:VA},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},KA()),{},{subtitleStreamController:nA,subtitleTrackController:zS,timelineController:wA,audioStreamController:XT,audioTrackController:QT,emeController:Ii,cmcdController:HS,contentSteeringController:jS,interstitialsController:iA});function KA(){return{cueHandler:PA,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function jA(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=Oa(i),n=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,c=[];r.forEach(u=>{const d=`${o}Loading${u}`,f=e[d];if(f!==void 0&&l){c.push(d);const h=s[a].default;switch(e[a]={default:h},u){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${a}": ${qe(e[a])}`)}),Ve(Ve({},s),e)}function Oa(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(Oa):Object.keys(i).reduce((e,t)=>(e[t]=Oa(i[t]),e),{}):i}function WA(i,e){const t=i.loader;t!==cd&&t!==Ng?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):OA()&&(i.loader=cd,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const gr=2,qA=.1,YA=.05,zA=100;class XA extends Nh{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(zA),this.mediaSource=t.mediaSource;const s=this.media=t.media;Ft(s,"playing",this.onMediaPlaying),Ft(s,"waiting",this.onMediaWaiting),Ft(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(Ht(s,"playing",this.onMediaPlaying),Ht(s,"waiting",this.onMediaWaiting),Ht(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,n;const r=(s=this.hls)==null?void 0:s.config;if(!r)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,c=!this.seeking&&a,u=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!1}));return}if(!Ae.getBuffered(o).length){this.nudgeRetry=0;return}const d=Ae.bufferInfo(o,e,0),f=d.nextStart||0,h=this.fragmentTracker;if(a&&h&&this.hls){const w=ud(this.hls.inFlightFragments,e),L=d.len>gr,k=!f||w||f-e>gr&&!h.getPartialFragment(e);if(L||k)return;this.moved=!1}const g=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&h){if(!(d.len>0)&&!f)return;const L=Math.max(f,d.start||0)-e,R=!!(g!=null&&g.live)?g.targetduration*2:gr,_=h.getPartialFragment(e);if(L>0&&(L<=R||_)){o.paused||this._trySkipBufferHole(_);return}}const p=r.detectStallWithCurrentTimeMs,m=self.performance.now(),x=this.waiting;let E=this.stalled;if(E===null)if(x>0&&m-x<p)E=this.stalled=x;else{this.stalled=m;return}const v=m-E;if(!a&&(v>=p||x)&&this.hls){var b;if(((b=this.mediaSource)==null?void 0:b.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const S=Ae.bufferInfo(o,e,r.maxBufferHole);this._tryFixBufferStall(S,v,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(y.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&n&&n.length>1&&e>n.end(0)){const r=Ae.bufferedInfo(Ae.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const o=Ae.timeRangesToArray(n),a=Ae.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=Ae.bufferedInfo(o,e,0).bufferedIndex,c=o[a].end,u=o[a+1].start;if((l===-1||l>a)&&u-c<1&&e-c<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;const f=this.fragmentTracker.getPartialFragment(e)||void 0,h=Ae.bufferInfo(this.media,e,0);this.hls.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,t,s){var n,r;const{fragmentTracker:o,media:a}=this,l=(n=this.hls)==null?void 0:n.config;if(!a||!o||!l)return;const c=(r=this.hls)==null?void 0:r.latestLevelDetails,u=o.getPartialFragment(s);if((u||c!=null&&c.live&&s<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,s);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-s<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,n=e.nextStart;if(s&&n){const r=s.getFragAtPos(t,de.MAIN),o=s.getFragAtPos(n,de.MAIN);if(r&&o)return o.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:n,stalled:r}=this;if(!n&&r!==null&&s&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${qe(e)})`);this.warn(o.message),t.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:n}=this,r=(t=this.hls)==null?void 0:t.config;if(!n||!s||!r)return 0;const o=n.currentTime,a=Ae.bufferInfo(n,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const u=a.len<=r.maxBufferHole,d=a.len>0&&a.len<1&&n.readyState<3,f=l-o;if(f>0&&(u||d)){if(f>r.maxBufferHole){let g=!1;if(o===0){const p=s.getAppendedFrag(0,de.MAIN);p&&l<p.end&&(g=!0)}if(!g){const p=e||s.getAppendedFrag(o,de.MAIN);if(p){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||ud(this.hls.inFlightFragments,l))return 0;let x=!1,E=p.end;for(;E<l;){const v=s.getAppendedFrag(E,de.MAIN)||s.getPartialFragment(E);if(v)E+=v.duration;else{x=!0;break}}if(x)return 0}}}const h=Math.max(l+YA,o+qA);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${h}`),this.moved=!0,n.currentTime=h,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${h}`);this.hls.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:e||void 0,buffer:a.len,bufferInfo:a})}return h}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:n}=this,r=t==null?void 0:t.config;if(!s||!r)return 0;const o=s.currentTime;if(this.nudgeRetry++,n<r.nudgeMaxRetry){const a=o+(n+1)*r.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),s.currentTime=a,t.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${r.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function ud(i,e){const t=dd(i.main);if(t&&t.start<=e)return t;const s=dd(i.audio);return s&&s.start<=e?s:null}function dd(i){if(!i)return null;switch(i.state){case K.IDLE:case K.STOPPED:case K.ENDED:case K.ERROR:return null}return i.frag}const QA=.25;function Fa(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function fd(i,e,t,s,n){let r=new i(e,t,"");try{r.value=s,n&&(r.type=n)}catch{r=new i(e,t,qe(n?Ve({type:n},s):s))}return r}const zn=(()=>{const i=Fa();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class JA{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(y.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ti(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return _g(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:s,enableID3MetadataCues:n}}}=this;if(!s&&!n)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Fa();if(o)for(let a=0;a<r.length;a++){const l=r[a].type;if(l===kt.emsg&&!s||!n)continue;const c=ng(r[a].data);if(c){const u=r[a].pts;let d=u+r[a].duration;d>zn&&(d=zn),d-u<=0&&(d=u+QA);for(let h=0;h<c.length;h++){const g=c[h];if(!rg(g)){this.updateId3CueEnds(u,l);const p=fd(o,u,d,g,l);p&&this.id3Track.addCue(p)}}}}}updateId3CueEnds(e,t){var s;const n=(s=this.id3Track)==null?void 0:s.cues;if(n)for(let r=n.length;r--;){const o=n[r];o.type===t&&o.startTime<e&&o.endTime===zn&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:n}){const{id3Track:r,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(r&&(a||l)){let c;n==="audio"?c=u=>u.type===kt.audioId3&&l:n==="video"?c=u=>u.type===kt.emsg&&a:c=u=>u.type===kt.audioId3&&l||u.type===kt.emsg&&a,Da(r,t,s,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:s}=this,{dateRanges:n}=e,r=Object.keys(n);let o=this.dateRangeCuesAppended;if(s&&t){var a;if((a=s.cues)!=null&&a.length){const u=Object.keys(o).filter(d=>!r.includes(d));for(let d=u.length;d--;){const f=u[d],h=o[f].cues;delete o[f],Object.keys(h).forEach(g=>{try{const p=h[g];p.removeEventListener("enter",this.onEventCueEnter),s.removeCue(p)}catch{}})}}else o=this.dateRangeCuesAppended={}}const l=e.fragments[e.fragments.length-1];if(r.length===0||!le(l==null?void 0:l.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const c=Fa();for(let u=0;u<r.length;u++){const d=r[u],f=n[d],h=f.startTime,g=o[d],p=(g==null?void 0:g.cues)||{};let m=(g==null?void 0:g.durationKnown)||!1,x=zn;const{duration:E,endDate:v}=f;if(v&&E!==null)x=h+E,m=!0;else if(f.endOnNext&&!m){const S=r.reduce((w,L)=>{if(L!==f.id){const k=n[L];if(k.class===f.class&&k.startDate>f.startDate&&(!w||f.startDate<w.startDate))return k}return w},null);S&&(x=S.startTime,m=!0)}const b=Object.keys(f.attr);for(let S=0;S<b.length;S++){const w=b[S];if(!kb(w))continue;const L=p[w];if(L)m&&!g.durationKnown?L.endTime=x:Math.abs(L.startTime-h)>.01&&(L.startTime=h,L.endTime=x);else if(c){let k=f.attr[w];wb(w)&&(k=bh(k));const _=fd(c,h,x,{key:w,data:k},kt.dateRange);_&&(_.id=d,this.id3Track.addCue(_),p[w]=_,this.hls.config.interstitialsController&&(w==="X-ASSET-LIST"||w==="X-ASSET-URL")&&_.addEventListener("enter",this.onEventCueEnter))}}o[d]={cues:p,dateRange:f,durationKnown:m}}}}class ZA{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:o}=this.config;if(!r||o===1||!s.live)return;const a=this.targetLatency;if(a===null)return;const l=n-a,c=Math.min(this.maxLatency,a+s.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,h)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:n}=e,{liveSyncDuration:r,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&s||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=r!==void 0?r:o*n);const u=n;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const n=s.edge,r=e-t-this.edgeStalled,o=n-s.totalduration,a=n-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(o,r),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===P.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,n;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class e_ extends _l{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,n=[],r={},o={};let a=!1,l=!1,c=!1;t.levels.forEach(u=>{const d=u.attrs;let{audioCodec:f,videoCodec:h}=u;f&&(u.audioCodec=f=Ir(f,s)||void 0),h&&(h=u.videoCodec=YE(h));const{width:g,height:p,unknownCodecs:m}=u;let x=m?m.length:0;if(m)for(let _=x;_--;){const N=m[_];this.isAudioSupported(N)?(u.audioCodec=f=f?`${f},${N}`:N,x--,Pi.audio[f.substring(0,4)]=2):this.isVideoSupported(N)&&(u.videoCodec=h=h?`${h},${N}`:N,x--,Pi.video[h.substring(0,4)]=2)}if(a||(a=!!(g&&p)),l||(l=!!h),c||(c=!!f),x||f&&!this.isAudioSupported(f)||h&&!this.isVideoSupported(h)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:E,"FRAME-RATE":v,"HDCP-LEVEL":b,"PATHWAY-ID":S,RESOLUTION:w,"VIDEO-RANGE":L}=d,R=`${`${S||"."}-`}${u.bitrate}-${w}-${v}-${E}-${L}-${b}`;if(r[R])if(r[R].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const _=o[R]+=1;u.attrs["PATHWAY-ID"]=new Array(_+1).join(".");const N=this.createLevel(u);r[R]=N,n.push(N)}else r[R].addGroupId("audio",d.AUDIO),r[R].addGroupId("text",d.SUBTITLES);else{const _=this.createLevel(u);r[R]=_,o[R]=1,n.push(_)}}),this.filterAndSortMediaOptions(n,t,a,l,c)}createLevel(e){const t=new xn(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(n.message),t.supportedResult=Ch(n,[])}return t}isAudioSupported(e){return xa(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return xa(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,n,r){let o=[],a=[],l=e;if((s||n)&&r&&(l=l.filter(({videoCodec:m,videoRange:x,width:E,height:v})=>(!!m||!!(E&&v))&&sb(x))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let m="no level with compatible codecs found in manifest",x=m;t.levels.length&&(x=`one or more CODECS in variant not supported: ${qe(t.levels.map(v=>v.attrs.CODECS).filter((v,b,S)=>S.indexOf(v)===b))}`,this.warn(x),m+=` (${x})`);const E=new Error(m);this.hls.trigger(y.ERROR,{type:me.MEDIA_ERROR,details:P.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:E,reason:x})}});return}t.audioTracks&&(o=t.audioTracks.filter(m=>!m.audioCodec||this.isAudioSupported(m.audioCodec)),hd(o)),t.subtitles&&(a=t.subtitles,hd(a));const c=l.slice(0);l.sort((m,x)=>{if(m.attrs["HDCP-LEVEL"]!==x.attrs["HDCP-LEVEL"])return(m.attrs["HDCP-LEVEL"]||"")>(x.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&m.height!==x.height)return m.height-x.height;if(m.frameRate!==x.frameRate)return m.frameRate-x.frameRate;if(m.videoRange!==x.videoRange)return kr.indexOf(m.videoRange)-kr.indexOf(x.videoRange);if(m.videoCodec!==x.videoCodec){const E=ru(m.videoCodec),v=ru(x.videoCodec);if(E!==v)return v-E}if(m.uri===x.uri&&m.codecSet!==x.codecSet){const E=Rr(m.codecSet),v=Rr(x.codecSet);if(E!==v)return v-E}return m.averageBitrate!==x.averageBitrate?m.averageBitrate-x.averageBitrate:0});let u=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let m=0;m<c.length;m++)if(c[m].pathwayId===l[0].pathwayId){u=c[m];break}}this._levels=l;for(let m=0;m<l.length;m++)if(l[m]===u){var d;this._firstLevel=m;const x=u.bitrate,E=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${x}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const v=Math.min(x,this.hls.config.abrEwmaDefaultEstimateMax);v>E&&E===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=v)}break}const f=r&&!n,h=this.hls.config,g=!!(h.audioStreamController&&h.audioTrackController),p={levels:l,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:n,altAudio:g&&!f&&o.some(m=>!!m.url)};this.hls.trigger(y.MANIFEST_PARSED,p)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(y.ERROR,{type:me.OTHER_ERROR,details:P.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,n=this.currentLevel,r=n?n.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,s===e&&n&&r===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${s}${r?" with Pathway "+r:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(y.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,n==null?void 0:n.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===Ce.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===de.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(r=>!!s[r]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var s;const{level:n,details:r}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${n}`),(a=t.deliveryDirectives)!=null&&a.skip&&(r.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(n,t,l)}else(s=t.deliveryDirectives)!=null&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(y.LEVEL_LOADING,{url:s,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((r,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(a=>a.level=-1)),!1));Yh(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=s.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(y.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(y.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function hd(i){const e={};i.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function Bg(){return self.SourceBuffer||self.WebKitSourceBuffer}function $g(){if(!js())return!1;const e=Bg();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function t_(){if(!$g())return!1;const i=js();return typeof(i==null?void 0:i.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(vn(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(vn(e,"audio"))))}function s_(){var i;const e=Bg();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const i_=100;class n_ extends yl{constructor(e,t,s){super(e,t,s,"stream-controller",de.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,r=n?n.currentTime:null;if(r===null||!le(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const o=this.getFwdBufferInfoAtPos(n,r,de.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:n}=this;if(this.stopLoad(),this.setInterval(i_),this.level=-1,!this.startFragRequested){let r=n.startLevel;r===-1&&(n.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=n.firstAutoLevel),n.nextLoadLevel=r,this.level=n.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=K.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=K.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case K.WAITING_LEVEL:{const{levels:t,level:s}=this,n=t==null?void 0:t[s],r=n==null?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=K.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=K.IDLE;break}break}case K.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),s=this.retryDate;if(!s||t>=s||(e=this.media)!=null&&e.seeking){const{levels:n,level:r}=this,o=n==null?void 0:n[r];this.resetStartWhenNotLoaded(o||null),this.state=K.IDLE}}break}this.state===K.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[r]))return;const o=s[r],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const p={};this.altAudio===2&&(p.type="video"),this.hls.trigger(y.BUFFER_EOS,p),this.state=K.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const c=o.details;if(!c||this.state===K.WAITING_LEVEL||this.waitForLive(o)){this.level=r,this.state=K.WAITING_LEVEL,this.startFragRequested=!1;return}const u=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(u>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&h&&et(h)&&this.fragmentTracker.getState(h)!==st.OK){var g;const m=((g=this.backtrackFragment)!=null?g:h).sn-c.startSN,x=c.fragments[m-1];x&&h.cc===x.cc&&(h=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const m=this.audioOnly&&!this.altAudio?Ke.AUDIO:Ke.VIDEO,x=(m===Ke.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;x&&this.afterBufferFlushed(x,m,de.MAIN)}h=this.getNextFragmentLoopLoading(h,c,a,de.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,o,f))}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);n===st.NOT_LOADED||n===st.PARTIAL?et(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,de.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<r.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],c=this.fragLastKbps;c&&this.fragCurrent?s=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:s=0}else s=0;const o=this.getBufferedFrag(t.currentTime+s);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,u=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case K.KEY_LOADING:case K.FRAG_LOADING:case K.FRAG_LOADING_WAITING_RETRY:case K.PARSING:case K.PARSED:this.state=K.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Ft(s,"playing",this.onMediaPlaying),Ft(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(Ht(s,"playing",this.onMediaPlaying),Ht(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,n=!1;t.levels.forEach(r=>{const o=r.audioCodec;o&&(s=s||o.indexOf("mp4a.40.2")!==-1,n=n||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=s&&n&&!s_(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==K.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=K.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:n,startFragRequested:r}=this,o=t.level,a=t.details,l=a.totalduration;if(!n){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===K.FRAG_LOADING||this.state===K.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let d=0;if(a.live||(s=c.details)!=null&&s.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(c.details=a,this.levelLastLoaded=c,r||this.setStartPosition(a,d),this.hls.trigger(y.LEVEL_UPDATED,{details:a,level:o}),this.state===K.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=K.IDLE}r&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const n=this.hls.liveSyncPosition,r=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=r>=o-t.maxFragLookUpTolerance&&r<=a;if(n!==null&&s.duration>n&&(r<n||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&s.readyState<4||r<a-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),s.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const d=Ae.bufferInfo(s,n,0);if(!(d!=null&&(c=d.buffered)!=null&&c.length)){s.currentTime=n;return}if(d.start<=r){s.currentTime=n;return}const{nextStart:h}=Ae.bufferedInfo(d.buffered,r,0);h&&(s.currentTime=h)}else s.currentTime=n}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const a=o[s.level];if(!a){this.warn(`Level ${s.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const c=a.videoCodec,u=l.PTSKnown||!l.live,d=(t=s.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new pg(this.hls,de.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=n?n.index:-1,p=g!==-1,m=new ml(s.level,s.sn,s.stats.chunkCount,r.byteLength,g,p),x=this.initPTS[s.cc];h.push(r,d,f,c,s,n,l.totalduration,u,m,x)}onAudioTrackSwitching(e,t){const s=this.hls,n=this.altAudio===2;if(wr(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.fragmentTracker.removeAllFragments(),s.once(y.BUFFER_FLUSHED,()=>{var o;(o=this.hls)==null||o.trigger(y.AUDIO_TRACK_SWITCHED,t)}),s.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(y.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=wr(t.url,this.hls);if(s){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let n,r,o=!1;for(const a in s){const l=s[a];if(l.id==="main"){if(r=a,n=l,a==="video"){const c=s[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&n?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:n}=t,r=s.type===de.MAIN;if(r){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===K.PARSED&&(this.state=K.IDLE);return}const a=n?n.stats:s.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),et(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,n)}const o=this.media;o&&(!this._hasEnoughToStart&&Ae.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=K.ERROR;return}switch(t.details){case P.FRAG_GAP:case P.FRAG_PARSING_ERROR:case P.FRAG_DECRYPT_ERROR:case P.FRAG_LOAD_ERROR:case P.FRAG_LOAD_TIMEOUT:case P.KEY_LOAD_ERROR:case P.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(de.MAIN,t);break;case P.LEVEL_LOAD_ERROR:case P.LEVEL_LOAD_TIMEOUT:case P.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===K.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===Ce.LEVEL&&(this.state=K.IDLE);break;case P.BUFFER_ADD_CODEC_ERROR:case P.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case P.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case P.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=K.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ke.AUDIO||!this.altAudio){const s=(t===Ke.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,de.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&s&&(s+=n);const r=this.getLevelDetails(),o=Ae.getBuffered(e),a=o.length?o.start(0):0,l=a-s,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((r==null?void 0:r.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),s+=l,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${a}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:n}=this,r=s==null?void 0:s.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=K.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=r.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),n.trigger(y.FRAG_LOADED,s),r.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const s=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{video:d,text:f,id3:h,initSegment:g}=r,{details:p}=u,m=this.altAudio?void 0:r.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=K.PARSING,g){if(g!=null&&g.tracks){const b=l.initSegment||l;this._bufferInitSegment(u,g.tracks,b,o),n.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:s,tracks:g.tracks})}const x=g.initPTS,E=g.timescale,v=this.initPTS[l.cc];le(x)&&(!v||v.baseTime!==x||v.timescale!==E)&&(this.initPTS[l.cc]={baseTime:x,timescale:E},n.trigger(y.INIT_PTS_FOUND,{frag:l,id:s,initPTS:x,timescale:E}))}if(d&&p){m&&d.type==="audiovideo"&&this.logMuxedErr(l);const x=p.fragments[l.sn-1-p.startSN],E=l.sn===p.startSN,v=!x||l.cc>x.cc;if(r.independent!==!1){const{startPTS:b,endPTS:S,startDTS:w,endDTS:L}=d;if(c)c.elementaryStreams[d.type]={startPTS:b,endPTS:S,startDTS:w,endDTS:L};else if(d.firstKeyFrame&&d.independent&&o.id===1&&!v&&(this.couldBacktrack=!0),d.dropped&&d.independent){const k=this.getMainFwdBufferInfo(),R=(k?k.end:this.getLoadPosition())+this.config.maxBufferHole,_=d.firstKeyFramePTS?d.firstKeyFramePTS:b;if(!E&&R<_-this.config.maxBufferHole&&!v){this.backtrack(l);return}else v&&(l.gap=!0);l.setElementaryStreamInfo(d.type,l.start,S,l.start,L,!0)}else E&&b-(p.appliedTimelineOffset||0)>gr&&(l.gap=!0);l.setElementaryStreamInfo(d.type,b,S,w,L),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,c,o,E||v)}else if(E||v)l.gap=!0;else{this.backtrack(l);return}}if(m){const{startPTS:x,endPTS:E,startDTS:v,endDTS:b}=m;c&&(c.elementaryStreams[Ke.AUDIO]={startPTS:x,endPTS:E,startDTS:v,endDTS:b}),l.setElementaryStreamInfo(Ke.AUDIO,x,E,v,b),this.bufferFragmentData(m,l,c,o)}if(p&&h!=null&&(t=h.samples)!=null&&t.length){const x={id:s,frag:l,details:p,samples:h.samples};n.trigger(y.FRAG_PARSING_METADATA,x)}if(p&&f){const x={id:s,frag:l,details:p,samples:f.samples};n.trigger(y.FRAG_PARSING_USERDATA,x)}}logMuxedErr(e){this.warn(`${et(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,n){if(this.state!==K.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:o,audiovideo:a}=t;if(r){const c=e.audioCodec;let u=ar(r.codec,c);u==="mp4a"&&(u="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const f=r.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),r.levelCodec=u,r.id=de.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${r.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=de.MAIN;const c=o.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(y.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const d=t[c].initSegment;d!=null&&d.byteLength&&this.hls.trigger(y.BUFFER_APPENDING,{type:c,data:d,frag:s,part:null,chunkMeta:n,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,de.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e==null?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=K.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(Ae.isBuffered(e,s)?t=this.getAppendedFrag(s):Ae.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,r=t.level;(!n||t.sn!==n.sn||n.level!==r)&&(this.fragPlaying=t,this.hls.trigger(y.FRAG_CHANGED,{frag:t}),(!n||n.level!==r)&&this.hls.trigger(y.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return le(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(le(t)){const s=this.getLevelDetails(),n=this.currentFrag||(s?ui(null,s.fragments,t):null);if(n){const r=n.programDateTime;if(r!==null){const o=r+(t-n.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class r_{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyUriToKeyInfo){const n=this.keyUriToKeyInfo[s].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=P.KEY_LOAD_ERROR,s,n,r){return new vs({type:me.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:n})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,r=t.length;n<r;n++){const o=t[n];if(e.cc<=o.cc&&(!et(e)||!et(o)||e.sn<o.sn)||!s&&n==r-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=Aa(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const n=cr(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,n;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,P.KEY_LOAD_ERROR,c))}const o=r.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,P.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if((s=a)!=null&&s.decryptdata.key)return r.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});if((n=a)!=null&&n.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(c=>(r.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[o]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,P.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const n=this.emeController.loadKey(s);if(n)return(e.keyLoadPromise=n.then(r=>(e.mediaKeySessionContext=r,s))).catch(r=>{throw e.keyLoadPromise=null,r})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,n=s.loader,r=new n(s);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=s.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,g,p)=>{const{frag:m,keyInfo:x,url:E}=g;if(!m.decryptdata||x!==this.keyUriToKeyInfo[E])return a(this.createKeyLoadError(m,P.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));x.decryptdata.key=m.decryptdata.key=new Uint8Array(f.data),m.keyLoader=null,x.loader=null,o({frag:m,keyInfo:x})},onError:(f,h,g,p)=>{this.resetLoader(h),a(this.createKeyLoadError(t,P.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),g,Ve({url:l.url,data:void 0},f)))},onTimeout:(f,h,g)=>{this.resetLoader(h),a(this.createKeyLoadError(t,P.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(f,h,g)=>{this.resetLoader(h),a(this.createKeyLoadError(t,P.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};r.load(l,u,d)})}resetLoader(e){const{frag:t,keyInfo:s,url:n}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null),delete this.keyUriToKeyInfo[n],r&&r.destroy()}}function gd(i){const{type:e}=i;switch(e){case Ce.AUDIO_TRACK:return de.AUDIO;case Ce.SUBTITLE_TRACK:return de.SUBTITLE;default:return de.MAIN}}function zo(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class o_{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,n=t.loader,r=s||n,o=new r(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ce.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:n,pathwayId:r,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:s,level:n,pathwayId:r,responseType:"text",type:Ce.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:o,track:a}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:Ce.AUDIO_TRACK,url:r,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:o,track:a}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:Ce.SUBTITLE_TRACK,url:r,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const s=this.loaders[Ce.LEVEL];if(s){const n=s.context;n&&!t.levels.some(r=>r===n.levelOrTrack)&&(s.abort(),delete this.loaders[Ce.LEVEL])}}load(e){var t;const s=this.hls.config;let n=this.getInternalLoader(e);if(n){const c=this.hls.logger,u=n.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let r;if(e.type===Ce.MANIFEST?r=s.manifestLoadPolicy.default:r=Ue({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),le((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===Ce.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===Ce.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===Ce.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const f=Math.max(u*3,d*.8)*1e3;r=Ue({},r,{maxTimeToFirstByteMs:Math.min(f,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,r.maxTimeToFirstByteMs)})}}}const o=r.errorRetry||r.timeoutRetry||{},a={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,u,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const g=c.data;if(g.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,d,new Error("no EXTM3U delimiter"),f||null,u);return}u.parsing.start=performance.now(),as.isMediaPlaylist(g)||d.type!==Ce.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,d,f||null,h):this.handleMasterPlaylist(c,u,d,f)},onError:(c,u,d,f)=>{this.handleNetworkError(u,d,!1,c,f)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}};n.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,n){const r=this.hls,o=e.data,a=zo(e,s),l=as.parseMasterPlaylist(o,a);if(l.playlistParsingError){this.handleManifestParsingError(e,s,l.playlistParsingError,n,t);return}const{contentSteering:c,levels:u,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:g}=l;this.variableList=g;const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":x}=as.parseMasterPlaylistMedia(o,a,l);p.length&&!p.some(v=>!v.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ze({}),bitrate:0,url:""})),r.trigger(y.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:m,captions:x,contentSteering:c,url:a,stats:t,networkDetails:n,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:g})}handleTrackOrLevelPlaylist(e,t,s,n,r){const o=this.hls,{id:a,level:l,type:c}=s,u=zo(e,s),d=le(l)?l:le(a)?a:0,f=gd(s),h=as.parseLevelPlaylist(e.data,u,d,f,0,this.variableList);if(c===Ce.MANIFEST){const g={attrs:new ze({}),bitrate:0,details:h,name:"",url:u};h.requestScheduled=t.loading.start+jh(h,0),o.trigger(y.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=h,this.handlePlaylistLoaded(h,e,t,s,n,r)}handleManifestParsingError(e,t,s,n,r){this.hls.trigger(y.ERROR,{type:me.NETWORK_ERROR,details:P.MANIFEST_PARSING_ERROR,fatal:t.type===Ce.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:n,stats:r})}handleNetworkError(e,t,s=!1,n,r){let o=`A network ${s?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===Ce.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Ce.AUDIO_TRACK||e.type===Ce.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=P.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case Ce.MANIFEST:l=s?P.MANIFEST_LOAD_TIMEOUT:P.MANIFEST_LOAD_ERROR,c=!0;break;case Ce.LEVEL:l=s?P.LEVEL_LOAD_TIMEOUT:P.LEVEL_LOAD_ERROR,c=!1;break;case Ce.AUDIO_TRACK:l=s?P.AUDIO_TRACK_LOAD_TIMEOUT:P.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Ce.SUBTITLE_TRACK:l=s?P.SUBTITLE_TRACK_LOAD_TIMEOUT:P.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const d={type:me.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:r};if(n){const f=(t==null?void 0:t.url)||e.url;d.response=Ve({url:f,data:void 0},n)}this.hls.trigger(y.ERROR,d)}handlePlaylistLoaded(e,t,s,n,r,o){const a=this.hls,{type:l,level:c,id:u,groupId:d,deliveryDirectives:f}=n,h=zo(t,n),g=gd(n),p=typeof n.level=="number"&&g===de.MAIN?c:void 0;if(!e.fragments.length){const x=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(y.ERROR,{type:me.NETWORK_ERROR,details:P.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:x,reason:x.message,response:t,context:n,level:p,parent:g,networkDetails:r,stats:s});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const m=e.playlistParsingError;if(m){if(this.hls.logger.warn(m),!a.config.ignorePlaylistParsingErrors){a.trigger(y.ERROR,{type:me.NETWORK_ERROR,details:P.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:m,reason:m.message,response:t,context:n,level:p,parent:g,networkDetails:r,stats:s});return}e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Ce.MANIFEST:case Ce.LEVEL:a.trigger(y.LEVEL_LOADED,{details:e,levelInfo:n.levelOrTrack||a.levels[0],level:p||0,id:u||0,stats:s,networkDetails:r,deliveryDirectives:f,withoutMultiVariant:l===Ce.MANIFEST});break;case Ce.AUDIO_TRACK:a.trigger(y.AUDIO_TRACK_LOADED,{details:e,track:n.levelOrTrack,id:u||0,groupId:d||"",stats:s,networkDetails:r,deliveryDirectives:f});break;case Ce.SUBTITLE_TRACK:a.trigger(y.SUBTITLE_TRACK_LOADED,{details:e,track:n.levelOrTrack,id:u||0,groupId:d||"",stats:s,networkDetails:r,deliveryDirectives:f});break}}}class Vt{static get version(){return bn}static isMSESupported(){return $g()}static isSupported(){return t_()}static getMediaSource(){return js()}static get Events(){return y}static get MetadataSchema(){return kt}static get ErrorTypes(){return me}static get ErrorDetails(){return P}static get DefaultConfig(){return Vt.defaultConfig?Vt.defaultConfig:HA}static set DefaultConfig(e){Vt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new vl,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=LE(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=jA(Vt.DefaultConfig,e,t);this.userConfig=e,s.progressive&&WA(s,t);const{abrController:n,bufferController:r,capLevelController:o,errorController:a,fpsController:l}=s,c=new a(this),u=this.abrController=new n(this),d=new yb(this),f=s.interstitialsController,h=f?this.interstitialsController=new f(this,Vt):null,g=this.bufferController=new r(this,d),p=this.capLevelController=new o(this),m=new l(this),x=new o_(this),E=s.contentSteeringController,v=E?new E(this):null,b=this.levelController=new e_(this,v),S=new JA(this),w=new r_(this.config),L=this.streamController=new n_(this,d,w),k=this.gapController=new XA(this,d);p.setStreamController(L),m.setStreamController(L);const R=[x,b,L];h&&R.splice(1,0,h),v&&R.splice(1,0,v),this.networkControllers=R;const _=[u,g,k,p,m,S,d];this.audioTrackController=this.createController(s.audioTrackController,R);const N=s.audioStreamController;N&&R.push(this.audioStreamController=new N(this,d,w)),this.subtitleTrackController=this.createController(s.subtitleTrackController,R);const O=s.subtitleStreamController;O&&R.push(this.subtititleStreamController=new O(this,d,w)),this.createController(s.timelineController,_),w.emeController=this.emeController=this.createController(s.emeController,_),this.cmcdController=this.createController(s.cmcdController,_),this.latencyController=this.createController(ZA,_),this.coreComponents=_,R.push(c);const X=c.onErrorOut;typeof X=="function"&&this.on(y.ERROR,X,c),this.on(y.MANIFEST_LOADED,x.onManifestLoaded,x)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,n){this._emitter.off(e,t,s,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const n=e===y.ERROR;this.trigger(y.ERROR,{type:me.OTHER_ERROR,details:P.INTERNAL_EXCEPTION,fatal:n,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(y.ERROR,{type:me.OTHER_ERROR,details:P.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,n=t?e:{media:s};this._media=s,this.trigger(y.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(y.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(y.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,n=this._url=ll.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&s&&(s!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(y.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[de.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[de.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[de.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=XS()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){tb(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let n=0;n<s;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,s)for(let r=n;r--;){const o=e[r].attrs["HDCP-LEVEL"];if(o&&o<=s)return r}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=Oh(t);return Dh(e,s,navigator.mediaCapabilities)}}Vt.defaultConfig=void 0;const a_={class:"bg-white/70 rounded-lg shadow-lg p-6 w-full max-w-md relative border border-white/30 dark:bg-gray-800/70 dark:border-gray-600",style:{"backdrop-filter":"blur(24px) saturate(180%) brightness(1.1)"}},l_={__name:"BaseModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(i,{emit:e}){const t=e;function s(){t("update:modelValue",!1)}return(n,r)=>(M(),cs(wf,{name:"glass-fade"},{default:Ge(()=>[i.modelValue?(M(),B("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",style:{"backdrop-filter":"blur(12px) saturate(160%) brightness(1.1)",background:"rgba(255,255,255,0.12)"},onClick:Is(s,["self"])},[T("div",a_,[T("button",{class:"absolute top-2 right-2 text-gray-400 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-500",onClick:s,"aria-label":"Close"},"  "),zm(n.$slots,"default")])])):ve("",!0)]),_:3}))}},c_={key:0,class:"animate-pulse"},u_={key:1,class:"p-8 text-center"},d_={class:"text-sm text-text-secondary"},f_={key:2},h_={class:"flex items-center gap-3 mb-6 relative"},g_=["src"],m_={class:"flex items-center gap-2"},p_={key:1,class:"font-semibold text-text-main text-base"},y_={key:0,class:"text-text-secondary text-xs mt-0.5"},v_={class:"mb-4"},x_={key:0,class:"flex justify-end mb-2"},E_={class:"relative bg-black rounded-lg overflow-hidden shadow-lg"},b_={key:0,class:"relative w-full aspect-video"},T_=["src"],S_={key:1,class:"relative w-full aspect-video"},A_=["src"],__={key:2,class:"relative w-full bg-surface flex items-center justify-center aspect-video"},L_={class:"text-xl md:text-2xl font-bold text-text-main mb-2 break-words"},R_={class:"flex flex-wrap items-center text-xs text-text-secondary gap-x-3 gap-y-1 mb-4"},I_={key:0,class:"whitespace-nowrap"},k_={key:1,class:"font-bold text-gray-600"},w_=["title"],C_=["href","title"],D_={class:"text-text-secondary"},P_={class:"bg-surface p-4 rounded-lg mb-6 shadow-sm"},O_={key:0,class:"text-text-main whitespace-pre-wrap text-sm"},F_={key:1,class:"text-text-secondary italic text-sm"},M_={class:"mb-2"},N_={key:0,class:"flex flex-wrap gap-2"},B_={key:1,class:"text-text-secondary italic text-xs"},$_={__name:"BookmarkDetailView",setup(i){const e=Zr(),t=ne(!0),s=ne(null),n=ne(null),r=ne(!1),o=ne(null),a=ne(!1),l=ne(null);let c=null;const u=Ye(()=>e.params.id);async function d(){var p,m;t.value=!0,s.value=null;try{const x=await ox(u.value);if(n.value=x,a.value=((p=x.video)==null?void 0:p.player_type)==="iframe",localStorage.getItem("access")){const E=await dt.get(`/videos/${n.value.video.id}/like-status/`);r.value=E.data.is_liked;const v=await dt.get("/profile/me/");o.value=v.data.id}}catch(x){s.value=((m=x==null?void 0:x.response)==null?void 0:m.data)||{message:"Failed to load bookmark details."}}finally{t.value=!1}}fi(d);const f=Ye(()=>{var p,m;try{return new URL(((m=(p=n.value)==null?void 0:p.video)==null?void 0:m.source_url)||"").hostname.replace("www.","")}catch{return null}});function h(p){return new Date(p).toLocaleString()}function g(p){const m=Math.floor((Date.now()-new Date(p).getTime())/1e3);return m<60?`${m}s`:m<3600?`${Math.floor(m/60)}m`:m<86400?`${Math.floor(m/3600)}h`:`${Math.floor(m/86400)}d`}return tt([()=>{var p,m;return(m=(p=n.value)==null?void 0:p.video)==null?void 0:m.embed_url},l,a],([p,m,x])=>{c&&(c.destroy(),c=null),m&&p&&!x&&(p.includes(".m3u8")&&Vt.isSupported()?(c=new Vt,c.loadSource(p),c.attachMedia(m),m.play().catch(()=>{})):m.src=p)}),Wr(()=>{c&&c.destroy()}),(p,m)=>{var E,v,b,S;const x=Ls("router-link");return t.value?(M(),B("div",c_,m[1]||(m[1]=[In('<div class="p-6" data-v-7f72ebba><div class="mb-4 bg-surface rounded-lg aspect-video" data-v-7f72ebba></div><div class="h-8 bg-surface rounded w-3/4 mb-3" data-v-7f72ebba></div><div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-y-3" data-v-7f72ebba><div class="flex flex-wrap items-center gap-x-4 gap-y-1" data-v-7f72ebba><div class="h-5 bg-surface rounded w-16" data-v-7f72ebba></div><div class="h-5 bg-surface rounded w-24" data-v-7f72ebba></div></div></div></div>',1)]))):s.value?(M(),B("div",u_,[m[3]||(m[3]=T("p",{class:"font-medium text-red-400"},"Error Loading Bookmark",-1)),T("p",d_,ue(s.value.message||"Failed to load bookmark details."),1),Se(x,{to:{name:"home"},class:"mt-4 inline-block px-4 py-2 text-sm font-medium rounded-md text-white bg-primary hover:bg-primary/80"},{default:Ge(()=>m[2]||(m[2]=[_e(" Go back home ")])),_:1,__:[2]})])):n.value?(M(),B("div",f_,[T("div",h_,[T("img",{src:((E=n.value.user)==null?void 0:E.avatar_url)||"/media/default.jpg",alt:"User Avatar",class:"w-10 h-10 rounded-full object-cover border border-primary/20"},null,8,g_),T("div",null,[T("div",m_,[(v=n.value.user)!=null&&v.username?(M(),cs(x,{key:0,to:{name:"user-profile",params:{username:n.value.user.username}},class:"font-semibold text-text-main text-base hover:underline"},{default:Ge(()=>[_e(ue(n.value.user.username),1)]),_:1},8,["to"])):(M(),B("span",p_,"Unknown User"))]),(b=n.value.user)!=null&&b.bio?(M(),B("p",y_,ue(n.value.user.bio),1)):ve("",!0)])]),T("div",v_,[n.value.video&&n.value.video.embed_url?(M(),B("div",x_,[T("button",{onClick:m[0]||(m[0]=w=>a.value=!a.value),class:"px-2 py-1 text-xs bg-surface hover:bg-background text-text-secondary rounded"}," Switch to "+ue(a.value?"Direct Player":"Iframe Player"),1)])):ve("",!0),T("div",E_,[n.value.video&&n.value.video.embed_url?(M(),B("div",b_,[a.value?ve("",!0):(M(),B("video",{key:0,ref_key:"videoPlayer",ref:l,controls:"",autoplay:"",muted:"",playsinline:"",class:"absolute top-0 left-0 w-full h-full",title:"Video Player"},null,512)),a.value?(M(),B("iframe",{key:1,src:n.value.video.embed_url,frameborder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowfullscreen:"",class:"absolute top-0 left-0 w-full h-full",title:"Video Player"},null,8,T_)):ve("",!0)])):n.value.video&&n.value.video.thumbnail_url?(M(),B("div",S_,[T("img",{src:n.value.video.thumbnail_url,alt:"Video Thumbnail",class:"absolute top-0 left-0 w-full h-full object-contain bg-background"},null,8,A_)])):(M(),B("div",__,m[4]||(m[4]=[T("div",{class:"absolute top-0 left-0 w-full h-full flex items-center justify-center text-text-secondary"}," No Video Preview Available ",-1)])))])]),T("h1",L_,ue(n.value.title),1),T("div",R_,[n.value.video?(M(),B("span",I_,ue(n.value.video.likes_count??0)+" likes",1)):ve("",!0),n.value.video?(M(),B("span",k_,"")):ve("",!0),T("span",{class:"whitespace-nowrap",title:h(n.value.created_at)},"Bookmarked "+ue(g(n.value.created_at))+" ago",9,w_),f.value&&((S=n.value.video)!=null&&S.source_url)?(M(),B(ke,{key:2},[m[6]||(m[6]=T("span",{class:"font-bold text-gray-600 hidden sm:inline"},"",-1)),T("a",{href:n.value.video.source_url,target:"_blank",rel:"noopener noreferrer",class:"whitespace-nowrap hover:underline text-primary/80",title:`Visit video source on ${f.value}`},[m[5]||(m[5]=_e(" Host: ")),T("strong",D_,ue(f.value),1)],8,C_)],64)):ve("",!0)]),T("div",P_,[m[7]||(m[7]=T("h3",{class:"text-base font-semibold text-text-main mb-1"},"Description",-1)),n.value.description?(M(),B("p",O_,ue(n.value.description),1)):(M(),B("p",F_,"No description provided."))]),T("div",M_,[m[8]||(m[8]=T("h3",{class:"text-base font-semibold text-text-main mb-1"},"Tags",-1)),n.value.tags&&n.value.tags.length>0?(M(),B("div",N_,[(M(!0),B(ke,null,Et(n.value.tags,w=>(M(),cs(x,{key:w.name||w,to:{name:"home",query:{tag:w.name||w}},class:"bg-primary/10 text-primary px-3 py-1 rounded-full text-xs font-medium hover:bg-primary/20 transition"},{default:Ge(()=>[_e(ue(w.name||w),1)]),_:2},1032,["to"]))),128))])):(M(),B("p",B_,"No tags for this bookmark."))])])):ve("",!0)}}},U_=ds($_,[["__scopeId","data-v-7f72ebba"]]),G_={key:0,class:"text-center py-10 text-gray-700 dark:text-gray-300"},V_={key:1,class:"text-center py-10 text-red-500 dark:text-red-400"},H_={key:2,class:"container mx-auto px-4 py-8"},K_={class:"flex flex-col md:flex-row items-center md:items-start mb-8"},j_=["src"],W_={class:"text-center md:text-left w-full flex-grow"},q_={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2"},Y_={class:"text-3xl font-bold text-gray-800 dark:text-gray-200 mb-2 sm:mb-0 flex items-center"},z_={key:0,class:"ml-2",title:"Verified Subscriber"},X_={key:0,class:"text-gray-600 dark:text-gray-400 mb-4 break-words text-sm"},Q_={class:"flex flex-wrap justify-center md:justify-start gap-x-4 sm:gap-x-6 gap-y-2 my-4 text-sm"},J_={class:"font-semibold text-gray-800 dark:text-gray-200"},Z_={class:"font-semibold text-gray-800 dark:text-gray-200"},eL={class:"font-semibold text-gray-800 dark:text-gray-200 group-hover:underline"},tL={class:"font-semibold text-gray-800 dark:text-gray-200 group-hover:underline"},sL={class:"mb-12"},iL={class:"border-b border-gray-200 dark:border-gray-700"},nL={class:"flex space-x-8 py-3","aria-label":"Tabs"},rL=["onClick"],oL={class:"mt-6"},aL={class:"flex items-center gap-1 py-1 px-1 rounded-md bg-gray-50 dark:bg-gray-800 w-full sm:w-auto mb-4"},lL={class:"flex items-center gap-1 py-1 px-1 rounded-md bg-gray-50 dark:bg-gray-800 w-full sm:w-auto mb-4"},cL={key:0},uL={key:0,class:"text-center py-10"},dL={key:1,class:"text-center py-10 text-red-500"},fL={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"},hL=["onClick"],gL={class:"w-full h-32 bg-gray-200 flex items-center justify-center overflow-hidden"},mL=["src","alt"],pL={key:1,class:"text-3xl font-semibold text-gray-500"},yL={class:"p-4"},vL={class:"text-lg font-semibold text-gray-800 truncate group-hover:text-indigo-600"},xL={key:3,class:"text-center py-10 text-gray-500"},EL={key:1},bL={class:"text-xl font-bold mb-4"},TL={key:0,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"},SL=["onClick"],AL={class:"w-full h-24 bg-gray-200 flex items-center justify-center overflow-hidden"},_L=["src","alt"],LL={key:1,class:"text-2xl font-semibold text-gray-500"},RL={class:"p-4"},IL={class:"text-base font-semibold text-gray-800 truncate group-hover:text-indigo-600"},kL={key:1,class:"text-center py-10 text-gray-500"},wL={key:2},CL={class:"text-xl font-bold mb-4"},DL={class:"mb-4"},PL={key:0,class:"mt-2"},OL=["src"],FL={class:"mb-4"},ML={class:"mb-4"},NL={class:"mb-4"},BL=["value"],$L={class:"mb-4"},UL={class:"flex flex-col gap-2"},GL={class:"inline-flex items-center"},VL={class:"inline-flex items-center"},HL={class:"inline-flex items-center"},KL={class:"inline-flex items-center"},jL={class:"flex justify-end"},WL={__name:"UserProfileView",setup(i){const e=Zr(),t=Ni(),s=ne(e.params.username),n=ne(null),r=ne(!0),o=ne(""),a=ne(!1),l=ne({bio:"",default_bookmark_orientation:"",default_bookmark_collection:"",notify_on_follow:!0,notify_on_own_video_bookmarked:!0,notify_on_new_bookmark_from_followed_user:!0,notify_on_own_video_liked:!0}),c=ne(null),u=ne(null),d=ne("bookmarks"),f=["bookmarks","liked","collections"],h=ne([]),g=ne(!1),p=ne(""),m=ne(null),x=ne(null),E=ne({user:s.value}),v=ne({liked_by:s.value}),b=ne({}),S=al(),w=ne(1),L=Ye(()=>({...E.value,...S.selectedOrientation!=="all"?{orientation:S.selectedOrientation}:{}})),k=Ye(()=>({...v.value,...S.selectedOrientation!=="all"?{orientation:S.selectedOrientation}:{}})),R=Ye(()=>({...b.value,...S.selectedOrientation!=="all"?{orientation:S.selectedOrientation}:{}}));function _(F){return F.charAt(0).toUpperCase()+F.slice(1)}function N(F){d.value=F,F!=="collections"&&(m.value=null,x.value=null)}function O(F){m.value=F,x.value=null}function X(F){x.value=F}const te=async(F={})=>await nr({...F,user:s.value,page:w.value}),re=async(F={})=>await nr({...F,liked_by:s.value}),q=async(F={})=>x.value?await nr({...F,channel:x.value.id,user:s.value}):{results:[],count:0};tt(x,F=>{b.value=F?{channel:F.id,user:s.value}:{}}),tt(()=>e.params.username,async F=>{s.value=F,E.value={user:F},v.value={liked_by:F},m.value=null,x.value=null,await Z()}),tt(()=>e.query,F=>{F.page&&(w.value=Number(F.page))}),tt(w,F=>{t.replace({query:{...e.query,page:F}})});const z=Ye(()=>{if(typeof window<"u"&&window.localStorage){const F=window.localStorage.getItem("username");return Es.value&&F&&F.toLowerCase()===s.value.toLowerCase()}return!1});async function j(){var F;if(z.value)try{const V=localStorage.getItem("access"),xe=await Xe.get("/api/collections/",{headers:{Authorization:`Bearer ${V}`}});h.value=xe.data||[]}catch{h.value=[]}l.value={bio:n.value.bio||"",default_bookmark_orientation:n.value.default_bookmark_orientation||"",default_bookmark_collection:((F=n.value.default_bookmark_collection)==null?void 0:F.id)||n.value.default_bookmark_collection||"",notify_on_follow:n.value.notify_on_follow??!0,notify_on_own_video_bookmarked:n.value.notify_on_own_video_bookmarked??!0,notify_on_new_bookmark_from_followed_user:n.value.notify_on_new_bookmark_from_followed_user??!0,notify_on_own_video_liked:n.value.notify_on_own_video_liked??!0},c.value=n.value.avatar_url||null,u.value=null,a.value=!0}async function he(){try{const F=new FormData;Object.entries(l.value).forEach(([xe,Q])=>F.append(xe,Q??"")),u.value&&F.append("avatar",u.value);const V=await fx(F);n.value={...n.value,...V},a.value=!1}catch{a.value=!1}}function fe(F){const V=F.target.files[0];V&&(u.value=V,c.value=URL.createObjectURL(V))}async function Z(){r.value=!0,o.value="";try{let F;z.value?F=await dx():F=await ux(s.value),n.value=F,h.value=F.collections||[]}catch(F){o.value=(F==null?void 0:F.detail)||"Failed to load profile."}finally{r.value=!1}}return fi(Z),(F,V)=>{var xe;return r.value?(M(),B("div",G_,"Loading profile...")):o.value?(M(),B("div",V_,"Error loading profile.")):n.value?(M(),B("div",H_,[T("div",K_,[T("img",{src:n.value.avatar_url||F.defaultAvatar,alt:"User avatar",class:"h-24 w-24 md:h-32 md:w-32 aspect-square rounded-full object-cover mb-4 md:mb-0 md:mr-8 border-2 border-gray-300 dark:border-gray-600 flex-shrink-0"},null,8,j_),T("div",W_,[T("div",q_,[T("h1",Y_,[_e(ue(n.value.username)+" ",1),n.value.is_verified?(M(),B("span",z_,V[16]||(V[16]=[T("svg",{class:"w-5 h-5 text-blue-500 dark:text-blue-300 inline",fill:"currentColor",viewBox:"0 0 20 20"},[T("circle",{cx:"10",cy:"10",r:"10",fill:"#3b82f6"}),T("path",{d:"M7.5 10.5l2 2 3-4",stroke:"#fff","stroke-width":"1.5",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))):ve("",!0)]),z.value?(M(),B("button",{key:0,class:"px-4 py-2 bg-indigo-600 text-white rounded shadow hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600 transition font-semibold text-sm",onClick:j}," Edit Profile ")):ve("",!0)]),n.value.bio?(M(),B("p",X_,ue(n.value.bio),1)):ve("",!0),T("div",Q_,[T("div",{onClick:V[0]||(V[0]=Q=>N("bookmarks")),class:"cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors"},[T("span",J_,ue(n.value.bookmarks_count??0),1),V[17]||(V[17]=T("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"Bookmarks",-1))]),T("div",{onClick:V[1]||(V[1]=Q=>N("liked")),class:"cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors"},[T("span",Z_,ue(n.value.likes_count??0),1),V[18]||(V[18]=T("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"Likes",-1))]),T("div",{onClick:V[2]||(V[2]=Q=>F.showUserListModal("followers")),class:"cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors group"},[T("span",eL,ue(n.value.followers_count??0),1),V[19]||(V[19]=T("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"Followers",-1))]),T("div",{onClick:V[3]||(V[3]=Q=>F.showUserListModal("following")),class:"cursor-pointer hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors group"},[T("span",tL,ue(n.value.following_count??0),1),V[20]||(V[20]=T("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"Following",-1))])])])]),T("div",sL,[T("div",iL,[T("nav",nL,[(M(),B(ke,null,Et(f,Q=>T("button",{key:Q,onClick:Ee=>N(Q),class:Kt([d.value===Q?"border-indigo-500 text-indigo-600 dark:border-indigo-400 dark:text-indigo-300":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},ue(_(Q)),11,rL)),64))])]),T("div",oL,[d.value==="bookmarks"?(M(),B(ke,{key:0},[T("div",aL,[V[21]||(V[21]=T("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 hidden sm:inline pl-2"},"Filter:",-1)),Se(rr)]),Se(or,{fetchBookmarks:te,filters:L.value,showPagination:!0,currentPage:w.value,"onUpdate:page":V[4]||(V[4]=Q=>w.value=Q)},null,8,["filters","currentPage"])],64)):d.value==="liked"?(M(),B(ke,{key:1},[T("div",lL,[V[22]||(V[22]=T("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 hidden sm:inline pl-2"},"Filter:",-1)),Se(rr)]),Se(or,{fetchBookmarks:re,filters:k.value,showPagination:!0},null,8,["filters"])],64)):d.value==="collections"?(M(),B(ke,{key:2},[!m.value&&!x.value?(M(),B("div",cL,[g.value?(M(),B("div",uL,"Loading collections...")):p.value?(M(),B("div",dL,"Failed to load collections.")):h.value.length>0?(M(),B("div",fL,[(M(!0),B(ke,null,Et(h.value,Q=>(M(),B("div",{key:Q.id,class:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer overflow-hidden group block",onClick:Ee=>O(Q)},[T("div",gL,[Q.display_image_url?(M(),B("img",{key:0,src:Q.display_image_url,alt:Q.name,class:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"},null,8,mL)):(M(),B("span",pL,ue(Q.name.charAt(0).toUpperCase()),1))]),T("div",yL,[T("h3",vL,ue(Q.name),1),T("p",{class:Kt(["text-sm mt-1 truncate h-10",Q.description?"text-gray-600 ":"text-gray-400 "])},ue(Q.description||"No description available"),3)])],8,hL))),128))])):(M(),B("div",xL,"No collections found."))])):m.value&&!x.value?(M(),B("div",EL,[T("button",{onClick:V[5]||(V[5]=Q=>m.value=null),class:"mb-4 text-indigo-600 hover:underline flex items-center"},V[23]||(V[23]=[T("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[T("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1),_e(" Back to Collections ")])),T("h2",bL,ue(m.value.name),1),(xe=m.value.channels)!=null&&xe.length?(M(),B("div",TL,[(M(!0),B(ke,null,Et(m.value.channels,Q=>(M(),B("div",{key:Q.id,class:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer overflow-hidden group block",onClick:Ee=>X(Q)},[T("div",AL,[Q.imageUrl?(M(),B("img",{key:0,src:Q.imageUrl,alt:Q.name,class:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"},null,8,_L)):(M(),B("span",LL,ue(Q.name.charAt(0).toUpperCase()),1))]),T("div",RL,[T("h3",IL,ue(Q.name),1),T("p",{class:Kt(["text-sm mt-1 truncate h-8",Q.description?"text-gray-600 ":"text-gray-400 "])},ue(Q.description||"No description available"),3)])],8,SL))),128))])):(M(),B("div",kL,"No channels found in this collection."))])):x.value?(M(),B("div",wL,[T("button",{onClick:V[6]||(V[6]=Q=>x.value=null),class:"mb-4 text-indigo-600 hover:underline flex items-center"},V[24]||(V[24]=[T("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[T("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19l-7-7 7-7"})],-1),_e(" Back to Channels ")])),T("h2",CL,ue(x.value.name),1),Se(rr,{class:"mb-4"}),Se(or,{fetchBookmarks:q,filters:R.value,showPagination:!0},null,8,["filters"])])):ve("",!0)],64)):ve("",!0)])]),Se(l_,{modelValue:a.value,"onUpdate:modelValue":V[15]||(V[15]=Q=>a.value=Q)},{default:Ge(()=>[V[37]||(V[37]=T("h2",{class:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200"},"Edit Profile",-1)),T("form",{onSubmit:Is(he,["prevent"])},[T("div",DL,[V[25]||(V[25]=T("label",{class:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300"},"Avatar",-1)),T("input",{type:"file",accept:"image/*",onChange:fe,class:"block w-full text-sm text-gray-700 dark:text-gray-300"},null,32),c.value?(M(),B("div",PL,[T("img",{src:c.value,alt:"Avatar Preview",class:"h-20 w-20 rounded-full object-cover border dark:border-gray-600"},null,8,OL)])):ve("",!0)]),T("div",FL,[V[26]||(V[26]=T("label",{class:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300"},"Bio",-1)),Be(T("textarea",{"onUpdate:modelValue":V[7]||(V[7]=Q=>l.value.bio=Q),class:"w-full px-3 py-2 border rounded dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},null,512),[[ot,l.value.bio]])]),T("div",ML,[V[28]||(V[28]=T("label",{class:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300"},"Default Bookmark Orientation",-1)),Be(T("select",{"onUpdate:modelValue":V[8]||(V[8]=Q=>l.value.default_bookmark_orientation=Q),class:"w-full px-3 py-2 border rounded dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},V[27]||(V[27]=[T("option",{value:""},"None",-1),T("option",{value:"straight"},"Straight",-1),T("option",{value:"gay"},"Gay",-1),T("option",{value:"bi"},"Bi",-1),T("option",{value:"trans"},"Trans",-1),T("option",{value:"sfw"},"SFW",-1)]),512),[[si,l.value.default_bookmark_orientation]])]),T("div",NL,[V[30]||(V[30]=T("label",{class:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300"},"Default Bookmark Collection",-1)),Be(T("select",{"onUpdate:modelValue":V[9]||(V[9]=Q=>l.value.default_bookmark_collection=Q),class:"w-full px-3 py-2 border rounded dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},[V[29]||(V[29]=T("option",{value:""},"None",-1)),(M(!0),B(ke,null,Et(h.value,Q=>(M(),B("option",{key:Q.id,value:Q.id},ue(Q.name),9,BL))),128))],512),[[si,l.value.default_bookmark_collection]])]),T("div",$L,[V[35]||(V[35]=T("label",{class:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300"},"Notification Preferences",-1)),T("div",UL,[T("label",GL,[Be(T("input",{type:"checkbox","onUpdate:modelValue":V[10]||(V[10]=Q=>l.value.notify_on_follow=Q),class:"mr-2 dark:bg-gray-800 dark:border-gray-600"},null,512),[[Mn,l.value.notify_on_follow]]),V[31]||(V[31]=_e("Notify on Follow"))]),T("label",VL,[Be(T("input",{type:"checkbox","onUpdate:modelValue":V[11]||(V[11]=Q=>l.value.notify_on_own_video_bookmarked=Q),class:"mr-2 dark:bg-gray-800 dark:border-gray-600"},null,512),[[Mn,l.value.notify_on_own_video_bookmarked]]),V[32]||(V[32]=_e("Notify on Own Video Bookmarked"))]),T("label",HL,[Be(T("input",{type:"checkbox","onUpdate:modelValue":V[12]||(V[12]=Q=>l.value.notify_on_new_bookmark_from_followed_user=Q),class:"mr-2 dark:bg-gray-800 dark:border-gray-600"},null,512),[[Mn,l.value.notify_on_new_bookmark_from_followed_user]]),V[33]||(V[33]=_e("Notify on New Bookmark from Followed User"))]),T("label",KL,[Be(T("input",{type:"checkbox","onUpdate:modelValue":V[13]||(V[13]=Q=>l.value.notify_on_own_video_liked=Q),class:"mr-2 dark:bg-gray-800 dark:border-gray-600"},null,512),[[Mn,l.value.notify_on_own_video_liked]]),V[34]||(V[34]=_e("Notify on Own Video Liked"))])])]),T("div",jL,[T("button",{type:"button",class:"mr-2 px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",onClick:V[14]||(V[14]=Q=>a.value=!1)},"Cancel"),V[36]||(V[36]=T("button",{type:"submit",class:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600"},"Save",-1))])],32)]),_:1,__:[37]},8,["modelValue"])])):ve("",!0)}}},qL=ds(WL,[["__scopeId","data-v-6f781ae2"]]),YL=["value"],zL=["value"],XL=["disabled"],QL=["value"],JL=["value"],ZL=["disabled"],eR={key:0},tR={key:1},sR={key:2},iR={__name:"BookmarkManual",props:{initialData:{type:Object,default:()=>({})},useIframe:{type:Boolean,default:!1},submissionError:{type:[String,Object],default:null}},emits:["update:formData","submit"],setup(i,{emit:e}){const t=i,s=ne(!1),n=ne([]),r=ne([]),o=ne(!1),a=ne(!1),l=ne(null),c=li({source_url:"",title:"",thumbnail_url:"",embed_url:"",orientation:null,tags:[]}),u=li({channel:null,description:"",access:null}),d=ne(""),f=[{value:"straight",label:"Straight"},{value:"gay",label:"Gay"},{value:"bi",label:"Bi"},{value:"trans",label:"Trans"},{value:"sfw",label:"SFW"}],h=[{value:"public",label:"Public"},{value:"private",label:"Private"}],g=e;tt([c,u,d],()=>{g("update:formData",{video:{...c},bookmark:{...u},tags:d.value.split(",").map(E=>E.trim()).filter(Boolean)})},{deep:!0}),tt(()=>t.initialData,E=>{E&&(c.source_url=E.source_url||"",c.title=E.title||"",c.thumbnail_url=E.thumbnail_url||"",c.embed_url=E.embed_url||"",u.description=E.description||"",E.tags&&E.tags.length>0?d.value=E.tags.join(", "):d.value="")},{immediate:!0,deep:!0}),fi(async()=>{await p()}),tt(l,async E=>{E?await m(E):r.value=[]});async function p(){o.value=!0;try{const E=await dt.get("/collections/");n.value=E.data}catch{n.value=[]}finally{o.value=!1}}async function m(E){a.value=!0;try{const v=await dt.get(`/collections/${E}/channels/`);r.value=v.data}catch{r.value=[]}finally{a.value=!1}}function x(){const E={video:{source_url:c.source_url,title:c.title,thumbnail_url:c.thumbnail_url,embed_url:c.embed_url,orientation:c.orientation,player_type:t.useIframe?"iframe":"direct",tags:d.value.split(",").map(v=>v.trim()).filter(Boolean)},bookmark:{channel_id:u.channel,description:u.description,access:u.access,tags:d.value.split(",").map(v=>v.trim()).filter(Boolean)}};g("submit",E)}return(E,v)=>(M(),B("div",null,[T("form",{onSubmit:Is(x,["prevent"]),class:"bg-surface p-6 rounded shadow space-y-6"},[T("div",null,[v[10]||(v[10]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"video-source-url"},"Source URL",-1)),Be(T("input",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main placeholder-text-secondary",type:"url",id:"video-source-url","onUpdate:modelValue":v[0]||(v[0]=b=>c.source_url=b),placeholder:"https://example.com/video.mp4",required:""},null,512),[[ot,c.source_url]])]),T("div",null,[v[11]||(v[11]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"video-thumbnail-url"},"Thumbnail URL",-1)),Be(T("input",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main placeholder-text-secondary",type:"url",id:"video-thumbnail-url","onUpdate:modelValue":v[1]||(v[1]=b=>c.thumbnail_url=b),placeholder:"https://example.com/thumbnail.jpg",required:""},null,512),[[ot,c.thumbnail_url]])]),T("div",null,[v[12]||(v[12]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"video-embed-url"},"Embed URL",-1)),Be(T("input",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main placeholder-text-secondary",type:"url",id:"video-embed-url","onUpdate:modelValue":v[2]||(v[2]=b=>c.embed_url=b),placeholder:"https://example.com/embed/video",required:""},null,512),[[ot,c.embed_url]])]),T("div",null,[v[13]||(v[13]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"video-title"},"Video Title",-1)),Be(T("input",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main placeholder-text-secondary",type:"text",id:"video-title","onUpdate:modelValue":v[3]||(v[3]=b=>c.title=b),placeholder:"Title of the video",required:""},null,512),[[ot,c.title]])]),T("div",null,[v[15]||(v[15]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"video-orientation"},"Orientation",-1)),Be(T("select",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main",id:"video-orientation","onUpdate:modelValue":v[4]||(v[4]=b=>c.orientation=b),required:""},[v[14]||(v[14]=T("option",{value:null,disabled:""},"-- Select Orientation --",-1)),(M(),B(ke,null,Et(f,b=>T("option",{key:b.value,value:b.value},ue(b.label),9,YL)),64))],512),[[si,c.orientation]])]),T("div",null,[v[16]||(v[16]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"tags"},"Tags (comma-separated)",-1)),Be(T("input",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main placeholder-text-secondary",type:"text",id:"tags","onUpdate:modelValue":v[5]||(v[5]=b=>d.value=b),placeholder:"tag1, tag2, another tag"},null,512),[[ot,d.value]])]),T("div",null,[v[18]||(v[18]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"bookmark-collection"},"Collection",-1)),Be(T("select",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main",id:"bookmark-collection","onUpdate:modelValue":v[6]||(v[6]=b=>l.value=b),required:""},[v[17]||(v[17]=T("option",{value:null,disabled:""},"-- Select Collection --",-1)),(M(!0),B(ke,null,Et(n.value,b=>(M(),B("option",{key:b.id,value:b.id},ue(b.name),9,zL))),128))],512),[[si,l.value]])]),T("div",null,[v[20]||(v[20]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"bookmark-channel"},"Channel",-1)),Be(T("select",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main",id:"bookmark-channel","onUpdate:modelValue":v[7]||(v[7]=b=>u.channel=b),required:"",disabled:!l.value},[v[19]||(v[19]=T("option",{value:null,disabled:""},"-- Select Channel --",-1)),(M(!0),B(ke,null,Et(r.value,b=>(M(),B("option",{key:b.id,value:b.id},ue(b.name),9,QL))),128))],8,XL),[[si,u.channel]])]),T("div",null,[v[21]||(v[21]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"bookmark-description"},"Description",-1)),Be(T("textarea",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main",id:"bookmark-description","onUpdate:modelValue":v[8]||(v[8]=b=>u.description=b),rows:"3"},null,512),[[ot,u.description]])]),T("div",null,[v[22]||(v[22]=T("label",{class:"block mb-1 font-medium text-text-secondary",for:"bookmark-access"},"Access",-1)),Be(T("select",{class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-background text-text-main",id:"bookmark-access","onUpdate:modelValue":v[9]||(v[9]=b=>u.access=b),required:""},[(M(),B(ke,null,Et(h,b=>T("option",{key:b.value,value:b.value},ue(b.label),9,JL)),64))],512),[[si,u.access]])]),T("button",{type:"submit",class:Kt(["w-full py-2 px-4 text-white font-semibold rounded shadow disabled:opacity-50 transition",i.submissionError?"bg-red-500 hover:bg-red-600":"bg-primary hover:bg-primary/80"]),disabled:s.value},[s.value?(M(),B("span",eR,"Saving...")):i.submissionError?(M(),B("span",tR,ue(i.submissionError),1)):(M(),B("span",sR,"Save Bookmark & Video"))],10,ZL)],32)]))}},nR=ds(iR,[["__scopeId","data-v-45ae95aa"]]),rR={class:"sticky top-4"},oR={key:0,class:"text-center py-10 text-gray-500 dark:text-gray-400"},aR={key:1,class:"max-w-full mx-auto"},lR={class:"mb-4"},cR={key:0,class:"flex justify-end mb-2"},uR={class:"bg-black rounded-lg overflow-hidden shadow-lg"},dR={key:0,class:"relative w-full aspect-video"},fR=["src"],hR={key:1,class:"relative w-full aspect-video"},gR=["src"],mR={key:2,class:"relative w-full bg-gray-700 flex items-center justify-center aspect-video dark:bg-gray-800"},pR={class:"mb-4"},yR={key:0,class:"w-full flex justify-center"},vR=["src"],xR={key:1,class:"text-text-secondary italic text-sm text-center"},ER={class:"text-2xl font-bold text-text-main mb-3 break-words overflow-hidden"},bR={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 text-sm text-text-secondary gap-y-2"},TR={class:"flex flex-wrap items-center gap-x-3 gap-y-1"},SR={class:"whitespace-nowrap"},AR={class:"text-text-main"},_R={class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-primary/10 text-primary"},LR={class:"flex items-center gap-2"},RR=["href","aria-disabled"],IR={class:"bg-surface p-4 rounded-lg mb-6 shadow-sm"},kR={key:0,class:"text-text-main whitespace-pre-wrap text-sm"},wR={key:1,class:"text-text-secondary italic text-sm"},CR={key:0,class:"mb-6"},DR={class:"text-text-secondary"},PR={__name:"BookmarkManualPreview",props:{videoData:{type:Object,default:()=>({})},bookmarkData:{type:Object,default:()=>({})},tagsArray:{type:[Array,String],default:()=>[]},channelName:{type:String,default:""},useIframe:{type:Boolean,default:!1}},emits:["update:useIframe"],setup(i,{emit:e}){const t=i,s=Ye(()=>Array.isArray(t.tagsArray)?t.tagsArray:typeof t.tagsArray=="string"?t.tagsArray.split(",").map(a=>a.trim()).filter(Boolean):[]),n=Ye(()=>t.videoData&&(t.videoData.title||t.videoData.source_url||t.videoData.thumbnail_url)),r=ne(null);let o=null;return tt([()=>t.videoData.embed_url,r,()=>t.useIframe],([a,l,c])=>{o&&(o.destroy(),o=null),l&&a&&!c&&(a.includes(".m3u8")&&Vt.isSupported()?(o=new Vt,o.loadSource(a),o.attachMedia(l),l.play().catch(()=>{})):l.src=a)}),Wr(()=>{o&&o.destroy()}),(a,l)=>(M(),B("div",rR,[n.value?(M(),B("div",aR,[T("div",lR,[i.videoData.embed_url?(M(),B("div",cR,[T("button",{onClick:l[0]||(l[0]=c=>a.$emit("update:useIframe",!t.useIframe)),class:"px-2 py-1 text-xs bg-surface hover:bg-background text-text-secondary rounded"}," Switch to "+ue(t.useIframe?"Direct Player":"Iframe Player"),1)])):ve("",!0),T("div",uR,[i.videoData.embed_url?(M(),B("div",dR,[i.useIframe?ve("",!0):(M(),B("video",{key:0,ref_key:"videoPlayer",ref:r,controls:"",autoplay:"",muted:"",playsinline:"",class:"absolute top-0 left-0 w-full h-full",title:"Video Preview"},null,512)),i.useIframe?(M(),B("iframe",{key:1,src:i.videoData.embed_url,frameborder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowfullscreen:"",class:"absolute top-0 left-0 w-full h-full",title:"Video Preview"},null,8,fR)):ve("",!0)])):i.videoData.thumbnail_url?(M(),B("div",hR,[T("img",{src:i.videoData.thumbnail_url,alt:"Video Thumbnail Preview",class:"absolute top-0 left-0 w-full h-full object-contain bg-gray-800 dark:bg-gray-700"},null,8,gR)])):(M(),B("div",mR,l[3]||(l[3]=[T("div",{class:"absolute top-0 left-0 w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-500"}," No Video Preview Available ",-1)])))])]),T("div",pR,[l[4]||(l[4]=T("h3",{class:"text-md font-semibold text-text-main mb-2"},"Thumbnail Preview",-1)),i.videoData.thumbnail_url?(M(),B("div",yR,[T("img",{src:i.videoData.thumbnail_url,alt:"Thumbnail Preview",class:"max-h-48 rounded shadow border border-gray-600 bg-surface object-contain",style:{"max-width":"100%"}},null,8,vR)])):(M(),B("div",xR,"No thumbnail provided."))]),T("h1",ER,ue(i.videoData.title||"Video Title Preview"),1),T("div",bR,[T("div",TR,[l[7]||(l[7]=T("span",{class:"whitespace-nowrap"},[_e("Added by "),T("strong",{class:"italic text-text-main"},"You")],-1)),l[8]||(l[8]=T("span",{class:"text-gray-500"},"|",-1)),T("span",SR,[l[5]||(l[5]=_e("Channel: ")),T("strong",AR,ue(i.channelName||"Selected Channel"),1)]),l[9]||(l[9]=T("span",{class:"text-gray-500"},"|",-1)),l[10]||(l[10]=T("span",{class:"whitespace-nowrap italic"},"Just now",-1)),i.videoData.orientation?(M(),B(ke,{key:0},[l[6]||(l[6]=T("span",{class:"text-gray-500"},"|",-1)),T("span",_R,ue(i.videoData.orientation),1)],64)):ve("",!0)]),T("div",LR,[l[11]||(l[11]=T("span",{class:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-text-secondary bg-surface opacity-50 cursor-not-allowed"}," Save ",-1)),T("a",{href:i.videoData.source_url||"#",target:"_blank",rel:"noopener noreferrer",class:Kt(["inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md",i.videoData.source_url?"text-primary bg-primary/10 hover:bg-primary/20 cursor-pointer":"text-text-secondary bg-surface opacity-50 cursor-not-allowed"]),"aria-disabled":!i.videoData.source_url,onClick:l[1]||(l[1]=Is(c=>!i.videoData.source_url,["prevent"]))}," View Source ",10,RR)])]),T("div",IR,[l[12]||(l[12]=T("h3",{class:"text-lg font-semibold text-text-main mb-2"},"Description",-1)),i.bookmarkData.description?(M(),B("p",kR,ue(i.bookmarkData.description),1)):(M(),B("p",wR,"Description preview will appear here."))]),s.value.length>0?(M(),B("div",CR,[l[13]||(l[13]=T("span",{class:"font-semibold text-text-main"},"Tags:",-1)),T("span",DR,ue(s.value.join(", ")),1)])):ve("",!0)])):(M(),B("div",oR,l[2]||(l[2]=[T("p",null,"Fill the form to see a preview.",-1)])))]))}},OR=ds(PR,[["__scopeId","data-v-6481afc5"]]),FR={class:"container mx-auto px-4 py-6"},MR={key:0,class:"mb-6"},NR={class:"flex gap-2"},BR=["disabled"],$R=["disabled"],UR={key:0},GR={key:1},VR={key:0,class:"text-red-400 text-sm mt-1"},HR={key:1,class:"animate-fade-in"},KR={key:0,class:"mb-6"},jR=["value"],WR={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},qR={key:1,class:"bg-surface p-6 rounded shadow flex flex-col items-center justify-center text-center"},YR={class:"flex gap-4"},zR={__name:"CreateBookmarkView",setup(i){Ni();const e=ne(""),t=ne(!1),s=ne(!1),n=ne(null),r=ne([]),o=ne(!1),a=ne(!1),l=ne(null),c=ne({}),u=ne({video:{},bookmark:{},tags:[],channelName:""});async function d(){var p,m;t.value=!0,s.value=!1,n.value=null;try{const x=await lx(e.value);r.value=x.embed_url_options||[],c.value={source_url:e.value,title:x.title,description:x.description,thumbnail_url:x.thumbnail_url,embed_url:x.embed_url,tags:x.tags||[]},s.value=!0}catch(x){n.value=((m=(p=x.response)==null?void 0:p.data)==null?void 0:m.error)||"Failed to fetch metadata from the URL."}finally{t.value=!1}}function f(p){u.value={...u.value,...p},l.value&&(l.value=null)}async function h(p){var m,x,E;l.value=null;try{await cx(p),a.value=!0}catch(v){l.value=((x=(m=v.response)==null?void 0:m.data)==null?void 0:x.detail)||((E=v.response)==null?void 0:E.data)||"An unknown error occurred."}}function g(){a.value=!1,s.value=!1,e.value="",c.value={},u.value={video:{},bookmark:{},tags:[],channelName:""}}return(p,m)=>{const x=Ls("router-link");return M(),B("div",FR,[m[8]||(m[8]=T("h1",{class:"text-2xl font-semibold mb-6 text-text-main"},"Add New Bookmark",-1)),a.value?ve("",!0):(M(),B("div",MR,[m[3]||(m[3]=T("label",{for:"sourceUrl",class:"block text-sm font-medium text-text-secondary mb-1"},"Video URL",-1)),T("div",NR,[Be(T("input",{id:"sourceUrl","onUpdate:modelValue":m[0]||(m[0]=E=>e.value=E),type:"url",placeholder:"Enter the URL of the video you want to bookmark...",class:"w-full px-3 py-2 border border-gray-600 rounded shadow-sm focus:outline-none focus:ring focus:border-primary bg-surface text-text-main placeholder-text-secondary",disabled:t.value},null,8,BR),[[ot,e.value]]),T("button",{onClick:d,disabled:!e.value||t.value,class:"px-4 py-2 bg-primary text-white rounded hover:bg-primary/80 transition disabled:opacity-50"},[t.value?(M(),B("span",GR,"Fetching...")):(M(),B("span",UR,"Fetch Details"))],8,$R)]),n.value?(M(),B("p",VR,ue(n.value),1)):ve("",!0)])),s.value?(M(),B("div",HR,[r.value.length>1?(M(),B("div",KR,[m[4]||(m[4]=T("label",{for:"embedUrlSelect",class:"block text-sm font-medium text-text-secondary mb-1"},"Multiple embed URLs found. Please select the best one:",-1)),Be(T("select",{id:"embedUrlSelect","onUpdate:modelValue":m[1]||(m[1]=E=>c.value.embed_url=E),class:"block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring focus:border-primary bg-surface text-text-main"},[(M(!0),B(ke,null,Et(r.value,E=>(M(),B("option",{key:E,value:E},ue(E),9,jR))),128))],512),[[si,c.value.embed_url]])])):ve("",!0),T("div",WR,[a.value?ve("",!0):(M(),cs(nR,{key:0,"initial-data":c.value,"use-iframe":o.value,"submission-error":l.value,"onUpdate:formData":f,onSubmit:h},null,8,["initial-data","use-iframe","submission-error"])),a.value?(M(),B("div",qR,[m[6]||(m[6]=T("h2",{class:"text-2xl font-bold text-green-400 mb-4"},"Bookmark Saved!",-1)),m[7]||(m[7]=T("p",{class:"text-text-secondary mb-6"},"Your video has been successfully added to your collection.",-1)),T("div",YR,[T("button",{onClick:g,class:"px-4 py-2 bg-primary/20 text-primary rounded hover:bg-primary/30 transition"},"Add Another Bookmark"),Se(x,{to:{name:"home"},class:"px-4 py-2 bg-surface hover:bg-background text-text-main rounded transition"},{default:Ge(()=>m[5]||(m[5]=[_e("Go to Homepage")])),_:1,__:[5]})])])):ve("",!0),Se(OR,{"use-iframe":o.value,"onUpdate:useIframe":m[2]||(m[2]=E=>o.value=E),videoData:u.value.video,bookmarkData:u.value.bookmark,tagsArray:u.value.tags,channelName:u.value.channelName},null,8,["use-iframe","videoData","bookmarkData","tagsArray","channelName"])])])):ve("",!0)])}}},XR=ds(zR,[["__scopeId","data-v-6084d629"]]),QR={class:"container mx-auto px-4 py-10 max-w-2xl"},JR={__name:"Careers",setup(i){return(e,t)=>(M(),B("div",QR,t[0]||(t[0]=[In('<h1 class="text-3xl font-bold mb-6 text-blue-700 text-center dark:text-blue-300">Careers at MyVidVault</h1><p class="mb-8 text-gray-700 text-center dark:text-gray-300"> MyVidVault is a growing platform for video bookmarking and sharing. We&#39;re currently seeking passionate volunteers to help us build and moderate our community. If you want to make a difference and gain experience, we&#39;d love to hear from you! </p><div class="space-y-8"><section class="bg-white rounded-lg shadow p-6 dark:bg-gray-800"><h2 class="text-xl font-semibold mb-2 text-indigo-700 dark:text-indigo-400">Volunteer Django Developer</h2><p class="mb-2 text-gray-700 dark:text-gray-300"> Help us expand and maintain our backend, built with Django and Django REST Framework. You&#39;ll work on new features, bug fixes, and integrations. </p><ul class="list-disc pl-6 mb-2 text-gray-600 dark:text-gray-400"><li>Experience with Django (REST Framework a plus)</li><li>Familiarity with MySQL</li><li>Comfortable with Git and collaborative development</li></ul><p class="text-sm text-gray-500 dark:text-gray-400"> Time commitment: Flexible, remote. All contributions are credited. </p></section><section class="bg-white rounded-lg shadow p-6 dark:bg-gray-800"><h2 class="text-xl font-semibold mb-2 text-indigo-700 dark:text-indigo-400">Volunteer Vue Developer</h2><p class="mb-2 text-gray-700 dark:text-gray-300"> Join our frontend team to build beautiful, responsive user experiences with Vue. You&#39;ll help design and implement new features and improve usability. </p><ul class="list-disc pl-6 mb-2 text-gray-600 dark:text-gray-400"><li>Experience with Vue.js</li><li>Familiarity with REST APIs and modern JavaScript</li><li>UI/UX sensibility and attention to detail</li></ul><p class="text-sm text-gray-500 dark:text-gray-400"> Time commitment: Flexible, remote. All contributions are credited. </p></section><section class="bg-white rounded-lg shadow p-6 dark:bg-gray-800"><h2 class="text-xl font-semibold mb-2 text-indigo-700 dark:text-indigo-400">Volunteer Moderators</h2><p class="mb-2 text-gray-700 dark:text-gray-300"> Help keep MyVidVault a safe and welcoming community. As a moderator, you&#39;ll review reports, enforce guidelines, and support users. </p><ul class="list-disc pl-6 mb-2 text-gray-600 dark:text-gray-400"><li>Strong sense of fairness and responsibility</li><li>Good communication skills</li><li>Familiarity with online communities a plus</li></ul><p class="text-sm text-gray-500 dark:text-gray-400"> Time commitment: Flexible, remote. All contributions are credited. </p></section></div><div class="mt-10 text-center"><h3 class="text-lg font-semibold mb-2 text-blue-700 dark:text-blue-300">Interested?</h3><p class="mb-2 text-gray-700 dark:text-gray-300"> Email us at <a href="mailto:myvidvault506@gmail.com" class="text-blue-600 underline dark:text-blue-400">myvidvault506@gmail.com</a> with your background, interests, and how you&#39;d like to help! </p><p class="text-xs text-gray-500 dark:text-gray-400"> These are volunteer positions until we generate revenue. Early contributors will be first in line for future paid roles. </p></div>',4)])))}},ZR={class:"text-center py-12"},eI={__name:"ContactView",setup(i){return(e,t)=>(M(),B("div",ZR,t[0]||(t[0]=[T("h2",{class:"text-2xl font-semibold mb-6 text-gray-800 dark:text-gray-200"},"Contact Us",-1),T("div",{class:"mb-6 text-gray-600 dark:text-gray-400"},[_e(" Our contact form is currently unavailable."),T("br"),_e(" Please email us directly at "),T("a",{href:"mailto:myvidvault506@gmail.com",class:"text-indigo-600 underline dark:text-indigo-400"},"myvidvault506@gmail.com")],-1)])))}},tI=ds(eI,[["__scopeId","data-v-1dfb1dfe"]]),sI={key:0,class:"text-red-500 text-xs mt-1"},iI={key:1,class:"text-red-500 text-xs mt-1"},nI=["disabled"],rI={class:"mt-4 text-center text-sm text-gray-700 dark:text-gray-300"},oI={__name:"ForgotPasswordView",setup(i){const e=ne(""),t=ne(!1),s=ne(""),n=ne(!1),r=ne({email:[],detail:[]});async function o(){var a;if(t.value=!0,s.value="",n.value=!1,r.value={email:[],detail:[]},!e.value){r.value.email.push("Email is required."),t.value=!1;return}try{await hx(e.value),s.value="If an account with that email exists, a password reset link has been sent.",n.value=!1,e.value=""}catch(l){if(n.value=!0,(a=l.response)!=null&&a.data){const c=l.response.data;r.value={...r.value,...c}}else r.value.detail.push("An error occurred. Please try again.")}finally{t.value=!1}}return(a,l)=>{const c=Ls("router-link");return M(),B(ke,null,[l[3]||(l[3]=T("h1",{class:"text-2xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200"},"Forgot Password",-1)),T("form",{onSubmit:Is(o,["prevent"]),class:"space-y-4"},[T("div",null,[l[1]||(l[1]=T("label",{for:"email",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Email Address",-1)),Be(T("input",{type:"email",id:"email","onUpdate:modelValue":l[0]||(l[0]=u=>e.value=u),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500"},null,512),[[ot,e.value]]),r.value.email?(M(),B("p",sI,ue(r.value.email.join(", ")),1)):ve("",!0)]),s.value?(M(),B("div",{key:0,class:Kt([n.value?"text-red-500":"text-green-500","text-sm"])},ue(s.value),3)):ve("",!0),r.value.detail?(M(),B("p",iI,ue(r.value.detail.join(", ")),1)):ve("",!0),T("div",null,[T("button",{type:"submit",disabled:t.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 dark:bg-indigo-500 dark:hover:bg-indigo-600"},ue(t.value?"Sending...":"Send Password Reset Email"),9,nI)])],32),T("div",rI,[Se(c,{to:{name:"login"},class:"text-indigo-600 hover:underline dark:text-indigo-400"},{default:Ge(()=>l[2]||(l[2]=[_e(" Back to Login ")])),_:1,__:[2]})])],64)}}},aI={key:0,class:"text-red-500 text-sm"},lI={class:"flex items-center justify-end mt-2 text-sm"},cI=["disabled"],uI={class:"text-center text-sm mt-4 text-gray-700 dark:text-gray-300"},dI={__name:"LoginView",setup(i){const e=ne(""),t=ne(""),s=ne(!1),n=ne(!1),r=ne(""),o=Ni();async function a(){var l,c;if(s.value=!0,n.value=!1,r.value="",!e.value||!t.value){n.value=!0,r.value="Username and password are required.",s.value=!1;return}try{const u=await xh(e.value,t.value);localStorage.setItem("username",e.value),Lr(),o.push({name:"home"})}catch(u){n.value=!0,r.value=((c=(l=u.response)==null?void 0:l.data)==null?void 0:c.detail)||"Login failed. Please try again."}finally{s.value=!1}}return(l,c)=>{const u=Ls("router-link");return M(),B(ke,null,[c[7]||(c[7]=T("h1",{class:"text-2xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200"},"Login",-1)),T("form",{onSubmit:Is(a,["prevent"]),class:"space-y-4"},[T("div",null,[c[2]||(c[2]=T("label",{for:"username",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Username",-1)),Be(T("input",{type:"text",id:"username","onUpdate:modelValue":c[0]||(c[0]=d=>e.value=d),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},null,512),[[ot,e.value]])]),T("div",null,[c[3]||(c[3]=T("label",{for:"password",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Password",-1)),Be(T("input",{type:"password",id:"password","onUpdate:modelValue":c[1]||(c[1]=d=>t.value=d),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},null,512),[[ot,t.value]])]),n.value?(M(),B("div",aI,ue(r.value),1)):ve("",!0),T("div",lI,[Se(u,{to:{name:"forgot-password"},class:"font-medium text-indigo-600 hover:text-indigo-500 dark:text-indigo-400 dark:hover:text-indigo-300"},{default:Ge(()=>c[4]||(c[4]=[_e(" Forgot your password? ")])),_:1,__:[4]})]),T("div",null,[T("button",{type:"submit",disabled:s.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 dark:bg-indigo-500 dark:hover:bg-indigo-600"},ue(s.value?"Logging in...":"Login"),9,cI)]),T("div",uI,[c[6]||(c[6]=_e(" Don't have an account? ")),Se(u,{to:{name:"register"},class:"text-indigo-600 hover:underline dark:text-indigo-400"},{default:Ge(()=>c[5]||(c[5]=[_e("Register here")])),_:1,__:[5]})])],32)],64)}}},fI={__name:"PrivacyView",setup(i){return(e,t)=>t[0]||(t[0]=In('<h1 class="text-3xl font-bold mb-8 text-blue-700 text-center dark:text-blue-300">MyVidVault Privacy Policy</h1><div class="prose max-w-none text-gray-800 dark:text-gray-200"><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Our Privacy Principles</h2><ul class="list-disc pl-6"><li>We dont ask for personal information unless we truly need it.</li><li>We dont share your information unless its to provide a service, comply with the law, or protect our rights.</li><li>We dont store personal data unless necessary for operating our services.</li></ul></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">What This Policy Covers</h2><p> This Privacy Policy applies to the use of Myvidvault.com and all services provided under the Myvidvault brand (Platform). It describes how we collect, use, and safeguard personally identifiable information (Personal Information), such as your email address, IP address, or usage data. </p><p> Myvidvault is not intended for users under 18, and we do not knowingly collect data from children. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Information We Collect</h2><p>When you register for an account or use the Platform, we may collect:</p><ul class="list-disc pl-6"><li>Email address (for account creation and communication)</li><li>IP address</li><li>Browser information and request logs</li><li>Cookies and usage data</li><li>Content you share or bookmark on the platform</li></ul><p>We may use Google Analytics and other tools to analyze anonymized, aggregated traffic patterns.</p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">IP Addresses</h2><p>We may use IP addresses for:</p><ul class="list-disc pl-6"><li>Diagnosing service issues</li><li>Estimating user locations for content or advertising relevance</li><li>Preventing abuse (e.g. cheating in contests)</li><li>Analytics reporting to improve our services</li></ul></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Cookies</h2><p>Cookies are small files sent to your browser to identify your session.</p><p>We use cookies to:</p><ul class="list-disc pl-6"><li>Enable login and session persistence</li><li>Save user preferences</li><li>Measure traffic and usage trends</li><li>Enable integration with external posting services</li><li>Improve overall service quality</li></ul></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Third-Party Data Matching</h2><p> We may share hashed, non-human-readable versions of your email address with trusted third-party partners for analytics or personalized advertising. No personally identifiable data is shared without your explicit consent. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Sharing and Disclosure</h2><p>We do not sell or rent your Personal Information.</p><p>We may disclose your data under these conditions:</p><ul class="list-disc pl-6"><li>To comply with legal requests such as subpoenas or court orders</li><li>To investigate, prevent, or act against illegal activities or threats</li><li>To protect our rights, systems, and users</li><li>During a merger, acquisition, or other change of control</li><li>With your consent</li></ul><p> Public content (comments, bookmarks, profiles, etc.) may be visible to other users and the public. Be cautious when posting personal information. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Communications</h2><p>We may send:</p><ul class="list-disc pl-6"><li>Administrative messages related to your account</li><li>Notifications from other users (e.g., messages or comments)</li><li>Opt-in marketing or newsletter emails (if you choose to receive them)</li></ul><p>You can manage preferences or unsubscribe at any time.</p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Account Editing and Deletion</h2><p>You may update or delete your account from your settings page at any time.</p><ul class="list-disc pl-6"><li>Some data may remain in backups or logs for legal or operational reasons.</li><li>We may retain IP or usage data as permitted by law.</li></ul></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Data Security</h2><p> We use commercially reasonable security practices, including SSL encryption where applicable, to protect your data. However, no method of transmission is 100% secure. You share information at your own risk. </p><p> If a data breach occurs, we will notify users through the Platform or email when legally required. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Business Transfers</h2><p> If Myvidvault is acquired, merged, or enters bankruptcy, your data may be transferred as part of the business assets. You will be notified and provided with updated privacy terms where required. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Changes to This Policy</h2><p> We may update this Privacy Policy periodically. When we do, well update the Effective Date above and notify you of any material changes. </p><p> Your continued use of the Platform means you accept the revised policy. For materially less restrictive changes, we will seek your consent if required by law. </p></section><section><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">Contact</h2><p> If you have questions or concerns about your privacy, data usage, or this policy, contact us at:<br><a href="mailto:myvidvault506@gmail.com" class="text-blue-600 dark:text-blue-400">myvidvault506@gmail.com</a></p></section></div>',2))}},hI={key:0,class:"mb-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-md dark:bg-green-900 dark:border-green-700"},gI={class:"flex"},mI={class:"ml-3"},pI={class:"mt-2 text-green-700 dark:text-green-400"},yI={key:0,class:"text-base"},vI={class:"block mt-2 font-semibold"},xI={key:1,class:"text-base"},EI={key:1},bI={key:0,class:"bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-4 dark:bg-red-900 dark:border-red-700 dark:text-red-300",role:"alert"},TI={class:"mt-2 list-disc list-inside"},SI=["disabled"],AI={key:0,class:"inline-flex items-center"},_I={key:1},LI={class:"text-center text-sm text-gray-700 dark:text-gray-300"},RI={key:2,class:"space-y-4 mt-6"},II={key:0,class:"flex flex-col space-y-4"},kI={key:1,class:"flex flex-col space-y-4"},wI={__name:"RegisterView",setup(i){const e=ne(""),t=ne(""),s=ne(""),n=ne(""),r=ne(!1),o=ne(!1),a=ne([]),l=ne(!1),c=ne(!1),u=ne(5);let d=null;const f=Ni();function h(){return a.value=[],e.value||a.value.push("Username is required."),t.value||a.value.push("Email is required."),s.value||a.value.push("Password is required."),s.value!==n.value&&a.value.push("Passwords do not match."),a.value.length===0}async function g(){var E;if(r.value=!0,o.value=!1,a.value=[],!h()){o.value=!0,r.value=!1;return}try{await rx(e.value,t.value,s.value,n.value),l.value=!0;try{await xh(e.value,s.value),c.value=!0,Lr(),p()}catch{c.value=!1}}catch(v){if(o.value=!0,(E=v.response)!=null&&E.data){const b=v.response.data;a.value=Object.values(b).flat()}else a.value=["Registration failed. Please try again."]}finally{r.value=!1}}function p(){u.value=5,d=setInterval(()=>{u.value--,u.value<=0&&(clearInterval(d),x())},1e3)}function m(){f.push({name:"login"})}function x(){f.push({name:"home"})}return(E,v)=>{const b=Ls("router-link");return M(),B(ke,null,[l.value?(M(),B("div",hI,[T("div",gI,[v[6]||(v[6]=T("div",{class:"flex-shrink-0"},[T("svg",{class:"h-6 w-6 text-green-500 dark:text-green-300",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[T("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),T("div",mI,[v[5]||(v[5]=T("h3",{class:"text-lg font-medium text-green-800 dark:text-green-300"},"Registration successful!",-1)),T("div",pI,[c.value?(M(),B("p",yI,[v[4]||(v[4]=_e(" Your account has been created and you're now logged in! ")),T("span",vI," Redirecting to home page in "+ue(u.value)+" seconds... ",1)])):(M(),B("p",xI," Your account has been created. Please log in with your credentials. "))])])])])):ve("",!0),l.value?ve("",!0):(M(),B("div",EI,[v[15]||(v[15]=T("h1",{class:"text-2xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200"},"Register",-1)),T("form",{onSubmit:Is(g,["prevent"]),class:"space-y-4"},[T("div",null,[v[7]||(v[7]=T("label",{for:"username",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Username",-1)),Be(T("input",{type:"text",id:"username","onUpdate:modelValue":v[0]||(v[0]=S=>e.value=S),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},null,512),[[ot,e.value]])]),T("div",null,[v[8]||(v[8]=T("label",{for:"email",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Email",-1)),Be(T("input",{type:"email",id:"email","onUpdate:modelValue":v[1]||(v[1]=S=>t.value=S),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},null,512),[[ot,t.value]])]),T("div",null,[v[9]||(v[9]=T("label",{for:"password",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Password",-1)),Be(T("input",{type:"password",id:"password","onUpdate:modelValue":v[2]||(v[2]=S=>s.value=S),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},null,512),[[ot,s.value]])]),T("div",null,[v[10]||(v[10]=T("label",{for:"password2",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Confirm Password",-1)),Be(T("input",{type:"password",id:"password2","onUpdate:modelValue":v[3]||(v[3]=S=>n.value=S),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},null,512),[[ot,n.value]])]),o.value&&a.value.length>0?(M(),B("div",bI,[v[11]||(v[11]=T("strong",{class:"font-bold"},"Registration error:",-1)),T("ul",TI,[(M(!0),B(ke,null,Et(a.value,(S,w)=>(M(),B("li",{key:w},ue(S),1))),128))])])):ve("",!0),T("div",null,[T("button",{type:"submit",disabled:r.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 dark:bg-indigo-500 dark:hover:bg-indigo-600"},[r.value?(M(),B("span",AI,v[12]||(v[12]=[T("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[T("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),T("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),_e(" Registering... ")]))):(M(),B("span",_I,"Register"))],8,SI)]),T("div",LI,[v[14]||(v[14]=_e(" Already have an account? ")),Se(b,{to:{name:"login"},class:"text-indigo-600 hover:underline dark:text-indigo-400"},{default:Ge(()=>v[13]||(v[13]=[_e("Login here")])),_:1,__:[13]})])],32)])),l.value?(M(),B("div",RI,[c.value?(M(),B("div",kI,[T("button",{onClick:x,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," Continue to Home Now ")])):(M(),B("div",II,[T("button",{onClick:m,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," Go to Login ")]))])):ve("",!0)],64)}}},CI=ds(wI,[["__scopeId","data-v-a4e32dd3"]]),DI={key:0,class:"text-red-500 text-xs mt-1"},PI={key:0,class:"text-red-500 text-xs mt-1"},OI={key:0,class:"text-red-500 text-sm"},FI={key:1,class:"text-red-500 text-xs mt-1"},MI={key:2,class:"text-red-500 text-xs mt-1"},NI={key:3,class:"text-red-500 text-xs mt-1"},BI=["disabled"],$I={key:1,class:"text-green-500 text-sm text-center py-4"},UI={class:"mt-4"},GI={key:2,class:"text-red-500 text-sm text-center py-4"},md={__name:"ResetPasswordConfirmView",setup(i){const e=Zr(),t=ne(""),s=ne(""),n=ne(!1),r=ne(""),o=ne(""),a=ne({new_password1:[],new_password2:[],uidb64:[],token:[],detail:[]}),l=ne(!0);let c="",u="";fi(()=>{c=e.params.uidb64||e.query.uidb64||"",u=e.params.token||e.query.token||"",(!c||!u)&&(l.value=!1,o.value="Invalid password reset link.")});async function d(){var f;if(n.value=!0,o.value="",a.value={new_password1:[],new_password2:[],uidb64:[],token:[],detail:[]},t.value||a.value.new_password1.push("New password is required."),s.value||a.value.new_password2.push("Please confirm your new password."),t.value&&s.value&&t.value!==s.value&&a.value.new_password2.push("Passwords do not match."),a.value.new_password1.length||a.value.new_password2.length){n.value=!1;return}try{await gx({uidb64:c,token:u,new_password1:t.value,new_password2:s.value}),r.value="Your password has been reset successfully!",l.value=!1}catch(h){if((f=h.response)!=null&&f.data){const g=h.response.data;a.value={...a.value,...g},g.detail&&(o.value=g.detail.join?g.detail.join(" "):g.detail)}else a.value.detail.push("An error occurred. Please try again.");l.value=!0}finally{n.value=!1}}return(f,h)=>{const g=Ls("router-link");return M(),B(ke,null,[h[8]||(h[8]=T("h1",{class:"text-2xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200"},"Reset Password",-1)),!r.value&&l.value?(M(),B("form",{key:0,onSubmit:Is(d,["prevent"]),class:"space-y-4"},[T("div",null,[h[2]||(h[2]=T("label",{for:"new_password1",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"New Password",-1)),Be(T("input",{type:"password",id:"new_password1","onUpdate:modelValue":h[0]||(h[0]=p=>t.value=p),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},null,512),[[ot,t.value]]),a.value.new_password1?(M(),B("p",DI,ue(a.value.new_password1.join(", ")),1)):ve("",!0)]),T("div",null,[h[3]||(h[3]=T("label",{for:"new_password2",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Confirm New Password",-1)),Be(T("input",{type:"password",id:"new_password2","onUpdate:modelValue":h[1]||(h[1]=p=>s.value=p),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200"},null,512),[[ot,s.value]]),a.value.new_password2?(M(),B("p",PI,ue(a.value.new_password2.join(", ")),1)):ve("",!0)]),o.value?(M(),B("div",OI,ue(o.value),1)):ve("",!0),a.value.uidb64?(M(),B("p",FI,ue(a.value.uidb64.join(", ")),1)):ve("",!0),a.value.token?(M(),B("p",MI,ue(a.value.token.join(", ")),1)):ve("",!0),a.value.detail?(M(),B("p",NI,ue(a.value.detail.join(", ")),1)):ve("",!0),T("div",null,[T("button",{type:"submit",disabled:n.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 dark:bg-indigo-500 dark:hover:bg-indigo-600"},ue(n.value?"Resetting...":"Reset Password"),9,BI)])],32)):ve("",!0),r.value?(M(),B("div",$I,[_e(ue(r.value)+" ",1),T("div",UI,[Se(g,{to:{name:"login"},class:"text-indigo-600 hover:underline dark:text-indigo-400"},{default:Ge(()=>h[4]||(h[4]=[_e(" Proceed to Login ")])),_:1,__:[4]})])])):ve("",!0),!l.value&&!r.value?(M(),B("div",GI,[T("p",null,ue(o.value||"The password reset link is invalid or has expired."),1),T("p",null,[h[6]||(h[6]=_e(" Please ")),Se(g,{to:{name:"forgot-password"},class:"text-indigo-600 hover:underline dark:text-indigo-400"},{default:Ge(()=>h[5]||(h[5]=[_e(" request a new one ")])),_:1,__:[5]}),h[7]||(h[7]=_e(". "))])])):ve("",!0)],64)}}},VI={__name:"TermsView",setup(i){return(e,t)=>t[0]||(t[0]=In('<h1 class="text-3xl font-bold mb-8 text-blue-700 text-center dark:text-blue-300">MyVidVault Terms of Service</h1><div class="prose max-w-none text-gray-800 dark:text-gray-200"><section class="mb-6"><p> Welcome to <strong>MyVidVault</strong>, a video bookmarking platform (&quot;MyVidVault&quot;, &quot;we&quot;, &quot;us&quot;, or &quot;our&quot;). By using our website, mobile application, and related services (collectively, the Platform), you agree to these Terms of Service (&quot;Terms&quot;). If you do not agree, you may not use the Platform. </p><p><strong>Please read these Terms carefully, as they form a legally binding agreement between you and MyVidVault.</strong></p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">1. Modifications to Terms and Platform</h2><p> We reserve the right to change these Terms or modify the Platform at any time. Updates will be posted here or otherwise communicated. Continued use of the Platform after changes means you accept the revised Terms. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">2. Description of Service</h2><p> MyVidVault allows users to collect, bookmark, organize, and share links to third-party video content hosted externally. MyVidVault does not host or stream any video files on its servers. </p><p> Use of the Platform may include access to third-party content and websites, which you access at your own risk. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">3. Eligibility</h2><p> You must be at least 18 years old or the age of majority in your jurisdiction to use the Platform. If you are under 18, you may not access or use the Platform. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">4. Account Registration</h2><p> To use certain features, you must create an account. You agree to provide accurate information and to safeguard your login credentials. You are responsible for all activity under your account. Notify us immediately of any unauthorized use. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">5. Acceptable Use</h2><ul class="list-disc pl-6"><li>Use the Platform for any illegal or unauthorized purpose;</li><li>Bookmark or share content that is obscene, violent, defamatory, harassing, or otherwise unlawful;</li><li>Violate any copyright or other proprietary rights;</li><li>Attempt to interfere with the Platforms functionality or security;</li><li>Scrape or collect data from the Platform without our prior consent.</li></ul><p> You agree that MyVidVault may remove content or terminate accounts at its sole discretion for violations of these Terms. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">6. Content Ownership and Licensing</h2><p> All third-party content remains the property of its respective owners. MyVidVault does not claim ownership or control over content linked to by users. </p><p> By sharing bookmarks, you confirm that: </p><ul class="list-disc pl-6"><li>The content is publicly accessible;</li><li>You have the legal right to share it;</li><li>It does not violate any law or intellectual property rights.</li></ul></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">7. Copyright &amp; DMCA Compliance</h2><p> MyVidVault respects copyright law and complies with the Digital Millennium Copyright Act (DMCA). If you believe content linked on our platform infringes your copyright, please submit a proper takedown notice to: </p><p> Email: <a href="mailto:myvidvault506@gmail.com" class="text-blue-600">myvidvault506@gmail.com</a></p><p> We will investigate and may remove the material or disable access in response. </p><p> Counter-notifications may be submitted per DMCA guidelines if you believe your content was wrongfully removed. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">8. Third-Party Content</h2><ul class="list-disc pl-6"><li>Third-party videos are not created or hosted by MyVidVault;</li><li>We do not guarantee the accuracy, legality, or reliability of third-party content;</li><li>We are not responsible for the policies or content of external sites.</li></ul></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">9. Adult Content Policy</h2><p> Users must flag all bookmarks containing adult material. MyVidVault has a zero-tolerance policy for child pornography or any content involving minors, and will permanently ban any user found to be in violation. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">10. Privacy</h2><p> Your use of the Platform is subject to our Privacy Policy which governs how we collect, use, and disclose your data. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">11. Termination</h2><p> We may suspend or terminate your access at any time, for any reason, including violations of these Terms. Upon termination, your right to use the Platform ends immediately. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">12. Disclaimers</h2><p><strong>THE PLATFORM IS PROVIDED &quot;AS IS&quot; WITHOUT WARRANTIES OF ANY KIND.</strong> WE DO NOT GUARANTEE: </p><ul class="list-disc pl-6"><li>CONTINUOUS OR ERROR-FREE OPERATION;</li><li>ACCURACY OR RELIABILITY OF CONTENT;</li><li>THAT THE PLATFORM WILL BE FREE OF VIRUSES OR MALICIOUS SOFTWARE.</li></ul><p class="italic">Your use is at your own risk.</p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">13. Limitation of Liability</h2><p> TO THE MAXIMUM EXTENT PERMITTED BY LAW, MYVIDVAULT SHALL NOT BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, OR CONSEQUENTIAL DAMAGES, EVEN IF ADVISED OF THE POSSIBILITY. OUR TOTAL LIABILITY TO YOU WILL NOT EXCEED $100. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2">14. Indemnity</h2><p> You agree to indemnify and hold harmless MyVidVault, its owners, affiliates, and employees from any claims, damages, or expenses arising from: </p><ul class="list-disc pl-6"><li>Your use of the Platform;</li><li>Your violation of these Terms;</li><li>Your violation of any third-party rights.</li></ul></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">15. Governing Law</h2><p> These Terms are governed by the laws of the State of <span class="italic">[Insert State]</span>, without regard to conflict of law principles. Any disputes will be resolved in the state or federal courts located in <span class="italic">[Insert Jurisdiction]</span>. </p></section><section class="mb-6"><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">16. General Provisions</h2><ul class="list-disc pl-6 text-gray-800 dark:text-gray-200"><li>These Terms represent the entire agreement between you and MyVidVault;</li><li>If any provision is held invalid, the remaining terms remain enforceable;</li><li>We may assign our rights under these Terms without notice to you.</li></ul></section><section><h2 class="text-2xl font-semibold mt-8 mb-2 text-gray-800 dark:text-gray-200">17. Contact</h2><p> For questions or concerns, contact:<br> Email: <a href="mailto:myvidvault506@gmail.com" class="text-blue-600 dark:text-blue-400">myvidvault506@gmail.com</a></p></section></div>',2))}},HI=[{path:"/",name:"home",component:yE},{path:"/bookmarks/:id",name:"bookmark-detail",component:U_,props:!0},{path:"/careers",name:"careers",component:JR},{path:"/contact",name:"contact",component:tI},{path:"/forgot-password",name:"forgot-password",component:oI},{path:"/login",name:"login",component:dI},{path:"/privacy",name:"privacy",component:fI},{path:"/register",name:"register",component:CI},{path:"/reset-password/:uidb64/:token",name:"reset-password-confirm",component:md,props:!0},{path:"/reset-password-confirm",name:"reset-password-confirm-query",component:md},{path:"/terms",name:"terms",component:VI},{path:"/users/:username",name:"user-profile",component:qL,props:!0},{path:"/bookmarks/create",name:"CreateBookmark",component:XR,meta:{requiresAuth:!0}}],KI=Ly({history:ty(),routes:HI}),wl=m0(Gx);wl.use(v0());wl.use(KI);wl.mount("#app");
